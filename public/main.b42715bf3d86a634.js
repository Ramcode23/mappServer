(self.webpackChunkMapapp=self.webpackChunkMapapp||[]).push([[179],{355:(xi,Nn,it)=>{"use strict";var Ln={};function at(e){return"function"==typeof e}function ln(e){const r=e(a=>{Error.call(a),a.stack=(new Error).stack});return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}it.r(Ln),it.d(Ln,{Decoder:()=>yv,Encoder:()=>BM,PacketType:()=>an,protocol:()=>zM});const d=ln(e=>function(r){e(this),this.message=r?`${r.length} errors occurred during unsubscription:\n${r.map((a,u)=>`${u+1}) ${a.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=r});function At(e,t){if(e){const r=e.indexOf(t);0<=r&&e.splice(r,1)}}class Bt{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:r}=this;if(r)if(this._parentage=null,Array.isArray(r))for(const g of r)g.remove(this);else r.remove(this);const{initialTeardown:a}=this;if(at(a))try{a()}catch(g){t=g instanceof d?g.errors:[g]}const{_teardowns:u}=this;if(u){this._teardowns=null;for(const g of u)try{De(g)}catch(b){t=null!=t?t:[],b instanceof d?t=[...t,...b.errors]:t.push(b)}}if(t)throw new d(t)}}add(t){var r;if(t&&t!==this)if(this.closed)De(t);else{if(t instanceof Bt){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._teardowns=null!==(r=this._teardowns)&&void 0!==r?r:[]).push(t)}}_hasParent(t){const{_parentage:r}=this;return r===t||Array.isArray(r)&&r.includes(t)}_addParent(t){const{_parentage:r}=this;this._parentage=Array.isArray(r)?(r.push(t),r):r?[r,t]:t}_removeParent(t){const{_parentage:r}=this;r===t?this._parentage=null:Array.isArray(r)&&At(r,t)}remove(t){const{_teardowns:r}=this;r&&At(r,t),t instanceof Bt&&t._removeParent(this)}}Bt.EMPTY=(()=>{const e=new Bt;return e.closed=!0,e})();const Sn=Bt.EMPTY;function Ie(e){return e instanceof Bt||e&&"closed"in e&&at(e.remove)&&at(e.add)&&at(e.unsubscribe)}function De(e){at(e)?e():e.unsubscribe()}const nt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ui={setTimeout(...e){const{delegate:t}=ui;return((null==t?void 0:t.setTimeout)||setTimeout)(...e)},clearTimeout(e){const{delegate:t}=ui;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function na(e){ui.setTimeout(()=>{const{onUnhandledError:t}=nt;if(!t)throw e;t(e)})}function vo(){}const yn=Vo("C",void 0,void 0);function Vo(e,t,r){return{kind:e,value:t,error:r}}let ni=null;function bi(e){if(nt.useDeprecatedSynchronousErrorHandling){const t=!ni;if(t&&(ni={errorThrown:!1,error:null}),e(),t){const{errorThrown:r,error:a}=ni;if(ni=null,r)throw a}}else e()}class xo extends Bt{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,Ie(t)&&t.add(this)):this.destination=_s}static create(t,r,a){return new Uo(t,r,a)}next(t){this.isStopped?Va(function Hl(e){return Vo("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?Va(function ti(e){return Vo("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?Va(yn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}class Uo extends xo{constructor(t,r,a){let u;if(super(),at(t))u=t;else if(t){let g;({next:u,error:r,complete:a}=t),this&&nt.useDeprecatedNextContext?(g=Object.create(t),g.unsubscribe=()=>this.unsubscribe()):g=t,u=null==u?void 0:u.bind(g),r=null==r?void 0:r.bind(g),a=null==a?void 0:a.bind(g)}this.destination={next:u?jo(u):vo,error:jo(null!=r?r:Vn),complete:a?jo(a):vo}}}function jo(e,t){return(...r)=>{try{e(...r)}catch(a){nt.useDeprecatedSynchronousErrorHandling?function en(e){nt.useDeprecatedSynchronousErrorHandling&&ni&&(ni.errorThrown=!0,ni.error=e)}(a):na(a)}}}function Vn(e){throw e}function Va(e,t){const{onStoppedNotification:r}=nt;r&&ui.setTimeout(()=>r(e,t))}const _s={closed:!0,next:vo,error:Vn,complete:vo},ys="function"==typeof Symbol&&Symbol.observable||"@@observable";function ra(e){return e}let Hn=(()=>{class e{constructor(r){r&&(this._subscribe=r)}lift(r){const a=new e;return a.source=this,a.operator=r,a}subscribe(r,a,u){const g=function cr(e){return e&&e instanceof xo||function Wi(e){return e&&at(e.next)&&at(e.error)&&at(e.complete)}(e)&&Ie(e)}(r)?r:new Uo(r,a,u);return bi(()=>{const{operator:b,source:E}=this;g.add(b?b.call(g,E):E?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(r){try{return this._subscribe(r)}catch(a){r.error(a)}}forEach(r,a){return new(a=Zi(a))((u,g)=>{let b;b=this.subscribe(E=>{try{r(E)}catch(S){g(S),null==b||b.unsubscribe()}},g,u)})}_subscribe(r){var a;return null===(a=this.source)||void 0===a?void 0:a.subscribe(r)}[ys](){return this}pipe(...r){return function $o(e){return 0===e.length?ra:1===e.length?e[0]:function(r){return e.reduce((a,u)=>u(a),r)}}(r)(this)}toPromise(r){return new(r=Zi(r))((a,u)=>{let g;this.subscribe(b=>g=b,b=>u(b),()=>a(g))})}}return e.create=t=>new e(t),e})();function Zi(e){var t;return null!==(t=null!=e?e:nt.Promise)&&void 0!==t?t:Promise}const ia=ln(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let En=(()=>{class e extends Hn{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(r){const a=new hi(this,this);return a.operator=r,a}_throwIfClosed(){if(this.closed)throw new ia}next(r){bi(()=>{if(this._throwIfClosed(),!this.isStopped){const a=this.observers.slice();for(const u of a)u.next(r)}})}error(r){bi(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=r;const{observers:a}=this;for(;a.length;)a.shift().error(r)}})}complete(){bi(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:r}=this;for(;r.length;)r.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var r;return(null===(r=this.observers)||void 0===r?void 0:r.length)>0}_trySubscribe(r){return this._throwIfClosed(),super._trySubscribe(r)}_subscribe(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)}_innerSubscribe(r){const{hasError:a,isStopped:u,observers:g}=this;return a||u?Sn:(g.push(r),new Bt(()=>At(g,r)))}_checkFinalizedStatuses(r){const{hasError:a,thrownError:u,isStopped:g}=this;a?r.error(u):g&&r.complete()}asObservable(){const r=new Hn;return r.source=this,r}}return e.create=(t,r)=>new hi(t,r),e})();class hi extends En{constructor(t,r){super(),this.destination=t,this.source=r}next(t){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.next)||void 0===a||a.call(r,t)}error(t){var r,a;null===(a=null===(r=this.destination)||void 0===r?void 0:r.error)||void 0===a||a.call(r,t)}complete(){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===r||r.call(t)}_subscribe(t){var r,a;return null!==(a=null===(r=this.source)||void 0===r?void 0:r.subscribe(t))&&void 0!==a?a:Sn}}function yr(e){return t=>{if(function Zl(e){return at(null==e?void 0:e.lift)}(t))return t.lift(function(r){try{return e(r,this)}catch(a){this.error(a)}});throw new TypeError("Unable to lift unknown Observable type")}}class wi extends xo{constructor(t,r,a,u,g){super(t),this.onFinalize=g,this._next=r?function(b){try{r(b)}catch(E){t.error(E)}}:super._next,this._error=u?function(b){try{u(b)}catch(E){t.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=a?function(){try{a()}catch(b){t.error(b)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;const{closed:r}=this;super.unsubscribe(),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}function Xi(e,t){return yr((r,a)=>{let u=0;r.subscribe(new wi(a,g=>{a.next(e.call(t,g,u++))}))})}function ur(e){return this instanceof ur?(this.v=e,this):new ur(e)}function Ho(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,a=r.apply(e,t||[]),g=[];return u={},b("next"),b("throw"),b("return"),u[Symbol.asyncIterator]=function(){return this},u;function b(ne){a[ne]&&(u[ne]=function(oe){return new Promise(function(ye,Fe){g.push([ne,oe,ye,Fe])>1||E(ne,oe)})})}function E(ne,oe){try{!function S(ne){ne.value instanceof ur?Promise.resolve(ne.value.v).then(k,B):j(g[0][2],ne)}(a[ne](oe))}catch(ye){j(g[0][3],ye)}}function k(ne){E("next",ne)}function B(ne){E("throw",ne)}function j(ne,oe){ne(oe),g.shift(),g.length&&E(g[0][0],g[0][1])}}function Di(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function aa(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r);function a(g){r[g]=e[g]&&function(b){return new Promise(function(E,S){!function u(g,b,E,S){Promise.resolve(S).then(function(k){g({value:k,done:E})},b)}(E,S,(b=e[g](b)).done,b.value)})}}}const Jl=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Wa(e){return at(null==e?void 0:e.then)}function Xa(e){return at(e[ys])}function Eo(e){return Symbol.asyncIterator&&at(null==e?void 0:e[Symbol.asyncIterator])}function la(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const qo=function Ti(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Ka(e){return at(null==e?void 0:e[qo])}function Zo(e){return Ho(this,arguments,function*(){const r=e.getReader();try{for(;;){const{value:a,done:u}=yield ur(r.read());if(u)return yield ur(void 0);yield yield ur(a)}}finally{r.releaseLock()}})}function Ki(e){return at(null==e?void 0:e.getReader)}function Ri(e){if(e instanceof Hn)return e;if(null!=e){if(Xa(e))return function Ya(e){return new Hn(t=>{const r=e[ys]();if(at(r.subscribe))return r.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Jl(e))return function xs(e){return new Hn(t=>{for(let r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()})}(e);if(Wa(e))return function bs(e){return new Hn(t=>{e.then(r=>{t.closed||(t.next(r),t.complete())},r=>t.error(r)).then(null,na)})}(e);if(Eo(e))return O(e);if(Ka(e))return function Y(e){return new Hn(t=>{for(const r of e)if(t.next(r),t.closed)return;t.complete()})}(e);if(Ki(e))return function V(e){return O(Zo(e))}(e)}throw la(e)}function O(e){return new Hn(t=>{(function X(e,t){var r,a,u,g;return function zt(e,t,r,a){return new(r||(r=Promise))(function(g,b){function E(B){try{k(a.next(B))}catch(j){b(j)}}function S(B){try{k(a.throw(B))}catch(j){b(j)}}function k(B){B.done?g(B.value):function u(g){return g instanceof r?g:new r(function(b){b(g)})}(B.value).then(E,S)}k((a=a.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(r=Di(e);!(a=yield r.next()).done;)if(t.next(a.value),t.closed)return}catch(b){u={error:b}}finally{try{a&&!a.done&&(g=r.return)&&(yield g.call(r))}finally{if(u)throw u.error}}t.complete()})})(e,t).catch(r=>t.error(r))})}function J(e,t,r,a=0,u=!1){const g=t.schedule(function(){r(),u?e.add(this.schedule(null,a)):this.unsubscribe()},a);if(e.add(g),!u)return g}function me(e,t,r=1/0){return at(t)?me((a,u)=>Xi((g,b)=>t(a,g,u,b))(Ri(e(a,u))),r):("number"==typeof t&&(r=t),yr((a,u)=>function le(e,t,r,a,u,g,b,E){const S=[];let k=0,B=0,j=!1;const ne=()=>{j&&!S.length&&!k&&t.complete()},oe=Fe=>k<a?ye(Fe):S.push(Fe),ye=Fe=>{g&&t.next(Fe),k++;let qe=!1;Ri(r(Fe,B++)).subscribe(new wi(t,je=>{null==u||u(je),g?oe(je):t.next(je)},()=>{qe=!0},void 0,()=>{if(qe)try{for(k--;S.length&&k<a;){const je=S.shift();b?J(t,b,()=>ye(je)):ye(je)}ne()}catch(je){t.error(je)}}))};return e.subscribe(new wi(t,oe,()=>{j=!0,ne()})),()=>{null==E||E()}}(a,u,e,r)))}const ce=new Hn(e=>e.complete());function Le(e){return e[e.length-1]}function $e(e){return function We(e){return e&&at(e.schedule)}(Le(e))?e.pop():void 0}function Te(e,t=0){return yr((r,a)=>{r.subscribe(new wi(a,u=>J(a,e,()=>a.next(u),t),()=>J(a,e,()=>a.complete(),t),u=>J(a,e,()=>a.error(u),t)))})}function It(e,t=0){return yr((r,a)=>{a.add(e.schedule(()=>r.subscribe(a),t))})}function Wo(e,t){if(!e)throw new Error("Iterable cannot be null");return new Hn(r=>{J(r,t,()=>{const a=e[Symbol.asyncIterator]();J(r,t,()=>{a.next().then(u=>{u.done?r.complete():r.next(u.value)})},0,!0)})})}function Tt(e,t){return t?function Xe(e,t){if(null!=e){if(Xa(e))return function Kt(e,t){return Ri(e).pipe(It(t),Te(t))}(e,t);if(Jl(e))return function Nt(e,t){return new Hn(r=>{let a=0;return t.schedule(function(){a===e.length?r.complete():(r.next(e[a++]),r.closed||this.schedule())})})}(e,t);if(Wa(e))return function mt(e,t){return Ri(e).pipe(It(t),Te(t))}(e,t);if(Eo(e))return Wo(e,t);if(Ka(e))return function Gt(e,t){return new Hn(r=>{let a;return J(r,t,()=>{a=e[qo](),J(r,t,()=>{let u,g;try{({value:u,done:g}=a.next())}catch(b){return void r.error(b)}g?r.complete():r.next(u)},0,!0)}),()=>at(null==a?void 0:a.return)&&a.return()})}(e,t);if(Ki(e))return function Yi(e,t){return Wo(Zo(e),t)}(e,t)}throw la(e)}(e,t):Ri(e)}function Et(e,t,...r){return!0===t?(e(),null):!1===t?null:t(...r).pipe(function qn(e){return e<=0?()=>ce:yr((t,r)=>{let a=0;t.subscribe(new wi(r,u=>{++a<=e&&(r.next(u),e<=a&&r.complete())}))})}(1)).subscribe(()=>e())}function cn(e){for(let t in e)if(e[t]===cn)return t;throw Error("Could not find renamed property on target object.")}function Pt(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Pt).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const r=t.indexOf("\n");return-1===r?t:t.substring(0,r)}function Ur(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Mn=cn({__forward_ref__:cn});function Ql(e){return e.__forward_ref__=Ql,e.toString=function(){return Pt(this())},e}function gt(e){return function ec(e){return"function"==typeof e&&e.hasOwnProperty(Mn)&&e.__forward_ref__===Ql}(e)?e():e}class Ar extends Error{constructor(t,r){super(function Vt(e,t){return`${e?`NG0${e}: `:""}${t}`}(t,r)),this.code=t}}function vt(e){return"string"==typeof e?e:null==e?"":String(e)}function Zn(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():vt(e)}function Es(e,t){const r=t?` in ${t}`:"";throw new Ar("201",`No provider for ${Zn(e)} found${r}`)}function kr(e,t){null==e&&function tn(e,t,r,a){throw new Error(`ASSERTION ERROR: ${e}`+(null==a?"":` [Expected=> ${r} ${a} ${t} <=Actual]`))}(t,e,null,"!=")}function nn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ci(e){return{providers:e.providers||[],imports:e.imports||[]}}function nc(e){return dh(e,ua)||dh(e,ha)}function dh(e,t){return e.hasOwnProperty(t)?e[t]:null}function di(e){return e&&(e.hasOwnProperty(Ja)||e.hasOwnProperty(da))?e[Ja]:null}const ua=cn({\u0275prov:cn}),Ja=cn({\u0275inj:cn}),ha=cn({ngInjectableDef:cn}),da=cn({ngInjectorDef:cn});var _t=(()=>((_t=_t||{})[_t.Default=0]="Default",_t[_t.Host=1]="Host",_t[_t.Self=2]="Self",_t[_t.SkipSelf=4]="SkipSelf",_t[_t.Optional=8]="Optional",_t))();let Yo;function Dt(e){const t=Yo;return Yo=e,t}function Qa(e,t,r){const a=nc(e);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:r&_t.Optional?null:void 0!==t?t:void Es(Pt(e),"Injector")}function to(e){return{toString:e}.toString()}var $r=(()=>(($r=$r||{})[$r.OnPush=0]="OnPush",$r[$r.Default=1]="Default",$r))(),ii=(()=>{return(e=ii||(ii={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",ii;var e})();const oc="undefined"!=typeof globalThis&&globalThis,eu="undefined"!=typeof window&&window,fh="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,un=oc||"undefined"!=typeof global&&global||eu||fh,Jo={},hn=[],Ts=cn({\u0275cmp:cn}),pa=cn({\u0275dir:cn}),el=cn({\u0275pipe:cn}),tu=cn({\u0275mod:cn}),no=cn({\u0275fac:cn}),ro=cn({__NG_ELEMENT_ID__:cn});let tl=0;function io(e){return to(()=>{const r={},a={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===$r.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||hn,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||ii.Emulated,id:"c",styles:e.styles||hn,_:null,setInput:null,schemas:e.schemas||null,tView:null},u=e.directives,g=e.features,b=e.pipes;return a.id+=tl++,a.inputs=rl(e.inputs,r),a.outputs=rl(e.outputs),g&&g.forEach(E=>E(a)),a.directiveDefs=u?()=>("function"==typeof u?u():u).map(ac):null,a.pipeDefs=b?()=>("function"==typeof b?b():b).map(nl):null,a})}function ac(e){return ir(e)||function so(e){return e[pa]||null}(e)}function nl(e){return function Qo(e){return e[el]||null}(e)}const fa={};function oo(e){return to(()=>{const t={type:e.type,bootstrap:e.bootstrap||hn,declarations:e.declarations||hn,imports:e.imports||hn,exports:e.exports||hn,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(fa[e.id]=e.type),t})}function rl(e,t){if(null==e)return Jo;const r={};for(const a in e)if(e.hasOwnProperty(a)){let u=e[a],g=u;Array.isArray(u)&&(g=u[1],u=u[0]),r[u]=a,t&&(t[u]=g)}return r}const Gr=io;function ir(e){return e[Ts]||null}function xr(e,t){const r=e[tu]||null;if(!r&&!0===t)throw new Error(`Type ${Pt(e)} does not have '\u0275mod' property.`);return r}function br(e){return Array.isArray(e)&&"object"==typeof e[1]}function si(e){return Array.isArray(e)&&!0===e[1]}function hc(e){return 0!=(8&e.flags)}function Do(e){return 2==(2&e.flags)}function Ni(e){return 1==(1&e.flags)}function Un(e){return null!==e.template}function dc(e){return 0!=(512&e[2])}function Jn(e,t){return e.hasOwnProperty(no)?e[no]:null}class ul{constructor(t,r,a){this.previousValue=t,this.currentValue=r,this.firstChange=a}isFirstChange(){return this.firstChange}}function ou(e){return e.type.prototype.ngOnChanges&&(e.setInput=bh),xh}function xh(){const e=su(this),t=null==e?void 0:e.current;if(t){const r=e.previous;if(r===Jo)e.previous=t;else for(let a in t)r[a]=t[a];e.current=null,this.ngOnChanges(t)}}function bh(e,t,r,a){const u=su(e)||function _c(e,t){return e[hl]=t}(e,{previous:Jo,current:null}),g=u.current||(u.current={}),b=u.previous,E=this.declaredInputs[r],S=b[E];g[E]=new ul(S&&S.currentValue,t,b===Jo),e[a]=t}const hl="__ngSimpleChanges__";function su(e){return e[hl]||null}let Co;function Fn(e){return!!e.listen}const cu={createRenderer:(e,t)=>function dl(){return void 0!==Co?Co:"undefined"!=typeof document?document:void 0}()};function fn(e){for(;Array.isArray(e);)e=e[0];return e}function rs(e,t){return fn(t[e])}function Ye(e,t){return fn(t[e.index])}function pl(e,t){return e.data[t]}function wr(e,t){const r=t[e];return br(r)?r:r[0]}function uu(e){return 4==(4&e[2])}function vc(e){return 128==(128&e[2])}function So(e,t){return null==t?null:e[t]}function hu(e){e[18]=0}function Ms(e,t){e[5]+=t;let r=e,a=e[3];for(;null!==a&&(1===t&&1===r[5]||-1===t&&0===r[5]);)a[5]+=t,r=a,a=a[3]}const xt={lFrame:C(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function fu(){return xt.bindingsEnabled}function Be(){return xt.lFrame.lView}function $t(){return xt.lFrame.tView}function As(e){return xt.lFrame.contextLView=e,e[8]}function On(){let e=_u();for(;null!==e&&64===e.type;)e=e.parent;return e}function _u(){return xt.lFrame.currentTNode}function ai(e,t){const r=xt.lFrame;r.currentTNode=e,r.isParent=t}function bc(){return xt.lFrame.isParent}function ml(){return xt.isInCheckNoChangesMode}function Da(e){xt.isInCheckNoChangesMode=e}function uo(){return xt.lFrame.bindingIndex++}function Kd(e,t){const r=xt.lFrame;r.bindingIndex=r.bindingRootIndex=e,is(t)}function is(e){xt.lFrame.currentDirectiveIndex=e}function i(){return xt.lFrame.currentQueryIndex}function c(e){xt.lFrame.currentQueryIndex=e}function m(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function y(e,t,r){if(r&_t.SkipSelf){let u=t,g=e;for(;!(u=u.parent,null!==u||r&_t.Host||(u=m(g),null===u||(g=g[15],10&u.type))););if(null===u)return!1;t=u,e=g}const a=xt.lFrame=D();return a.currentTNode=t,a.lView=e,!0}function v(e){const t=D(),r=e[1];xt.lFrame=t,t.currentTNode=r.firstChild,t.lView=e,t.tView=r,t.contextLView=e,t.bindingIndex=r.bindingStartIndex,t.inI18n=!1}function D(){const e=xt.lFrame,t=null===e?null:e.child;return null===t?C(e):t}function C(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function A(){const e=xt.lFrame;return xt.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const R=A;function L(){const e=A();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function H(){return xt.lFrame.selectedIndex}function Z(e){xt.lFrame.selectedIndex=e}function ae(e,t){for(let r=t.directiveStart,a=t.directiveEnd;r<a;r++){const g=e.data[r].type.prototype,{ngAfterContentInit:b,ngAfterContentChecked:E,ngAfterViewInit:S,ngAfterViewChecked:k,ngOnDestroy:B}=g;b&&(e.contentHooks||(e.contentHooks=[])).push(-r,b),E&&((e.contentHooks||(e.contentHooks=[])).push(r,E),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(r,E)),S&&(e.viewHooks||(e.viewHooks=[])).push(-r,S),k&&((e.viewHooks||(e.viewHooks=[])).push(r,k),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(r,k)),null!=B&&(e.destroyHooks||(e.destroyHooks=[])).push(r,B)}}function be(e,t,r){Se(e,t,3,r)}function xe(e,t,r,a){(3&e[2])===r&&Se(e,t,r,a)}function Ce(e,t){let r=e[2];(3&r)===t&&(r&=2047,r+=1,e[2]=r)}function Se(e,t,r,a){const g=null!=a?a:-1,b=t.length-1;let E=0;for(let S=void 0!==a?65535&e[18]:0;S<b;S++)if("number"==typeof t[S+1]){if(E=t[S],null!=a&&E>=a)break}else t[S]<0&&(e[18]+=65536),(E<g||-1==g)&&(Ve(e,r,t,S),e[18]=(4294901760&e[18])+S+2),S++}function Ve(e,t,r,a){const u=r[a]<0,g=r[a+1],E=e[u?-r[a]:r[a]];if(u){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{g.call(E)}finally{}}}else try{g.call(E)}finally{}}class Ue{constructor(t,r,a){this.factory=t,this.resolving=!1,this.canSeeViewProviders=r,this.injectImpl=a}}function ft(e,t,r){const a=Fn(e);let u=0;for(;u<r.length;){const g=r[u];if("number"==typeof g){if(0!==g)break;u++;const b=r[u++],E=r[u++],S=r[u++];a?e.setAttribute(t,E,S,b):t.setAttributeNS(b,E,S)}else{const b=g,E=r[++u];$n(b)?a&&e.setProperty(t,b,E):a?e.setAttribute(t,b,E):t.setAttribute(b,E),u++}}return u}function qt(e){return 3===e||4===e||6===e}function $n(e){return 64===e.charCodeAt(0)}function Qn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let r=-1;for(let a=0;a<t.length;a++){const u=t[a];"number"==typeof u?r=u:0===r||Dr(e,r,u,null,-1===r||2===r?t[++a]:null)}}return e}function Dr(e,t,r,a,u){let g=0,b=e.length;if(-1===t)b=-1;else for(;g<e.length;){const E=e[g++];if("number"==typeof E){if(E===t){b=-1;break}if(E>t){b=g-1;break}}}for(;g<e.length;){const E=e[g];if("number"==typeof E)break;if(E===r){if(null===a)return void(null!==u&&(e[g+1]=u));if(a===e[g+1])return void(e[g+2]=u)}g++,null!==a&&g++,null!==u&&g++}-1!==b&&(e.splice(b,0,t),g=b+1),e.splice(g++,0,r),null!==a&&e.splice(g++,0,a),null!==u&&e.splice(g++,0,u)}function Fr(e){return-1!==e}function Pn(e){return 32767&e}function Wr(e,t){let r=function Io(e){return e>>16}(e),a=t;for(;r>0;)a=a[15],r--;return a}let mn=!0;function kn(e){const t=mn;return mn=e,t}let Tn=0;function Mo(e,t){const r=ho(e,t);if(-1!==r)return r;const a=t[1];a.firstCreatePass&&(e.injectorIndex=t.length,Or(a.data,e),Or(t,null),Or(a.blueprint,null));const u=_l(e,t),g=e.injectorIndex;if(Fr(u)){const b=Pn(u),E=Wr(u,t),S=E[1].data;for(let k=0;k<8;k++)t[g+k]=E[b+k]|S[b+k]}return t[g+8]=u,g}function Or(e,t){e.push(0,0,0,0,0,0,0,0,t)}function ho(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function _l(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let r=0,a=null,u=t;for(;null!==u;){const g=u[1],b=g.type;if(a=2===b?g.declTNode:1===b?u[6]:null,null===a)return-1;if(r++,u=u[15],-1!==a.injectorIndex)return a.injectorIndex|r<<16}return-1}function ks(e,t,r){!function mi(e,t,r){let a;"string"==typeof r?a=r.charCodeAt(0)||0:r.hasOwnProperty(ro)&&(a=r[ro]),null==a&&(a=r[ro]=Tn++);const u=255&a;t.data[e+(u>>5)]|=1<<u}(e,t,r)}function vu(e,t,r){if(r&_t.Optional)return e;Es(t,"NodeInjector")}function Ca(e,t,r,a){if(r&_t.Optional&&void 0===a&&(a=null),0==(r&(_t.Self|_t.Host))){const u=e[9],g=Dt(void 0);try{return u?u.get(t,a,r&_t.Optional):Qa(t,a,r&_t.Optional)}finally{Dt(g)}}return vu(a,t,r)}function yl(e,t,r,a=_t.Default,u){if(null!==e){const g=function Rf(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ro)?e[ro]:void 0;return"number"==typeof t?t>=0?255&t:Pf:t}(r);if("function"==typeof g){if(!y(t,e,a))return a&_t.Host?vu(u,r,a):Ca(t,r,a,u);try{const b=g(a);if(null!=b||a&_t.Optional)return b;Es(r)}finally{R()}}else if("number"==typeof g){let b=null,E=ho(e,t),S=-1,k=a&_t.Host?t[16][6]:null;for((-1===E||a&_t.SkipSelf)&&(S=-1===E?_l(e,t):t[E+8],-1!==S&&wc(a,!1)?(b=t[1],E=Pn(S),t=Wr(S,t)):E=-1);-1!==E;){const B=t[1];if(Lf(g,E,B.data)){const j=kf(E,t,r,b,a,k);if(j!==Jd)return j}S=t[E+8],-1!==S&&wc(a,t[1].data[E+8]===k)&&Lf(g,E,t)?(b=B,E=Pn(S),t=Wr(S,t)):E=-1}}}return Ca(t,r,a,u)}const Jd={};function Pf(){return new Ec(On(),Be())}function kf(e,t,r,a,u,g){const b=t[1],E=b.data[e+8],B=Dh(E,b,r,null==a?Do(E)&&mn:a!=b&&0!=(3&E.type),u&_t.Host&&g===E);return null!==B?xu(t,b,B,E):Jd}function Dh(e,t,r,a,u){const g=e.providerIndexes,b=t.data,E=1048575&g,S=e.directiveStart,B=g>>20,ne=u?E+B:e.directiveEnd;for(let oe=a?E:E+B;oe<ne;oe++){const ye=b[oe];if(oe<S&&r===ye||oe>=S&&ye.type===r)return oe}if(u){const oe=b[S];if(oe&&Un(oe)&&oe.type===r)return S}return null}function xu(e,t,r,a){let u=e[r];const g=t.data;if(function ve(e){return e instanceof Ue}(u)){const b=u;b.resolving&&function Pr(e,t){const r=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Ar("200",`Circular dependency in DI detected for ${e}${r}`)}(Zn(g[r]));const E=kn(b.canSeeViewProviders);b.resolving=!0;const S=b.injectImpl?Dt(b.injectImpl):null;y(e,a,_t.Default);try{u=e[r]=b.factory(void 0,g,e,a),t.firstCreatePass&&r>=a.directiveStart&&function ie(e,t,r){const{ngOnChanges:a,ngOnInit:u,ngDoCheck:g}=t.type.prototype;if(a){const b=ou(t);(r.preOrderHooks||(r.preOrderHooks=[])).push(e,b),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,b)}u&&(r.preOrderHooks||(r.preOrderHooks=[])).push(0-e,u),g&&((r.preOrderHooks||(r.preOrderHooks=[])).push(e,g),(r.preOrderCheckHooks||(r.preOrderCheckHooks=[])).push(e,g))}(r,g[r],t)}finally{null!==S&&Dt(S),kn(E),b.resolving=!1,R()}}return u}function Lf(e,t,r){return!!(r[t+(e>>5)]&1<<e)}function wc(e,t){return!(e&_t.Self||e&_t.Host&&t)}class Ec{constructor(t,r){this._tNode=t,this._lView=r}get(t,r,a){return yl(this._tNode,this._lView,t,a,r)}}const Si="__parameters__";function Dc(e,t,r){return to(()=>{const a=function Sh(e){return function(...r){if(e){const a=e(...r);for(const u in a)this[u]=a[u]}}}(t);function u(...g){if(this instanceof u)return a.apply(this,g),this;const b=new u(...g);return E.annotation=b,E;function E(S,k,B){const j=S.hasOwnProperty(Si)?S[Si]:Object.defineProperty(S,Si,{value:[]})[Si];for(;j.length<=B;)j.push(null);return(j[B]=j[B]||[]).push(b),S}}return r&&(u.prototype=Object.create(r.prototype)),u.prototype.ngMetadataName=e,u.annotationCls=u,u})}class rn{constructor(t,r){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof r?this.__NG_ELEMENT_ID__=r:void 0!==r&&(this.\u0275prov=nn({token:this,providedIn:r.providedIn||"root",factory:r.factory}))}toString(){return`InjectionToken ${this._desc}`}}function po(e,t){void 0===t&&(t=e);for(let r=0;r<e.length;r++){let a=e[r];Array.isArray(a)?(t===e&&(t=e.slice(0,r)),po(a,t)):t!==e&&t.push(a)}return t}function ss(e,t){e.forEach(r=>Array.isArray(r)?ss(r,t):t(r))}function pr(e,t,r){t>=e.length?e.push(r):e.splice(t,0,r)}function Rt(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function gi(e,t,r){let a=_i(e,t);return a>=0?e[1|a]=r:(a=~a,function Ff(e,t,r,a){let u=e.length;if(u==t)e.push(r,a);else if(1===u)e.push(a,e[0]),e[0]=r;else{for(u--,e.push(e[u-1],e[u]);u>t;)e[u]=e[u-2],u--;e[t]=r,e[t+1]=a}}(e,a,t,r)),a}function Fs(e,t){const r=_i(e,t);if(r>=0)return e[1|r]}function _i(e,t){return function Os(e,t,r){let a=0,u=e.length>>r;for(;u!==a;){const g=a+(u-a>>1),b=e[g<<r];if(t===b)return g<<r;b>t?u=g:a=g+1}return~(u<<r)}(e,t,1)}const xl={},Ph="__NG_DI_FLAG__",kh="ngTempTokenPath",Og=/\n/gm,Uf="__source",ap=cn({provide:String,useValue:cn});let Sc;function lp(e){const t=Sc;return Sc=e,t}function Ic(e,t=_t.Default){if(void 0===Sc)throw new Error("inject() must be called from an injection context");return null===Sc?Qa(e,void 0,t):Sc.get(e,t&_t.Optional?null:void 0,t)}function Lt(e,t=_t.Default){return(function rc(){return Yo}()||Ic)(gt(e),t)}function Mc(e){const t=[];for(let r=0;r<e.length;r++){const a=gt(e[r]);if(Array.isArray(a)){if(0===a.length)throw new Error("Arguments array must have arguments.");let u,g=_t.Default;for(let b=0;b<a.length;b++){const E=a[b],S=$f(E);"number"==typeof S?-1===S?u=E.token:g|=S:u=E}t.push(Lt(u,g))}else t.push(Lt(a))}return t}function Ac(e,t){return e[Ph]=t,e.prototype[Ph]=t,e}function $f(e){return e[Ph]}const Cr=Ac(Dc("Inject",e=>({token:e})),-1),bl=Ac(Dc("Optional"),8),Pc=Ac(Dc("SkipSelf"),4);const rm="__ngContext__";function li(e,t){e[rm]=t}function Gh(e){const t=function Vs(e){return e[rm]||null}(e);return t?Array.isArray(t)?t:t.lView:null}function _p(e){return e.ngOriginalError}function m_(e,...t){e.error(...t)}class Sl{constructor(){this._console=console}handleError(t){const r=this._findOriginalError(t),a=function f_(e){return e&&e.ngErrorLogger||m_}(t);a(this._console,"ERROR",t),r&&a(this._console,"ORIGINAL ERROR",r)}_findOriginalError(t){let r=t&&_p(t);for(;r&&_p(r);)r=_p(r);return r||null}}const um=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(un))();function fo(e){return e instanceof Function?e():e}var Mi=(()=>((Mi=Mi||{})[Mi.Important=1]="Important",Mi[Mi.DashCase=2]="DashCase",Mi))();function xp(e,t){return undefined(e,t)}function Nu(e){const t=e[3];return si(t)?t[3]:t}function bp(e){return Vu(e[13])}function wp(e){return Vu(e[4])}function Vu(e){for(;null!==e&&!si(e);)e=e[4];return e}function Ml(e,t,r,a,u){if(null!=a){let g,b=!1;si(a)?g=a:br(a)&&(b=!0,a=a[0]);const E=fn(a);0===e&&null!==r?null==u?Mp(t,r,E):Us(t,r,E,u||null,!0):1===e&&null!==r?Us(t,r,E,u||null,!0):2===e?function Lp(e,t,r){const a=Lo(e,t);a&&function xm(e,t,r,a){Fn(e)?e.removeChild(t,r,a):t.removeChild(r)}(e,a,t,r)}(t,E,b):3===e&&t.destroyNode(E),null!=g&&function Dm(e,t,r,a,u){const g=r[7];g!==fn(r)&&Ml(t,e,a,g,u);for(let E=10;E<r.length;E++){const S=r[E];us(S[1],S,e,t,a,g)}}(t,e,g,r,u)}}function ju(e,t,r){return Fn(e)?e.createElement(t,r):null===r?e.createElement(t):e.createElementNS(r,t)}function Gu(e,t){const r=e[9],a=r.indexOf(t),u=t[3];1024&t[2]&&(t[2]&=-1025,Ms(u,-1)),r.splice(a,1)}function Cp(e,t){if(e.length<=10)return;const r=10+t,a=e[r];if(a){const u=a[17];null!==u&&u!==e&&Gu(u,a),t>0&&(e[r-1][4]=a[4]);const g=Rt(e,10+t);!function Dp(e,t){us(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(a[1],a);const b=g[19];null!==b&&b.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Sp(e,t){if(!(256&t[2])){const r=t[11];Fn(r)&&r.destroyNode&&us(e,t,r,3,null,null),function $u(e){let t=e[13];if(!t)return Wh(e[1],e);for(;t;){let r=null;if(br(t))r=t[13];else{const a=t[10];a&&(r=a)}if(!r){for(;t&&!t[4]&&t!==e;)br(t)&&Wh(t[1],t),t=t[3];null===t&&(t=e),br(t)&&Wh(t[1],t),r=t&&t[4]}t=r}}(t)}}function Wh(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function ym(e,t){let r;if(null!=e&&null!=(r=e.destroyHooks))for(let a=0;a<r.length;a+=2){const u=t[r[a]];if(!(u instanceof Ue)){const g=r[a+1];if(Array.isArray(g))for(let b=0;b<g.length;b+=2){const E=u[g[b]],S=g[b+1];try{S.call(E)}finally{}}else try{g.call(u)}finally{}}}}(e,t),function D_(e,t){const r=e.cleanup,a=t[7];let u=-1;if(null!==r)for(let g=0;g<r.length-1;g+=2)if("string"==typeof r[g]){const b=r[g+1],E="function"==typeof b?b(t):fn(t[b]),S=a[u=r[g+2]],k=r[g+3];"boolean"==typeof k?E.removeEventListener(r[g],S,k):k>=0?a[u=k]():a[u=-k].unsubscribe(),g+=2}else{const b=a[u=r[g+1]];r[g].call(b)}if(null!==a){for(let g=u+1;g<a.length;g++)a[g]();t[7]=null}}(e,t),1===t[1].type&&Fn(t[11])&&t[11].destroy();const r=t[17];if(null!==r&&si(t[3])){r!==t[3]&&Gu(r,t);const a=t[19];null!==a&&a.detachView(e)}}}function Ip(e,t,r){return function Xh(e,t,r){let a=t;for(;null!==a&&40&a.type;)a=(t=a).parent;if(null===a)return r[0];if(2&a.flags){const u=e.data[a.directiveStart].encapsulation;if(u===ii.None||u===ii.Emulated)return null}return Ye(a,r)}(e,t.parent,r)}function Us(e,t,r,a,u){Fn(e)?e.insertBefore(t,r,a,u):t.insertBefore(r,a,u)}function Mp(e,t,r){Fn(e)?e.appendChild(t,r):t.appendChild(r)}function vm(e,t,r,a,u){null!==a?Us(e,t,r,a,u):Mp(e,t,r)}function Lo(e,t){return Fn(e)?e.parentNode(t):t.parentNode}let kp=function Pp(e,t,r){return 40&e.type?Ye(e,r):null};function Hu(e,t,r,a){const u=Ip(e,a,t),g=t[11],E=function Ap(e,t,r){return kp(e,t,r)}(a.parent||t[6],a,t);if(null!=u)if(Array.isArray(r))for(let S=0;S<r.length;S++)vm(g,u,r[S],E,!1);else vm(g,u,r,E,!1)}function qu(e,t){if(null!==t){const r=t.type;if(3&r)return Ye(t,e);if(4&r)return Kh(-1,e[t.index]);if(8&r){const a=t.child;if(null!==a)return qu(e,a);{const u=e[t.index];return si(u)?Kh(-1,u):fn(u)}}if(32&r)return xp(t,e)()||fn(e[t.index]);{const a=zc(e,t);return null!==a?Array.isArray(a)?a[0]:qu(Nu(e[16]),a):qu(e,t.next)}}return null}function zc(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Kh(e,t){const r=10+e+1;if(r<t.length){const a=t[r],u=a[1].firstChild;if(null!==u)return qu(a,u)}return t[7]}function Zu(e,t,r,a,u,g,b){for(;null!=r;){const E=a[r.index],S=r.type;if(b&&0===t&&(E&&li(fn(E),a),r.flags|=4),64!=(64&r.flags))if(8&S)Zu(e,t,r.child,a,u,g,!1),Ml(t,e,u,E,g);else if(32&S){const k=xp(r,a);let B;for(;B=k();)Ml(t,e,u,B,g);Ml(t,e,u,E,g)}else 16&S?Wu(e,t,a,r,u,g):Ml(t,e,u,E,g);r=b?r.projectionNext:r.next}}function us(e,t,r,a,u,g){Zu(r,a,e.firstChild,t,u,g,!1)}function Wu(e,t,r,a,u,g){const b=r[16],S=b[6].projection[a.projection];if(Array.isArray(S))for(let k=0;k<S.length;k++)Ml(t,e,u,S[k],g);else Zu(e,t,S,b[3],u,g,!0)}function Xu(e,t,r){Fn(e)?e.setAttribute(t,"style",r):t.style.cssText=r}function Fp(e,t,r){Fn(e)?""===r?e.removeAttribute(t,"class"):e.setAttribute(t,"class",r):t.className=r}function Tm(e,t,r){let a=e.length;for(;;){const u=e.indexOf(t,r);if(-1===u)return u;if(0===u||e.charCodeAt(u-1)<=32){const g=t.length;if(u+g===a||e.charCodeAt(u+g)<=32)return u}r=u+1}}const Cm="ng-template";function T_(e,t,r){let a=0;for(;a<e.length;){let u=e[a++];if(r&&"class"===u){if(u=e[a],-1!==Tm(u.toLowerCase(),t,0))return!0}else if(1===u){for(;a<e.length&&"string"==typeof(u=e[a++]);)if(u.toLowerCase()===t)return!0;return!1}}return!1}function Al(e){return 4===e.type&&e.value!==Cm}function Op(e,t,r){return t===(4!==e.type||r?e.value:Cm)}function C_(e,t,r){let a=4;const u=e.attrs||[],g=function Aa(e){for(let t=0;t<e.length;t++)if(qt(e[t]))return t;return e.length}(u);let b=!1;for(let E=0;E<t.length;E++){const S=t[E];if("number"!=typeof S){if(!b)if(4&a){if(a=2|1&a,""!==S&&!Op(e,S,r)||""===S&&1===t.length){if(mo(a))return!1;b=!0}}else{const k=8&a?S:t[++E];if(8&a&&null!==e.attrs){if(!T_(e.attrs,k,r)){if(mo(a))return!1;b=!0}continue}const j=S_(8&a?"class":S,u,Al(e),r);if(-1===j){if(mo(a))return!1;b=!0;continue}if(""!==k){let ne;ne=j>g?"":u[j+1].toLowerCase();const oe=8&a?ne:null;if(oe&&-1!==Tm(oe,k,0)||2&a&&k!==ne){if(mo(a))return!1;b=!0}}}}else{if(!b&&!mo(a)&&!mo(S))return!1;if(b&&mo(S))continue;b=!1,a=S|1&a}}return mo(a)||b}function mo(e){return 0==(1&e)}function S_(e,t,r,a){if(null===t)return-1;let u=0;if(a||!r){let g=!1;for(;u<t.length;){const b=t[u];if(b===e)return u;if(3===b||6===b)g=!0;else{if(1===b||2===b){let E=t[++u];for(;"string"==typeof E;)E=t[++u];continue}if(4===b)break;if(0===b){u+=4;continue}}u+=g?1:2}return-1}return function Sm(e,t){let r=e.indexOf(4);if(r>-1)for(r++;r<e.length;){const a=e[r];if("number"==typeof a)return-1;if(a===t)return r;r++}return-1}(t,e)}function Jh(e,t,r=!1){for(let a=0;a<t.length;a++)if(C_(e,t[a],r))return!0;return!1}function Ku(e,t){return e?":not("+t.trim()+")":t}function zp(e){let t=e[0],r=1,a=2,u="",g=!1;for(;r<e.length;){let b=e[r];if("string"==typeof b)if(2&a){const E=e[++r];u+="["+b+(E.length>0?'="'+E+'"':"")+"]"}else 8&a?u+="."+b:4&a&&(u+=" "+b);else""!==u&&!mo(b)&&(t+=Ku(g,u),u=""),a=b,g=g||!mo(a);r++}return""!==u&&(t+=Ku(g,u)),t}const St={};function js(e){Qh($t(),Be(),H()+e,ml())}function Qh(e,t,r,a){if(!a)if(3==(3&t[2])){const g=e.preOrderCheckHooks;null!==g&&be(t,g,r)}else{const g=e.preOrderHooks;null!==g&&xe(t,g,0,r)}Z(r)}function Bc(e,t){return e<<17|t<<2}function ji(e){return e>>17&32767}function Yu(e){return 2|e}function hs(e){return(131068&e)>>2}function Nc(e,t){return-131069&e|t<<2}function Bp(e){return 1|e}function Qu(e,t){const r=e.contentQueries;if(null!==r)for(let a=0;a<r.length;a+=2){const u=r[a],g=r[a+1];if(-1!==g){const b=e.data[g];c(u),b.contentQueries(2,t[g],g)}}}function Ll(e,t,r,a,u,g,b,E,S,k){const B=t.blueprint.slice();return B[0]=u,B[2]=140|a,hu(B),B[3]=B[15]=e,B[8]=r,B[10]=b||e&&e[10],B[11]=E||e&&e[11],B[12]=S||e&&e[12]||null,B[9]=k||e&&e[9]||null,B[6]=g,B[16]=2==t.type?e[16]:B,B}function Pa(e,t,r,a,u){let g=e.data[t];if(null===g)g=function go(e,t,r,a,u){const g=_u(),b=bc(),S=e.data[t]=function N_(e,t,r,a,u,g){return{type:r,index:a,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:u,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,b?g:g&&g.parent,r,t,a,u);return null===e.firstChild&&(e.firstChild=S),null!==g&&(b?null==g.child&&null!==S.parent&&(g.child=S):null===g.next&&(g.next=S)),S}(e,t,r,a,u),function yu(){return xt.lFrame.inI18n}()&&(g.flags|=64);else if(64&g.type){g.type=r,g.value=a,g.attrs=u;const b=function Ea(){const e=xt.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();g.injectorIndex=null===b?-1:b.injectorIndex}return ai(g,!0),g}function ka(e,t,r,a){if(0===r)return-1;const u=t.length;for(let g=0;g<r;g++)t.push(a),e.blueprint.push(a),e.data.push(null);return u}function Fl(e,t,r){v(t);try{const a=e.viewQuery;null!==a&&Ne(1,a,r);const u=e.template;null!==u&&qp(e,t,u,1,r),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Qu(e,t),e.staticViewQueries&&Ne(2,e.viewQuery,r);const g=e.components;null!==g&&function Vc(e,t){for(let r=0;r<t.length;r++)ue(e,t[r])}(t,g)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),a}finally{t[2]&=-5,L()}}function ci(e,t,r,a){const u=t[2];if(256==(256&u))return;v(t);const g=ml();try{hu(t),function gl(e){return xt.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==r&&qp(e,t,r,2,a);const b=3==(3&u);if(!g)if(b){const k=e.preOrderCheckHooks;null!==k&&be(t,k,null)}else{const k=e.preOrderHooks;null!==k&&xe(t,k,0,null),Ce(t,0)}if(function K(e){for(let t=bp(e);null!==t;t=wp(t)){if(!t[2])continue;const r=t[9];for(let a=0;a<r.length;a++){const u=r[a],g=u[3];0==(1024&u[2])&&Ms(g,1),u[2]|=1024}}}(t),function $(e){for(let t=bp(e);null!==t;t=wp(t))for(let r=10;r<t.length;r++){const a=t[r],u=a[1];vc(a)&&ci(u,a,u.template,a[8])}}(t),null!==e.contentQueries&&Qu(e,t),!g)if(b){const k=e.contentCheckHooks;null!==k&&be(t,k)}else{const k=e.contentHooks;null!==k&&xe(t,k,1),Ce(t,1)}!function zm(e,t){const r=e.hostBindingOpCodes;if(null!==r)try{for(let a=0;a<r.length;a++){const u=r[a];if(u<0)Z(~u);else{const g=u,b=r[++a],E=r[++a];Kd(b,g),E(2,t[g])}}}finally{Z(-1)}}(e,t);const E=e.components;null!==E&&function B_(e,t){for(let r=0;r<t.length;r++)te(e,t[r])}(t,E);const S=e.viewQuery;if(null!==S&&Ne(2,S,a),!g)if(b){const k=e.viewCheckHooks;null!==k&&be(t,k)}else{const k=e.viewHooks;null!==k&&xe(t,k,2),Ce(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),g||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Ms(t[3],-1))}finally{L()}}function Ol(e,t,r,a){const u=t[10],g=!ml(),b=uu(t);try{g&&!b&&u.begin&&u.begin(),b&&Fl(e,t,a),ci(e,t,r,a)}finally{g&&!b&&u.end&&u.end()}}function qp(e,t,r,a,u){const g=H(),b=2&a;try{Z(-1),b&&t.length>20&&Qh(e,t,20,ml()),r(a,u)}finally{Z(g)}}function Uc(e,t,r){!fu()||(function $m(e,t,r,a){const u=r.directiveStart,g=r.directiveEnd;e.firstCreatePass||Mo(r,t),li(a,t);const b=r.initialInputs;for(let E=u;E<g;E++){const S=e.data[E],k=Un(S);k&&w(t,r,S);const B=xu(t,e,E,r);li(B,t),null!==b&&M(0,E-u,B,S,0,b),k&&(wr(r.index,t)[8]=B)}}(e,t,r,Ye(r,t)),128==(128&r.flags)&&function o(e,t,r){const a=r.directiveStart,u=r.directiveEnd,b=r.index,E=function Yd(){return xt.lFrame.currentDirectiveIndex}();try{Z(b);for(let S=a;S<u;S++){const k=e.data[S],B=t[S];is(S),(null!==k.hostBindings||0!==k.hostVars||null!==k.hostAttrs)&&n(k,B)}}finally{Z(-1),is(E)}}(e,t,r))}function ud(e,t,r=Ye){const a=t.localNames;if(null!==a){let u=t.index+1;for(let g=0;g<a.length;g+=2){const b=a[g+1],E=-1===b?r(t,e):e[b];e[u++]=E}}}function Wp(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=hd(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function hd(e,t,r,a,u,g,b,E,S,k){const B=20+a,j=B+u,ne=function Bm(e,t){const r=[];for(let a=0;a<t;a++)r.push(a<e?null:St);return r}(B,j),oe="function"==typeof k?k():k;return ne[1]={type:e,blueprint:ne,template:r,queries:null,viewQuery:E,declTNode:t,data:ne.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:j,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof b?b():b,firstChild:null,schemas:S,consts:oe,incompleteFirstPass:!1}}function Kp(e,t,r,a){const u=Qe(t);null===r?u.push(a):(u.push(r),e.firstCreatePass&&yt(e).push(a,u.length-1))}function jc(e,t,r){for(let a in e)if(e.hasOwnProperty(a)){const u=e[a];(r=null===r?{}:r).hasOwnProperty(a)?r[a].push(t,u):r[a]=[t,u]}return r}function pd(e,t,r,a){let u=!1;if(fu()){const g=function s(e,t,r){const a=e.directiveRegistry;let u=null;if(a)for(let g=0;g<a.length;g++){const b=a[g];Jh(r,b.selectors,!1)&&(u||(u=[]),ks(Mo(r,t),e,b.type),Un(b)?(l(e,r),u.unshift(b)):u.push(b))}return u}(e,t,r),b=null===a?null:{"":-1};if(null!==g){u=!0,_(r,e.data.length,g.length);for(let B=0;B<g.length;B++){const j=g[B];j.providersResolver&&j.providersResolver(j)}let E=!1,S=!1,k=ka(e,t,g.length,null);for(let B=0;B<g.length;B++){const j=g[B];r.mergedAttrs=Qn(r.mergedAttrs,j.hostAttrs),x(e,r,t,k,j),f(k,j,b),null!==j.contentQueries&&(r.flags|=8),(null!==j.hostBindings||null!==j.hostAttrs||0!==j.hostVars)&&(r.flags|=128);const ne=j.type.prototype;!E&&(ne.ngOnChanges||ne.ngOnInit||ne.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(r.index),E=!0),!S&&(ne.ngOnChanges||ne.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(r.index),S=!0),k++}!function eh(e,t){const a=t.directiveEnd,u=e.data,g=t.attrs,b=[];let E=null,S=null;for(let k=t.directiveStart;k<a;k++){const B=u[k],j=B.inputs,ne=null===g||Al(t)?null:P(j,g);b.push(ne),E=jc(j,k,E),S=jc(B.outputs,k,S)}null!==E&&(E.hasOwnProperty("class")&&(t.flags|=16),E.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=b,t.inputs=E,t.outputs=S}(e,r)}b&&function h(e,t,r){if(t){const a=e.localNames=[];for(let u=0;u<t.length;u+=2){const g=r[t[u+1]];if(null==g)throw new Ar("301",`Export of name '${t[u+1]}' not found!`);a.push(t[u],g)}}}(r,a,b)}return r.mergedAttrs=Qn(r.mergedAttrs,r.attrs),u}function Um(e,t,r,a,u,g){const b=g.hostBindings;if(b){let E=e.hostBindingOpCodes;null===E&&(E=e.hostBindingOpCodes=[]);const S=~t.index;(function jm(e){let t=e.length;for(;t>0;){const r=e[--t];if("number"==typeof r&&r<0)return r}return 0})(E)!=S&&E.push(S),E.push(a,u,b)}}function n(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function l(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function f(e,t,r){if(r){if(t.exportAs)for(let a=0;a<t.exportAs.length;a++)r[t.exportAs[a]]=e;Un(t)&&(r[""]=e)}}function _(e,t,r){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+r,e.providerIndexes=t}function x(e,t,r,a,u){e.data[a]=u;const g=u.factory||(u.factory=Jn(u.type)),b=new Ue(g,Un(u),null);e.blueprint[a]=b,r[a]=b,Um(e,t,0,a,ka(e,r,u.hostVars,St),u)}function w(e,t,r){const a=Ye(t,e),u=Wp(r),g=e[10],b=he(e,Ll(e,u,null,r.onPush?64:16,a,t,g,g.createRenderer(a,r),null,null));e[t.index]=b}function M(e,t,r,a,u,g){const b=g[t];if(null!==b){const E=a.setInput;for(let S=0;S<b.length;){const k=b[S++],B=b[S++],j=b[S++];null!==E?a.setInput(r,j,k,B):r[B]=j}}}function P(e,t){let r=null,a=0;for(;a<t.length;){const u=t[a];if(0!==u)if(5!==u){if("number"==typeof u)break;e.hasOwnProperty(u)&&(null===r&&(r=[]),r.push(u,e[u],t[a+1])),a+=2}else a+=2;else a+=4}return r}function N(e,t,r,a){return new Array(e,!0,!1,t,null,0,a,r,null,null)}function te(e,t){const r=wr(t,e);if(vc(r)){const a=r[1];80&r[2]?ci(a,r,a.template,r[8]):r[5]>0&&se(r)}}function se(e){for(let a=bp(e);null!==a;a=wp(a))for(let u=10;u<a.length;u++){const g=a[u];if(1024&g[2]){const b=g[1];ci(b,g,b.template,g[8])}else g[5]>0&&se(g)}const r=e[1].components;if(null!==r)for(let a=0;a<r.length;a++){const u=wr(r[a],e);vc(u)&&u[5]>0&&se(u)}}function ue(e,t){const r=wr(t,e),a=r[1];(function pe(e,t){for(let r=t.length;r<e.blueprint.length;r++)t.push(e.blueprint[r])})(a,r),Fl(a,r,r[8])}function he(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function fe(e){for(;e;){e[2]|=64;const t=Nu(e);if(dc(e)&&!t)return e;e=t}return null}function Ze(e,t,r){const a=t[10];a.begin&&a.begin();try{ci(e,t,e.template,r)}catch(u){throw ut(t,u),u}finally{a.end&&a.end()}}function Oe(e){!function Ee(e){for(let t=0;t<e.components.length;t++){const r=e.components[t],a=Gh(r),u=a[1];Ol(u,a,u.template,r)}}(e[8])}function Ne(e,t,r){c(0),t(e,r)}const Ke=(()=>Promise.resolve(null))();function Qe(e){return e[7]||(e[7]=[])}function yt(e){return e.cleanup||(e.cleanup=[])}function ut(e,t){const r=e[9],a=r?r.get(Sl,null):null;a&&a.handleError(t)}function Wt(e,t,r,a,u){for(let g=0;g<r.length;){const b=r[g++],E=r[g++],S=t[b],k=e.data[b];null!==k.setInput?k.setInput(S,u,a,E):S[E]=u}}function He(e,t,r){const a=rs(t,e);!function gm(e,t,r){Fn(e)?e.setValue(t,r):t.textContent=r}(e[11],a,r)}function sn(e,t,r){let a=r?e.styles:null,u=r?e.classes:null,g=0;if(null!==t)for(let b=0;b<t.length;b++){const E=t[b];"number"==typeof E?g=E:1==g?u=Ur(u,E):2==g&&(a=Ur(a,E+": "+t[++b]+";"))}r?e.styles=a:e.stylesWithoutHost=a,r?e.classes=u:e.classesWithoutHost=u}const Wn=new rn("INJECTOR",-1);class mr{get(t,r=xl){if(r===xl){const a=new Error(`NullInjectorError: No provider for ${Pt(t)}!`);throw a.name="NullInjectorError",a}return r}}const on=new rn("Set Injector scope."),Ut={},Rn={};let gr;function Xn(){return void 0===gr&&(gr=new mr),gr}function sr(e,t=null,r=null,a){const u=Ir(e,t,r,a);return u._resolveInjectorDefTypes(),u}function Ir(e,t=null,r=null,a){return new zn(e,r,t||Xn(),a)}class zn{constructor(t,r,a,u=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];r&&ss(r,E=>this.processProvider(E,t,r)),ss([t],E=>this.processInjectorType(E,[],g)),this.records.set(Wn,In(void 0,this));const b=this.records.get(on);this.scope=null!=b?b.value:null,this.source=u||("object"==typeof t?null:Pt(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,r=xl,a=_t.Default){this.assertNotDestroyed();const u=lp(this),g=Dt(void 0);try{if(!(a&_t.SkipSelf)){let E=this.records.get(t);if(void 0===E){const S=function Gi(e){return"function"==typeof e||"object"==typeof e&&e instanceof rn}(t)&&nc(t);E=S&&this.injectableDefInScope(S)?In(Kr(t),Ut):null,this.records.set(t,E)}if(null!=E)return this.hydrate(t,E)}return(a&_t.Self?Xn():this.parent).get(t,r=a&_t.Optional&&r===xl?null:r)}catch(b){if("NullInjectorError"===b.name){if((b[kh]=b[kh]||[]).unshift(Pt(t)),u)throw b;return function zg(e,t,r,a){const u=e[kh];throw t[Uf]&&u.unshift(t[Uf]),e.message=function Bg(e,t,r,a=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let u=Pt(t);if(Array.isArray(t))u=t.map(Pt).join(" -> ");else if("object"==typeof t){let g=[];for(let b in t)if(t.hasOwnProperty(b)){let E=t[b];g.push(b+":"+("string"==typeof E?JSON.stringify(E):Pt(E)))}u=`{${g.join(", ")}}`}return`${r}${a?"("+a+")":""}[${u}]: ${e.replace(Og,"\n  ")}`}("\n"+e.message,u,r,a),e.ngTokenPath=u,e[kh]=null,e}(b,t,"R3InjectorError",this.source)}throw b}finally{Dt(g),lp(u)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((a,u)=>t.push(Pt(u))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,r,a){if(!(t=gt(t)))return!1;let u=di(t);const g=null==u&&t.ngModule||void 0,b=void 0===g?t:g,E=-1!==a.indexOf(b);if(void 0!==g&&(u=di(g)),null==u)return!1;if(null!=u.imports&&!E){let B;a.push(b);try{ss(u.imports,j=>{this.processInjectorType(j,r,a)&&(void 0===B&&(B=[]),B.push(j))})}finally{}if(void 0!==B)for(let j=0;j<B.length;j++){const{ngModule:ne,providers:oe}=B[j];ss(oe,ye=>this.processProvider(ye,ne,oe||hn))}}this.injectorDefTypes.add(b);const S=Jn(b)||(()=>new b);this.records.set(b,In(S,Ut));const k=u.providers;if(null!=k&&!E){const B=t;ss(k,j=>this.processProvider(j,B,k))}return void 0!==g&&void 0!==t.providers}processProvider(t,r,a){let u=nr(t=gt(t))?t:gt(t&&t.provide);const g=function tr(e,t,r){return Bn(e)?In(void 0,e.useValue):In(function Kn(e,t,r){let a;if(nr(e)){const u=gt(e);return Jn(u)||Kr(u)}if(Bn(e))a=()=>gt(e.useValue);else if(function wn(e){return!(!e||!e.useFactory)}(e))a=()=>e.useFactory(...Mc(e.deps||[]));else if(function ar(e){return!(!e||!e.useExisting)}(e))a=()=>Lt(gt(e.useExisting));else{const u=gt(e&&(e.useClass||e.provide));if(!function $i(e){return!!e.deps}(e))return Jn(u)||Kr(u);a=()=>new u(...Mc(e.deps))}return a}(e),Ut)}(t);if(nr(t)||!0!==t.multi)this.records.get(u);else{let b=this.records.get(u);b||(b=In(void 0,Ut,!0),b.factory=()=>Mc(b.multi),this.records.set(u,b)),u=t,b.multi.push(t)}this.records.set(u,g)}hydrate(t,r){return r.value===Ut&&(r.value=Rn,r.value=r.factory()),"object"==typeof r.value&&r.value&&function _o(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(r.value)&&this.onDestroy.add(r.value),r.value}injectableDefInScope(t){if(!t.providedIn)return!1;const r=gt(t.providedIn);return"string"==typeof r?"any"===r||r===this.scope:this.injectorDefTypes.has(r)}}function Kr(e){const t=nc(e),r=null!==t?t.factory:Jn(e);if(null!==r)return r;if(e instanceof rn)throw new Error(`Token ${Pt(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function bn(e){const t=e.length;if(t>0){const a=function Po(e,t){const r=[];for(let a=0;a<e;a++)r.push(t);return r}(t,"?");throw new Error(`Can't resolve all parameters for ${Pt(e)}: (${a.join(", ")}).`)}const r=function ph(e){const t=e&&(e[ua]||e[ha]);if(t){const r=function Vd(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${r}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${r}" class.`),t}return null}(e);return null!==r?()=>r.factory(e):()=>new e}(e);throw new Error("unreachable")}function In(e,t,r=!1){return{factory:e,value:t,multi:r?[]:void 0}}function Bn(e){return null!==e&&"object"==typeof e&&ap in e}function nr(e){return"function"==typeof e}let Cn=(()=>{class e{static create(r,a){var u;if(Array.isArray(r))return sr({name:""},a,r,"");{const g=null!==(u=r.name)&&void 0!==u?u:"";return sr({name:g},r.parent,r.providers,g)}}}return e.THROW_IF_NOT_FOUND=xl,e.NULL=new mr,e.\u0275prov=nn({token:e,providedIn:"any",factory:()=>Lt(Wn)}),e.__NG_ELEMENT_ID__=-1,e})();function cw(e,t){ae(Gh(e)[1],On())}let qm=null;function md(){if(!qm){const e=un.Symbol;if(e&&e.iterator)qm=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let r=0;r<t.length;++r){const a=t[r];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(qm=a)}}}return qm}function Qp(e){return!!G_(e)&&(Array.isArray(e)||!(e instanceof Map)&&md()in e)}function G_(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Pi(e,t,r){return!Object.is(e[t],r)&&(e[t]=r,!0)}function Td(e,t,r,a,u,g,b,E){const S=Be(),k=$t(),B=e+20,j=k.firstCreatePass?function xw(e,t,r,a,u,g,b,E,S){const k=t.consts,B=Pa(t,e,4,b||null,So(k,E));pd(t,r,B,So(k,S)),ae(t,B);const j=B.tViews=hd(2,B,a,u,g,t.directiveRegistry,t.pipeRegistry,null,t.schemas,k);return null!==t.queries&&(t.queries.template(t,B),j.queries=t.queries.embeddedTView(B)),B}(B,k,S,t,r,a,u,g,b):k.data[B];ai(j,!1);const ne=S[11].createComment("");Hu(k,S,ne,j),li(ne,S),he(S,S[B]=N(ne,S,ne,j)),Ni(j)&&Uc(k,S,j),null!=b&&ud(S,j,E)}function H_(e){return function lo(e,t){return e[t]}(function fl(){return xt.lFrame.contextLView}(),20+e)}function Mt(e,t=_t.Default){const r=Be();return null===r?Lt(e,t):yl(On(),r,gt(e),t)}function sh(e,t,r){const a=Be();return Pi(a,uo(),t)&&function Xr(e,t,r,a,u,g,b,E){const S=Ye(t,r);let B,k=t.inputs;!E&&null!=k&&(B=k[a])?(Wt(e,r,B,a,u),Do(t)&&function dd(e,t){const r=wr(t,e);16&r[2]||(r[2]|=64)}(r,t.index)):3&t.type&&(a=function th(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(a),u=null!=b?b(u,t.value||"",a):u,Fn(g)?g.setProperty(S,a,u):$n(a)||(S.setProperty?S.setProperty(a,u):S[a]=u))}($t(),function G(){const e=xt.lFrame;return pl(e.tView,e.selectedIndex)}(),a,e,t,a[11],r,!1),sh}function K_(e,t,r,a,u){const b=u?"class":"style";Wt(e,r,t.inputs[b],b,a)}function Yr(e,t,r,a){const u=Be(),g=$t(),b=20+e,E=u[11],S=u[b]=ju(E,t,function W(){return xt.lFrame.currentNamespace}()),k=g.firstCreatePass?function jw(e,t,r,a,u,g,b){const E=t.consts,k=Pa(t,e,2,u,So(E,g));return pd(t,r,k,So(E,b)),null!==k.attrs&&sn(k,k.attrs,!1),null!==k.mergedAttrs&&sn(k,k.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,k),k}(b,g,u,0,t,r,a):g.data[b];ai(k,!0);const B=k.mergedAttrs;null!==B&&ft(E,S,B);const j=k.classes;null!==j&&Fp(E,S,j);const ne=k.styles;null!==ne&&Xu(E,S,ne),64!=(64&k.flags)&&Hu(g,u,S,k),0===function wa(){return xt.lFrame.elementDepthCount}()&&li(S,u),function xc(){xt.lFrame.elementDepthCount++}(),Ni(k)&&(Uc(g,u,k),function Zp(e,t,r){if(hc(t)){const u=t.directiveEnd;for(let g=t.directiveStart;g<u;g++){const b=e.data[g];b.contentQueries&&b.contentQueries(1,r[g],g)}}}(g,k,u)),null!==a&&ud(u,k)}function Jr(){let e=On();bc()?function co(){xt.lFrame.isParent=!1}():(e=e.parent,ai(e,!1));const t=e;!function pu(){xt.lFrame.elementDepthCount--}();const r=$t();r.firstCreatePass&&(ae(r,e),hc(e)&&r.queries.elementEnd(e)),null!=t.classesWithoutHost&&function ht(e){return 0!=(16&e.flags)}(t)&&K_(r,t,Be(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function dt(e){return 0!=(32&e.flags)}(t)&&K_(r,t,Be(),t.stylesWithoutHost,!1)}function Fa(e,t,r,a){Yr(e,t,r,a),Jr()}function Y_(){return Be()}function J_(e){return!!e&&"function"==typeof e.then}const Hw=function xx(e){return!!e&&"function"==typeof e.subscribe};function ah(e,t,r,a){const u=Be(),g=$t(),b=On();return function wx(e,t,r,a,u,g,b,E){const S=Ni(a),B=e.firstCreatePass&&yt(e),j=t[8],ne=Qe(t);let oe=!0;if(3&a.type||E){const qe=Ye(a,t),je=E?E(qe):qe,Re=ne.length,ct=E?Ft=>E(fn(Ft[a.index])):a.index;if(Fn(r)){let Ft=null;if(!E&&S&&(Ft=function qw(e,t,r,a){const u=e.cleanup;if(null!=u)for(let g=0;g<u.length-1;g+=2){const b=u[g];if(b===r&&u[g+1]===a){const E=t[7],S=u[g+2];return E.length>S?E[S]:null}"string"==typeof b&&(g+=2)}return null}(e,t,u,a.index)),null!==Ft)(Ft.__ngLastListenerFn__||Ft).__ngNextListenerFn__=g,Ft.__ngLastListenerFn__=g,oe=!1;else{g=Q_(a,t,j,g,!1);const _n=r.listen(je,u,g);ne.push(g,_n),B&&B.push(u,ct,Re,Re+1)}}else g=Q_(a,t,j,g,!0),je.addEventListener(u,g,b),ne.push(g),B&&B.push(u,ct,Re,b)}else g=Q_(a,t,j,g,!1);const ye=a.outputs;let Fe;if(oe&&null!==ye&&(Fe=ye[u])){const qe=Fe.length;if(qe)for(let je=0;je<qe;je+=2){const No=t[Fe[je]][Fe[je+1]].subscribe(g),uh=ne.length;ne.push(g,No),B&&B.push(u,a.index,uh,-(uh+1))}}}(g,u,u[11],b,e,t,!!r,a),ah}function Ex(e,t,r,a){try{return!1!==r(a)}catch(u){return ut(e,u),!1}}function Q_(e,t,r,a,u){return function g(b){if(b===Function)return a;const E=2&e.flags?wr(e.index,t):t;0==(32&t[2])&&fe(E);let S=Ex(t,0,a,b),k=g.__ngNextListenerFn__;for(;k;)S=Ex(t,0,k,b)&&S,k=k.__ngNextListenerFn__;return u&&!1===S&&(b.preventDefault(),b.returnValue=!1),S}}function tf(e=1){return function F(e){return(xt.lFrame.contextLView=function U(e,t){for(;e>0;)t=t[15],e--;return t}(e,xt.lFrame.contextLView))[8]}(e)}function Rx(e,t,r,a,u){const g=e[r+1],b=null===t;let E=a?ji(g):hs(g),S=!1;for(;0!==E&&(!1===S||b);){const B=e[E+1];Jw(e[E],t)&&(S=!0,e[E+1]=a?Bp(B):Yu(B)),E=a?ji(B):hs(B)}S&&(e[r+1]=a?Yu(g):Bp(g))}function Jw(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&_i(e,t)>=0}function ty(e,t){return function Xs(e,t,r,a){const u=Be(),g=$t(),b=function Vi(e){const t=xt.lFrame,r=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,r}(2);g.firstUpdatePass&&function jx(e,t,r,a){const u=e.data;if(null===u[r+1]){const g=u[H()],b=function Ux(e,t){return t>=e.expandoStartIndex}(e,r);(function qx(e,t){return 0!=(e.flags&(t?16:32))})(g,a)&&null===t&&!b&&(t=!1),t=function aE(e,t,r,a){const u=function p(e){const t=xt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let g=a?t.residualClasses:t.residualStyles;if(null===u)0===(a?t.classBindings:t.styleBindings)&&(r=nf(r=ny(null,e,t,r,a),t.attrs,a),g=null);else{const b=t.directiveStylingLast;if(-1===b||e[b]!==u)if(r=ny(u,e,t,r,a),null===g){let S=function lE(e,t,r){const a=r?t.classBindings:t.styleBindings;if(0!==hs(a))return e[ji(a)]}(e,t,a);void 0!==S&&Array.isArray(S)&&(S=ny(null,e,t,S[1],a),S=nf(S,t.attrs,a),function cE(e,t,r,a){e[ji(r?t.classBindings:t.styleBindings)]=a}(e,t,a,S))}else g=function uE(e,t,r){let a;const u=t.directiveEnd;for(let g=1+t.directiveStylingLast;g<u;g++)a=nf(a,e[g].hostAttrs,r);return nf(a,t.attrs,r)}(e,t,a)}return void 0!==g&&(a?t.residualClasses=g:t.residualStyles=g),r}(u,g,t,a),function Kw(e,t,r,a,u,g){let b=g?t.classBindings:t.styleBindings,E=ji(b),S=hs(b);e[a]=r;let B,k=!1;if(Array.isArray(r)){const j=r;B=j[1],(null===B||_i(j,B)>0)&&(k=!0)}else B=r;if(u)if(0!==S){const ne=ji(e[E+1]);e[a+1]=Bc(ne,E),0!==ne&&(e[ne+1]=Nc(e[ne+1],a)),e[E+1]=function P_(e,t){return 131071&e|t<<17}(e[E+1],a)}else e[a+1]=Bc(E,0),0!==E&&(e[E+1]=Nc(e[E+1],a)),E=a;else e[a+1]=Bc(S,0),0===E?E=a:e[S+1]=Nc(e[S+1],a),S=a;k&&(e[a+1]=Yu(e[a+1])),Rx(e,B,a,!0),Rx(e,B,a,!1),function Yw(e,t,r,a,u){const g=u?e.residualClasses:e.residualStyles;null!=g&&"string"==typeof t&&_i(g,t)>=0&&(r[a+1]=Bp(r[a+1]))}(t,B,e,a,g),b=Bc(E,S),g?t.classBindings=b:t.styleBindings=b}(u,g,t,r,b,a)}}(g,e,b,a),t!==St&&Pi(u,b,t)&&function Gx(e,t,r,a,u,g,b,E){if(!(3&t.type))return;const S=e.data,k=S[E+1];Xm(function Am(e){return 1==(1&e)}(k)?Hx(S,t,r,u,hs(k),b):void 0)||(Xm(g)||function $s(e){return 2==(2&e)}(k)&&(g=Hx(S,null,r,u,E,b)),function Yh(e,t,r,a,u){const g=Fn(e);if(t)u?g?e.addClass(r,a):r.classList.add(a):g?e.removeClass(r,a):r.classList.remove(a);else{let b=-1===a.indexOf("-")?void 0:Mi.DashCase;if(null==u)g?e.removeStyle(r,a,b):r.style.removeProperty(a);else{const E="string"==typeof u&&u.endsWith("!important");E&&(u=u.slice(0,-10),b|=Mi.Important),g?e.setStyle(r,a,u,b):r.style.setProperty(a,u,E?"important":"")}}}(a,b,rs(H(),r),u,g))}(g,g.data[H()],u,u[11],e,u[b+1]=function pE(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=Pt(function Ro(e){return e instanceof class Ii{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?e.changingThisBreaksApplicationSecurity:e}(e)))),e}(t,r),a,b)}(e,t,null,!0),ty}function ny(e,t,r,a,u){let g=null;const b=r.directiveEnd;let E=r.directiveStylingLast;for(-1===E?E=r.directiveStart:E++;E<b&&(g=t[E],a=nf(a,g.hostAttrs,u),g!==e);)E++;return null!==e&&(r.directiveStylingLast=E),a}function nf(e,t,r){const a=r?1:2;let u=-1;if(null!==t)for(let g=0;g<t.length;g++){const b=t[g];"number"==typeof b?u=b:u===a&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),gi(e,b,!!r||t[++g]))}return void 0===e?null:e}function Hx(e,t,r,a,u,g){const b=null===t;let E;for(;u>0;){const S=e[u],k=Array.isArray(S),B=k?S[1]:S,j=null===B;let ne=r[u+1];ne===St&&(ne=j?hn:void 0);let oe=j?Fs(ne,a):B===a?ne:void 0;if(k&&!Xm(oe)&&(oe=Fs(S,a)),Xm(oe)&&(E=oe,b))return E;const ye=e[u+1];u=b?ji(ye):hs(ye)}if(null!==t){let S=g?t.residualClasses:t.residualStyles;null!=S&&(E=Fs(S,a))}return E}function Xm(e){return void 0!==e}function $c(e,t=""){const r=Be(),a=$t(),u=e+20,g=a.firstCreatePass?Pa(a,u,1,t,null):a.data[u],b=r[u]=function Ep(e,t){return Fn(e)?e.createText(t):e.createTextNode(t)}(r[11],t);Hu(a,r,b,g),ai(g,!1)}function rf(e,t,r){const a=Be(),u=function _d(e,t,r,a){return Pi(e,uo(),r)?t+vt(r)+a:St}(a,e,t,r);return u!==St&&He(a,H(),u),rf}const lh=void 0;var RE=["en",[["a","p"],["AM","PM"],lh],[["AM","PM"],lh,lh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],lh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],lh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",lh,"{1} 'at' {0}",lh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function kE(e){const r=Math.floor(Math.abs(e)),a=e.toString().replace(/^[^.]*\.?/,"").length;return 1===r&&0===a?1:5}];let Id={};function m0(e){return e in Id||(Id[e]=un.ng&&un.ng.common&&un.ng.common.locales&&un.ng.common.locales[e]),Id[e]}var rt=(()=>((rt=rt||{})[rt.LocaleId=0]="LocaleId",rt[rt.DayPeriodsFormat=1]="DayPeriodsFormat",rt[rt.DayPeriodsStandalone=2]="DayPeriodsStandalone",rt[rt.DaysFormat=3]="DaysFormat",rt[rt.DaysStandalone=4]="DaysStandalone",rt[rt.MonthsFormat=5]="MonthsFormat",rt[rt.MonthsStandalone=6]="MonthsStandalone",rt[rt.Eras=7]="Eras",rt[rt.FirstDayOfWeek=8]="FirstDayOfWeek",rt[rt.WeekendRange=9]="WeekendRange",rt[rt.DateFormat=10]="DateFormat",rt[rt.TimeFormat=11]="TimeFormat",rt[rt.DateTimeFormat=12]="DateTimeFormat",rt[rt.NumberSymbols=13]="NumberSymbols",rt[rt.NumberFormats=14]="NumberFormats",rt[rt.CurrencyCode=15]="CurrencyCode",rt[rt.CurrencySymbol=16]="CurrencySymbol",rt[rt.CurrencyName=17]="CurrencyName",rt[rt.Currencies=18]="Currencies",rt[rt.Directionality=19]="Directionality",rt[rt.PluralCase=20]="PluralCase",rt[rt.ExtraData=21]="ExtraData",rt))();const Km="en-US";let g0=Km;class U0{}class OD{resolveComponentFactory(t){throw function FD(e){const t=Error(`No component factory found for ${Pt(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let cf=(()=>{class e{}return e.NULL=new OD,e})();function zD(){return Ad(On(),Be())}function Ad(e,t){return new Pd(Ye(e,t))}let Pd=(()=>{class e{constructor(r){this.nativeElement=r}}return e.__NG_ELEMENT_ID__=zD,e})();function BD(e){return e instanceof Pd?e.nativeElement:e}class $0{}let G0=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>function VD(){const e=Be(),r=wr(On().index,e);return function ND(e){return e[11]}(br(r)?r:e)}(),e})(),UD=(()=>{class e{}return e.\u0275prov=nn({token:e,providedIn:"root",factory:()=>null}),e})();class cy{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const jD=new cy("13.0.3"),uy={};function tg(e,t,r,a,u=!1){for(;null!==r;){const g=t[r.index];if(null!==g&&a.push(fn(g)),si(g))for(let E=10;E<g.length;E++){const S=g[E],k=S[1].firstChild;null!==k&&tg(S[1],S,k,a)}const b=r.type;if(8&b)tg(e,t,r.child,a);else if(32&b){const E=xp(r,t);let S;for(;S=E();)a.push(S)}else if(16&b){const E=zc(t,r);if(Array.isArray(E))a.push(...E);else{const S=Nu(t[16]);tg(S[1],S,E,a,!0)}}r=u?r.projectionNext:r.next}return a}class uf{constructor(t,r){this._lView=t,this._cdRefInjectingView=r,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,r=t[1];return tg(r,t,r.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(si(t)){const r=t[8],a=r?r.indexOf(this):-1;a>-1&&(Cp(t,a),Rt(r,a))}this._attachedToViewContainer=!1}Sp(this._lView[1],this._lView)}onDestroy(t){Kp(this._lView[1],this._lView,null,t)}markForCheck(){fe(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Ze(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Ae(e,t,r){Da(!0);try{Ze(e,t,r)}finally{Da(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ui(e,t){us(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class $D extends uf{constructor(t){super(t),this._view=t}detectChanges(){Oe(this._view)}checkNoChanges(){!function ze(e){Da(!0);try{Oe(e)}finally{Da(!1)}}(this._view)}get context(){return null}}class H0 extends cf{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const r=ir(t);return new hy(r,this.ngModule)}}function q0(e){const t=[];for(let r in e)e.hasOwnProperty(r)&&t.push({propName:e[r],templateName:r});return t}const HD=new rn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>um});class hy extends U0{constructor(t,r){super(),this.componentDef=t,this.ngModule=r,this.componentType=t.type,this.selector=function M_(e){return e.map(zp).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!r}get inputs(){return q0(this.componentDef.inputs)}get outputs(){return q0(this.componentDef.outputs)}create(t,r,a,u){const g=(u=u||this.ngModule)?function qD(e,t){return{get:(r,a,u)=>{const g=e.get(r,uy,u);return g!==uy||a===uy?g:t.get(r,a,u)}}}(t,u.injector):t,b=g.get($0,cu),E=g.get(UD,null),S=b.createRenderer(null,this.componentDef),k=this.componentDef.selectors[0][0]||"div",B=a?function Xp(e,t,r){if(Fn(e))return e.selectRootElement(t,r===ii.ShadowDom);let a="string"==typeof t?e.querySelector(t):t;return a.textContent="",a}(S,a,this.componentDef.encapsulation):ju(b.createRenderer(null,this.componentDef),k,function GD(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(k)),j=this.componentDef.onPush?576:528,ne=function Xv(e,t){return{components:[],scheduler:e||um,clean:Ke,playerHandler:t||null,flags:0}}(),oe=hd(0,null,null,1,0,null,null,null,null,null),ye=Ll(null,oe,ne,j,null,null,b,S,E,g);let Fe,qe;v(ye);try{const je=function Zv(e,t,r,a,u,g){const b=r[1];r[20]=e;const S=Pa(b,20,2,"#host",null),k=S.mergedAttrs=t.hostAttrs;null!==k&&(sn(S,k,!0),null!==e&&(ft(u,e,k),null!==S.classes&&Fp(u,e,S.classes),null!==S.styles&&Xu(u,e,S.styles)));const B=a.createRenderer(e,t),j=Ll(r,Wp(t),null,t.onPush?64:16,r[20],S,a,B,g||null,null);return b.firstCreatePass&&(ks(Mo(S,r),b,t.type),l(b,S),_(S,r.length,1)),he(r,j),r[20]=j}(B,this.componentDef,ye,b,S);if(B)if(a)ft(S,B,["ng-version",jD.full]);else{const{attrs:Re,classes:ct}=function A_(e){const t=[],r=[];let a=1,u=2;for(;a<e.length;){let g=e[a];if("string"==typeof g)2===u?""!==g&&t.push(g,e[++a]):8===u&&r.push(g);else{if(!mo(u))break;u=g}a++}return{attrs:t,classes:r}}(this.componentDef.selectors[0]);Re&&ft(S,B,Re),ct&&ct.length>0&&Fp(S,B,ct.join(" "))}if(qe=pl(oe,20),void 0!==r){const Re=qe.projection=[];for(let ct=0;ct<this.ngContentSelectors.length;ct++){const Ft=r[ct];Re.push(null!=Ft?Array.from(Ft):null)}}Fe=function Wv(e,t,r,a,u){const g=r[1],b=function U_(e,t,r){const a=On();e.firstCreatePass&&(r.providersResolver&&r.providersResolver(r),x(e,a,t,ka(e,t,1,null),r));const u=xu(t,e,a.directiveStart,a);li(u,t);const g=Ye(a,t);return g&&li(g,t),u}(g,r,t);if(a.components.push(b),e[8]=b,u&&u.forEach(S=>S(b,t)),t.contentQueries){const S=On();t.contentQueries(1,b,S.directiveStart)}const E=On();return!g.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(Z(E.index),Um(r[1],E,0,E.directiveStart,E.directiveEnd,t),n(t,b)),b}(je,this.componentDef,ye,ne,[cw]),Fl(oe,ye,null)}finally{L()}return new WD(this.componentType,Fe,Ad(qe,ye),ye,qe)}}class WD extends class LD{}{constructor(t,r,a,u,g){super(),this.location=a,this._rootLView=u,this._tNode=g,this.instance=r,this.hostView=this.changeDetectorRef=new $D(u),this.componentType=t}get injector(){return new Ec(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}class kd{}const Rd=new Map;class X0 extends kd{constructor(t,r){super(),this._parent=r,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new H0(this);const a=xr(t);this._bootstrapComponents=fo(a.bootstrap),this._r3Injector=Ir(t,r,[{provide:kd,useValue:this},{provide:cf,useValue:this.componentFactoryResolver}],Pt(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,r=Cn.THROW_IF_NOT_FOUND,a=_t.Default){return t===Cn||t===kd||t===Wn?this:this._r3Injector.get(t,r,a)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(r=>r()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class dy extends class KD{}{constructor(t){super(),this.moduleType=t,null!==xr(t)&&function YD(e){const t=new Set;!function r(a){const u=xr(a,!0),g=u.id;null!==g&&(function Z0(e,t,r){if(t&&t!==r)throw new Error(`Duplicate module registered for ${e} - ${Pt(t)} vs ${Pt(t.name)}`)}(g,Rd.get(g),a),Rd.set(g,a));const b=fo(u.imports);for(const E of b)t.has(E)||(t.add(E),r(E))}(e)}(t)}create(t){return new X0(this.moduleType,t)}}function py(e){return t=>{setTimeout(e,void 0,t)}}const Vl=class mT extends En{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,r,a){var u,g,b;let E=t,S=r||(()=>null),k=a;if(t&&"object"==typeof t){const j=t;E=null===(u=j.next)||void 0===u?void 0:u.bind(j),S=null===(g=j.error)||void 0===g?void 0:g.bind(j),k=null===(b=j.complete)||void 0===b?void 0:b.bind(j)}this.__isAsync&&(S=py(S),E&&(E=py(E)),k&&(k=py(k)));const B=super.subscribe({next:E,error:S,complete:k});return t instanceof Bt&&t.add(B),B}};function gT(){return this._results[md()]()}class fy{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const r=md(),a=fy.prototype;a[r]||(a[r]=gT)}get changes(){return this._changes||(this._changes=new Vl)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,r){return this._results.reduce(t,r)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,r){const a=this;a.dirty=!1;const u=po(t);(this._changesDetected=!function Ao(e,t,r){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++){let u=e[a],g=t[a];if(r&&(u=r(u),g=r(g)),g!==u)return!1}return!0}(a._results,u,r))&&(a._results=u,a.length=u.length,a.last=u[this.length-1],a.first=u[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Ul=(()=>{class e{}return e.__NG_ELEMENT_ID__=vT,e})();const _T=Ul,yT=class extends _T{constructor(t,r,a){super(),this._declarationLView=t,this._declarationTContainer=r,this.elementRef=a}createEmbeddedView(t){const r=this._declarationTContainer.tViews,a=Ll(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(r)),Fl(r,a,t),new uf(a)}};function vT(){return ng(On(),Be())}function ng(e,t){return 4&e.type?new yT(t,e,Ad(e,t)):null}let Ba=(()=>{class e{}return e.__NG_ELEMENT_ID__=xT,e})();function xT(){return r1(On(),Be())}const bT=Ba,t1=class extends bT{constructor(t,r,a){super(),this._lContainer=t,this._hostTNode=r,this._hostLView=a}get element(){return Ad(this._hostTNode,this._hostLView)}get injector(){return new Ec(this._hostTNode,this._hostLView)}get parentInjector(){const t=_l(this._hostTNode,this._hostLView);if(Fr(t)){const r=Wr(t,this._hostLView),a=Pn(t);return new Ec(r[1].data[a+8],r)}return new Ec(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const r=n1(this._lContainer);return null!==r&&r[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,r,a){const u=t.createEmbeddedView(r||{});return this.insert(u,a),u}createComponent(t,r,a,u,g){const b=t&&!function Cc(e){return"function"==typeof e}(t);let E;if(b)E=r;else{const j=r||{};E=j.index,a=j.injector,u=j.projectableNodes,g=j.ngModuleRef}const S=b?t:new hy(ir(t)),k=a||this.parentInjector;if(!g&&null==S.ngModule&&k){const j=k.get(kd,null);j&&(g=j)}const B=S.create(k,u,void 0,g);return this.insert(B.hostView,E),B}insert(t,r){const a=t._lView,u=a[1];if(function Eh(e){return si(e[3])}(a)){const B=this.indexOf(t);if(-1!==B)this.detach(B);else{const j=a[3],ne=new t1(j,j[6],j[3]);ne.detach(ne.indexOf(t))}}const g=this._adjustIndex(r),b=this._lContainer;!function Oc(e,t,r,a){const u=10+a,g=r.length;a>0&&(r[u-1][4]=t),a<g-10?(t[4]=r[u],pr(r,10+a,t)):(r.push(t),t[4]=null),t[3]=r;const b=t[17];null!==b&&r!==b&&function Tp(e,t){const r=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===r?e[9]=[t]:r.push(t)}(b,t);const E=t[19];null!==E&&E.insertView(e),t[2]|=128}(u,a,b,g);const E=Kh(g,b),S=a[11],k=Lo(S,b[7]);return null!==k&&function _m(e,t,r,a,u,g){a[0]=u,a[6]=t,us(e,a,r,1,u,g)}(u,b[6],S,a,k,E),t.attachToViewContainerRef(),pr(my(b),g,t),t}move(t,r){return this.insert(t,r)}indexOf(t){const r=n1(this._lContainer);return null!==r?r.indexOf(t):-1}remove(t){const r=this._adjustIndex(t,-1),a=Cp(this._lContainer,r);a&&(Rt(my(this._lContainer),r),Sp(a[1],a))}detach(t){const r=this._adjustIndex(t,-1),a=Cp(this._lContainer,r);return a&&null!=Rt(my(this._lContainer),r)?new uf(a):null}_adjustIndex(t,r=0){return null==t?this.length+r:t}};function n1(e){return e[8]}function my(e){return e[8]||(e[8]=[])}function r1(e,t){let r;const a=t[e.index];if(si(a))r=a;else{let u;if(8&e.type)u=fn(a);else{const g=t[11];u=g.createComment("");const b=Ye(e,t);Us(g,Lo(g,b),u,function bm(e,t){return Fn(e)?e.nextSibling(t):t.nextSibling}(g,b),!1)}t[e.index]=r=N(a,t,u,e),he(t,r)}return new t1(r,e,t)}class gy{constructor(t){this.queryList=t,this.matches=null}clone(){return new gy(this.queryList)}setDirty(){this.queryList.setDirty()}}class _y{constructor(t=[]){this.queries=t}createEmbeddedView(t){const r=t.queries;if(null!==r){const a=null!==t.contentQueries?t.contentQueries[0]:r.length,u=[];for(let g=0;g<a;g++){const b=r.getByIndex(g);u.push(this.queries[b.indexInDeclarationView].clone())}return new _y(u)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let r=0;r<this.queries.length;r++)null!==h1(t,r).matches&&this.queries[r].setDirty()}}class i1{constructor(t,r,a=null){this.predicate=t,this.flags=r,this.read=a}}class yy{constructor(t=[]){this.queries=t}elementStart(t,r){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(t,r)}elementEnd(t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementEnd(t)}embeddedTView(t){let r=null;for(let a=0;a<this.length;a++){const u=null!==r?r.length:0,g=this.getByIndex(a).embeddedTView(t,u);g&&(g.indexInDeclarationView=a,null!==r?r.push(g):r=[g])}return null!==r?new yy(r):null}template(t,r){for(let a=0;a<this.queries.length;a++)this.queries[a].template(t,r)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class vy{constructor(t,r=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=r}elementStart(t,r){this.isApplyingToNode(r)&&this.matchTNode(t,r)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,r){this.elementStart(t,r)}embeddedTView(t,r){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,r),new vy(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const r=this._declarationNodeIndex;let a=t.parent;for(;null!==a&&8&a.type&&a.index!==r;)a=a.parent;return r===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(t,r){const a=this.metadata.predicate;if(Array.isArray(a))for(let u=0;u<a.length;u++){const g=a[u];this.matchTNodeWithReadOption(t,r,DT(r,g)),this.matchTNodeWithReadOption(t,r,Dh(r,t,g,!1,!1))}else a===Ul?4&r.type&&this.matchTNodeWithReadOption(t,r,-1):this.matchTNodeWithReadOption(t,r,Dh(r,t,a,!1,!1))}matchTNodeWithReadOption(t,r,a){if(null!==a){const u=this.metadata.read;if(null!==u)if(u===Pd||u===Ba||u===Ul&&4&r.type)this.addMatch(r.index,-2);else{const g=Dh(r,t,u,!1,!1);null!==g&&this.addMatch(r.index,g)}else this.addMatch(r.index,a)}}addMatch(t,r){null===this.matches?this.matches=[t,r]:this.matches.push(t,r)}}function DT(e,t){const r=e.localNames;if(null!==r)for(let a=0;a<r.length;a+=2)if(r[a]===t)return r[a+1];return null}function CT(e,t,r,a){return-1===r?function TT(e,t){return 11&e.type?Ad(e,t):4&e.type?ng(e,t):null}(t,e):-2===r?function ST(e,t,r){return r===Pd?Ad(t,e):r===Ul?ng(t,e):r===Ba?r1(t,e):void 0}(e,t,a):xu(e,e[1],r,t)}function o1(e,t,r,a){const u=t[19].queries[a];if(null===u.matches){const g=e.data,b=r.matches,E=[];for(let S=0;S<b.length;S+=2){const k=b[S];E.push(k<0?null:CT(t,g[k],b[S+1],r.metadata.read))}u.matches=E}return u.matches}function xy(e,t,r,a){const u=e.queries.getByIndex(r),g=u.matches;if(null!==g){const b=o1(e,t,u,r);for(let E=0;E<g.length;E+=2){const S=g[E];if(S>0)a.push(b[E/2]);else{const k=g[E+1],B=t[-S];for(let j=10;j<B.length;j++){const ne=B[j];ne[17]===ne[3]&&xy(ne[1],ne,k,a)}if(null!==B[9]){const j=B[9];for(let ne=0;ne<j.length;ne++){const oe=j[ne];xy(oe[1],oe,k,a)}}}}}return a}function s1(e){const t=Be(),r=$t(),a=i();c(a+1);const u=h1(r,a);if(e.dirty&&uu(t)===(2==(2&u.metadata.flags))){if(null===u.matches)e.reset([]);else{const g=u.crossesNgTemplate?xy(r,t,a,[]):o1(r,t,u,a);e.reset(g,BD),e.notifyOnChanges()}return!0}return!1}function a1(e,t,r){const a=$t();a.firstCreatePass&&(function u1(e,t,r){null===e.queries&&(e.queries=new yy),e.queries.track(new vy(t,r))}(a,new i1(e,t,r),-1),2==(2&t)&&(a.staticViewQueries=!0)),function c1(e,t,r){const a=new fy(4==(4&r));Kp(e,t,a,a.destroy),null===t[19]&&(t[19]=new _y),t[19].queries.push(new gy(a))}(a,Be(),t)}function h1(e,t){return e.queries.getByIndex(t)}function d1(e,t){return ng(e,t)}function og(...e){}const Cy=new rn("Application Initializer");let Fd=(()=>{class e{constructor(r){this.appInits=r,this.resolve=og,this.reject=og,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,u)=>{this.resolve=a,this.reject=u})}runInitializers(){if(this.initialized)return;const r=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let u=0;u<this.appInits.length;u++){const g=this.appInits[u]();if(J_(g))r.push(g);else if(Hw(g)){const b=new Promise((E,S)=>{g.subscribe({complete:E,error:S})});r.push(b)}}Promise.all(r).then(()=>{a()}).catch(u=>{this.reject(u)}),0===r.length&&a(),this.initialized=!0}}return e.\u0275fac=function(r){return new(r||e)(Lt(Cy,8))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const ff=new rn("AppId"),WT={provide:ff,useFactory:function ZT(){return`${Sy()}${Sy()}${Sy()}`},deps:[]};function Sy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const M1=new rn("Platform Initializer"),sg=new rn("Platform ID"),XT=new rn("appBootstrapListener");let KT=(()=>{class e{log(r){console.log(r)}warn(r){console.warn(r)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const Gc=new rn("LocaleId"),A1=new rn("DefaultCurrencyCode");class YT{constructor(t,r){this.ngModuleFactory=t,this.componentFactories=r}}let P1=(()=>{class e{compileModuleSync(r){return new dy(r)}compileModuleAsync(r){return Promise.resolve(this.compileModuleSync(r))}compileModuleAndAllComponentsSync(r){const a=this.compileModuleSync(r),g=fo(xr(r).declarations).reduce((b,E)=>{const S=ir(E);return S&&b.push(new hy(S)),b},[]);return new YT(a,g)}compileModuleAndAllComponentsAsync(r){return Promise.resolve(this.compileModuleAndAllComponentsSync(r))}clearCache(){}clearCacheFor(r){}getModuleId(r){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const QT=(()=>Promise.resolve(0))();function Iy(e){"undefined"==typeof Zone?QT.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ki{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Vl(!1),this.onMicrotaskEmpty=new Vl(!1),this.onStable=new Vl(!1),this.onError=new Vl(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const u=this;u._nesting=0,u._outer=u._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(u._inner=u._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(u._inner=u._inner.fork(Zone.longStackTraceZoneSpec)),u.shouldCoalesceEventChangeDetection=!a&&r,u.shouldCoalesceRunChangeDetection=a,u.lastRequestAnimationFrameId=-1,u.nativeRequestAnimationFrame=function eC(){let e=un.requestAnimationFrame,t=un.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r);const a=t[Zone.__symbol__("OriginalDelegate")];a&&(t=a)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function rC(e){const t=()=>{!function nC(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(un,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Ay(e),e.isCheckStableRunning=!0,My(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Ay(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(r,a,u,g,b,E)=>{try{return k1(e),r.invokeTask(u,g,b,E)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||e.shouldCoalesceRunChangeDetection)&&t(),R1(e)}},onInvoke:(r,a,u,g,b,E,S)=>{try{return k1(e),r.invoke(u,g,b,E,S)}finally{e.shouldCoalesceRunChangeDetection&&t(),R1(e)}},onHasTask:(r,a,u,g)=>{r.hasTask(u,g),a===u&&("microTask"==g.change?(e._hasPendingMicrotasks=g.microTask,Ay(e),My(e)):"macroTask"==g.change&&(e.hasPendingMacrotasks=g.macroTask))},onHandleError:(r,a,u,g)=>(r.handleError(u,g),e.runOutsideAngular(()=>e.onError.emit(g)),!1)})}(u)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ki.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(ki.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,r,a){return this._inner.run(t,r,a)}runTask(t,r,a,u){const g=this._inner,b=g.scheduleEventTask("NgZoneEvent: "+u,t,tC,og,og);try{return g.runTask(b,r,a)}finally{g.cancelTask(b)}}runGuarded(t,r,a){return this._inner.runGuarded(t,r,a)}runOutsideAngular(t){return this._outer.run(t)}}const tC={};function My(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Ay(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function k1(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function R1(e){e._nesting--,My(e)}class iC{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Vl,this.onMicrotaskEmpty=new Vl,this.onStable=new Vl,this.onError=new Vl}run(t,r,a){return t.apply(r,a)}runGuarded(t,r,a){return t.apply(r,a)}runOutsideAngular(t){return t()}runTask(t,r,a,u){return t.apply(r,a)}}let Py=(()=>{class e{constructor(r){this._ngZone=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),r.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ki.assertNotInAngularZone(),Iy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Iy(()=>{for(;0!==this._callbacks.length;){let r=this._callbacks.pop();clearTimeout(r.timeoutId),r.doneCb(this._didWork)}this._didWork=!1});else{let r=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(r)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(r=>({source:r.source,creationLocation:r.creationLocation,data:r.data})):[]}addCallback(r,a,u){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(b=>b.timeoutId!==g),r(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:r,timeoutId:g,updateCb:u})}whenStable(r,a,u){if(u&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(r,a,u),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(r,a,u){return[]}}return e.\u0275fac=function(r){return new(r||e)(Lt(ki))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})(),L1=(()=>{class e{constructor(){this._applications=new Map,ky.addToWindow(this)}registerApplication(r,a){this._applications.set(r,a)}unregisterApplication(r){this._applications.delete(r)}unregisterAllApplications(){this._applications.clear()}getTestability(r){return this._applications.get(r)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(r,a=!0){return ky.findTestabilityInTree(this,r,a)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();class oC{addToWindow(t){}findTestabilityInTree(t,r,a){return null}}let Ys,ky=new oC;const F1=new rn("AllowMultipleToken");function O1(e,t,r=[]){const a=`Platform: ${t}`,u=new rn(a);return(g=[])=>{let b=z1();if(!b||b.injector.get(F1,!1))if(e)e(r.concat(g).concat({provide:u,useValue:!0}));else{const E=r.concat(g).concat({provide:u,useValue:!0},{provide:on,useValue:"platform"});!function cC(e){if(Ys&&!Ys.destroyed&&!Ys.injector.get(F1,!1))throw new Ar("400","");Ys=e.get(B1);const t=e.get(M1,null);t&&t.forEach(r=>r())}(Cn.create({providers:E,name:a}))}return function uC(e){const t=z1();if(!t)throw new Ar("401","");return t}()}}function z1(){return Ys&&!Ys.destroyed?Ys:null}let B1=(()=>{class e{constructor(r){this._injector=r,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(r,a){const E=function hC(e,t){let r;return r="noop"===e?new iC:("zone.js"===e?void 0:e)||new ki({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),r}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),S=[{provide:ki,useValue:E}];return E.run(()=>{const k=Cn.create({providers:S,parent:this.injector,name:r.moduleType.name}),B=r.create(k),j=B.injector.get(Sl,null);if(!j)throw new Ar("402","");return E.runOutsideAngular(()=>{const ne=E.onError.subscribe({next:oe=>{j.handleError(oe)}});B.onDestroy(()=>{Ry(this._modules,B),ne.unsubscribe()})}),function dC(e,t,r){try{const a=r();return J_(a)?a.catch(u=>{throw t.runOutsideAngular(()=>e.handleError(u)),u}):a}catch(a){throw t.runOutsideAngular(()=>e.handleError(a)),a}}(j,E,()=>{const ne=B.injector.get(Fd);return ne.runInitializers(),ne.donePromise.then(()=>(function BE(e){kr(e,"Expected localeId to be defined"),"string"==typeof e&&(g0=e.toLowerCase().replace(/_/g,"-"))}(B.injector.get(Gc,Km)||Km),this._moduleDoBootstrap(B),B))})})}bootstrapModule(r,a=[]){const u=N1({},a);return function aC(e,t,r){const a=new dy(r);return Promise.resolve(a)}(0,0,r).then(g=>this.bootstrapModuleFactory(g,u))}_moduleDoBootstrap(r){const a=r.injector.get(ag);if(r._bootstrapComponents.length>0)r._bootstrapComponents.forEach(u=>a.bootstrap(u));else{if(!r.instance.ngDoBootstrap)throw new Ar("403","");r.instance.ngDoBootstrap(a)}this._modules.push(r)}onDestroy(r){this._destroyListeners.push(r)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ar("404","");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(r){return new(r||e)(Lt(Cn))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();function N1(e,t){return Array.isArray(t)?t.reduce(N1,e):Object.assign(Object.assign({},e),t)}let ag=(()=>{class e{constructor(r,a,u,g,b){this._zone=r,this._injector=a,this._exceptionHandler=u,this._componentFactoryResolver=g,this._initStatus=b,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const E=new Hn(k=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{k.next(this._stable),k.complete()})}),S=new Hn(k=>{let B;this._zone.runOutsideAngular(()=>{B=this._zone.onStable.subscribe(()=>{ki.assertNotInAngularZone(),Iy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,k.next(!0))})})});const j=this._zone.onUnstable.subscribe(()=>{ki.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{k.next(!1)}))});return()=>{B.unsubscribe(),j.unsubscribe()}});this.isStable=function Ct(...e){const t=$e(e),r=function de(e,t){return"number"==typeof Le(e)?e.pop():t}(e,1/0),a=e;return a.length?1===a.length?Ri(a[0]):function ge(e=1/0){return me(ra,e)}(r)(Tt(a,t)):ce}(E,S.pipe(function ws(e={}){const{connector:t=(()=>new En),resetOnError:r=!0,resetOnComplete:a=!0,resetOnRefCountZero:u=!0}=e;return g=>{let b=null,E=null,S=null,k=0,B=!1,j=!1;const ne=()=>{null==E||E.unsubscribe(),E=null},oe=()=>{ne(),b=S=null,B=j=!1},ye=()=>{const Fe=b;oe(),null==Fe||Fe.unsubscribe()};return yr((Fe,qe)=>{k++,!j&&!B&&ne();const je=S=null!=S?S:t();qe.add(()=>{k--,0===k&&!j&&!B&&(E=Et(ye,u))}),je.subscribe(qe),b||(b=new Uo({next:Re=>je.next(Re),error:Re=>{j=!0,ne(),E=Et(oe,r,Re),je.error(Re)},complete:()=>{B=!0,ne(),E=Et(oe,a),je.complete()}}),Tt(Fe).subscribe(b))})(g)}}()))}bootstrap(r,a){if(!this._initStatus.done)throw new Ar("405","");let u;u=r instanceof U0?r:this._componentFactoryResolver.resolveComponentFactory(r),this.componentTypes.push(u.componentType);const g=function lC(e){return e.isBoundToModule}(u)?void 0:this._injector.get(kd),E=u.create(Cn.NULL,[],a||u.selector,g),S=E.location.nativeElement,k=E.injector.get(Py,null),B=k&&E.injector.get(L1);return k&&B&&B.registerApplication(S,k),E.onDestroy(()=>{this.detachView(E.hostView),Ry(this.components,E),B&&B.unregisterApplication(S)}),this._loadComponent(E),E}tick(){if(this._runningTick)throw new Ar("101","");try{this._runningTick=!0;for(let r of this._views)r.detectChanges()}catch(r){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(r))}finally{this._runningTick=!1}}attachView(r){const a=r;this._views.push(a),a.attachToAppRef(this)}detachView(r){const a=r;Ry(this._views,a),a.detachFromAppRef()}_loadComponent(r){this.attachView(r.hostView),this.tick(),this.components.push(r),this._injector.get(XT,[]).concat(this._bootstrapListeners).forEach(u=>u(r))}ngOnDestroy(){this._views.slice().forEach(r=>r.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(r){return new(r||e)(Lt(ki),Lt(Cn),Lt(Sl),Lt(cf),Lt(Fd))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();function Ry(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}let U1=!0;class W1{constructor(){}supports(t){return Qp(t)}create(t){return new EC(t)}}const wC=(e,t)=>t;class EC{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||wC}forEachItem(t){let r;for(r=this._itHead;null!==r;r=r._next)t(r)}forEachOperation(t){let r=this._itHead,a=this._removalsHead,u=0,g=null;for(;r||a;){const b=!a||r&&r.currentIndex<K1(a,u,g)?r:a,E=K1(b,u,g),S=b.currentIndex;if(b===a)u--,a=a._nextRemoved;else if(r=r._next,null==b.previousIndex)u++;else{g||(g=[]);const k=E-u,B=S-u;if(k!=B){for(let ne=0;ne<k;ne++){const oe=ne<g.length?g[ne]:g[ne]=0,ye=oe+ne;B<=ye&&ye<k&&(g[ne]=oe+1)}g[b.previousIndex]=B-k}}E!==S&&t(b,E,S)}}forEachPreviousItem(t){let r;for(r=this._previousItHead;null!==r;r=r._nextPrevious)t(r)}forEachAddedItem(t){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)t(r)}forEachMovedItem(t){let r;for(r=this._movesHead;null!==r;r=r._nextMoved)t(r)}forEachRemovedItem(t){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)t(r)}forEachIdentityChange(t){let r;for(r=this._identityChangesHead;null!==r;r=r._nextIdentityChange)t(r)}diff(t){if(null==t&&(t=[]),!Qp(t))throw new Error(`Error trying to diff '${Pt(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let u,g,b,r=this._itHead,a=!1;if(Array.isArray(t)){this.length=t.length;for(let E=0;E<this.length;E++)g=t[E],b=this._trackByFn(E,g),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,g,b,E)),Object.is(r.item,g)||this._addIdentityChange(r,g)):(r=this._mismatch(r,g,b,E),a=!0),r=r._next}else u=0,function vw(e,t){if(Array.isArray(e))for(let r=0;r<e.length;r++)t(e[r]);else{const r=e[md()]();let a;for(;!(a=r.next()).done;)t(a.value)}}(t,E=>{b=this._trackByFn(u,E),null!==r&&Object.is(r.trackById,b)?(a&&(r=this._verifyReinsertion(r,E,b,u)),Object.is(r.item,E)||this._addIdentityChange(r,E)):(r=this._mismatch(r,E,b,u),a=!0),r=r._next,u++}),this.length=u;return this._truncate(r),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,r,a,u){let g;return null===t?g=this._itTail:(g=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(t.item,r)||this._addIdentityChange(t,r),this._reinsertAfter(t,g,u)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(a,u))?(Object.is(t.item,r)||this._addIdentityChange(t,r),this._moveAfter(t,g,u)):t=this._addAfter(new DC(r,a),g,u),t}_verifyReinsertion(t,r,a,u){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?t=this._reinsertAfter(g,t._prev,u):t.currentIndex!=u&&(t.currentIndex=u,this._addToMoves(t,u)),t}_truncate(t){for(;null!==t;){const r=t._next;this._addToRemovals(this._unlink(t)),t=r}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,r,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const u=t._prevRemoved,g=t._nextRemoved;return null===u?this._removalsHead=g:u._nextRemoved=g,null===g?this._removalsTail=u:g._prevRemoved=u,this._insertAfter(t,r,a),this._addToMoves(t,a),t}_moveAfter(t,r,a){return this._unlink(t),this._insertAfter(t,r,a),this._addToMoves(t,a),t}_addAfter(t,r,a){return this._insertAfter(t,r,a),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,r,a){const u=null===r?this._itHead:r._next;return t._next=u,t._prev=r,null===u?this._itTail=t:u._prev=t,null===r?this._itHead=t:r._next=t,null===this._linkedRecords&&(this._linkedRecords=new X1),this._linkedRecords.put(t),t.currentIndex=a,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const r=t._prev,a=t._next;return null===r?this._itHead=a:r._next=a,null===a?this._itTail=r:a._prev=r,t}_addToMoves(t,r){return t.previousIndex===r||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new X1),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,r){return t.item=r,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class DC{constructor(t,r){this.item=t,this.trackById=r,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class TC{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,r){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===r||r<=a.currentIndex)&&Object.is(a.trackById,t))return a;return null}remove(t){const r=t._prevDup,a=t._nextDup;return null===r?this._head=a:r._nextDup=a,null===a?this._tail=r:a._prevDup=r,null===this._head}}class X1{constructor(){this.map=new Map}put(t){const r=t.trackById;let a=this.map.get(r);a||(a=new TC,this.map.set(r,a)),a.add(t)}get(t,r){const u=this.map.get(t);return u?u.get(t,r):null}remove(t){const r=t.trackById;return this.map.get(r).remove(t)&&this.map.delete(r),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function K1(e,t,r){const a=e.previousIndex;if(null===a)return a;let u=0;return r&&a<r.length&&(u=r[a]),a+t+u}class Y1{constructor(){}supports(t){return t instanceof Map||G_(t)}create(){return new CC}}class CC{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let r;for(r=this._mapHead;null!==r;r=r._next)t(r)}forEachPreviousItem(t){let r;for(r=this._previousMapHead;null!==r;r=r._nextPrevious)t(r)}forEachChangedItem(t){let r;for(r=this._changesHead;null!==r;r=r._nextChanged)t(r)}forEachAddedItem(t){let r;for(r=this._additionsHead;null!==r;r=r._nextAdded)t(r)}forEachRemovedItem(t){let r;for(r=this._removalsHead;null!==r;r=r._nextRemoved)t(r)}diff(t){if(t){if(!(t instanceof Map||G_(t)))throw new Error(`Error trying to diff '${Pt(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let r=this._mapHead;if(this._appendAfter=null,this._forEach(t,(a,u)=>{if(r&&r.key===u)this._maybeAddToChanges(r,a),this._appendAfter=r,r=r._next;else{const g=this._getOrCreateRecordForKey(u,a);r=this._insertBeforeOrAppend(r,g)}}),r){r._prev&&(r._prev._next=null),this._removalsHead=r;for(let a=r;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,r){if(t){const a=t._prev;return r._next=t,r._prev=a,t._prev=r,a&&(a._next=r),t===this._mapHead&&(this._mapHead=r),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=r,r._prev=this._appendAfter):this._mapHead=r,this._appendAfter=r,null}_getOrCreateRecordForKey(t,r){if(this._records.has(t)){const u=this._records.get(t);this._maybeAddToChanges(u,r);const g=u._prev,b=u._next;return g&&(g._next=b),b&&(b._prev=g),u._next=null,u._prev=null,u}const a=new SC(t);return this._records.set(t,a),a.currentValue=r,this._addToAdditions(a),a}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,r){Object.is(r,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=r,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,r){t instanceof Map?t.forEach(r):Object.keys(t).forEach(a=>r(t[a],a))}}class SC{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function J1(){return new mf([new W1])}let mf=(()=>{class e{constructor(r){this.factories=r}static create(r,a){if(null!=a){const u=a.factories.slice();r=r.concat(u)}return new e(r)}static extend(r){return{provide:e,useFactory:a=>e.create(r,a||J1()),deps:[[e,new Pc,new bl]]}}find(r){const a=this.factories.find(u=>u.supports(r));if(null!=a)return a;throw new Error(`Cannot find a differ supporting object '${r}' of type '${function IC(e){return e.name||typeof e}(r)}'`)}}return e.\u0275prov=nn({token:e,providedIn:"root",factory:J1}),e})();function Q1(){return new Od([new Y1])}let Od=(()=>{class e{constructor(r){this.factories=r}static create(r,a){if(a){const u=a.factories.slice();r=r.concat(u)}return new e(r)}static extend(r){return{provide:e,useFactory:a=>e.create(r,a||Q1()),deps:[[e,new Pc,new bl]]}}find(r){const a=this.factories.find(u=>u.supports(r));if(a)return a;throw new Error(`Cannot find a differ supporting object '${r}'`)}}return e.\u0275prov=nn({token:e,providedIn:"root",factory:Q1}),e})();const MC=[new Y1],PC=new mf([new W1]),kC=new Od(MC),RC=O1(null,"core",[{provide:sg,useValue:"unknown"},{provide:B1,deps:[Cn]},{provide:L1,deps:[]},{provide:KT,deps:[]}]),BC=[{provide:ag,useClass:ag,deps:[ki,Cn,Sl,cf,Fd]},{provide:HD,deps:[ki],useFactory:function NC(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(r){t.push(r)}}},{provide:Fd,useClass:Fd,deps:[[new bl,Cy]]},{provide:P1,useClass:P1,deps:[]},WT,{provide:mf,useFactory:function LC(){return PC},deps:[]},{provide:Od,useFactory:function FC(){return kC},deps:[]},{provide:Gc,useFactory:function OC(e){return e||function zC(){return"undefined"!=typeof $localize&&$localize.locale||Km}()},deps:[[new Cr(Gc),new bl,new Pc]]},{provide:A1,useValue:"USD"}];let VC=(()=>{class e{constructor(r){}}return e.\u0275fac=function(r){return new(r||e)(Lt(ag))},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({providers:BC}),e})(),cg=null;function gf(){return cg}const Js=new rn("DocumentToken");var Br=(()=>((Br=Br||{})[Br.Zero=0]="Zero",Br[Br.One=1]="One",Br[Br.Two=2]="Two",Br[Br.Few=3]="Few",Br[Br.Many=4]="Many",Br[Br.Other=5]="Other",Br))();const QC=function f0(e){return function Hi(e){const t=function LE(e){return e.toLowerCase().replace(/_/g,"-")}(e);let r=m0(t);if(r)return r;const a=t.split("-")[0];if(r=m0(a),r)return r;if("en"===a)return RE;throw new Error(`Missing locale data for the locale "${e}".`)}(e)[rt.PluralCase]};class vg{}let IS=(()=>{class e extends vg{constructor(r){super(),this.locale=r}getPluralCategory(r,a){switch(QC(a||this.locale)(r)){case Br.Zero:return"zero";case Br.One:return"one";case Br.Two:return"two";case Br.Few:return"few";case Br.Many:return"many";default:return"other"}}}return e.\u0275fac=function(r){return new(r||e)(Lt(Gc))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();function ub(e,t){t=encodeURIComponent(t);for(const r of e.split(";")){const a=r.indexOf("="),[u,g]=-1==a?[r,""]:[r.slice(0,a),r.slice(a+1)];if(u.trim()===t)return decodeURIComponent(g)}return null}let hb=(()=>{class e{constructor(r,a,u,g){this._iterableDiffers=r,this._keyValueDiffers=a,this._ngEl=u,this._renderer=g,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(r){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof r?r.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(r){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof r?r.split(/\s+/):r,this._rawClass&&(Qp(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const r=this._iterableDiffer.diff(this._rawClass);r&&this._applyIterableChanges(r)}else if(this._keyValueDiffer){const r=this._keyValueDiffer.diff(this._rawClass);r&&this._applyKeyValueChanges(r)}}_applyKeyValueChanges(r){r.forEachAddedItem(a=>this._toggleClass(a.key,a.currentValue)),r.forEachChangedItem(a=>this._toggleClass(a.key,a.currentValue)),r.forEachRemovedItem(a=>{a.previousValue&&this._toggleClass(a.key,!1)})}_applyIterableChanges(r){r.forEachAddedItem(a=>{if("string"!=typeof a.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Pt(a.item)}`);this._toggleClass(a.item,!0)}),r.forEachRemovedItem(a=>this._toggleClass(a.item,!1))}_applyClasses(r){r&&(Array.isArray(r)||r instanceof Set?r.forEach(a=>this._toggleClass(a,!0)):Object.keys(r).forEach(a=>this._toggleClass(a,!!r[a])))}_removeClasses(r){r&&(Array.isArray(r)||r instanceof Set?r.forEach(a=>this._toggleClass(a,!1)):Object.keys(r).forEach(a=>this._toggleClass(a,!1)))}_toggleClass(r,a){(r=r.trim())&&r.split(/\s+/g).forEach(u=>{a?this._renderer.addClass(this._ngEl.nativeElement,u):this._renderer.removeClass(this._ngEl.nativeElement,u)})}}return e.\u0275fac=function(r){return new(r||e)(Mt(mf),Mt(Od),Mt(Pd),Mt(G0))},e.\u0275dir=Gr({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class AS{constructor(t,r,a,u){this.$implicit=t,this.ngForOf=r,this.index=a,this.count=u}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let db=(()=>{class e{constructor(r,a,u){this._viewContainer=r,this._template=a,this._differs=u,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(r){this._ngForOf=r,this._ngForOfDirty=!0}set ngForTrackBy(r){this._trackByFn=r}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(r){r&&(this._template=r)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const r=this._ngForOf;if(!this._differ&&r)try{this._differ=this._differs.find(r).create(this.ngForTrackBy)}catch(a){throw new Error(`Cannot find a differ supporting object '${r}' of type '${function PS(e){return e.name||typeof e}(r)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const r=this._differ.diff(this._ngForOf);r&&this._applyChanges(r)}}_applyChanges(r){const a=[];r.forEachOperation((u,g,b)=>{if(null==u.previousIndex){const E=this._viewContainer.createEmbeddedView(this._template,new AS(null,this._ngForOf,-1,-1),null===b?void 0:b),S=new pb(u,E);a.push(S)}else if(null==b)this._viewContainer.remove(null===g?void 0:g);else if(null!==g){const E=this._viewContainer.get(g);this._viewContainer.move(E,b);const S=new pb(u,E);a.push(S)}});for(let u=0;u<a.length;u++)this._perViewChange(a[u].view,a[u].record);for(let u=0,g=this._viewContainer.length;u<g;u++){const b=this._viewContainer.get(u);b.context.index=u,b.context.count=g,b.context.ngForOf=this._ngForOf}r.forEachIdentityChange(u=>{this._viewContainer.get(u.currentIndex).context.$implicit=u.item})}_perViewChange(r,a){r.context.$implicit=a.item}static ngTemplateContextGuard(r,a){return!0}}return e.\u0275fac=function(r){return new(r||e)(Mt(Ba),Mt(Ul),Mt(mf))},e.\u0275dir=Gr({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class pb{constructor(t,r){this.record=t,this.view=r}}let qy=(()=>{class e{constructor(r,a){this._viewContainer=r,this._context=new kS,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=a}set ngIf(r){this._context.$implicit=this._context.ngIf=r,this._updateView()}set ngIfThen(r){fb("ngIfThen",r),this._thenTemplateRef=r,this._thenViewRef=null,this._updateView()}set ngIfElse(r){fb("ngIfElse",r),this._elseTemplateRef=r,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(r,a){return!0}}return e.\u0275fac=function(r){return new(r||e)(Mt(Ba),Mt(Ul))},e.\u0275dir=Gr({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class kS{constructor(){this.$implicit=null,this.ngIf=null}}function fb(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${Pt(t)}'.`)}let _b=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({providers:[{provide:vg,useClass:IS}]}),e})();class xb{}class Yy extends class cI extends class $C{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function jC(e){cg||(cg=e)}(new Yy)}onAndCancel(t,r,a){return t.addEventListener(r,a,!1),()=>{t.removeEventListener(r,a,!1)}}dispatchEvent(t,r){t.dispatchEvent(r)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,r){return(r=r||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,r){return"window"===r?window:"document"===r?t:"body"===r?t.body:null}getBaseHref(t){const r=function uI(){return vf=vf||document.querySelector("base"),vf?vf.getAttribute("href"):null}();return null==r?null:function hI(e){xg=xg||document.createElement("a"),xg.setAttribute("href",e);const t=xg.pathname;return"/"===t.charAt(0)?t:`/${t}`}(r)}resetBaseElement(){vf=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return ub(document.cookie,t)}}let xg,vf=null;const bb=new rn("TRANSITION_ID"),pI=[{provide:Cy,useFactory:function dI(e,t,r){return()=>{r.get(Fd).donePromise.then(()=>{const a=gf(),u=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let g=0;g<u.length;g++)a.remove(u[g])})}},deps:[bb,Js,Cn],multi:!0}];class Jy{static init(){!function sC(e){ky=e}(new Jy)}addToWindow(t){un.getAngularTestability=(a,u=!0)=>{const g=t.findTestabilityInTree(a,u);if(null==g)throw new Error("Could not find testability for element.");return g},un.getAllAngularTestabilities=()=>t.getAllTestabilities(),un.getAllAngularRootElements=()=>t.getAllRootElements(),un.frameworkStabilizers||(un.frameworkStabilizers=[]),un.frameworkStabilizers.push(a=>{const u=un.getAllAngularTestabilities();let g=u.length,b=!1;const E=function(S){b=b||S,g--,0==g&&a(b)};u.forEach(function(S){S.whenStable(E)})})}findTestabilityInTree(t,r,a){if(null==r)return null;const u=t.getTestability(r);return null!=u?u:a?gf().isShadowRoot(r)?this.findTestabilityInTree(t,r.host,!0):this.findTestabilityInTree(t,r.parentElement,!0):null}}let fI=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const bg=new rn("EventManagerPlugins");let wg=(()=>{class e{constructor(r,a){this._zone=a,this._eventNameToPlugin=new Map,r.forEach(u=>u.manager=this),this._plugins=r.slice().reverse()}addEventListener(r,a,u){return this._findPluginFor(a).addEventListener(r,a,u)}addGlobalEventListener(r,a,u){return this._findPluginFor(a).addGlobalEventListener(r,a,u)}getZone(){return this._zone}_findPluginFor(r){const a=this._eventNameToPlugin.get(r);if(a)return a;const u=this._plugins;for(let g=0;g<u.length;g++){const b=u[g];if(b.supports(r))return this._eventNameToPlugin.set(r,b),b}throw new Error(`No event manager plugin found for event ${r}`)}}return e.\u0275fac=function(r){return new(r||e)(Lt(bg),Lt(ki))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();class wb{constructor(t){this._doc=t}addGlobalEventListener(t,r,a){const u=gf().getGlobalEventTarget(this._doc,t);if(!u)throw new Error(`Unsupported event target ${u} for event ${r}`);return this.addEventListener(u,r,a)}}let Eb=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(r){const a=new Set;r.forEach(u=>{this._stylesSet.has(u)||(this._stylesSet.add(u),a.add(u))}),this.onStylesAdded(a)}onStylesAdded(r){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})(),xf=(()=>{class e extends Eb{constructor(r){super(),this._doc=r,this._hostNodes=new Map,this._hostNodes.set(r.head,[])}_addStylesToHost(r,a,u){r.forEach(g=>{const b=this._doc.createElement("style");b.textContent=g,u.push(a.appendChild(b))})}addHost(r){const a=[];this._addStylesToHost(this._stylesSet,r,a),this._hostNodes.set(r,a)}removeHost(r){const a=this._hostNodes.get(r);a&&a.forEach(Db),this._hostNodes.delete(r)}onStylesAdded(r){this._hostNodes.forEach((a,u)=>{this._addStylesToHost(r,u,a)})}ngOnDestroy(){this._hostNodes.forEach(r=>r.forEach(Db))}}return e.\u0275fac=function(r){return new(r||e)(Lt(Js))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();function Db(e){gf().remove(e)}const Qy={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},ev=/%COMP%/g;function Eg(e,t,r){for(let a=0;a<t.length;a++){let u=t[a];Array.isArray(u)?Eg(e,u,r):(u=u.replace(ev,e),r.push(u))}return r}function Sb(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let tv=(()=>{class e{constructor(r,a,u){this.eventManager=r,this.sharedStylesHost=a,this.appId=u,this.rendererByCompId=new Map,this.defaultRenderer=new nv(r)}createRenderer(r,a){if(!r||!a)return this.defaultRenderer;switch(a.encapsulation){case ii.Emulated:{let u=this.rendererByCompId.get(a.id);return u||(u=new xI(this.eventManager,this.sharedStylesHost,a,this.appId),this.rendererByCompId.set(a.id,u)),u.applyToHost(r),u}case 1:case ii.ShadowDom:return new bI(this.eventManager,this.sharedStylesHost,r,a);default:if(!this.rendererByCompId.has(a.id)){const u=Eg(a.id,a.styles,[]);this.sharedStylesHost.addStyles(u),this.rendererByCompId.set(a.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(r){return new(r||e)(Lt(wg),Lt(xf),Lt(ff))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();class nv{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,r){return r?document.createElementNS(Qy[r]||r,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,r){t.appendChild(r)}insertBefore(t,r,a){t&&t.insertBefore(r,a)}removeChild(t,r){t&&t.removeChild(r)}selectRootElement(t,r){let a="string"==typeof t?document.querySelector(t):t;if(!a)throw new Error(`The selector "${t}" did not match any elements`);return r||(a.textContent=""),a}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,r,a,u){if(u){r=u+":"+r;const g=Qy[u];g?t.setAttributeNS(g,r,a):t.setAttribute(r,a)}else t.setAttribute(r,a)}removeAttribute(t,r,a){if(a){const u=Qy[a];u?t.removeAttributeNS(u,r):t.removeAttribute(`${a}:${r}`)}else t.removeAttribute(r)}addClass(t,r){t.classList.add(r)}removeClass(t,r){t.classList.remove(r)}setStyle(t,r,a,u){u&(Mi.DashCase|Mi.Important)?t.style.setProperty(r,a,u&Mi.Important?"important":""):t.style[r]=a}removeStyle(t,r,a){a&Mi.DashCase?t.style.removeProperty(r):t.style[r]=""}setProperty(t,r,a){t[r]=a}setValue(t,r){t.nodeValue=r}listen(t,r,a){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,r,Sb(a)):this.eventManager.addEventListener(t,r,Sb(a))}}class xI extends nv{constructor(t,r,a,u){super(t),this.component=a;const g=Eg(u+"-"+a.id,a.styles,[]);r.addStyles(g),this.contentAttr=function _I(e){return"_ngcontent-%COMP%".replace(ev,e)}(u+"-"+a.id),this.hostAttr=function yI(e){return"_nghost-%COMP%".replace(ev,e)}(u+"-"+a.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,r){const a=super.createElement(t,r);return super.setAttribute(a,this.contentAttr,""),a}}class bI extends nv{constructor(t,r,a,u){super(t),this.sharedStylesHost=r,this.hostEl=a,this.shadowRoot=a.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const g=Eg(u.id,u.styles,[]);for(let b=0;b<g.length;b++){const E=document.createElement("style");E.textContent=g[b],this.shadowRoot.appendChild(E)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,r){return super.appendChild(this.nodeOrShadowRoot(t),r)}insertBefore(t,r,a){return super.insertBefore(this.nodeOrShadowRoot(t),r,a)}removeChild(t,r){return super.removeChild(this.nodeOrShadowRoot(t),r)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let wI=(()=>{class e extends wb{constructor(r){super(r)}supports(r){return!0}addEventListener(r,a,u){return r.addEventListener(a,u,!1),()=>this.removeEventListener(r,a,u)}removeEventListener(r,a,u){return r.removeEventListener(a,u)}}return e.\u0275fac=function(r){return new(r||e)(Lt(Js))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const Mb=["alt","control","meta","shift"],DI={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Ab={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},TI={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let CI=(()=>{class e extends wb{constructor(r){super(r)}supports(r){return null!=e.parseEventName(r)}addEventListener(r,a,u){const g=e.parseEventName(a),b=e.eventCallback(g.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>gf().onAndCancel(r,g.domEventName,b))}static parseEventName(r){const a=r.toLowerCase().split("."),u=a.shift();if(0===a.length||"keydown"!==u&&"keyup"!==u)return null;const g=e._normalizeKey(a.pop());let b="";if(Mb.forEach(S=>{const k=a.indexOf(S);k>-1&&(a.splice(k,1),b+=S+".")}),b+=g,0!=a.length||0===g.length)return null;const E={};return E.domEventName=u,E.fullKey=b,E}static getEventFullKey(r){let a="",u=function SI(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Ab.hasOwnProperty(t)&&(t=Ab[t]))}return DI[t]||t}(r);return u=u.toLowerCase()," "===u?u="space":"."===u&&(u="dot"),Mb.forEach(g=>{g!=u&&TI[g](r)&&(a+=g+".")}),a+=u,a}static eventCallback(r,a,u){return g=>{e.getEventFullKey(g)===r&&u.runGuarded(()=>a(g))}}static _normalizeKey(r){return"esc"===r?"escape":r}}return e.\u0275fac=function(r){return new(r||e)(Lt(Js))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const PI=O1(RC,"browser",[{provide:sg,useValue:"browser"},{provide:M1,useValue:function II(){Yy.makeCurrent(),Jy.init()},multi:!0},{provide:Js,useFactory:function AI(){return function Zd(e){Co=e}(document),document},deps:[]}]),kI=[{provide:on,useValue:"root"},{provide:Sl,useFactory:function MI(){return new Sl},deps:[]},{provide:bg,useClass:wI,multi:!0,deps:[Js,ki,sg]},{provide:bg,useClass:CI,multi:!0,deps:[Js]},{provide:tv,useClass:tv,deps:[wg,xf,ff]},{provide:$0,useExisting:tv},{provide:Eb,useExisting:xf},{provide:xf,useClass:xf,deps:[Js]},{provide:Py,useClass:Py,deps:[ki]},{provide:wg,useClass:wg,deps:[bg,ki]},{provide:xb,useClass:fI,deps:[]}];let RI=(()=>{class e{constructor(r){if(r)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(r){return{ngModule:e,providers:[{provide:ff,useValue:r.appId},{provide:bb,useExisting:ff},pI]}}}return e.\u0275fac=function(r){return new(r||e)(Lt(e,12))},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({providers:kI,imports:[_b,VC]}),e})();"undefined"!=typeof window&&window;class Dg{}class Rb{}class $l{constructor(t){this.normalizedNames=new Map,this.lazyUpdate=null,t?this.lazyInit="string"==typeof t?()=>{this.headers=new Map,t.split("\n").forEach(r=>{const a=r.indexOf(":");if(a>0){const u=r.slice(0,a),g=u.toLowerCase(),b=r.slice(a+1).trim();this.maybeSetNormalizedName(u,g),this.headers.has(g)?this.headers.get(g).push(b):this.headers.set(g,[b])}})}:()=>{this.headers=new Map,Object.keys(t).forEach(r=>{let a=t[r];const u=r.toLowerCase();"string"==typeof a&&(a=[a]),a.length>0&&(this.headers.set(u,a),this.maybeSetNormalizedName(r,u))})}:this.headers=new Map}has(t){return this.init(),this.headers.has(t.toLowerCase())}get(t){this.init();const r=this.headers.get(t.toLowerCase());return r&&r.length>0?r[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(t){return this.init(),this.headers.get(t.toLowerCase())||null}append(t,r){return this.clone({name:t,value:r,op:"a"})}set(t,r){return this.clone({name:t,value:r,op:"s"})}delete(t,r){return this.clone({name:t,value:r,op:"d"})}maybeSetNormalizedName(t,r){this.normalizedNames.has(r)||this.normalizedNames.set(r,t)}init(){this.lazyInit&&(this.lazyInit instanceof $l?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(t=>this.applyUpdate(t)),this.lazyUpdate=null))}copyFrom(t){t.init(),Array.from(t.headers.keys()).forEach(r=>{this.headers.set(r,t.headers.get(r)),this.normalizedNames.set(r,t.normalizedNames.get(r))})}clone(t){const r=new $l;return r.lazyInit=this.lazyInit&&this.lazyInit instanceof $l?this.lazyInit:this,r.lazyUpdate=(this.lazyUpdate||[]).concat([t]),r}applyUpdate(t){const r=t.name.toLowerCase();switch(t.op){case"a":case"s":let a=t.value;if("string"==typeof a&&(a=[a]),0===a.length)return;this.maybeSetNormalizedName(t.name,r);const u=("a"===t.op?this.headers.get(r):void 0)||[];u.push(...a),this.headers.set(r,u);break;case"d":const g=t.value;if(g){let b=this.headers.get(r);if(!b)return;b=b.filter(E=>-1===g.indexOf(E)),0===b.length?(this.headers.delete(r),this.normalizedNames.delete(r)):this.headers.set(r,b)}else this.headers.delete(r),this.normalizedNames.delete(r)}}forEach(t){this.init(),Array.from(this.normalizedNames.keys()).forEach(r=>t(this.normalizedNames.get(r),this.headers.get(r)))}}class ZI{encodeKey(t){return Lb(t)}encodeValue(t){return Lb(t)}decodeKey(t){return decodeURIComponent(t)}decodeValue(t){return decodeURIComponent(t)}}const XI=/%(\d[a-f0-9])/gi,KI={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Lb(e){return encodeURIComponent(e).replace(XI,(t,r)=>{var a;return null!==(a=KI[r])&&void 0!==a?a:t})}function Fb(e){return`${e}`}class qc{constructor(t={}){if(this.updates=null,this.cloneFrom=null,this.encoder=t.encoder||new ZI,t.fromString){if(t.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function WI(e,t){const r=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(u=>{const g=u.indexOf("="),[b,E]=-1==g?[t.decodeKey(u),""]:[t.decodeKey(u.slice(0,g)),t.decodeValue(u.slice(g+1))],S=r.get(b)||[];S.push(E),r.set(b,S)}),r}(t.fromString,this.encoder)}else t.fromObject?(this.map=new Map,Object.keys(t.fromObject).forEach(r=>{const a=t.fromObject[r];this.map.set(r,Array.isArray(a)?a:[a])})):this.map=null}has(t){return this.init(),this.map.has(t)}get(t){this.init();const r=this.map.get(t);return r?r[0]:null}getAll(t){return this.init(),this.map.get(t)||null}keys(){return this.init(),Array.from(this.map.keys())}append(t,r){return this.clone({param:t,value:r,op:"a"})}appendAll(t){const r=[];return Object.keys(t).forEach(a=>{const u=t[a];Array.isArray(u)?u.forEach(g=>{r.push({param:a,value:g,op:"a"})}):r.push({param:a,value:u,op:"a"})}),this.clone(r)}set(t,r){return this.clone({param:t,value:r,op:"s"})}delete(t,r){return this.clone({param:t,value:r,op:"d"})}toString(){return this.init(),this.keys().map(t=>{const r=this.encoder.encodeKey(t);return this.map.get(t).map(a=>r+"="+this.encoder.encodeValue(a)).join("&")}).filter(t=>""!==t).join("&")}clone(t){const r=new qc({encoder:this.encoder});return r.cloneFrom=this.cloneFrom||this,r.updates=(this.updates||[]).concat(t),r}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(t=>this.map.set(t,this.cloneFrom.map.get(t))),this.updates.forEach(t=>{switch(t.op){case"a":case"s":const r=("a"===t.op?this.map.get(t.param):void 0)||[];r.push(Fb(t.value)),this.map.set(t.param,r);break;case"d":if(void 0===t.value){this.map.delete(t.param);break}{let a=this.map.get(t.param)||[];const u=a.indexOf(Fb(t.value));-1!==u&&a.splice(u,1),a.length>0?this.map.set(t.param,a):this.map.delete(t.param)}}}),this.cloneFrom=this.updates=null)}}class YI{constructor(){this.map=new Map}set(t,r){return this.map.set(t,r),this}get(t){return this.map.has(t)||this.map.set(t,t.defaultValue()),this.map.get(t)}delete(t){return this.map.delete(t),this}keys(){return this.map.keys()}}function Ob(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function zb(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Bb(e){return"undefined"!=typeof FormData&&e instanceof FormData}class bf{constructor(t,r,a,u){let g;if(this.url=r,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=t.toUpperCase(),function JI(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||u?(this.body=void 0!==a?a:null,g=u):g=a,g&&(this.reportProgress=!!g.reportProgress,this.withCredentials=!!g.withCredentials,g.responseType&&(this.responseType=g.responseType),g.headers&&(this.headers=g.headers),g.context&&(this.context=g.context),g.params&&(this.params=g.params)),this.headers||(this.headers=new $l),this.context||(this.context=new YI),this.params){const b=this.params.toString();if(0===b.length)this.urlWithParams=r;else{const E=r.indexOf("?");this.urlWithParams=r+(-1===E?"?":E<r.length-1?"&":"")+b}}else this.params=new qc,this.urlWithParams=r}serializeBody(){return null===this.body?null:Ob(this.body)||zb(this.body)||Bb(this.body)||function QI(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof qc?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Bb(this.body)?null:zb(this.body)?this.body.type||null:Ob(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof qc?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(t={}){var r;const a=t.method||this.method,u=t.url||this.url,g=t.responseType||this.responseType,b=void 0!==t.body?t.body:this.body,E=void 0!==t.withCredentials?t.withCredentials:this.withCredentials,S=void 0!==t.reportProgress?t.reportProgress:this.reportProgress;let k=t.headers||this.headers,B=t.params||this.params;const j=null!==(r=t.context)&&void 0!==r?r:this.context;return void 0!==t.setHeaders&&(k=Object.keys(t.setHeaders).reduce((ne,oe)=>ne.set(oe,t.setHeaders[oe]),k)),t.setParams&&(B=Object.keys(t.setParams).reduce((ne,oe)=>ne.set(oe,t.setParams[oe]),B)),new bf(a,u,b,{params:B,headers:k,context:j,reportProgress:S,responseType:g,withCredentials:E})}}var Vr=(()=>((Vr=Vr||{})[Vr.Sent=0]="Sent",Vr[Vr.UploadProgress=1]="UploadProgress",Vr[Vr.ResponseHeader=2]="ResponseHeader",Vr[Vr.DownloadProgress=3]="DownloadProgress",Vr[Vr.Response=4]="Response",Vr[Vr.User=5]="User",Vr))();class iv{constructor(t,r=200,a="OK"){this.headers=t.headers||new $l,this.status=void 0!==t.status?t.status:r,this.statusText=t.statusText||a,this.url=t.url||null,this.ok=this.status>=200&&this.status<300}}class ov extends iv{constructor(t={}){super(t),this.type=Vr.ResponseHeader}clone(t={}){return new ov({headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Tg extends iv{constructor(t={}){super(t),this.type=Vr.Response,this.body=void 0!==t.body?t.body:null}clone(t={}){return new Tg({body:void 0!==t.body?t.body:this.body,headers:t.headers||this.headers,status:void 0!==t.status?t.status:this.status,statusText:t.statusText||this.statusText,url:t.url||this.url||void 0})}}class Nb extends iv{constructor(t){super(t,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${t.url||"(unknown url)"}`:`Http failure response for ${t.url||"(unknown url)"}: ${t.status} ${t.statusText}`,this.error=t.error||null}}function sv(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let av=(()=>{class e{constructor(r){this.handler=r}request(r,a,u={}){let g;if(r instanceof bf)g=r;else{let S,k;S=u.headers instanceof $l?u.headers:new $l(u.headers),u.params&&(k=u.params instanceof qc?u.params:new qc({fromObject:u.params})),g=new bf(r,a,void 0!==u.body?u.body:null,{headers:S,context:u.context,params:k,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials})}const b=function GI(...e){return Tt(e,$e(e))}(g).pipe(function HI(e,t){return at(t)?me(e,t,1):me(e,1)}(S=>this.handler.handle(S)));if(r instanceof bf||"events"===u.observe)return b;const E=b.pipe(function qI(e,t){return yr((r,a)=>{let u=0;r.subscribe(new wi(a,g=>e.call(t,g,u++)&&a.next(g)))})}(S=>S instanceof Tg));switch(u.observe||"body"){case"body":switch(g.responseType){case"arraybuffer":return E.pipe(Xi(S=>{if(null!==S.body&&!(S.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return S.body}));case"blob":return E.pipe(Xi(S=>{if(null!==S.body&&!(S.body instanceof Blob))throw new Error("Response is not a Blob.");return S.body}));case"text":return E.pipe(Xi(S=>{if(null!==S.body&&"string"!=typeof S.body)throw new Error("Response is not a string.");return S.body}));default:return E.pipe(Xi(S=>S.body))}case"response":return E;default:throw new Error(`Unreachable: unhandled observe type ${u.observe}}`)}}delete(r,a={}){return this.request("DELETE",r,a)}get(r,a={}){return this.request("GET",r,a)}head(r,a={}){return this.request("HEAD",r,a)}jsonp(r,a){return this.request("JSONP",r,{params:(new qc).append(a,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,a={}){return this.request("OPTIONS",r,a)}patch(r,a,u={}){return this.request("PATCH",r,sv(u,a))}post(r,a,u={}){return this.request("POST",r,sv(u,a))}put(r,a,u={}){return this.request("PUT",r,sv(u,a))}}return e.\u0275fac=function(r){return new(r||e)(Lt(Dg))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();class Vb{constructor(t,r){this.next=t,this.interceptor=r}handle(t){return this.interceptor.intercept(t,this.next)}}const Ub=new rn("HTTP_INTERCEPTORS");let eM=(()=>{class e{intercept(r,a){return a.handle(r)}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const tM=/^\)\]\}',?\n/;let jb=(()=>{class e{constructor(r){this.xhrFactory=r}handle(r){if("JSONP"===r.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new Hn(a=>{const u=this.xhrFactory.build();if(u.open(r.method,r.urlWithParams),r.withCredentials&&(u.withCredentials=!0),r.headers.forEach((oe,ye)=>u.setRequestHeader(oe,ye.join(","))),r.headers.has("Accept")||u.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){const oe=r.detectContentTypeHeader();null!==oe&&u.setRequestHeader("Content-Type",oe)}if(r.responseType){const oe=r.responseType.toLowerCase();u.responseType="json"!==oe?oe:"text"}const g=r.serializeBody();let b=null;const E=()=>{if(null!==b)return b;const oe=1223===u.status?204:u.status,ye=u.statusText||"OK",Fe=new $l(u.getAllResponseHeaders()),qe=function nM(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(u)||r.url;return b=new ov({headers:Fe,status:oe,statusText:ye,url:qe}),b},S=()=>{let{headers:oe,status:ye,statusText:Fe,url:qe}=E(),je=null;204!==ye&&(je=void 0===u.response?u.responseText:u.response),0===ye&&(ye=je?200:0);let Re=ye>=200&&ye<300;if("json"===r.responseType&&"string"==typeof je){const ct=je;je=je.replace(tM,"");try{je=""!==je?JSON.parse(je):null}catch(Ft){je=ct,Re&&(Re=!1,je={error:Ft,text:je})}}Re?(a.next(new Tg({body:je,headers:oe,status:ye,statusText:Fe,url:qe||void 0})),a.complete()):a.error(new Nb({error:je,headers:oe,status:ye,statusText:Fe,url:qe||void 0}))},k=oe=>{const{url:ye}=E(),Fe=new Nb({error:oe,status:u.status||0,statusText:u.statusText||"Unknown Error",url:ye||void 0});a.error(Fe)};let B=!1;const j=oe=>{B||(a.next(E()),B=!0);let ye={type:Vr.DownloadProgress,loaded:oe.loaded};oe.lengthComputable&&(ye.total=oe.total),"text"===r.responseType&&!!u.responseText&&(ye.partialText=u.responseText),a.next(ye)},ne=oe=>{let ye={type:Vr.UploadProgress,loaded:oe.loaded};oe.lengthComputable&&(ye.total=oe.total),a.next(ye)};return u.addEventListener("load",S),u.addEventListener("error",k),u.addEventListener("timeout",k),u.addEventListener("abort",k),r.reportProgress&&(u.addEventListener("progress",j),null!==g&&u.upload&&u.upload.addEventListener("progress",ne)),u.send(g),a.next({type:Vr.Sent}),()=>{u.removeEventListener("error",k),u.removeEventListener("abort",k),u.removeEventListener("load",S),u.removeEventListener("timeout",k),r.reportProgress&&(u.removeEventListener("progress",j),null!==g&&u.upload&&u.upload.removeEventListener("progress",ne)),u.readyState!==u.DONE&&u.abort()}})}}return e.\u0275fac=function(r){return new(r||e)(Lt(xb))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})();const lv=new rn("XSRF_COOKIE_NAME"),cv=new rn("XSRF_HEADER_NAME");class $b{}let rM=(()=>{class e{constructor(r,a,u){this.doc=r,this.platform=a,this.cookieName=u,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=ub(r,this.cookieName),this.lastCookieString=r),this.lastToken}}return e.\u0275fac=function(r){return new(r||e)(Lt(Js),Lt(sg),Lt(lv))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})(),uv=(()=>{class e{constructor(r,a){this.tokenService=r,this.headerName=a}intercept(r,a){const u=r.url.toLowerCase();if("GET"===r.method||"HEAD"===r.method||u.startsWith("http://")||u.startsWith("https://"))return a.handle(r);const g=this.tokenService.getToken();return null!==g&&!r.headers.has(this.headerName)&&(r=r.clone({headers:r.headers.set(this.headerName,g)})),a.handle(r)}}return e.\u0275fac=function(r){return new(r||e)(Lt($b),Lt(cv))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})(),iM=(()=>{class e{constructor(r,a){this.backend=r,this.injector=a,this.chain=null}handle(r){if(null===this.chain){const a=this.injector.get(Ub,[]);this.chain=a.reduceRight((u,g)=>new Vb(u,g),this.backend)}return this.chain.handle(r)}}return e.\u0275fac=function(r){return new(r||e)(Lt(Rb),Lt(Cn))},e.\u0275prov=nn({token:e,factory:e.\u0275fac}),e})(),oM=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:uv,useClass:eM}]}}static withOptions(r={}){return{ngModule:e,providers:[r.cookieName?{provide:lv,useValue:r.cookieName}:[],r.headerName?{provide:cv,useValue:r.headerName}:[]]}}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({providers:[uv,{provide:Ub,useExisting:uv,multi:!0},{provide:$b,useClass:rM},{provide:lv,useValue:"XSRF-TOKEN"},{provide:cv,useValue:"X-XSRF-TOKEN"}]}),e})(),sM=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({providers:[av,{provide:Dg,useClass:iM},jb,{provide:Rb,useExisting:jb}],imports:[[oM.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();var Gl=it(898),aM=it.n(Gl);class Gb extends En{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const r=super._subscribe(t);return!r.closed&&t.next(this._value),r}getValue(){const{hasError:t,thrownError:r,_value:a}=this;if(t)throw r;return this._throwIfClosed(),a}next(t){super.next(this._value=t)}}var hv=it(884),cM=it(764);const Zc="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Hb(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||cM))return new XMLHttpRequest}catch(r){}if(!t)try{return new(Zc[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(r){}}function qb(e,...t){return t.reduce((r,a)=>(e.hasOwnProperty(a)&&(r[a]=e[a]),r),{})}const uM=setTimeout,hM=clearTimeout;function Cg(e,t){t.useNativeTimers?(e.setTimeoutFn=uM.bind(Zc),e.clearTimeoutFn=hM.bind(Zc)):(e.setTimeoutFn=setTimeout.bind(Zc),e.clearTimeoutFn=clearTimeout.bind(Zc))}var zd=it(80);const Na=Object.create(null);Na.open="0",Na.close="1",Na.ping="2",Na.pong="3",Na.message="4",Na.upgrade="5",Na.noop="6";const Sg=Object.create(null);Object.keys(Na).forEach(e=>{Sg[Na[e]]=e});const dM={type:"error",data:"parser error"},pM="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),fM="function"==typeof ArrayBuffer,Zb=(e,t)=>{const r=new FileReader;return r.onload=function(){const a=r.result.split(",")[1];t("b"+a)},r.readAsDataURL(e)},Wb=({type:e,data:t},r,a)=>pM&&t instanceof Blob?r?a(t):Zb(t,a):fM&&(t instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer)(t))?r?a(t):Zb(new Blob([t]),a):a(Na[e]+(t||""));for(var Bd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",wf="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ig=0;Ig<Bd.length;Ig++)wf[Bd.charCodeAt(Ig)]=Ig;const yM="function"==typeof ArrayBuffer,xM=(e,t)=>{if(yM){const r=function(e){var a,g,b,E,S,t=.75*e.length,r=e.length,u=0;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);var k=new ArrayBuffer(t),B=new Uint8Array(k);for(a=0;a<r;a+=4)g=wf[e.charCodeAt(a)],b=wf[e.charCodeAt(a+1)],E=wf[e.charCodeAt(a+2)],S=wf[e.charCodeAt(a+3)],B[u++]=g<<2|b>>4,B[u++]=(15&b)<<4|E>>2,B[u++]=(3&E)<<6|63&S;return k}(e);return Xb(r,t)}return{base64:!0,data:e}},Xb=(e,t)=>"blob"===t&&e instanceof ArrayBuffer?new Blob([e]):e,Kb=(e,t)=>{if("string"!=typeof e)return{type:"message",data:Xb(e,t)};const r=e.charAt(0);return"b"===r?{type:"message",data:xM(e.substring(1),t)}:Sg[r]?e.length>1?{type:Sg[r],data:e.substring(1)}:{type:Sg[r]}:dM},Yb=String.fromCharCode(30);class Qb extends zd.Q{constructor(t){super(),this.writable=!1,Cg(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,r){const a=new Error(t);return a.type="TransportError",a.description=r,super.emit("error",a),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(t){const r=Kb(t,this.socket.binaryType);this.onPacket(r)}onPacket(t){super.emit("packet",t)}onClose(){this.readyState="closed",super.emit("close")}}var ew=it(379),dv=it(257);class EM extends Qb{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const r=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let a=0;this.polling&&(a++,this.once("pollComplete",function(){--a||r()})),this.writable||(a++,this.once("drain",function(){--a||r()}))}else r()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(t){((e,t)=>{const r=e.split(Yb),a=[];for(let u=0;u<r.length;u++){const g=Kb(r[u],t);if(a.push(g),"error"===g.type)break}return a})(t,this.socket.binaryType).forEach(a=>{if("opening"===this.readyState&&"open"===a.type&&this.onOpen(),"close"===a.type)return this.onClose(),!1;this.onPacket(a)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,((e,t)=>{const r=e.length,a=new Array(r);let u=0;e.forEach((g,b)=>{Wb(g,!1,E=>{a[b]=E,++u===r&&t(a.join(Yb))})})})(t,r=>{this.doWrite(r,()=>{this.writable=!0,this.emit("drain")})})}uri(){let t=this.query||{};const r=this.opts.secure?"https":"http";let a="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=ew()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.opts.port&&("https"===r&&443!==Number(this.opts.port)||"http"===r&&80!==Number(this.opts.port))&&(a=":"+this.opts.port);const u=dv.encode(t);return r+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+a+this.opts.path+(u.length?"?"+u:"")}}function DM(){}const TM=null!=new Hb({xdomain:!1}).responseType;let Mg=(()=>{class e extends zd.Q{constructor(r,a){super(),Cg(this,a),this.opts=a,this.method=a.method||"GET",this.uri=r,this.async=!1!==a.async,this.data=void 0!==a.data?a.data:null,this.create()}create(){const r=qb(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this.opts.xd,r.xscheme=!!this.opts.xs;const a=this.xhr=new Hb(r);try{a.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){a.setDisableHeaderCheck&&a.setDisableHeaderCheck(!0);for(let u in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(u)&&a.setRequestHeader(u,this.opts.extraHeaders[u])}}catch(u){}if("POST"===this.method)try{a.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(u){}try{a.setRequestHeader("Accept","*/*")}catch(u){}"withCredentials"in a&&(a.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(a.timeout=this.opts.requestTimeout),a.onreadystatechange=()=>{4===a.readyState&&(200===a.status||1223===a.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof a.status?a.status:0)},0))},a.send(this.data)}catch(u){return void this.setTimeoutFn(()=>{this.onError(u)},0)}"undefined"!=typeof document&&(this.index=e.requestsCount++,e.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(r){this.emit("data",r),this.onSuccess()}onError(r){this.emit("error",r),this.cleanup(!0)}cleanup(r){if(null!=this.xhr){if(this.xhr.onreadystatechange=DM,r)try{this.xhr.abort()}catch(a){}"undefined"!=typeof document&&delete e.requests[this.index],this.xhr=null}}onLoad(){const r=this.xhr.responseText;null!==r&&this.onData(r)}abort(){this.cleanup()}}return e.requestsCount=0,e.requests={},e})();function tw(){for(let e in Mg.requests)Mg.requests.hasOwnProperty(e)&&Mg.requests[e].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",tw):"function"==typeof addEventListener&&addEventListener("onpagehide"in Zc?"pagehide":"unload",tw,!1));const SM="function"==typeof Promise&&"function"==typeof Promise.resolve?t=>Promise.resolve().then(t):(t,r)=>r(t,0),Ef=Zc.WebSocket||Zc.MozWebSocket,nw="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class fv extends Qb{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),r=this.opts.protocols,a=nw?{}:qb(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(a.headers=this.opts.extraHeaders);try{this.ws=nw?new Ef(t,r,a):r?new Ef(t,r):new Ef(t)}catch(u){return this.emit("error",u)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let r=0;r<t.length;r++){const u=r===t.length-1;Wb(t[r],this.supportsBinary,g=>{try{this.ws.send(g)}catch(E){}u&&SM(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const r=this.opts.secure?"wss":"ws";let a="";this.opts.port&&("wss"===r&&443!==Number(this.opts.port)||"ws"===r&&80!==Number(this.opts.port))&&(a=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=ew()),this.supportsBinary||(t.b64=1);const u=dv.encode(t);return r+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+a+this.opts.path+(u.length?"?"+u:"")}check(){return!(!Ef||"__initialize"in Ef&&this.name===fv.prototype.name)}}const MM={websocket:fv,polling:class CM extends EM{constructor(t){if(super(t),"undefined"!=typeof location){const a="https:"===location.protocol;let u=location.port;u||(u=a?"443":"80"),this.xd="undefined"!=typeof location&&t.hostname!==location.hostname||u!==t.port,this.xs=t.secure!==a}this.supportsBinary=TM&&!(t&&t.forceBase64)}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new Mg(this.uri(),t)}doWrite(t,r){const a=this.request({method:"POST",data:t});a.on("success",r),a.on("error",u=>{this.onError("xhr post error",u)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",r=>{this.onError("xhr poll error",r)}),this.pollXhr=t}}};let rw=(()=>{class e extends zd.Q{constructor(r,a={}){super(),r&&"object"==typeof r&&(a=r,r=null),r?(r=hv(r),a.hostname=r.host,a.secure="https"===r.protocol||"wss"===r.protocol,a.port=r.port,r.query&&(a.query=r.query)):a.host&&(a.hostname=hv(a.host).host),Cg(this,a),this.secure=null!=a.secure?a.secure:"undefined"!=typeof location&&"https:"===location.protocol,a.hostname&&!a.port&&(a.port=this.secure?"443":"80"),this.hostname=a.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=a.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=a.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},a),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=dv.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(r){const a=function AM(e){const t={};for(let r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.opts.query);a.EIO=4,a.transport=r,this.id&&(a.sid=this.id);const u=Object.assign({},this.opts.transportOptions[r],this.opts,{query:a,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new MM[r](u)}open(){let r;if(this.opts.rememberUpgrade&&e.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))r="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);r=this.transports[0]}this.readyState="opening";try{r=this.createTransport(r)}catch(a){return this.transports.shift(),void this.open()}r.open(),this.setTransport(r)}setTransport(r){this.transport&&this.transport.removeAllListeners(),this.transport=r,r.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(r){let a=this.createTransport(r),u=!1;e.priorWebsocketSuccess=!1;const g=()=>{u||(a.send([{type:"ping",data:"probe"}]),a.once("packet",ne=>{if(!u)if("pong"===ne.type&&"probe"===ne.data){if(this.upgrading=!0,this.emitReserved("upgrading",a),!a)return;e.priorWebsocketSuccess="websocket"===a.name,this.transport.pause(()=>{u||"closed"!==this.readyState&&(j(),this.setTransport(a),a.send([{type:"upgrade"}]),this.emitReserved("upgrade",a),a=null,this.upgrading=!1,this.flush())})}else{const oe=new Error("probe error");oe.transport=a.name,this.emitReserved("upgradeError",oe)}}))};function b(){u||(u=!0,j(),a.close(),a=null)}const E=ne=>{const oe=new Error("probe error: "+ne);oe.transport=a.name,b(),this.emitReserved("upgradeError",oe)};function S(){E("transport closed")}function k(){E("socket closed")}function B(ne){a&&ne.name!==a.name&&b()}const j=()=>{a.removeListener("open",g),a.removeListener("error",E),a.removeListener("close",S),this.off("close",k),this.off("upgrading",B)};a.once("open",g),a.once("error",E),a.once("close",S),this.once("close",k),this.once("upgrading",B),a.open()}onOpen(){if(this.readyState="open",e.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let r=0;const a=this.upgrades.length;for(;r<a;r++)this.probe(this.upgrades[r])}}onPacket(r){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",r),this.emitReserved("heartbeat"),r.type){case"open":this.onHandshake(JSON.parse(r.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const a=new Error("server error");a.code=r.data,this.onError(a);break;case"message":this.emitReserved("data",r.data),this.emitReserved("message",r.data)}}onHandshake(r){this.emitReserved("handshake",r),this.id=r.sid,this.transport.query.sid=r.sid,this.upgrades=this.filterUpgrades(r.upgrades),this.pingInterval=r.pingInterval,this.pingTimeout=r.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(r,a,u){return this.sendPacket("message",r,a,u),this}send(r,a,u){return this.sendPacket("message",r,a,u),this}sendPacket(r,a,u,g){if("function"==typeof a&&(g=a,a=void 0),"function"==typeof u&&(g=u,u=null),"closing"===this.readyState||"closed"===this.readyState)return;(u=u||{}).compress=!1!==u.compress;const b={type:r,data:a,options:u};this.emitReserved("packetCreate",b),this.writeBuffer.push(b),g&&this.once("flush",g),this.flush()}close(){const r=()=>{this.onClose("forced close"),this.transport.close()},a=()=>{this.off("upgrade",a),this.off("upgradeError",a),r()},u=()=>{this.once("upgrade",a),this.once("upgradeError",a)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?u():r()}):this.upgrading?u():r()),this}onError(r){e.priorWebsocketSuccess=!1,this.emitReserved("error",r),this.onClose("transport error",r)}onClose(r,a){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",r,a),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(r){const a=[];let u=0;const g=r.length;for(;u<g;u++)~this.transports.indexOf(r[u])&&a.push(r[u]);return a}}return e.protocol=4,e})();const PM="function"==typeof ArrayBuffer,iw=Object.prototype.toString,RM="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===iw.call(Blob),LM="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===iw.call(File);function mv(e){return PM&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||RM&&e instanceof Blob||LM&&e instanceof File}function Ag(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let r=0,a=e.length;r<a;r++)if(Ag(e[r]))return!0;return!1}if(mv(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return Ag(e.toJSON(),!0);for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&Ag(e[r]))return!0;return!1}function FM(e){const t=[],a=e;return a.data=gv(e.data,t),a.attachments=t.length,{packet:a,buffers:t}}function gv(e,t){if(!e)return e;if(mv(e)){const r={_placeholder:!0,num:t.length};return t.push(e),r}if(Array.isArray(e)){const r=new Array(e.length);for(let a=0;a<e.length;a++)r[a]=gv(e[a],t);return r}if("object"==typeof e&&!(e instanceof Date)){const r={};for(const a in e)e.hasOwnProperty(a)&&(r[a]=gv(e[a],t));return r}return e}function OM(e,t){return e.data=_v(e.data,t),e.attachments=void 0,e}function _v(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(Array.isArray(e))for(let r=0;r<e.length;r++)e[r]=_v(e[r],t);else if("object"==typeof e)for(const r in e)e.hasOwnProperty(r)&&(e[r]=_v(e[r],t));return e}const zM=5;var an=(()=>{return(e=an||(an={}))[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK",an;var e})();class BM{encode(t){return t.type!==an.EVENT&&t.type!==an.ACK||!Ag(t)?[this.encodeAsString(t)]:(t.type=t.type===an.EVENT?an.BINARY_EVENT:an.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let r=""+t.type;return(t.type===an.BINARY_EVENT||t.type===an.BINARY_ACK)&&(r+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(r+=t.nsp+","),null!=t.id&&(r+=t.id),null!=t.data&&(r+=JSON.stringify(t.data)),r}encodeAsBinary(t){const r=FM(t),a=this.encodeAsString(r.packet),u=r.buffers;return u.unshift(a),u}}class yv extends zd.Q{constructor(){super()}add(t){let r;if("string"==typeof t)r=this.decodeString(t),r.type===an.BINARY_EVENT||r.type===an.BINARY_ACK?(this.reconstructor=new VM(r),0===r.attachments&&super.emitReserved("decoded",r)):super.emitReserved("decoded",r);else{if(!mv(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");r=this.reconstructor.takeBinaryData(t),r&&(this.reconstructor=null,super.emitReserved("decoded",r))}}decodeString(t){let r=0;const a={type:Number(t.charAt(0))};if(void 0===an[a.type])throw new Error("unknown packet type "+a.type);if(a.type===an.BINARY_EVENT||a.type===an.BINARY_ACK){const g=r+1;for(;"-"!==t.charAt(++r)&&r!=t.length;);const b=t.substring(g,r);if(b!=Number(b)||"-"!==t.charAt(r))throw new Error("Illegal attachments");a.attachments=Number(b)}if("/"===t.charAt(r+1)){const g=r+1;for(;++r&&","!==t.charAt(r)&&r!==t.length;);a.nsp=t.substring(g,r)}else a.nsp="/";const u=t.charAt(r+1);if(""!==u&&Number(u)==u){const g=r+1;for(;++r;){const b=t.charAt(r);if(null==b||Number(b)!=b){--r;break}if(r===t.length)break}a.id=Number(t.substring(g,r+1))}if(t.charAt(++r)){const g=function NM(e){try{return JSON.parse(e)}catch(t){return!1}}(t.substr(r));if(!yv.isPayloadValid(a.type,g))throw new Error("invalid payload");a.data=g}return a}static isPayloadValid(t,r){switch(t){case an.CONNECT:return"object"==typeof r;case an.DISCONNECT:return void 0===r;case an.CONNECT_ERROR:return"string"==typeof r||"object"==typeof r;case an.EVENT:case an.BINARY_EVENT:return Array.isArray(r)&&r.length>0;case an.ACK:case an.BINARY_ACK:return Array.isArray(r)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class VM{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const r=OM(this.reconPack,this.buffers);return this.finishedReconstruction(),r}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function ta(e,t,r){return e.on(t,r),function(){e.off(t,r)}}const UM=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class ow extends zd.Q{constructor(t,r,a){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=r,a&&a.auth&&(this.auth=a.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const t=this.io;this.subs=[ta(t,"open",this.onopen.bind(this)),ta(t,"packet",this.onpacket.bind(this)),ta(t,"error",this.onerror.bind(this)),ta(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...r){if(UM.hasOwnProperty(t))throw new Error('"'+t+'" is a reserved event name');r.unshift(t);const a={type:an.EVENT,data:r,options:{}};if(a.options.compress=!1!==this.flags.compress,"function"==typeof r[r.length-1]){const b=this.ids++,E=r.pop();this._registerAckCallback(b,E),a.id=b}return this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?this.packet(a):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,r){const a=this.flags.timeout;if(void 0===a)return void(this.acks[t]=r);const u=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let g=0;g<this.sendBuffer.length;g++)this.sendBuffer[g].id===t&&this.sendBuffer.splice(g,1);r.call(this,new Error("operation has timed out"))},a);this.acks[t]=(...g)=>{this.io.clearTimeoutFn(u),r.apply(this,[null,...g])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth(t=>{this.packet({type:an.CONNECT,data:t})}):this.packet({type:an.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",t)}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case an.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case an.EVENT:case an.BINARY_EVENT:this.onevent(t);break;case an.ACK:case an.BINARY_ACK:this.onack(t);break;case an.DISCONNECT:this.ondisconnect();break;case an.CONNECT_ERROR:this.destroy();const a=new Error(t.data.message);a.data=t.data.data,this.emitReserved("connect_error",a)}}onevent(t){const r=t.data||[];null!=t.id&&r.push(this.ack(t.id)),this.connected?this.emitEvent(r):this.receiveBuffer.push(Object.freeze(r))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const r=this._anyListeners.slice();for(const a of r)a.apply(this,t)}super.emit.apply(this,t)}ack(t){const r=this;let a=!1;return function(...u){a||(a=!0,r.packet({type:an.ACK,id:t,data:u}))}}onack(t){const r=this.acks[t.id];"function"==typeof r&&(r.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>this.packet(t)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:an.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const r=this._anyListeners;for(let a=0;a<r.length;a++)if(t===r[a])return r.splice(a,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var jM=it(150);class vv extends zd.Q{constructor(t,r){var a;super(),this.nsps={},this.subs=[],t&&"object"==typeof t&&(r=t,t=void 0),(r=r||{}).path=r.path||"/socket.io",this.opts=r,Cg(this,r),this.reconnection(!1!==r.reconnection),this.reconnectionAttempts(r.reconnectionAttempts||1/0),this.reconnectionDelay(r.reconnectionDelay||1e3),this.reconnectionDelayMax(r.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(a=r.randomizationFactor)&&void 0!==a?a:.5),this.backoff=new jM({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==r.timeout?2e4:r.timeout),this._readyState="closed",this.uri=t;const u=r.parser||Ln;this.encoder=new u.Encoder,this.decoder=new u.Decoder,this._autoConnect=!1!==r.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var r;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(r=this.backoff)||void 0===r||r.setMin(t),this)}randomizationFactor(t){var r;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(r=this.backoff)||void 0===r||r.setJitter(t),this)}reconnectionDelayMax(t){var r;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(r=this.backoff)||void 0===r||r.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new rw(this.uri,this.opts);const r=this.engine,a=this;this._readyState="opening",this.skipReconnect=!1;const u=ta(r,"open",function(){a.onopen(),t&&t()}),g=ta(r,"error",b=>{a.cleanup(),a._readyState="closed",this.emitReserved("error",b),t?t(b):a.maybeReconnectOnOpen()});if(!1!==this._timeout){const b=this._timeout;0===b&&u();const E=this.setTimeoutFn(()=>{u(),r.close(),r.emit("error",new Error("timeout"))},b);this.opts.autoUnref&&E.unref(),this.subs.push(function(){clearTimeout(E)})}return this.subs.push(u),this.subs.push(g),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(ta(t,"ping",this.onping.bind(this)),ta(t,"data",this.ondata.bind(this)),ta(t,"error",this.onerror.bind(this)),ta(t,"close",this.onclose.bind(this)),ta(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){this.decoder.add(t)}ondecoded(t){this.emitReserved("packet",t)}onerror(t){this.emitReserved("error",t)}socket(t,r){let a=this.nsps[t];return a||(a=new ow(this,t,r),this.nsps[t]=a),a}_destroy(t){const r=Object.keys(this.nsps);for(const a of r)if(this.nsps[a].active)return;this._close()}_packet(t){const r=this.encoder.encode(t);for(let a=0;a<r.length;a++)this.engine.write(r[a],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const r=this.backoff.duration();this._reconnecting=!0;const a=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(u=>{u?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",u)):t.onreconnect()}))},r);this.opts.autoUnref&&a.unref(),this.subs.push(function(){clearTimeout(a)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Df={};function Pg(e,t){"object"==typeof e&&(t=e,e=void 0);const r=function lM(e,t="",r){let a=e;r=r||"undefined"!=typeof location&&location,null==e&&(e=r.protocol+"//"+r.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?r.protocol+e:r.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==r?r.protocol+"//"+e:"https://"+e),a=hv(e)),a.port||(/^(http|ws)$/.test(a.protocol)?a.port="80":/^(http|ws)s$/.test(a.protocol)&&(a.port="443")),a.path=a.path||"/";const g=-1!==a.host.indexOf(":")?"["+a.host+"]":a.host;return a.id=a.protocol+"://"+g+":"+a.port+t,a.href=a.protocol+"://"+g+(r&&r.port===a.port?"":":"+a.port),a}(e,(t=t||{}).path||"/socket.io"),a=r.source,u=r.id;let S;return t.forceNew||t["force new connection"]||!1===t.multiplex||Df[u]&&r.path in Df[u].nsps?S=new vv(a,t):(Df[u]||(Df[u]=new vv(a,t)),S=Df[u]),r.query&&!t.query&&(t.query=r.queryKey),S.socket(r.path,t)}Object.assign(Pg,{Manager:vv,Socket:ow,io:Pg,connect:Pg});const Tf_apiKey="pk.eyJ1IjoicmFtYzIzNCIsImEiOiJja3oxdHF6ZW8xNmU0MnhvN3FtMXJwd3J0In0.G5FiR5WDvYluiY0JJuSKxw";let $M=(()=>{class e extends av{constructor(r){super(r),this.baseUrl="https://api.mapbox.com/directions/v5/mapbox/driving"}get(r){return super.get(r=this.baseUrl+r,{params:{alternatives:!1,geometries:"geojson",language:"en",overview:"simplified",steps:!1,access_token:Tf_apiKey}})}}return e.\u0275fac=function(r){return new(r||e)(Lt(Dg))},e.\u0275prov=nn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),kg=(()=>{class e{constructor(r){this.directionApi=r,this.message$=new Gb(""),this.driver$=new Gb(""),this.socket=Pg("https://mapp1223.herokuapp.com"),this.markers=[],this.getLocation=()=>(this.socket.on("position",a=>{this.driver$.next(a),console.log(a)}),this.driver$.asObservable())}get isMapReady(){return!!this.map}setMap(r){this.map=r}flyTo(r){var a;if(!this.isMapReady)throw new Error("Map is not ready");null===(a=this.map)||void 0===a||a.flyTo({zoom:14,center:r})}createMakerFromPlaces(r,a){if(!this.map)throw new Error("Map is not ready");const u=[];for(const b of r){const[E,S]=b.center,k=(new Gl.Popup).setHTML(`\n      <h6>${b.text}</h6>\n       <span>${b.place_name}</span>`);this.markers.forEach(j=>j.remove());const B=(new Gl.Marker).setLngLat([E,S]).setPopup(k).addTo(this.map);u.push(B)}if(this.markers=u,0===r.length)return;const g=new Gl.LngLatBounds;u.forEach(b=>g.extend(b.getLngLat())),g.extend(a),this.map.fitBounds(g,{padding:200})}getRouteBetweenPonts(r,a){return this.directionApi.get(`/${r.join(",")};${a.join(",")}`).subscribe(u=>{this.drawPoline(u.routes[0])})}drawPoline(r){if(console.log({kms:r.distance/1e3,duration:r.duration/60}),!this.map)throw Error("Map is not  ready");const a=r.geometry.coordinates,g=new Gl.LngLatBounds;a.forEach(([E,S])=>{g.extend([E,S])}),this.map.fitBounds(g,{padding:200});const b={type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:a}}]}};this.map.getLayer("RouteString")&&(this.map.removeLayer("RouteString"),this.map.removeSource("RouteString")),this.map.addSource("RouteString",b),this.map.addLayer({id:"RouteString",type:"line",source:"RouteString",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"red","line-width":3}}),this.route=r}sendLocation(r){const{geometry:a}=r,{coordinates:u}=a;this.socket.emit("find-driver",u)}wacthLocation(){navigator.geolocation.watchPosition(r=>{console.log(r)})}CreateUSerMarker(r){const a=[];if(!this.map)throw Error("Map is not ready");this.markers.forEach(g=>g.remove());const u=new Gl.Marker;u.getElement().className="fa-solid fa-car-side fa-3x",u.setLngLat(r).addTo(this.map),a.push(u),this.markers=a}}return e.\u0275fac=function(r){return new(r||e)(Lt($M))},e.\u0275prov=nn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function sw(e,t,r,a,u,g,b){try{var E=e[g](b),S=E.value}catch(k){return void r(k)}E.done?t(S):Promise.resolve(S).then(a,u)}let HM=(()=>{class e extends av{constructor(r){super(r),this.baseUrl="https://api.mapbox.com/geocoding/v5/mapbox.places"}get(r,a){return super.get(r=this.baseUrl+r,{params:Object.assign({limit:5,language:"en",access_token:Tf_apiKey},null==a?void 0:a.params)})}}return e.\u0275fac=function(r){return new(r||e)(Lt(Dg))},e.\u0275prov=nn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Cf=(()=>{class e{constructor(r,a){this.placesIp=r,this.mapService=a,this.isLoandingPlaces=!1,this.places=[],this.getUserLocation()}get isUserLocation(){return!!this.userLocaction}getUserLocation(){var r=this;return function GM(e){return function(){var t=this,r=arguments;return new Promise(function(a,u){var g=e.apply(t,r);function b(S){sw(g,a,u,b,E,"next",S)}function E(S){sw(g,a,u,b,E,"throw",S)}b(void 0)})}}(function*(){return new Promise((a,u)=>{navigator.geolocation.getCurrentPosition(({coords:g})=>{r.userLocaction=[g.longitude,g.latitude],a([g.longitude,g.latitude])},g=>{alert("Please enable location services"),console.log(g),u(g)})})})()}getPlacesByQuery(r=""){var a;if(0===r.trim().length)return this.isLoandingPlaces=!1,void(this.places=[]);if(!this.userLocaction)throw new Error("User location is not defined");this.isLoandingPlaces=!0,this.placesIp.get(`/${r}.json`,{params:{proximity:null===(a=this.userLocaction)||void 0===a?void 0:a.join(",")}}).subscribe(u=>{this.places=u.features,this.isLoandingPlaces=!1,this.mapService.createMakerFromPlaces(this.places,this.userLocaction)})}deletePlaces(){this.places=[]}}return e.\u0275fac=function(r){return new(r||e)(Lt(HM),Lt(kg))},e.\u0275prov=nn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),qM=(()=>{class e{constructor(){}ngOnInit(){}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=io({type:e,selectors:[["app-loading"]],decls:6,vars:0,consts:[[1,"loading-map","d-flex","justify-content-center","align-items-center"],[1,"text-center"]],template:function(r,a){1&r&&(Yr(0,"div",0),Yr(1,"div",1),Yr(2,"h3"),$c(3," Wait Please"),Jr(),Yr(4,"span"),$c(5,"Finding......"),Jr(),Jr(),Jr())},styles:[".loading-map[_ngcontent-%COMP%]{background-color:#000c;color:#fff;height:100vh;position:fixed;right:0;top:0;width:100vw}"]}),e})();const ZM=["mapDiv"];let WM=(()=>{class e{constructor(r,a){this.placeesService=r,this.mapServise=a,this.messageList=[]}ngOnInit(){this.mapServise.getLocation().subscribe(r=>{this.mapServise.CreateUSerMarker(r)})}ngAfterViewInit(){if(!this.placeesService.userLocaction)throw new Error("User location is not defined");const r=new Gl.Map({container:this.mapDivElement.nativeElement,style:"mapbox://styles/mapbox/streets-v11",center:this.placeesService.userLocaction,zoom:14}),a=(new Gl.Popup).setHTML("<h6>Im here </h6> <span>In this places </span>");new Gl.Marker({color:"red"}).setLngLat(this.placeesService.userLocaction).setPopup(a).addTo(r),this.mapServise.setMap(r)}}return e.\u0275fac=function(r){return new(r||e)(Mt(Cf),Mt(kg))},e.\u0275cmp=io({type:e,selectors:[["app-map-view"]],viewQuery:function(r,a){if(1&r&&a1(ZM,5),2&r){let u;s1(u=function l1(){return function MT(e,t){return e[19].queries[t].queryList}(Be(),i())}())&&(a.mapDivElement=u.first)}},decls:2,vars:0,consts:[[1,"map-container"],["mapDiv",""]],template:function(r,a){1&r&&Fa(0,"div",0,1)},styles:[".map-container[_ngcontent-%COMP%]{background-color:#e93636;height:100vh;position:fixed;right:0;top:0;width:100vw}"]}),e})(),XM=(()=>{class e{constructor(r,a){this.placeesService=r,this.mapServise=a}goToMyLocation(){if(!this.mapServise.isMapReady)throw new Error("Map is not ready");if(!this.placeesService.isUserLocation)throw new Error("Places are not loaded");this.mapServise.flyTo(this.placeesService.userLocaction),this.mapServise.wacthLocation()}goToTrip(){if(!this.mapServise.isMapReady)throw new Error("Map is not ready");if(!this.placeesService.isUserLocation)throw new Error("Places are not loaded");if(!this.placeesService.isUserLocation)throw new Error("Places are not loaded");this.mapServise.sendLocation(this.mapServise.route)}}return e.\u0275fac=function(r){return new(r||e)(Mt(Cf),Mt(kg))},e.\u0275cmp=io({type:e,selectors:[["app-btn-my-location"]],decls:4,vars:0,consts:[[1,"btn","btn-primary",3,"click"],[1,"fa-solid","fa-location-crosshairs"],[1,"btn","btn-success",3,"click"],[1,"fa-solid","fa-car-side"]],template:function(r,a){1&r&&(Yr(0,"button",0),ah("click",function(){return a.goToMyLocation()}),Fa(1,"i",1),Jr(),Yr(2,"button",2),ah("click",function(){return a.goToTrip()}),Fa(3,"i",3),Jr())},styles:[".btn-primary[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px}.btn-success[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px}"]}),e})();function KM(e,t){1&e&&(Yr(0,"div",2),Yr(1,"h6"),$c(2,"Loanding"),Jr(),Yr(3,"span"),$c(4,"Wait please"),Jr(),Jr())}function YM(e,t){if(1&e){const r=Y_();Yr(0,"li",5),ah("click",function(){const g=As(r).$implicit;return tf(2).flytTo(g)}),Yr(1,"h6"),$c(2),Jr(),Yr(3,"p"),$c(4),Jr(),Yr(5,"button",6),ah("click",function(){const g=As(r).$implicit;return tf(2).getDirections(g)}),$c(6," Addresses"),Jr(),Jr()}if(2&e){const r=t.$implicit,a=tf(2);ty("active",a.selectedId==r.id),js(2),rf(" ",r.text_en,""),js(2),rf(" ",r.place_name,""),js(1),sh("ngClass",r.id==a.selectedId?"btn-outline-light":"btn-outline-primary")}}function JM(e,t){if(1&e&&(Yr(0,"ul",3),Td(1,YM,7,5,"li",4),Jr()),2&e){const r=tf();js(1),sh("ngForOf",r.places)}}let QM=(()=>{class e{constructor(r,a){this.placesServices=r,this.mapService=a,this.selectedId=""}get isLoading(){return this.placesServices.isLoandingPlaces}get places(){return this.placesServices.places}flytTo(r){this.selectedId=r.id;const[a,u]=r.center;this.mapService.flyTo([a,u])}getDirections(r){if(!this.placesServices.userLocaction)throw Error("There not userLocation");this.placesServices.deletePlaces(),this.mapService.getRouteBetweenPonts(this.placesServices.userLocaction,r.center)}}return e.\u0275fac=function(r){return new(r||e)(Mt(Cf),Mt(kg))},e.\u0275cmp=io({type:e,selectors:[["app-search-results"]],decls:2,vars:2,consts:[["class","alert alert-primary mt-2 text-center",4,"ngIf"],["class"," list-group mt-2",4,"ngIf"],[1,"alert","alert-primary","mt-2","text-center"],[1,"list-group","mt-2"],["class"," list-group-item list-group-item-action pointer",3,"active","click",4,"ngFor","ngForOf"],[1,"list-group-item","list-group-item-action","pointer",3,"click"],[1,"btn","btn-sm",3,"ngClass","click"]],template:function(r,a){1&r&&(Td(0,KM,5,0,"div",0),Td(1,JM,2,1,"ul",1)),2&r&&(sh("ngIf",a.isLoading),js(1),sh("ngIf",a.places.length>0))},directives:[qy,db,hb],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}p[_ngcontent-%COMP%]{font-size:12px}"]}),e})(),e2=(()=>{class e{constructor(r){this.placeservice=r}ngOnInit(){}onQueryChange(r=""){this.deboucenceTime&&clearTimeout(this.deboucenceTime),this.deboucenceTime=setTimeout(()=>{console.log(this.placeservice.getPlacesByQuery(r))},350)}}return e.\u0275fac=function(r){return new(r||e)(Mt(Cf))},e.\u0275cmp=io({type:e,selectors:[["app-search-bar"]],decls:4,vars:0,consts:[[1,"search-container"],["type","text","placeholder","Search place ..",1,"form-control",3,"keyup"],["txtQuery",""]],template:function(r,a){if(1&r){const u=Y_();Yr(0,"div",0),Yr(1,"input",1,2),ah("keyup",function(){As(u);const b=H_(2);return a.onQueryChange(b.value)}),Jr(),Fa(3,"app-search-results"),Jr()}},directives:[QM],styles:[".search-container[_ngcontent-%COMP%]{left:20px;position:fixed;top:20px;width:250px;background-color:#fff;border-radius:5px;border:1px solid rgba(0,0,0,.1);box-shadow:0 10px 10px #0000001a;padding:5px}"]}),e})();function t2(e,t){1&e&&Fa(0,"app-loading")}function n2(e,t){1&e&&(Fa(0,"app-map-view"),Yr(1,"div",2),Fa(2,"app-btn-my-location"),Fa(3,"app-search-bar"),Jr())}let r2=(()=>{class e{constructor(r){this.placeesService=r}get isUserLocationReady(){return this.placeesService.isUserLocation}}return e.\u0275fac=function(r){return new(r||e)(Mt(Cf))},e.\u0275cmp=io({type:e,selectors:[["app-map-screen"]],decls:3,vars:2,consts:[[4,"ngIf","ngIfElse"],["mapReady",""],[1,"mapcontainer"]],template:function(r,a){if(1&r&&(Td(0,t2,1,0,"app-loading",0),Td(1,n2,4,0,"ng-template",null,1,d1)),2&r){const u=H_(2);sh("ngIf",!a.isUserLocationReady)("ngIfElse",u)}},directives:[qy,qM,WM,XM,e2],styles:[".mapcontainer[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:center}"]}),e})(),i2=(()=>{class e{constructor(){this.title="Mapapp"}}return e.\u0275fac=function(r){return new(r||e)},e.\u0275cmp=io({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(r,a){1&r&&Fa(0,"app-map-screen")},directives:[r2],styles:[""]}),e})(),o2=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oo({type:e}),e.\u0275inj=Ci({imports:[[_b]]}),e})(),s2=(()=>{class e{}return e.\u0275fac=function(r){return new(r||e)},e.\u0275mod=oo({type:e,bootstrap:[i2]}),e.\u0275inj=Ci({providers:[],imports:[[RI,o2,sM]]}),e})();aM().accessToken=Tf_apiKey,navigator.geolocation||alert("Geolocation is not supported by your browser"),function fC(){U1=!1}(),PI().bootstrapModule(s2).catch(e=>console.error(e))},80:(xi,Nn)=>{function it(at){if(at)return function Ln(at){for(var ln in it.prototype)at[ln]=it.prototype[ln];return at}(at)}Nn.Q=it,it.prototype.on=it.prototype.addEventListener=function(at,ln){return this._callbacks=this._callbacks||{},(this._callbacks["$"+at]=this._callbacks["$"+at]||[]).push(ln),this},it.prototype.once=function(at,ln){function d(){this.off(at,d),ln.apply(this,arguments)}return d.fn=ln,this.on(at,d),this},it.prototype.off=it.prototype.removeListener=it.prototype.removeAllListeners=it.prototype.removeEventListener=function(at,ln){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var d=this._callbacks["$"+at];if(!d)return this;if(1==arguments.length)return delete this._callbacks["$"+at],this;for(var At,Bt=0;Bt<d.length;Bt++)if((At=d[Bt])===ln||At.fn===ln){d.splice(Bt,1);break}return 0===d.length&&delete this._callbacks["$"+at],this},it.prototype.emitReserved=it.prototype.emit=function(at){this._callbacks=this._callbacks||{};for(var ln=new Array(arguments.length-1),d=this._callbacks["$"+at],At=1;At<arguments.length;At++)ln[At-1]=arguments[At];if(d){At=0;for(var Bt=(d=d.slice(0)).length;At<Bt;++At)d[At].apply(this,ln)}return this},it.prototype.listeners=function(at){return this._callbacks=this._callbacks||{},this._callbacks["$"+at]||[]},it.prototype.hasListeners=function(at){return!!this.listeners(at).length}},150:xi=>{function Nn(it){this.ms=(it=it||{}).min||100,this.max=it.max||1e4,this.factor=it.factor||2,this.jitter=it.jitter>0&&it.jitter<=1?it.jitter:0,this.attempts=0}xi.exports=Nn,Nn.prototype.duration=function(){var it=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var Ln=Math.random(),at=Math.floor(Ln*this.jitter*it);it=0==(1&Math.floor(10*Ln))?it-at:it+at}return 0|Math.min(it,this.max)},Nn.prototype.reset=function(){this.attempts=0},Nn.prototype.setMin=function(it){this.ms=it},Nn.prototype.setMax=function(it){this.max=it},Nn.prototype.setJitter=function(it){this.jitter=it}},764:xi=>{try{xi.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(Nn){xi.exports=!1}},898:function(xi){xi.exports=function(){"use strict";var Nn,it,Ln;function at(d,At){if(Nn)if(it){var Bt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Nn+")(sharedChunk); ("+it+")(sharedChunk); self.onerror = null;",Sn={};Nn(Sn),Ln=At(Sn),"undefined"!=typeof window&&(Ln.workerUrl=window.URL.createObjectURL(new Blob([Bt],{type:"text/javascript"})))}else it=At;else Nn=At}return at(0,function(d){var Bt=Sn;function Sn(o,n,s,l){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(l-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=s,this.p2y=l}Sn.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Sn.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Sn.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Sn.prototype.solveCurveX=function(o,n){var s,l,h,f,_;for(void 0===n&&(n=1e-6),h=o,_=0;_<8;_++){if(f=this.sampleCurveX(h)-o,Math.abs(f)<n)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=f/x}if((h=o)<(s=0))return s;if(h>(l=1))return l;for(;s<l;){if(f=this.sampleCurveX(h),Math.abs(f-o)<n)return h;o>f?s=h:l=h,h=.5*(l-s)+s}return h},Sn.prototype.solve=function(o,n){return this.sampleCurveY(this.solveCurveX(o,n))};var Ie=De;function De(o,n){this.x=o,this.y=n}De.prototype={clone:function(){return new De(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,n){return this.clone()._rotateAround(o,n)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var n=o.x-this.x,s=o.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,n){return Math.atan2(this.x*n-this.y*o,this.x*o+this.y*n)},_matMult:function(o){var n=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=n,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var n=Math.cos(o),s=Math.sin(o),l=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=l,this},_rotateAround:function(o,n){var s=Math.cos(o),l=Math.sin(o),h=n.y+l*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-l*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},De.convert=function(o){return o instanceof De?o:Array.isArray(o)?new De(o[0],o[1]):o};var nt="undefined"!=typeof self?self:{};const ui=Math.pow(2,53)-1,na=Math.PI/180,vo=180/Math.PI;function yn(o){return o*na}function ti(o){return o*vo}const Hl=[[0,0],[1,0],[1,1],[0,1]];function Vo(o){if(o<=0)return 0;if(o>=1)return 1;const n=o*o,s=n*o;return 4*(o<.5?s:3*(o-n)+s-.75)}function ni(o,n,s,l){const h=new Bt(o,n,s,l);return function(f){return h.solve(f)}}const bi=ni(.25,.1,.25,1);function en(o,n,s){return Math.min(s,Math.max(n,o))}function xo(o,n,s){const l=s-n,h=((o-n)%l+l)%l+n;return h===n?s:h}function Uo(o,n,s){if(!o.length)return s(null,[]);let l=o.length;const h=new Array(o.length);let f=null;o.forEach((_,x)=>{n(_,(w,T)=>{w&&(f=w),h[x]=T,0==--l&&s(f,h)})})}function jo(o){const n=[];for(const s in o)n.push(o[s]);return n}function Vn(o,...n){for(const s of n)for(const l in s)o[l]=s[l];return o}let Va=1;function _s(){return Va++}function ys(){return function o(n){return n?(n^16*Math.random()>>n/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function ra(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ql(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function $o(o,n){o.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function Hn(o,n){return-1!==o.indexOf(n,o.length-n.length)}function Zi(o,n,s){const l={};for(const h in o)l[h]=n.call(s||this,o[h],h,o);return l}function Wi(o,n,s){const l={};for(const h in o)n.call(s||this,o[h],h,o)&&(l[h]=o[h]);return l}function cr(o){return Array.isArray(o)?o.map(cr):"object"==typeof o&&o?Zi(o,cr):o}const ia={};function En(o){ia[o]||("undefined"!=typeof console&&console.warn(o),ia[o]=!0)}function hi(o,n,s){return(s.y-o.y)*(n.x-o.x)>(n.y-o.y)*(s.x-o.x)}function Zl(o){let n=0;for(let s,l,h=0,f=o.length,_=f-1;h<f;_=h++)s=o[h],l=o[_],n+=(l.x-s.x)*(s.y+l.y);return n}function yr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function wi(o){const n={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,l,h,f)=>{const _=h||f;return n[l]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let Xi,Ot,Ua,vs=null;function Wl(o){if(null==vs){const n=o.navigator?o.navigator.userAgent:null;vs=!!o.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return vs}function oa(o){try{const n=nt[o];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(n){return!1}}const Ei={now:()=>void 0!==Ua?Ua:nt.performance.now(),setNow(o){Ua=o},restoreNow(){Ua=void 0},frame(o){const n=nt.requestAnimationFrame(o);return{cancel:()=>nt.cancelAnimationFrame(n)}},getImageData(o,n=0){const s=nt.document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return s.width=o.width,s.height=o.height,l.drawImage(o,0,0,o.width,o.height),l.getImageData(-n,-n,o.width+2*n,o.height+2*n)},resolveURL:o=>(Xi||(Xi=nt.document.createElement("a")),Xi.href=o,Xi.href),get devicePixelRatio(){return nt.devicePixelRatio},get prefersReducedMotion(){return!!nt.matchMedia&&(null==Ot&&(Ot=nt.matchMedia("(prefers-reduced-motion: reduce)")),Ot.matches)}};let ja;const zt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ja){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ja=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(n){ja=o}}return ja},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},sa={supported:!1,testSupport:function(o){!aa&&wo&&(Go?$a(o):bo=o)}};let bo,wo,aa=!1,Go=!1;function $a(o){const n=o.createTexture();o.bindTexture(o.TEXTURE_2D,n);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,wo),o.isContextLost())return;sa.supported=!0}catch(s){}o.deleteTexture(n),aa=!0}nt.document&&(wo=nt.document.createElement("img"),wo.onload=function(){bo&&$a(bo),bo=null,Go=!0},wo.onerror=function(){aa=!0,bo=null},wo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ga="01",Ha="NO_ACCESS_TOKEN";function ur(o){return 0===o.indexOf("mapbox:")}function Ho(o){return zt.API_URL_REGEX.test(o)}const Wc=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Di(o){const n=o.match(Wc);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function ri(o){const n=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${n}`}function Xl(o){if(!o)return null;const n=o.split(".");if(!n||3!==n.length)return null;try{return JSON.parse(decodeURIComponent(nt.atob(n[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class qa{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=Xl(zt.ACCESS_TOKEN);let l="";return l=s&&s.u?nt.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(Number("0x"+f)))):zt.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const n=oa("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{const h=nt.localStorage.getItem(s);h&&(this.eventData=JSON.parse(h));const f=nt.localStorage.getItem(l);f&&(this.anonId=f)}catch(h){En("Unable to read from LocalStorage")}}saveEventData(){const n=oa("localStorage"),s=this.getStorageKey(),l=this.getStorageKey("uuid");if(n)try{nt.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&nt.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(h){En("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,l,h){if(!zt.EVENTS_URL)return;const f=Di(zt.EVENTS_URL);f.params.push(`access_token=${h||zt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.6.1",skuId:Ga,userId:this.anonId},x=s?Vn(_,s):_,w={url:ri(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=X(w,T=>{this.pendingRequest=null,l(T),this.saveEventData(),this.processRequests(h)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const Kl=new class extends qa{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,n){zt.EVENTS_URL&&zt.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>ur(s)||Ho(s))&&this.queueRequest(Date.now(),n)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Xl(zt.ACCESS_TOKEN),s=n?n.u:zt.ACCESS_TOKEN;let l=s!==this.eventData.tokenU;ql(this.anonId)||(this.anonId=ys(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||f.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(h,{"enabled.telemetry":!1},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=s)},o)}},Yl=Kl.postTurnstileEvent.bind(Kl),Za=new class extends qa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,n,s,l){this.skuToken=n,this.errorCb=l,zt.EVENTS_URL&&(s||zt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ha)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),ql(this.anonId)||(this.anonId=ys()),this.postEvent(s,{skuToken:this.skuToken},l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},o))}},Jl=Za.postMapLoadEvent.bind(Za),Wa=new class extends qa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,n,s,l){if(!zt.API_URL||!zt.SESSION_PATH)return;const h=Di(zt.API_URL+zt.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${l||zt.ACCESS_TOKEN||""}`);const f={url:ri(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=J(f,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(o,n,s,l){this.skuToken=n,this.errorCb=l,zt.SESSION_PATH&&zt.API_URL&&(s||zt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(Ha)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,l=>{l?this.errorCb(l):n&&(this.success[n]=!0)},o)}},Xa=Wa.getSessionAPI.bind(Wa),Eo=new Set,la="mapbox-tiles";let Ti,qo,Ka=500,Zo=50;function Ki(){nt.caches&&!Ti&&(Ti=nt.caches.open(la))}function Ri(o){const n=o.indexOf("?");return n<0?o:o.slice(0,n)}let Ya=1/0;const xs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(xs);class bs extends Error{constructor(n,s,l){401===s&&Ho(l)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Y=yr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===nt.location.protocol?nt.parent:nt).location.href,O=function(o,n){if(!(/^file:/.test(s=o.url)||/^file:/.test(Y())&&!/^\w+:/.test(s))){if(nt.fetch&&nt.Request&&nt.AbortController&&nt.Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new nt.AbortController,_=new nt.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:Y(),signal:f.signal});let x=!1,w=!1;const T=(I=_.url).indexOf("sku=")>0&&Ho(I);var I;"json"===l.type&&_.headers.set("Accept","application/json");const M=(z,N,$)=>{if(w)return;if(z&&"SecurityError"!==z.message&&En(z),N&&$)return P(N);const K=Date.now();nt.fetch(_).then(te=>{if(te.ok){const se=T?te.clone():null;return P(te,se,K)}return h(new bs(te.statusText,te.status,l.url))}).catch(te=>{20!==te.code&&h(new Error(te.message))})},P=(z,N,$)=>{("arrayBuffer"===l.type?z.arrayBuffer():"json"===l.type?z.json():z.text()).then(K=>{w||(N&&$&&function(te,se,ue){if(Ki(),!Ti)return;const pe={status:se.status,statusText:se.statusText,headers:new nt.Headers};se.headers.forEach((fe,Me)=>pe.headers.set(Me,fe));const he=wi(se.headers.get("Cache-Control")||"");he["no-store"]||(he["max-age"]&&pe.headers.set("Expires",new Date(ue+1e3*he["max-age"]).toUTCString()),new Date(pe.headers.get("Expires")).getTime()-ue<42e4||function(fe,Me){if(void 0===qo)try{new Response(new ReadableStream),qo=!0}catch(Ee){qo=!1}qo?Me(fe.body):fe.blob().then(Me)}(se,fe=>{const Me=new nt.Response(fe,pe);Ki(),Ti&&Ti.then(Ee=>Ee.put(Ri(te.url),Me)).catch(Ee=>En(Ee.message))}))}(_,N,$),x=!0,h(null,K,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(K=>{w||h(new Error(K.message))})};return T?function(z,N){if(Ki(),!Ti)return N(null);const $=Ri(z.url);Ti.then(K=>{K.match($).then(te=>{const se=function(ue){if(!ue)return!1;const pe=new Date(ue.headers.get("Expires")||0),he=wi(ue.headers.get("Cache-Control")||"");return pe>Date.now()&&!he["no-cache"]}(te);K.delete($),se&&K.put($,te.clone()),N(null,te,se)}).catch(N)}).catch(N)}(_,M):M(null,null),{cancel:()=>{w=!0,x||f.abort()}}}(o,n);if(yr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,n,void 0,!0)}var s;return function(l,h){const f=new nt.XMLHttpRequest;f.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(f.responseType="arraybuffer");for(const _ in l.headers)f.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===l.credentials,f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let _=f.response;if("json"===l.type)try{_=JSON.parse(f.response)}catch(x){return h(x)}h(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new bs(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(o,n)},V=function(o,n){return O(Vn(o,{type:"arrayBuffer"}),n)},X=function(o,n){return O(Vn(o,{method:"POST"}),n)},J=function(o,n){return O(Vn(o,{method:"GET"}),n)};function le(o){const n=nt.document.createElement("a");return n.href=o,n.protocol===nt.document.location.protocol&&n.host===nt.document.location.host}const me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ge,ce;ge=[],ce=0;const _e=function(o,n){if(sa.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),ce>=zt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:o,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return ge.push(f),f}ce++;let s=!1;const l=()=>{if(!s)for(s=!0,ce--;ge.length&&ce<zt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=ge.shift(),{requestParameters:_,callback:x,cancelled:w}=f;w||(f.cancel=_e(_,x).cancel)}},h=V(o,(f,_,x,w)=>{l(),f?n(f):_&&(nt.createImageBitmap?function(T,I){const M=new nt.Blob([new Uint8Array(T)],{type:"image/png"});nt.createImageBitmap(M).then(P=>{I(null,P)}).catch(P=>{I(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(T,I)=>n(T,I,x,w)):function(T,I){const M=new nt.Image,P=nt.URL;M.onload=()=>{I(null,M),P.revokeObjectURL(M.src),M.onload=null,nt.requestAnimationFrame(()=>{M.src=me})},M.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new nt.Blob([new Uint8Array(T)],{type:"image/png"});M.src=T.byteLength?P.createObjectURL(z):me}(_,(T,I)=>n(T,I,x,w)))});return{cancel:()=>{h.cancel(),l()}}};function Pe(o,n,s){s[o]&&-1!==s[o].indexOf(n)||(s[o]=s[o]||[],s[o].push(n))}function We(o,n,s){if(s&&s[o]){const l=s[o].indexOf(n);-1!==l&&s[o].splice(l,1)}}class Le{constructor(n,s={}){Vn(this,s),this.type=n}}class ot extends Le{constructor(n,s={}){super("error",Vn({error:n},s))}}class $e{on(n,s){return this._listeners=this._listeners||{},Pe(n,s,this._listeners),this}off(n,s){return We(n,s,this._listeners),We(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Pe(n,s,this._oneTimeListeners),this):new Promise(l=>this.once(n,l))}fire(n,s){"string"==typeof n&&(n=new Le(n,s||{}));const l=n.type;if(this.listens(l)){n.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,n);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)We(l,x,this._oneTimeListeners),x.call(this,n);const _=this._eventedParent;_&&(Vn(n,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof ot&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var de=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Te{constructor(n,s,l,h){this.message=(n?`${n}: `:"")+l,h&&(this.identifier=h),null!=s&&s.__line__&&(this.line=s.__line__)}}function It(o){const n=o.value;return n?[new Te(o.key,n,"constants have been deprecated as of v8")]:[]}function Kt(o,...n){for(const s of n)for(const l in s)o[l]=s[l];return o}function mt(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Nt(o){if(Array.isArray(o))return o.map(Nt);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const n={};for(const s in o)n[s]=Nt(o[s]);return n}return mt(o)}class Gt extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Wo{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[l,h]of s)this.bindings[l]=h}concat(n){return new Wo(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Yi={kind:"null"},Xe={kind:"number"},Tt={kind:"string"},Ct={kind:"boolean"},qn={kind:"color"},ws={kind:"object"},Et={kind:"value"},cn={kind:"collator"},Xo={kind:"formatted"},Pt={kind:"resolvedImage"};function Ur(o,n){return{kind:"array",itemType:o,N:n}}function Mn(o){if("array"===o.kind){const n=Mn(o.itemType);return"number"==typeof o.N?`array<${n}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${n}>`}return o.kind}const Ql=[Yi,Xe,Tt,Ct,qn,Xo,ws,Ur(Et),Pt];function gt(o,n){if("error"===n.kind)return null;if("array"===o.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!gt(o.itemType,n.itemType))&&("number"!=typeof o.N||o.N===n.N))return null}else{if(o.kind===n.kind)return null;if("value"===o.kind)for(const s of Ql)if(!gt(s,n))return null}return`Expected ${Mn(o)} but found ${Mn(n)} instead.`}function ec(o,n){return n.some(s=>s.kind===o.kind)}function Ji(o,n){return n.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}function Ar(o){var n={exports:{}};return o(n,n.exports),n.exports}var Qi=Ar(function(o,n){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return l("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function f(x){return(w="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function _(x,w,T){return T<0?T+=1:T>1&&(T-=1),6*T<1?x+(w-x)*T*6:2*T<1?w:3*T<2?x+(w-x)*(2/3-T)*6:x}try{n.parseCSSColor=function(x){var w,T=x.replace(/ /g,"").toLowerCase();if(T in s)return s[T].slice();if("#"===T[0])return 4===T.length?(w=parseInt(T.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===T.length&&(w=parseInt(T.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var I=T.indexOf("("),M=T.indexOf(")");if(-1!==I&&M+1===T.length){var P=T.substr(0,I),z=T.substr(I+1,M-(I+1)).split(","),N=1;switch(P){case"rgba":if(4!==z.length)return null;N=f(z.pop());case"rgb":return 3!==z.length?null:[h(z[0]),h(z[1]),h(z[2]),N];case"hsla":if(4!==z.length)return null;N=f(z.pop());case"hsl":if(3!==z.length)return null;var $=(parseFloat(z[0])%360+360)%360/360,K=f(z[1]),te=f(z[2]),se=te<=.5?te*(K+1):te+K-te*K,ue=2*te-se;return[l(255*_(ue,se,$+1/3)),l(255*_(ue,se,$)),l(255*_(ue,se,$-1/3)),N];default:return null}}return null}}catch(x){}});class Vt{constructor(n,s,l,h=1){this.r=n,this.g=s,this.b=l,this.a=h}static parse(n){if(!n)return;if(n instanceof Vt)return n;if("string"!=typeof n)return;const s=Qi.parseCSSColor(n);return s?new Vt(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,l,h]=this.toArray();return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(l)},${h})`}toArray(){const{r:n,g:s,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*n/h,255*s/h,255*l/h,h]}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1),Vt.blue=new Vt(0,0,1,1);class vt{constructor(n,s,l){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zn{constructor(n,s,l,h,f){this.text=n,this.image=s,this.scale=l,this.fontStack=h,this.textColor=f}}class Pr{constructor(n){this.sections=n}static fromString(n){return new Pr([new Zn(n,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(n=>0!==n.text.length||n.image&&0!==n.image.name.length)}static factory(n){return n instanceof Pr?n:Pr.fromString(n)}toString(){return 0===this.sections.length?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.name]);continue}n.push(s.text);const l={};s.fontStack&&(l["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(l["font-scale"]=s.scale),s.textColor&&(l["text-color"]=["rgba"].concat(s.textColor.toArray())),n.push(l)}return n}}class Li{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Li({name:n,available:!1}):null}serialize(){return["image",this.name]}}function Nd(o,n,s,l){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[o,n,s,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[o,n,s,l]:[o,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Es(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Vt||o instanceof vt||o instanceof Pr||o instanceof Li)return!0;if(Array.isArray(o)){for(const n of o)if(!Es(n))return!1;return!0}if("object"==typeof o){for(const n in o)if(!Es(o[n]))return!1;return!0}return!1}function Yt(o){if(null===o)return Yi;if("string"==typeof o)return Tt;if("boolean"==typeof o)return Ct;if("number"==typeof o)return Xe;if(o instanceof Vt)return qn;if(o instanceof vt)return cn;if(o instanceof Pr)return Xo;if(o instanceof Li)return Pt;if(Array.isArray(o)){const n=o.length;let s;for(const l of o){const h=Yt(l);if(s){if(s===h)continue;s=Et;break}s=h}return Ur(s||Et,n)}return ws}function ca(o){const n=typeof o;return null===o?"":"string"===n||"number"===n||"boolean"===n?String(o):o instanceof Vt||o instanceof Pr||o instanceof Li?o.toString():JSON.stringify(o)}class Ds{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(2!==n.length)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Es(n[1]))return s.error("invalid value");const l=n[1];let h=Yt(l);const f=s.expectedType;return"array"!==h.kind||0!==h.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(h=f),new Ds(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Vt?["rgba"].concat(this.value.toArray()):this.value instanceof Pr?this.value.serialize():this.value}}class rr{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Fi={string:Tt,number:Xe,boolean:Ct,object:ws};class eo{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let l,h=1;const f=n[0];if("array"===f){let x,w;if(n.length>2){const T=n[1];if("string"!=typeof T||!(T in Fi)||"object"===T)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Fi[T],h++}else x=Et;if(n.length>3){if(null!==n[2]&&("number"!=typeof n[2]||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=n[2],h++}l=Ur(x,w)}else l=Fi[f];const _=[];for(;h<n.length;h++){const x=s.parse(n[h],h,Et);if(!x)return null;_.push(x)}return new eo(l,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const l=this.args[s].evaluate(n);if(!gt(this.type,Yt(l)))return l;if(s===this.args.length-1)throw new rr(`Expected value to be of type ${Mn(this.type)}, but found ${Mn(Yt(l))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if("array"===n.kind){const l=n.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){s.push(l.kind);const h=n.N;("number"==typeof h||this.args.length>1)&&s.push(h)}}return s.concat(this.args.map(l=>l.serialize()))}}class tc{constructor(n){this.type=Xo,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const l=n[1];if(!Array.isArray(l)&&"object"==typeof l)return s.error("First argument must be an image or text section.");const h=[];let f=!1;for(let _=1;_<=n.length-1;++_){const x=n[_];if(f&&"object"==typeof x&&!Array.isArray(x)){f=!1;let w=null;if(x["font-scale"]&&(w=s.parse(x["font-scale"],1,Xe),!w))return null;let T=null;if(x["text-font"]&&(T=s.parse(x["text-font"],1,Ur(Tt)),!T))return null;let I=null;if(x["text-color"]&&(I=s.parse(x["text-color"],1,qn),!I))return null;const M=h[h.length-1];M.scale=w,M.font=T,M.textColor=I}else{const w=s.parse(n[_],1,Et);if(!w)return null;const T=w.type.kind;if("string"!==T&&"value"!==T&&"null"!==T&&"resolvedImage"!==T)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new tc(h)}evaluate(n){return new Pr(this.sections.map(s=>{const l=s.content.evaluate(n);return Yt(l)===Pt?new Zn("",l,null,null,null):new Zn(ca(l),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const l={};s.scale&&(l["font-scale"]=s.scale.serialize()),s.font&&(l["text-font"]=s.font.serialize()),s.textColor&&(l["text-color"]=s.textColor.serialize()),n.push(l)}return n}}class Xc{constructor(n){this.type=Pt,this.input=n}static parse(n,s){if(2!==n.length)return s.error("Expected two arguments.");const l=s.parse(n[1],1,Tt);return l?new Xc(l):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),l=Li.fromString(s);return l&&n.availableImages&&(l.available=n.availableImages.indexOf(s)>-1),l}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Sf={"to-boolean":Ct,"to-color":qn,"to-number":Xe,"to-string":Tt};class Ko{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const l=n[0];if(("to-boolean"===l||"to-string"===l)&&2!==n.length)return s.error("Expected one argument.");const h=Sf[l],f=[];for(let _=1;_<n.length;_++){const x=s.parse(n[_],_,Et);if(!x)return null;f.push(x)}return new Ko(h,f)}evaluate(n){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(n));if("color"===this.type.kind){let s,l;for(const h of this.args){if(s=h.evaluate(n),l=null,s instanceof Vt)return s;if("string"==typeof s){const f=n.parseColor(s);if(f)return f}else if(Array.isArray(s)&&(l=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:Nd(s[0],s[1],s[2],s[3]),!l))return new Vt(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new rr(l||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const l of this.args){if(s=l.evaluate(n),null===s)return 0;const h=Number(s);if(!isNaN(h))return h}throw new rr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Pr.fromString(ca(this.args[0].evaluate(n))):"resolvedImage"===this.type.kind?Li.fromString(ca(this.args[0].evaluate(n))):ca(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if("formatted"===this.type.kind)return new tc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Xc(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const If=["Unknown","Point","LineString","Polygon"];class Kc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?If[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*s-n[0])+this.featureDistanceData.bearing[1]*(h*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Vt.parse(n)),s}}class jr{constructor(n,s,l,h){this.name=n,this.type=s,this._evaluate=l,this.args=h}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const l=n[0],h=jr.definitions[l];if(!h)return s.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([T])=>!Array.isArray(T)||T.length===n.length-1);let w=null;for(const[T,I]of x){w=new Qc(s.registry,s.path,null,s.scope);const M=[];let P=!1;for(let z=1;z<n.length;z++){const N=n[z],$=Array.isArray(T)?T[z-1]:T.type,K=w.parse(N,1+M.length,$);if(!K){P=!0;break}M.push(K)}if(!P)if(Array.isArray(T)&&T.length!==M.length)w.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let z=0;z<M.length;z++){const N=Array.isArray(T)?T[z]:T.type,$=M[z];w.concat(z+1).checkSubtype(N,$.type)}if(0===w.errors.length)return new jr(l,f,I,M)}}if(1===x.length)s.errors.push(...w.errors);else{const T=(x.length?x:_).map(([M])=>{return P=M,Array.isArray(P)?`(${P.map(Mn).join(", ")})`:`(${Mn(P.type)}...)`;var P}).join(" | "),I=[];for(let M=1;M<n.length;M++){const P=s.parse(n[M],1+I.length);if(!P)return null;I.push(Mn(P.type))}s.error(`Expected arguments of type ${T}, but found (${I.join(", ")}) instead.`)}return null}static register(n,s){jr.definitions=s;for(const l in s)n[l]=jr}}class kr{constructor(n,s,l){this.type=cn,this.locale=l,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(2!==n.length)return s.error("Expected one argument.");const l=n[1];if("object"!=typeof l||Array.isArray(l))return s.error("Collator options argument must be an object.");const h=s.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,Ct);if(!h)return null;const f=s.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,Ct);if(!f)return null;let _=null;return l.locale&&(_=s.parse(l.locale,1,Tt),!_)?null:new kr(h,f,_)}evaluate(n){return new vt(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const tn=8192;function hh(o,n){o[0]=Math.min(o[0],n[0]),o[1]=Math.min(o[1],n[1]),o[2]=Math.max(o[2],n[0]),o[3]=Math.max(o[3],n[1])}function Yc(o,n){return!(o[0]<=n[0]||o[2]>=n[2]||o[1]<=n[1]||o[3]>=n[3])}function Mf(o,n){const s=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(s*h*tn),Math.round(l*h*tn)]}function nn(o,n,s){const l=o[0]-n[0],h=o[1]-n[1],f=o[0]-s[0],_=o[1]-s[1];return l*_-f*h==0&&l*f<=0&&h*_<=0}function Jc(o,n){let s=!1;for(let _=0,x=n.length;_<x;_++){const w=n[_];for(let T=0,I=w.length;T<I-1;T++){if(nn(o,w[T],w[T+1]))return!1;(h=w[T])[1]>(l=o)[1]!=(f=w[T+1])[1]>l[1]&&l[0]<(f[0]-h[0])*(l[1]-h[1])/(f[1]-h[1])+h[0]&&(s=!s)}}var l,h,f;return s}function Ci(o,n){for(let s=0;s<n.length;s++)if(Jc(o,n[s]))return!0;return!1}function nc(o,n,s,l){const h=l[0]-s[0],f=l[1]-s[1],_=(o[0]-s[0])*f-h*(o[1]-s[1]),x=(n[0]-s[0])*f-h*(n[1]-s[1]);return _>0&&x<0||_<0&&x>0}function dh(o,n,s){for(const T of s)for(let I=0;I<T.length-1;++I)if((x=[(_=T[I+1])[0]-(f=T[I])[0],_[1]-f[1]])[0]*(w=[(h=n)[0]-(l=o)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&nc(l,h,f,_)&&nc(f,_,l,h))return!0;var l,h,f,_,x,w;return!1}function ph(o,n){for(let s=0;s<o.length;++s)if(!Jc(o[s],n))return!1;for(let s=0;s<o.length-1;++s)if(dh(o[s],o[s+1],n))return!1;return!0}function Vd(o,n){for(let s=0;s<n.length;s++)if(ph(o,n[s]))return!0;return!1}function di(o,n,s){const l=[];for(let h=0;h<o.length;h++){const f=[];for(let _=0;_<o[h].length;_++){const x=Mf(o[h][_],s);hh(n,x),f.push(x)}l.push(f)}return l}function ua(o,n,s){const l=[];for(let h=0;h<o.length;h++){const f=di(o[h],n,s);l.push(f)}return l}function Ja(o,n,s,l){if(o[0]<s[0]||o[0]>s[2]){const h=.5*l;let f=o[0]-s[0]>h?-l:s[0]-o[0]>h?l:0;0===f&&(f=o[0]-s[2]>h?-l:s[2]-o[0]>h?l:0),o[0]+=f}hh(n,o)}function ha(o,n,s,l){const h=Math.pow(2,l.z)*tn,f=[l.x*tn,l.y*tn],_=[];for(const x of o)for(const w of x){const T=[w.x+f[0],w.y+f[1]];Ja(T,n,s,h),_.push(T)}return _}function da(o,n,s,l){const h=Math.pow(2,l.z)*tn,f=[l.x*tn,l.y*tn],_=[];for(const w of o){const T=[];for(const I of w){const M=[I.x+f[0],I.y+f[1]];hh(n,M),T.push(M)}_.push(T)}if(n[2]-n[0]<=h/2){(x=n)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const T of w)Ja(T,n,s,h)}var x;return _}class _t{constructor(n,s){this.type=Ct,this.geojson=n,this.geometries=s}static parse(n,s){if(2!==n.length)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Es(n[1])){const l=n[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new _t(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new _t(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new _t(l,l)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(null!=n.geometry()&&null!=n.canonicalID()){if("Point"===n.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const x=di(l.coordinates,f,_),w=ha(s.geometry(),h,f,_);if(!Yc(h,f))return!1;for(const T of w)if(!Jc(T,x))return!1}if("MultiPolygon"===l.type){const x=ua(l.coordinates,f,_),w=ha(s.geometry(),h,f,_);if(!Yc(h,f))return!1;for(const T of w)if(!Ci(T,x))return!1}return!0}(n,this.geometries);if("LineString"===n.geometryType())return function(s,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if("Polygon"===l.type){const x=di(l.coordinates,f,_),w=da(s.geometry(),h,f,_);if(!Yc(h,f))return!1;for(const T of w)if(!ph(T,x))return!1}if("MultiPolygon"===l.type){const x=ua(l.coordinates,f,_),w=da(s.geometry(),h,f,_);if(!Yc(h,f))return!1;for(const T of w)if(!Vd(T,x))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Yo(o){if(o instanceof jr&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof _t)return!1;let n=!0;return o.eachChild(s=>{n&&!Yo(s)&&(n=!1)}),n}function rc(o){if(o instanceof jr&&"feature-state"===o.name)return!1;let n=!0;return o.eachChild(s=>{n&&!rc(s)&&(n=!1)}),n}function Dt(o,n){if(o instanceof jr&&n.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(l=>{s&&!Dt(l,n)&&(s=!1)}),s}class Qa{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(2!==n.length||"string"!=typeof n[1])return s.error("'var' expression requires exactly one string literal argument.");const l=n[1];return s.scope.has(l)?new Qa(l,s.scope.get(l)):s.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qc{constructor(n,s=[],l,h=new Wo,f=[]){this.registry=n,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l}parse(n,s,l,h,f={}){return s?this.concat(s,l,h)._parse(n,f):this._parse(n,f)}_parse(n,s){function l(h,f,_){return"assert"===_?new eo(f,[h]):"coerce"===_?new Ko(f,[h]):h}if(null!==n&&"string"!=typeof n&&"boolean"!=typeof n&&"number"!=typeof n||(n=["literal",n]),Array.isArray(n)){if(0===n.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=n[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let _=f.parse(n,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else _=l(_,x,s.typeAnnotation||"coerce");else _=l(_,x,s.typeAnnotation||"assert")}if(!(_ instanceof Ds)&&"resolvedImage"!==_.type.kind&&to(_)){const x=new Kc;try{_=new Ds(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===n?"'undefined' value invalid. Use null instead.":"object"==typeof n?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,l){const h="number"==typeof n?this.path.concat(n):this.path,f=l?this.scope.concat(l):this.scope;return new Qc(this.registry,h,s||null,f,this.errors)}error(n,...s){const l=`${this.key}${s.map(h=>`[${h}]`).join("")}`;this.errors.push(new Gt(l,n))}checkSubtype(n,s){const l=gt(n,s);return l&&this.error(l),l}}function to(o){if(o instanceof Qa)return to(o.boundExpression);if(o instanceof jr&&"error"===o.name||o instanceof kr||o instanceof _t)return!1;const n=o instanceof Ko||o instanceof eo;let s=!0;return o.eachChild(l=>{s=n?s&&to(l):s&&l instanceof Ds}),!!s&&Yo(o)&&Dt(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function $r(o,n){const s=o.length-1;let l,h,f=0,_=s,x=0;for(;f<=_;)if(x=Math.floor((f+_)/2),l=o[x],h=o[x+1],l<=n){if(x===s||n<h)return x;f=x+1}else{if(!(l>n))throw new rr("Input is not a number.");_=x-1}return 0}class ic{constructor(n,s,l){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const l=s.parse(n[1],1,Xe);if(!l)return null;const h=[];let f=null;s.expectedType&&"value"!==s.expectedType.kind&&(f=s.expectedType);for(let _=1;_<n.length;_+=2){const x=1===_?-1/0:n[_],w=n[_+1],T=_,I=_+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=s.parse(w,I,f);if(!M)return null;f=f||M.type,h.push([x,M])}return new ic(f,l,h)}evaluate(n){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return l[0].evaluate(n);const f=s.length;return h>=s[f-1]?l[f-1].evaluate(n):l[$r(s,h)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}function Jt(o,n,s){return o*(1-s)+n*s}var ii=Object.freeze({__proto__:null,number:Jt,color:function(o,n,s){return new Vt(Jt(o.r,n.r,s),Jt(o.g,n.g,s),Jt(o.b,n.b,s),Jt(o.a,n.a,s))},array:function(o,n,s){return o.map((l,h)=>Jt(l,n[h],s))}});const fh=4/29,sc=6/29,un=3*sc*sc,Af=Math.PI/180,Ud=180/Math.PI;function Jo(o){return o>.008856451679035631?Math.pow(o,1/3):o/un+fh}function hn(o){return o>sc?o*o*o:un*(o-fh)}function Ts(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function pa(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function el(o){const n=pa(o.r),s=pa(o.g),l=pa(o.b),h=Jo((.4124564*n+.3575761*s+.1804375*l)/.95047),f=Jo((.2126729*n+.7151522*s+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-Jo((.0193339*n+.119192*s+.9503041*l)/1.08883)),alpha:o.a}}function tu(o){let n=(o.l+16)/116,s=isNaN(o.a)?n:n+o.a/500,l=isNaN(o.b)?n:n-o.b/200;return n=1*hn(n),s=.95047*hn(s),l=1.08883*hn(l),new Vt(Ts(3.2404542*s-1.5371385*n-.4985314*l),Ts(-.969266*s+1.8760108*n+.041556*l),Ts(.0556434*s-.2040259*n+1.0572252*l),o.alpha)}function no(o,n,s){const l=n-o;return o+s*(l>180||l<-180?l-360*Math.round(l/360):l)}const ro={forward:el,reverse:tu,interpolate:function(o,n,s){return{l:Jt(o.l,n.l,s),a:Jt(o.a,n.a,s),b:Jt(o.b,n.b,s),alpha:Jt(o.alpha,n.alpha,s)}}},tl={forward:function(o){const{l:n,a:s,b:l}=el(o),h=Math.atan2(l,s)*Ud;return{h:h<0?h+360:h,c:Math.sqrt(s*s+l*l),l:n,alpha:o.a}},reverse:function(o){const n=o.h*Af,s=o.c;return tu({l:o.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:o.alpha})},interpolate:function(o,n,s){return{h:no(o.h,n.h,s),c:Jt(o.c,n.c,s),l:Jt(o.l,n.l,s),alpha:Jt(o.alpha,n.alpha,s)}}};var io=Object.freeze({__proto__:null,lab:ro,hcl:tl});class pi{constructor(n,s,l,h,f){this.type=n,this.operator=s,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of f)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(n,s,l,h){let f=0;if("exponential"===n.name)f=ac(s,n.base,l,h);else if("linear"===n.name)f=ac(s,1,l,h);else if("cubic-bezier"===n.name){const _=n.controlPoints;f=new Bt(_[0],_[1],_[2],_[3]).solve(ac(s,1,l,h))}return f}static parse(n,s){let[l,h,f,..._]=n;if(!Array.isArray(h)||0===h.length)return s.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const T=h[1];if("number"!=typeof T)return s.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if("cubic-bezier"!==h[0])return s.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(4!==T.length||T.some(I=>"number"!=typeof I||I<0||I>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(f=s.parse(f,2,Xe),!f)return null;const x=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=qn:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let T=0;T<_.length;T+=2){const I=_[T],M=_[T+1],P=T+3,z=T+4;if("number"!=typeof I)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=I)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const N=s.parse(M,z,w);if(!N)return null;w=w||N.type,x.push([I,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new pi(w,l,h,f,x):s.error(`Type ${Mn(w)} is not interpolatable.`)}evaluate(n){const s=this.labels,l=this.outputs;if(1===s.length)return l[0].evaluate(n);const h=this.input.evaluate(n);if(h<=s[0])return l[0].evaluate(n);const f=s.length;if(h>=s[f-1])return l[f-1].evaluate(n);const _=$r(s,h),x=pi.interpolationFactor(this.interpolation,h,s[_],s[_+1]),w=l[_].evaluate(n),T=l[_+1].evaluate(n);return"interpolate"===this.operator?ii[this.type.kind.toLowerCase()](w,T,x):"interpolate-hcl"===this.operator?tl.reverse(tl.interpolate(tl.forward(w),tl.forward(T),x)):ro.reverse(ro.interpolate(ro.forward(w),ro.forward(T),x))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let l=0;l<this.labels.length;l++)s.push(this.labels[l],this.outputs[l].serialize());return s}}function ac(o,n,s,l){const h=l-s,f=o-s;return 0===h?0:1===n?f/h:(Math.pow(n,f)-1)/(Math.pow(n,h)-1)}class nl{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let l=null;const h=s.expectedType;h&&"value"!==h.kind&&(l=h);const f=[];for(const x of n.slice(1)){const w=s.parse(x,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const _=h&&f.some(x=>gt(h,x.type));return new nl(_?Et:l,f)}evaluate(n){let s,l=null,h=0;for(const f of this.args)if(h++,l=f.evaluate(n),l&&l instanceof Li&&!l.available&&(s||(s=l.name),l=null,h===this.args.length&&(l=s)),null!==l)break;return l}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class fa{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const l=[];for(let f=1;f<n.length-1;f+=2){const _=n[f];if("string"!=typeof _)return s.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=s.parse(n[f+1],f+1);if(!x)return null;l.push([_,x])}const h=s.parse(n[n.length-1],n.length-1,s.expectedType,l);return h?new fa(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,l]of this.bindings)n.push(s,l.serialize());return n.push(this.result.serialize()),n}}class oo{constructor(n,s,l){this.type=n,this.index=s,this.input=l}static parse(n,s){if(3!==n.length)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,Xe),h=s.parse(n[2],2,Ur(s.expectedType||Et));return l&&h?new oo(h.type.itemType,l,h):null}evaluate(n){const s=this.index.evaluate(n),l=this.input.evaluate(n);if(s<0)throw new rr(`Array index out of bounds: ${s} < 0.`);if(s>=l.length)throw new rr(`Array index out of bounds: ${s} > ${l.length-1}.`);if(s!==Math.floor(s))throw new rr(`Array index must be an integer, but found ${s} instead.`);return l[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class nu{constructor(n,s){this.type=Ct,this.needle=n,this.haystack=s}static parse(n,s){if(3!==n.length)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,Et),h=s.parse(n[2],2,Et);return l&&h?ec(l.type,[Ct,Tt,Xe,Yi,Et])?new nu(l,h):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(l.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!l)return!1;if(!Ji(s,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Yt(s))} instead.`);if(!Ji(l,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Mn(Yt(l))} instead.`);return l.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class rl{constructor(n,s,l){this.type=Xe,this.needle=n,this.haystack=s,this.fromIndex=l}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,Et),h=s.parse(n[2],2,Et);if(!l||!h)return null;if(!ec(l.type,[Ct,Tt,Xe,Yi,Et]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(l.type)} instead`);if(4===n.length){const f=s.parse(n[3],3,Xe);return f?new rl(l,h,f):null}return new rl(l,h)}evaluate(n){const s=this.needle.evaluate(n),l=this.haystack.evaluate(n);if(!Ji(s,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Yt(s))} instead.`);if(!Ji(l,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${Mn(Yt(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return l.indexOf(s,h)}return l.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Gr{constructor(n,s,l,h,f,_){this.inputType=n,this.type=s,this.input=l,this.cases=h,this.outputs=f,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let l,h;s.expectedType&&"value"!==s.expectedType.kind&&(h=s.expectedType);const f={},_=[];for(let T=2;T<n.length-1;T+=2){let I=n[T];const M=n[T+1];Array.isArray(I)||(I=[I]);const P=s.concat(T);if(0===I.length)return P.error("Expected at least one branch label.");for(const N of I){if("number"!=typeof N&&"string"!=typeof N)return P.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return P.error("Numeric branch labels must be integer values.");if(l){if(P.checkSubtype(l,Yt(N)))return null}else l=Yt(N);if(void 0!==f[String(N)])return P.error("Branch labels must be unique.");f[String(N)]=_.length}const z=s.parse(M,T,h);if(!z)return null;h=h||z.type,_.push(z)}const x=s.parse(n[1],1,Et);if(!x)return null;const w=s.parse(n[n.length-1],n.length-1,h);return w?"value"!==x.type.kind&&s.concat(1).checkSubtype(l,x.type)?null:new Gr(l,h,x,f,_,w):null}evaluate(n){const s=this.input.evaluate(n);return(Yt(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),l=[],h={};for(const _ of s){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[x][1].push(_)}const f=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of l)n.push(1===x.length?f(x[0]):x.map(f)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class vr{constructor(n,s,l){this.type=n,this.branches=s,this.otherwise=l}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let l;s.expectedType&&"value"!==s.expectedType.kind&&(l=s.expectedType);const h=[];for(let _=1;_<n.length-1;_+=2){const x=s.parse(n[_],_,Ct);if(!x)return null;const w=s.parse(n[_+1],_+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const f=s.parse(n[n.length-1],n.length-1,l);return f?new vr(l,h,f):null}evaluate(n){for(const[s,l]of this.branches)if(s.evaluate(n))return l.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,l]of this.branches)n(s),n(l);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class ir{constructor(n,s,l,h){this.type=n,this.input=s,this.beginIndex=l,this.endIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const l=s.parse(n[1],1,Et),h=s.parse(n[2],2,Xe);if(!l||!h)return null;if(!ec(l.type,[Ur(Et),Tt,Et]))return s.error(`Expected first argument to be of type array or string, but found ${Mn(l.type)} instead`);if(4===n.length){const f=s.parse(n[3],3,Xe);return f?new ir(l.type,l,h,f):null}return new ir(l.type,l,h)}evaluate(n){const s=this.input.evaluate(n),l=this.beginIndex.evaluate(n);if(!Ji(s,["string","array"]))throw new rr(`Expected first argument to be of type array or string, but found ${Mn(Yt(s))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return s.slice(l,h)}return s.slice(l)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function so(o,n){return"=="===o||"!="===o?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function Qo(o,n,s,l){return 0===l.compare(n,s)}function xr(o,n,s){const l="=="!==o&&"!="!==o;return class aw{constructor(f,_,x){this.type=Ct,this.lhs=f,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===f.type.kind||"value"===_.type.kind}static parse(f,_){if(3!==f.length&&4!==f.length)return _.error("Expected two or three arguments.");const x=f[0];let w=_.parse(f[1],1,Et);if(!w)return null;if(!so(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Mn(w.type)}'.`);let T=_.parse(f[2],2,Et);if(!T)return null;if(!so(x,T.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Mn(T.type)}'.`);if(w.type.kind!==T.type.kind&&"value"!==w.type.kind&&"value"!==T.type.kind)return _.error(`Cannot compare types '${Mn(w.type)}' and '${Mn(T.type)}'.`);l&&("value"===w.type.kind&&"value"!==T.type.kind?w=new eo(T.type,[w]):"value"!==w.type.kind&&"value"===T.type.kind&&(T=new eo(w.type,[T])));let I=null;if(4===f.length){if("string"!==w.type.kind&&"string"!==T.type.kind&&"value"!==w.type.kind&&"value"!==T.type.kind)return _.error("Cannot use collator to compare non-string types.");if(I=_.parse(f[3],3,cn),!I)return null}return new aw(w,T,I)}evaluate(f){const _=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=Yt(_),T=Yt(x);if(w.kind!==T.kind||"string"!==w.kind&&"number"!==w.kind)throw new rr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Yt(_),T=Yt(x);if("string"!==w.kind||"string"!==T.kind)return n(f,_,x)}return this.collator?s(f,_,x,this.collator.evaluate(f)):n(f,_,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[o];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const il=xr("==",function(o,n,s){return n===s},Qo),lc=xr("!=",function(o,n,s){return n!==s},function(o,n,s,l){return!Qo(0,n,s,l)}),ol=xr("<",function(o,n,s){return n<s},function(o,n,s,l){return l.compare(n,s)<0}),cc=xr(">",function(o,n,s){return n>s},function(o,n,s,l){return l.compare(n,s)>0}),Cs=xr("<=",function(o,n,s){return n<=s},function(o,n,s,l){return l.compare(n,s)<=0}),Rr=xr(">=",function(o,n,s){return n>=s},function(o,n,s,l){return l.compare(n,s)>=0});class ma{constructor(n,s,l,h,f){this.type=Tt,this.number=n,this.locale=s,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=f}static parse(n,s){if(3!==n.length)return s.error("Expected two arguments.");const l=s.parse(n[1],1,Xe);if(!l)return null;const h=n[2];if("object"!=typeof h||Array.isArray(h))return s.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=s.parse(h.locale,1,Tt),!f))return null;let _=null;if(h.currency&&(_=s.parse(h.currency,1,Tt),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=s.parse(h["min-fraction-digits"],1,Xe),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=s.parse(h["max-fraction-digits"],1,Xe),!w)?null:new ma(l,f,_,x,w)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Hr{constructor(n){this.type=Xe,this.input=n}static parse(n,s){if(2!==n.length)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const l=s.parse(n[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?s.error(`Expected argument of type string or array, but found ${Mn(l.type)} instead.`):new Hr(l):null}evaluate(n){const s=this.input.evaluate(n);if("string"==typeof s||Array.isArray(s))return s.length;throw new rr(`Expected value to be of type string or array, but found ${Mn(Yt(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}const et={"==":il,"!=":lc,">":cc,"<":ol,">=":Rr,"<=":Cs,array:eo,at:oo,boolean:eo,case:vr,coalesce:nl,collator:kr,format:tc,image:Xc,in:nu,"index-of":rl,interpolate:pi,"interpolate-hcl":pi,"interpolate-lab":pi,length:Hr,let:fa,literal:Ds,match:Gr,number:eo,"number-format":ma,object:eo,slice:ir,step:ic,string:eo,"to-boolean":Ko,"to-color":Ko,"to-number":Ko,"to-string":Ko,var:Qa,within:_t};function kt(o,[n,s,l,h]){n=n.evaluate(o),s=s.evaluate(o),l=l.evaluate(o);const f=h?h.evaluate(o):1,_=Nd(n,s,l,f);if(_)throw new rr(_);return new Vt(n/255*f,s/255*f,l/255*f,f)}function An(o,n){return o in n}function qr(o,n){const s=n[o];return void 0===s?null:s}function oi(o){return{type:o}}function Yn(o){return{result:"success",value:o}}function fi(o){return{result:"error",value:o}}function vn(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function ga(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function es(o){return!!o.expression&&o.expression.interpolated}function tt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Ss(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function _a(o){return o}function uc(o,n){const s="color"===n.type,l=o.stops&&"object"==typeof o.stops[0][0],h=l||!(l||void 0!==o.property),f=o.type||(es(n)?"exponential":"interval");if(s&&((o=Kt({},o)).stops&&(o.stops=o.stops.map(T=>[T[0],Vt.parse(T[1])])),o.default=Vt.parse(o.default?o.default:n.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!io[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,x,w;if("exponential"===f)_=Is;else if("interval"===f)_=ts;else if("categorical"===f){_=Zr,x=Object.create(null);for(const T of o.stops)x[T[0]]=T[1];w=typeof o.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);_=zi}if(l){const T={},I=[];for(let z=0;z<o.stops.length;z++){const N=o.stops[z],$=N[0].zoom;void 0===T[$]&&(T[$]={zoom:$,type:o.type,property:o.property,default:o.default,stops:[]},I.push($)),T[$].stops.push([N[0].value,N[1]])}const M=[];for(const z of I)M.push([T[z].zoom,uc(T[z],n)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:pi.interpolationFactor.bind(void 0,P),zoomStops:M.map(z=>z[0]),evaluate:({zoom:z},N)=>Is({stops:M,base:o.base},n,z).evaluate(z,N)}}if(h){const T="exponential"===f?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:pi.interpolationFactor.bind(void 0,T),zoomStops:o.stops.map(I=>I[0]),evaluate:({zoom:I})=>_(o,n,I,x,w)}}return{kind:"source",evaluate(T,I){const M=I&&I.properties?I.properties[o.property]:void 0;return void 0===M?Oi(o.default,n.default):_(o,n,M,x,w)}}}function Oi(o,n,s){return void 0!==o?o:void 0!==n?n:void 0!==s?s:void 0}function Zr(o,n,s,l,h){return Oi(typeof s===h?l[s]:void 0,o.default,n.default)}function ts(o,n,s){if("number"!==tt(s))return Oi(o.default,n.default);const l=o.stops.length;if(1===l||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[l-1][0])return o.stops[l-1][1];const h=$r(o.stops.map(f=>f[0]),s);return o.stops[h][1]}function Is(o,n,s){const l=void 0!==o.base?o.base:1;if("number"!==tt(s))return Oi(o.default,n.default);const h=o.stops.length;if(1===h||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[h-1][0])return o.stops[h-1][1];const f=$r(o.stops.map(I=>I[0]),s),_=function(I,M,P,z){const N=z-P,$=I-P;return 0===N?0:1===M?$/N:(Math.pow(M,$)-1)/(Math.pow(M,N)-1)}(s,l,o.stops[f][0],o.stops[f+1][0]),x=o.stops[f][1],w=o.stops[f+1][1];let T=ii[n.type]||_a;if(o.colorSpace&&"rgb"!==o.colorSpace){const I=io[o.colorSpace];T=(M,P)=>I.reverse(I.interpolate(I.forward(M),I.forward(P),_))}return"function"==typeof x.evaluate?{evaluate(...I){const M=x.evaluate.apply(void 0,I),P=w.evaluate.apply(void 0,I);if(void 0!==M&&void 0!==P)return T(M,P,_)}}:T(x,w,_)}function zi(o,n,s){return"color"===n.type?s=Vt.parse(s):"formatted"===n.type?s=Pr.fromString(s.toString()):"resolvedImage"===n.type?s=Li.fromString(s.toString()):tt(s)===n.type||"enum"===n.type&&n.values[s]||(s=void 0),Oi(s,o.default,n.default)}jr.register(et,{error:[{kind:"error"},[Tt],(o,[n])=>{throw new rr(n.evaluate(o))}],typeof:[Tt,[Et],(o,[n])=>Mn(Yt(n.evaluate(o)))],"to-rgba":[Ur(Xe,4),[qn],(o,[n])=>n.evaluate(o).toArray()],rgb:[qn,[Xe,Xe,Xe],kt],rgba:[qn,[Xe,Xe,Xe,Xe],kt],has:{type:Ct,overloads:[[[Tt],(o,[n])=>An(n.evaluate(o),o.properties())],[[Tt,ws],(o,[n,s])=>An(n.evaluate(o),s.evaluate(o))]]},get:{type:Et,overloads:[[[Tt],(o,[n])=>qr(n.evaluate(o),o.properties())],[[Tt,ws],(o,[n,s])=>qr(n.evaluate(o),s.evaluate(o))]]},"feature-state":[Et,[Tt],(o,[n])=>qr(n.evaluate(o),o.featureState||{})],properties:[ws,[],o=>o.properties()],"geometry-type":[Tt,[],o=>o.geometryType()],id:[Et,[],o=>o.id()],zoom:[Xe,[],o=>o.globals.zoom],pitch:[Xe,[],o=>o.globals.pitch||0],"distance-from-center":[Xe,[],o=>o.distanceFromCenter()],"heatmap-density":[Xe,[],o=>o.globals.heatmapDensity||0],"line-progress":[Xe,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Xe,[],o=>o.globals.skyRadialProgress||0],accumulated:[Et,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[Xe,oi(Xe),(o,n)=>{let s=0;for(const l of n)s+=l.evaluate(o);return s}],"*":[Xe,oi(Xe),(o,n)=>{let s=1;for(const l of n)s*=l.evaluate(o);return s}],"-":{type:Xe,overloads:[[[Xe,Xe],(o,[n,s])=>n.evaluate(o)-s.evaluate(o)],[[Xe],(o,[n])=>-n.evaluate(o)]]},"/":[Xe,[Xe,Xe],(o,[n,s])=>n.evaluate(o)/s.evaluate(o)],"%":[Xe,[Xe,Xe],(o,[n,s])=>n.evaluate(o)%s.evaluate(o)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(o,[n,s])=>Math.pow(n.evaluate(o),s.evaluate(o))],sqrt:[Xe,[Xe],(o,[n])=>Math.sqrt(n.evaluate(o))],log10:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN10],ln:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))],log2:[Xe,[Xe],(o,[n])=>Math.log(n.evaluate(o))/Math.LN2],sin:[Xe,[Xe],(o,[n])=>Math.sin(n.evaluate(o))],cos:[Xe,[Xe],(o,[n])=>Math.cos(n.evaluate(o))],tan:[Xe,[Xe],(o,[n])=>Math.tan(n.evaluate(o))],asin:[Xe,[Xe],(o,[n])=>Math.asin(n.evaluate(o))],acos:[Xe,[Xe],(o,[n])=>Math.acos(n.evaluate(o))],atan:[Xe,[Xe],(o,[n])=>Math.atan(n.evaluate(o))],min:[Xe,oi(Xe),(o,n)=>Math.min(...n.map(s=>s.evaluate(o)))],max:[Xe,oi(Xe),(o,n)=>Math.max(...n.map(s=>s.evaluate(o)))],abs:[Xe,[Xe],(o,[n])=>Math.abs(n.evaluate(o))],round:[Xe,[Xe],(o,[n])=>{const s=n.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Xe,[Xe],(o,[n])=>Math.floor(n.evaluate(o))],ceil:[Xe,[Xe],(o,[n])=>Math.ceil(n.evaluate(o))],"filter-==":[Ct,[Tt,Et],(o,[n,s])=>o.properties()[n.value]===s.value],"filter-id-==":[Ct,[Et],(o,[n])=>o.id()===n.value],"filter-type-==":[Ct,[Tt],(o,[n])=>o.geometryType()===n.value],"filter-<":[Ct,[Tt,Et],(o,[n,s])=>{const l=o.properties()[n.value],h=s.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Ct,[Et],(o,[n])=>{const s=o.id(),l=n.value;return typeof s==typeof l&&s<l}],"filter->":[Ct,[Tt,Et],(o,[n,s])=>{const l=o.properties()[n.value],h=s.value;return typeof l==typeof h&&l>h}],"filter-id->":[Ct,[Et],(o,[n])=>{const s=o.id(),l=n.value;return typeof s==typeof l&&s>l}],"filter-<=":[Ct,[Tt,Et],(o,[n,s])=>{const l=o.properties()[n.value],h=s.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Ct,[Et],(o,[n])=>{const s=o.id(),l=n.value;return typeof s==typeof l&&s<=l}],"filter->=":[Ct,[Tt,Et],(o,[n,s])=>{const l=o.properties()[n.value],h=s.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Ct,[Et],(o,[n])=>{const s=o.id(),l=n.value;return typeof s==typeof l&&s>=l}],"filter-has":[Ct,[Et],(o,[n])=>n.value in o.properties()],"filter-has-id":[Ct,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[Ct,[Ur(Tt)],(o,[n])=>n.value.indexOf(o.geometryType())>=0],"filter-id-in":[Ct,[Ur(Et)],(o,[n])=>n.value.indexOf(o.id())>=0],"filter-in-small":[Ct,[Tt,Ur(Et)],(o,[n,s])=>s.value.indexOf(o.properties()[n.value])>=0],"filter-in-large":[Ct,[Tt,Ur(Et)],(o,[n,s])=>function(l,h,f,_){for(;f<=_;){const x=f+_>>1;if(h[x]===l)return!0;h[x]>l?_=x-1:f=x+1}return!1}(o.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Ct,overloads:[[[Ct,Ct],(o,[n,s])=>n.evaluate(o)&&s.evaluate(o)],[oi(Ct),(o,n)=>{for(const s of n)if(!s.evaluate(o))return!1;return!0}]]},any:{type:Ct,overloads:[[[Ct,Ct],(o,[n,s])=>n.evaluate(o)||s.evaluate(o)],[oi(Ct),(o,n)=>{for(const s of n)if(s.evaluate(o))return!0;return!1}]]},"!":[Ct,[Ct],(o,[n])=>!n.evaluate(o)],"is-supported-script":[Ct,[Tt],(o,[n])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(n.evaluate(o))}],upcase:[Tt,[Tt],(o,[n])=>n.evaluate(o).toUpperCase()],downcase:[Tt,[Tt],(o,[n])=>n.evaluate(o).toLowerCase()],concat:[Tt,oi(Et),(o,n)=>n.map(s=>ca(s.evaluate(o))).join("")],"resolved-locale":[Tt,[cn],(o,[n])=>n.evaluate(o).resolvedLocale()]});class xn{constructor(n,s){var l;this.expression=n,this._warningHistory={},this._evaluator=new Kc,this._defaultValue=s?"color"===(l=s).type&&Ss(l.default)?new Vt(0,0,0,0):"color"===l.type?Vt.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(n,s,l,h,f,_,x,w){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,l,h,f,_,x,w){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const T=this.expression.evaluate(this._evaluator);if(null==T||"number"==typeof T&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,"undefined"!=typeof console&&console.warn(T.message)),this._defaultValue}}}function Bi(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in et}function ya(o,n){const s=new Qc(et,[],n?function(h){const f={color:qn,string:Tt,number:Xe,enum:Tt,boolean:Ct,formatted:Xo,resolvedImage:Pt};return"array"===h.type?Ur(f[h.value]||Et,h.length):f[h.type]}(n):void 0),l=s.parse(o,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return l?Yn(new xn(l,n)):fi(s.errors)}class br{constructor(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent="constant"!==n&&!rc(s.expression)}evaluateWithoutErrorHandling(n,s,l,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,h,f,_)}evaluate(n,s,l,h,f,_){return this._styleExpression.evaluate(n,s,l,h,f,_)}}class si{constructor(n,s,l,h){this.kind=n,this.zoomStops=l,this._styleExpression=s,this.isStateDependent="camera"!==n&&!rc(s.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,s,l,h,f,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,l,h,f,_)}evaluate(n,s,l,h,f,_){return this._styleExpression.evaluate(n,s,l,h,f,_)}interpolationFactor(n,s,l){return this.interpolationType?pi.interpolationFactor(this.interpolationType,n,s,l):0}}function hc(o,n){if("error"===(o=ya(o,n)).result)return o;const s=o.value.expression,l=Yo(s);if(!l&&!vn(n))return fi([new Gt("","data expressions not supported")]);const h=Dt(s,["zoom","pitch","distance-from-center"]);if(!h&&!ga(n))return fi([new Gt("","zoom expressions not supported")]);const f=Ni(s);return f||h?f instanceof Gt?fi([f]):f instanceof pi&&!es(n)?fi([new Gt("",'"interpolate" expressions cannot be used with this property')]):Yn(f?new si(l?"camera":"composite",o.value,f.labels,f instanceof pi?f.interpolation:void 0):new br(l?"constant":"source",o.value)):fi([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Do{constructor(n,s){this._parameters=n,this._specification=s,Kt(this,uc(this._parameters,this._specification))}static deserialize(n){return new Do(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ni(o){let n=null;if(o instanceof fa)n=Ni(o.result);else if(o instanceof nl){for(const s of o.args)if(n=Ni(s),n)break}else(o instanceof ic||o instanceof pi)&&o.input instanceof jr&&"zoom"===o.input.name&&(n=o);return n instanceof Gt||o.eachChild(s=>{const l=Ni(s);l instanceof Gt?n=l:!n&&l?n=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&l&&n!==l&&(n=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function Un(o){const n=o.key,s=o.value,l=o.valueSpec||{},h=o.objectElementValidators||{},f=o.style,_=o.styleSpec;let x=[];const w=tt(s);if("object"!==w)return[new Te(n,s,`object expected, ${w} found`)];for(const T in s){const I=T.split(".")[0],M=l[I]||l["*"];let P;if(h[I])P=h[I];else if(l[I])P=hr;else if(h["*"])P=h["*"];else{if(!l["*"]){x.push(new Te(n,s[T],`unknown property "${T}"`));continue}P=hr}x=x.concat(P({key:(n&&`${n}.`)+T,value:s[T],valueSpec:M,style:f,styleSpec:_,object:s,objectKey:T},s))}for(const T in l)h[T]||l[T].required&&void 0===l[T].default&&void 0===s[T]&&x.push(new Te(n,s,`missing required property "${T}"`));return x}function dc(o){const n=o.value,s=o.valueSpec,l=o.style,h=o.styleSpec,f=o.key,_=o.arrayElementValidator||hr;if("array"!==tt(n))return[new Te(f,n,`array expected, ${tt(n)} found`)];if(s.length&&n.length!==s.length)return[new Te(f,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new Te(f,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum};h.$version<7&&(x.function=s.function),"object"===tt(s.value)&&(x=s.value);let w=[];for(let T=0;T<n.length;T++)w=w.concat(_({array:n,arrayIndex:T,value:n[T],valueSpec:x,style:l,styleSpec:h,key:`${f}[${T}]`}));return w}function mh(o){const n=o.key,s=o.value,l=o.valueSpec;let h=tt(s);if("number"===h&&s!=s&&(h="NaN"),"number"!==h)return[new Te(n,s,`number expected, ${h} found`)];if("minimum"in l){let f=l.minimum;if("array"===tt(l.minimum)&&(f=l.minimum[o.arrayIndex]),s<f)return[new Te(n,s,`${s} is less than the minimum value ${f}`)]}if("maximum"in l){let f=l.maximum;if("array"===tt(l.maximum)&&(f=l.maximum[o.arrayIndex]),s>f)return[new Te(n,s,`${s} is greater than the maximum value ${f}`)]}return[]}function pc(o){const n=o.valueSpec,s=mt(o.value.type);let l,h,f,_={};const x="categorical"!==s&&void 0===o.value.property,w=!x,T="array"===tt(o.value.stops)&&"array"===tt(o.value.stops[0])&&"object"===tt(o.value.stops[0][0]),I=Un({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(z){if("identity"===s)return[new Te(z.key,z.value,'identity function may not have a "stops" property')];let N=[];const $=z.value;return N=N.concat(dc({key:z.key,value:$,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:M})),"array"===tt($)&&0===$.length&&N.push(new Te(z.key,$,"array must have at least one stop")),N},default:function(z){return hr({key:z.key,value:z.value,valueSpec:n,style:z.style,styleSpec:z.styleSpec})}}});return"identity"===s&&x&&I.push(new Te(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||I.push(new Te(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!es(o.valueSpec)&&I.push(new Te(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(w&&!vn(o.valueSpec)?I.push(new Te(o.key,o.value,"property functions not supported")):x&&!ga(o.valueSpec)&&I.push(new Te(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!T||void 0!==o.value.property||I.push(new Te(o.key,o.value,'"property" property is required')),I;function M(z){let N=[];const $=z.value,K=z.key;if("array"!==tt($))return[new Te(K,$,`array expected, ${tt($)} found`)];if(2!==$.length)return[new Te(K,$,`array length 2 expected, length ${$.length} found`)];if(T){if("object"!==tt($[0]))return[new Te(K,$,`object expected, ${tt($[0])} found`)];if(void 0===$[0].zoom)return[new Te(K,$,"object stop key must have zoom")];if(void 0===$[0].value)return[new Te(K,$,"object stop key must have value")];if(f&&f>mt($[0].zoom))return[new Te(K,$[0].zoom,"stop zoom values must appear in ascending order")];mt($[0].zoom)!==f&&(f=mt($[0].zoom),h=void 0,_={}),N=N.concat(Un({key:`${K}[0]`,value:$[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:mh,value:P}}))}else N=N.concat(P({key:`${K}[0]`,value:$[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},$));return Bi(Nt($[1]))?N.concat([new Te(`${K}[1]`,$[1],"expressions are not allowed in function stops.")]):N.concat(hr({key:`${K}[1]`,value:$[1],valueSpec:n,style:z.style,styleSpec:z.styleSpec}))}function P(z,N){const $=tt(z.value),K=mt(z.value),te=null!==z.value?z.value:N;if(l){if($!==l)return[new Te(z.key,te,`${$} stop domain type must match previous stop domain type ${l}`)]}else l=$;if("number"!==$&&"string"!==$&&"boolean"!==$)return[new Te(z.key,te,"stop domain value must be a number, string, or boolean")];if("number"!==$&&"categorical"!==s){let se=`number expected, ${$} found`;return vn(n)&&void 0===s&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Te(z.key,te,se)]}return"categorical"!==s||"number"!==$||isFinite(K)&&Math.floor(K)===K?"categorical"!==s&&"number"===$&&void 0!==h&&K<h?[new Te(z.key,te,"stop domain values must appear in ascending order")]:(h=K,"categorical"===s&&K in _?[new Te(z.key,te,"stop domain values must be unique")]:(_[K]=!0,[])):[new Te(z.key,te,`integer expected, found ${K}`)]}}function ns(o){const n=("property"===o.expressionContext?hc:ya)(Nt(o.value),o.valueSpec);if("error"===n.result)return n.value.map(l=>new Te(`${o.key}${l.key}`,o.value,l.message));const s=n.value.expression||n.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new Te(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!rc(s))return[new Te(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return gh(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Dt(s,["zoom","feature-state"]))return[new Te(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!Yo(s))return[new Te(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gh(o,n){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const h of n.valueSpec.expression.parameters)s.delete(h);if(0===s.size)return[];const l=[];return o instanceof jr&&s.has(o.name)?[new Te(n.key,n.value,`["${o.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(o.eachChild(h=>{l.push(...gh(h,n))}),l)}function sl(o){const n=o.key,s=o.value,l=o.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(mt(s))&&h.push(new Te(n,s,`expected one of [${l.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(l.values).indexOf(mt(s))&&h.push(new Te(n,s,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(s)} found`)),h}function ru(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const n of o.slice(1))if(!ru(n)&&"boolean"!=typeof n)return!1;return!0;default:return!0}}function fc(o,n="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ru(o)||(o=iu(o));const s=o;let l=!0;try{l=function(T){if(!xa(T))return T;let I=Nt(T);return va(I),I=_h(I),I}(s)}catch(T){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const h=de[`filter_${n}`],f=ya(l,h);let _=null;if("error"===f.result)throw new Error(f.value.map(T=>`${T.key}: ${T.message}`).join(", "));_=(T,I,M)=>f.value.evaluate(T,I,{},M);let x=null,w=null;if(l!==s){const T=ya(s,h);if("error"===T.result)throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,M,P,z,N)=>T.value.evaluate(I,M,{},P,void 0,void 0,z,N),w=!Yo(T.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:vh(l),needFeature:!!w}}function _h(o){if(!Array.isArray(o))return o;const n=function(s){if(jd.has(s[0]))for(let l=1;l<s.length;l++)if(xa(s[l]))return!0;return s}(o);return!0===n?n:n.map(s=>_h(s))}function va(o){let n=!1;const s=[];if("case"===o[0]){for(let l=1;l<o.length-1;l+=2)n=n||xa(o[l]),s.push(o[l+1]);s.push(o[o.length-1])}else if("match"===o[0]){n=n||xa(o[1]);for(let l=2;l<o.length-1;l+=2)s.push(o[l+1]);s.push(o[o.length-1])}else if("step"===o[0]){n=n||xa(o[1]);for(let l=1;l<o.length-1;l+=2)s.push(o[l+1])}n&&(o.length=0,o.push("any",...s));for(let l=1;l<o.length;l++)va(o[l])}function xa(o){if(!Array.isArray(o))return!1;if("pitch"===(n=o[0])||"distance-from-center"===n)return!0;var n;for(let s=1;s<o.length;s++)if(xa(o[s]))return!0;return!1}const jd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function yh(o,n){return o<n?-1:o>n?1:0}function vh(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let n=1;n<o.length;n++)if(vh(o[n]))return!0;return!1}function iu(o){if(!o)return!0;const n=o[0];return o.length<=1?"any"!==n:"=="===n?al(o[1],o[2],"=="):"!="===n?ll(al(o[1],o[2],"==")):"<"===n||">"===n||"<="===n||">="===n?al(o[1],o[2],n):"any"===n?(s=o.slice(1),["any"].concat(s.map(iu))):"all"===n?["all"].concat(o.slice(1).map(iu)):"none"===n?["all"].concat(o.slice(1).map(iu).map(ll)):"in"===n?$d(o[1],o.slice(2)):"!in"===n?ll($d(o[1],o.slice(2))):"has"===n?Gd(o[1]):"!has"===n?ll(Gd(o[1])):"within"!==n||o;var s}function al(o,n,s){switch(o){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,o,n]}}function $d(o,n){if(0===n.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",o,["literal",n.sort(yh)]]:["filter-in-small",o,["literal",n]]}}function Gd(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ll(o){return["!",o]}function cl(o){if(ru(Nt(o.value))){const n=Nt(o.layerType);return ns(Kt({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${n||"fill"}`]}))}return Hd(o)}function Hd(o){const n=o.value,s=o.key;if("array"!==tt(n))return[new Te(s,n,`array expected, ${tt(n)} found`)];const l=o.styleSpec;let h,f=[];if(n.length<1)return[new Te(s,n,"filter array must have at least 1 element")];switch(f=f.concat(sl({key:`${s}[0]`,value:n[0],valueSpec:l.filter_operator,style:o.style,styleSpec:o.styleSpec})),mt(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===mt(n[1])&&f.push(new Te(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":3!==n.length&&f.push(new Te(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(h=tt(n[1]),"string"!==h&&f.push(new Te(`${s}[1]`,n[1],`string expected, ${h} found`)));for(let _=2;_<n.length;_++)h=tt(n[_]),"$type"===mt(n[1])?f=f.concat(sl({key:`${s}[${_}]`,value:n[_],valueSpec:l.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&f.push(new Te(`${s}[${_}]`,n[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)f=f.concat(Hd({key:`${s}[${_}]`,value:n[_],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":h=tt(n[1]),2!==n.length?f.push(new Te(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):"string"!==h&&f.push(new Te(`${s}[1]`,n[1],`string expected, ${h} found`));break;case"within":h=tt(n[1]),2!==n.length?f.push(new Te(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):"object"!==h&&f.push(new Te(`${s}[1]`,n[1],`object expected, ${h} found`))}return f}function mc(o,n){const s=o.key,l=o.style,h=o.styleSpec,f=o.value,_=o.objectKey,x=h[`${n}_${o.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if("paint"===n&&w&&x[w[1]]&&x[w[1]].transition)return hr({key:s,value:f,valueSpec:h.transition,style:l,styleSpec:h});const T=o.valueSpec||x[_];if(!T)return[new Te(s,f,`unknown property "${_}"`)];let I;if("string"===tt(f)&&vn(T)&&!T.tokens&&(I=/^{([^}]+)}$/.exec(f)))return[new Te(s,f,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const M=[];return"symbol"===o.layerType&&("text-field"===_&&l&&!l.glyphs&&M.push(new Te(s,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Ss(Nt(f))&&"identity"===mt(f.type)&&M.push(new Te(s,f,'"text-font" does not support identity functions'))),M.concat(hr({key:o.key,value:f,valueSpec:T,style:l,styleSpec:h,expressionContext:"property",propertyType:n,propertyKey:_}))}function gc(o){return mc(o,"paint")}function Jn(o){return mc(o,"layout")}function ul(o){let n=[];const s=o.value,l=o.key,h=o.style,f=o.styleSpec;s.type||s.ref||n.push(new Te(l,s,'either "type" or "ref" is required'));let _=mt(s.type);const x=mt(s.ref);if(s.id){const w=mt(s.id);for(let T=0;T<o.arrayIndex;T++){const I=h.layers[T];mt(I.id)===w&&n.push(new Te(l,s.id,`duplicate layer id "${s.id}", previously used at line ${I.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(T=>{T in s&&n.push(new Te(l,s[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{mt(T.id)===x&&(w=T)}),w?w.ref?n.push(new Te(l,s.ref,"ref cannot reference another ref layer")):_=mt(w.type):n.push(new Te(l,s.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(s.source){const w=h.sources&&h.sources[s.source],T=w&&mt(w.type);w?"vector"===T&&"raster"===_?n.push(new Te(l,s.source,`layer "${s.id}" requires a raster source`)):"raster"===T&&"raster"!==_?n.push(new Te(l,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==T||s["source-layer"]?"raster-dem"===T&&"hillshade"!==_?n.push(new Te(l,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!s.paint||!s.paint["line-gradient"]||"geojson"===T&&w.lineMetrics||n.push(new Te(l,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Te(l,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new Te(l,s.source,`source "${s.source}" not found`))}else n.push(new Te(l,s,'missing required property "source"'));return n=n.concat(Un({key:l,value:s,valueSpec:f.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>hr({key:`${l}.type`,value:s.type,valueSpec:f.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:w=>cl(Kt({layerType:_},w)),layout:w=>Un({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>Jn(Kt({layerType:_},T))}}),paint:w=>Un({layer:s,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":T=>gc(Kt({layerType:_},T))}})}})),n}function To(o){const n=o.value,s=o.key,l=tt(n);return"string"!==l?[new Te(s,n,`string expected, ${l} found`)]:[]}const ou={promoteId:function({key:o,value:n}){if("string"===tt(n))return To({key:o,value:n});{const s=[];for(const l in n)s.push(...To({key:`${o}.${l}`,value:n[l]}));return s}}};function xh(o){const n=o.value,s=o.key,l=o.styleSpec,h=o.style;if(!n.type)return[new Te(s,n,'"type" is required')];const f=mt(n.type);let _;switch(f){case"vector":case"raster":case"raster-dem":return _=Un({key:s,value:n,valueSpec:l[`source_${f.replace("-","_")}`],style:o.style,styleSpec:l,objectElementValidators:ou}),_;case"geojson":if(_=Un({key:s,value:n,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:ou}),n.cluster)for(const x in n.clusterProperties){const[w,T]=n.clusterProperties[x],I="string"==typeof w?[w,["accumulated"],["get",x]]:w;_.push(...ns({key:`${s}.${x}.map`,value:T,expressionContext:"cluster-map"})),_.push(...ns({key:`${s}.${x}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return _;case"video":return Un({key:s,value:n,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return Un({key:s,value:n,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new Te(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return sl({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function bh(o){const n=o.value,s=o.styleSpec,l=s.light,h=o.style;let f=[];const _=tt(n);if(void 0===n)return f;if("object"!==_)return f=f.concat([new Te("light",n,`object expected, ${_} found`)]),f;for(const x in n){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&l[w[1]]&&l[w[1]].transition?hr({key:x,value:n[x],valueSpec:s.transition,style:h,styleSpec:s}):l[x]?hr({key:x,value:n[x],valueSpec:l[x],style:h,styleSpec:s}):[new Te(x,n[x],`unknown property "${x}"`)])}return f}function hl(o){const n=o.value,s=o.key,l=o.style,h=o.styleSpec,f=h.terrain;let _=[];const x=tt(n);if(void 0===n)return _;if("object"!==x)return _=_.concat([new Te("terrain",n,`object expected, ${x} found`)]),_;for(const w in n){const T=w.match(/^(.*)-transition$/);_=_.concat(T&&f[T[1]]&&f[T[1]].transition?hr({key:w,value:n[w],valueSpec:h.transition,style:l,styleSpec:h}):f[w]?hr({key:w,value:n[w],valueSpec:f[w],style:l,styleSpec:h}):[new Te(w,n[w],`unknown property "${w}"`)])}if(n.source){const w=l.sources&&l.sources[n.source],T=w&&mt(w.type);w?"raster-dem"!==T&&_.push(new Te(s,n.source,`terrain cannot be used with a source of type ${T}, it only be used with a "raster-dem" source type`)):_.push(new Te(s,n.source,`source "${n.source}" not found`))}else _.push(new Te(s,n,'terrain is missing required property "source"'));return _}function su(o){const n=o.value,s=o.style,l=o.styleSpec,h=l.fog;let f=[];const _=tt(n);if(void 0===n)return f;if("object"!==_)return f=f.concat([new Te("fog",n,`object expected, ${_} found`)]),f;for(const x in n){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&h[w[1]]&&h[w[1]].transition?hr({key:x,value:n[x],valueSpec:l.transition,style:s,styleSpec:l}):h[x]?hr({key:x,value:n[x],valueSpec:h[x],style:s,styleSpec:l}):[new Te(x,n[x],`unknown property "${x}"`)])}return f}const _c={"*":()=>[],array:dc,boolean:function(o){const n=o.value,s=o.key,l=tt(n);return"boolean"!==l?[new Te(s,n,`boolean expected, ${l} found`)]:[]},number:mh,color:function(o){const n=o.key,s=o.value,l=tt(s);return"string"!==l?[new Te(n,s,`color expected, ${l} found`)]:null===Qi.parseCSSColor(s)?[new Te(n,s,`color expected, "${s}" found`)]:[]},constants:It,enum:sl,filter:cl,function:pc,layer:ul,object:Un,source:xh,light:bh,terrain:hl,fog:su,string:To,formatted:function(o){return 0===To(o).length?[]:ns(o)},resolvedImage:function(o){return 0===To(o).length?[]:ns(o)},projection:function(o){const n=o.value,s=o.styleSpec,l=s.projection,h=o.style;let f=[];const _=tt(n);if("object"===_)for(const x in n)f=f.concat(hr({key:x,value:n[x],valueSpec:l[x],style:h,styleSpec:s}));else"string"!==_&&(f=f.concat([new Te("projection",n,`object or string expected, ${_} found`)]));return f}};function hr(o){const n=o.value,s=o.valueSpec,l=o.styleSpec;return s.expression&&Ss(mt(n))?pc(o):s.expression&&Bi(Nt(n))?ns(o):s.type&&_c[s.type]?_c[s.type](o):Un(Kt({},o,{valueSpec:s.type?l[s.type]:s}))}function qd(o){const n=o.value,s=o.key,l=To(o);return l.length||(-1===n.indexOf("{fontstack}")&&l.push(new Te(s,n,'"glyphs" url must include a "{fontstack}" token')),-1===n.indexOf("{range}")&&l.push(new Te(s,n,'"glyphs" url must include a "{range}" token'))),l}function jn(o,n=de){let s=[];return s=s.concat(hr({key:"",value:o,valueSpec:n.$root,styleSpec:n,style:o,objectElementValidators:{glyphs:qd,"*":()=>[]}})),o.constants&&(s=s.concat(It({key:"constants",value:o.constants,style:o,styleSpec:n}))),au(s)}function au(o){return[].concat(o).sort((n,s)=>n.line-s.line)}function ao(o){return function(...n){return au(o.apply(this,n))}}jn.source=ao(xh),jn.light=ao(bh),jn.terrain=ao(hl),jn.fog=ao(su),jn.layer=ao(ul),jn.filter=ao(cl),jn.paintProperty=ao(gc),jn.layoutProperty=ao(Jn);const Co=jn,Zd=Co.light,dl=Co.fog,lu=Co.paintProperty,Fn=Co.layoutProperty;function cu(o,n){let s=!1;if(n&&n.length)for(const l of n)o.fire(new ot(new Error(l.message))),s=!0;return s}var ba=fn;function fn(o,n,s){var l=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var h=new Int32Array(this.arrayBuffer);o=h[0],this.d=(n=h[1])+2*(s=h[2]);for(var f=0;f<this.d*this.d;f++){var _=h[3+f],x=h[3+f+1];l.push(_===x?null:h.subarray(_,x))}var w=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*s;for(var T=0;T<this.d*this.d;T++)l.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=o,this.padding=s,this.scale=n/o,this.uid=0;var I=s/n*o;this.min=-I,this.max=o+I}fn.prototype.insert=function(o,n,s,l,h){this._forEachCell(n,s,l,h,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(h)},fn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fn.prototype._insertCell=function(o,n,s,l,h,f){this.cells[h].push(f)},fn.prototype.query=function(o,n,s,l,h){var f=this.min,_=this.max;if(o<=f&&n<=f&&_<=s&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,n,s,l,this._queryCell,x,{},h),x},fn.prototype._queryCell=function(o,n,s,l,h,f,_,x){var w=this.cells[h];if(null!==w)for(var T=this.keys,I=this.bboxes,M=0;M<w.length;M++){var P=w[M];if(void 0===_[P]){var z=4*P;(x?x(I[z+0],I[z+1],I[z+2],I[z+3]):o<=I[z+2]&&n<=I[z+3]&&s>=I[z+0]&&l>=I[z+1])?(_[P]=!0,f.push(T[P])):_[P]=!1}}},fn.prototype._forEachCell=function(o,n,s,l,h,f,_,x){for(var w=this._convertToCellCoord(o),T=this._convertToCellCoord(n),I=this._convertToCellCoord(s),M=this._convertToCellCoord(l),P=w;P<=I;P++)for(var z=T;z<=M;z++){var N=this.d*z+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(z),this._convertFromCellCoord(P+1),this._convertFromCellCoord(z+1)))&&h.call(this,o,n,s,l,N,f,_,x))return}},fn.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},fn.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},fn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,n=3+this.cells.length+1+1,s=0,l=0;l<this.cells.length;l++)s+=this.cells[l].length;var h=new Int32Array(n+s+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=n,_=0;_<o.length;_++){var x=o[_];h[3+_]=f,h.set(x,f),f+=x.length}return h[3+o.length]=f,h.set(this.keys,f),h[3+o.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};const{ImageData:yc,ImageBitmap:Wd}=nt,rs={};function Ye(o,n,s={}){Object.defineProperty(n,"_classRegistryKey",{value:o,writeable:!1}),rs[o]={klass:n,omit:s.omit||[],shallow:s.shallow||[]}}Ye("Object",Object),ba.serialize=function(o,n){const s=o.toArrayBuffer();return n&&n.push(s),{buffer:s}},ba.deserialize=function(o){return new ba(o.buffer)},Ye("Grid",ba),Ye("Color",Vt),Ye("Error",Error),Ye("ResolvedImage",Li),Ye("StylePropertyFunction",Do),Ye("StyleExpression",xn,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",si),Ye("ZoomConstantExpression",br),Ye("CompoundExpression",jr,{omit:["_evaluate"]});for(const o in et)et[o]._classRegistryKey||Ye(`Expression_${o}`,et[o]);function wh(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function pl(o){return Wd&&o instanceof Wd}function lo(o,n){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(wh(o)||pl(o))return n&&n.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return n&&n.push(s.buffer),s}if(o instanceof yc)return n&&n.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const l of o)s.push(lo(l,n));return s}if("object"==typeof o){const s=o.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const h=s.serialize?s.serialize(o,n):{};if(!s.serialize){for(const f in o){if(!o.hasOwnProperty(f)||rs[l].omit.indexOf(f)>=0)continue;const _=o[f];h[f]=rs[l].shallow.indexOf(f)>=0?_:lo(_,n)}o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof o)}function wr(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||wh(o)||pl(o)||ArrayBuffer.isView(o)||o instanceof yc)return o;if(Array.isArray(o))return o.map(wr);if("object"==typeof o){const n=o.$name||"Object",{klass:s}=rs[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(o);const l=Object.create(s.prototype);for(const h of Object.keys(o)){if("$name"===h)continue;const f=o[h];l[h]=rs[n].shallow.indexOf(h)>=0?f:wr(f)}return l}throw new Error("can't deserialize object of type "+typeof o)}class uu{constructor(){this.first=!0}update(n,s){const l=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=l,!0))}}const vc=o=>o>=1536&&o<=1791,Eh=o=>o>=1872&&o<=1919,So=o=>o>=2208&&o<=2303,hu=o=>o>=11904&&o<=12031,Ms=o=>o>=12032&&o<=12255,xt=o=>o>=12272&&o<=12287,du=o=>o>=12288&&o<=12351,wa=o=>o>=12352&&o<=12447,xc=o=>o>=12448&&o<=12543,pu=o=>o>=12544&&o<=12591,fu=o=>o>=12704&&o<=12735,mu=o=>o>=12736&&o<=12783,gu=o=>o>=12784&&o<=12799,Be=o=>o>=12800&&o<=13055,$t=o=>o>=13056&&o<=13311,As=o=>o>=13312&&o<=19903,On=o=>o>=19968&&o<=40959,_u=o=>o>=40960&&o<=42127,Ea=o=>o>=42128&&o<=42191,ai=o=>o>=44032&&o<=55215,bc=o=>o>=63744&&o<=64255,co=o=>o>=64336&&o<=65023,Xd=o=>o>=65040&&o<=65055,fl=o=>o>=65072&&o<=65103,ml=o=>o>=65104&&o<=65135,Da=o=>o>=65136&&o<=65279,Er=o=>o>=65280&&o<=65519;function Lr(o){for(const n of o)if(Vi(n.charCodeAt(0)))return!0;return!1}function gl(o){for(const n of o)if(!uo(n.charCodeAt(0)))return!1;return!0}function uo(o){return!(vc(o)||Eh(o)||So(o)||co(o)||Da(o))}function Vi(o){return!(746!==o&&747!==o&&(o<4352||!(fu(o)||pu(o)||fl(o)&&!(o>=65097&&o<=65103)||bc(o)||$t(o)||hu(o)||mu(o)||!(!du(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||As(o)||On(o)||Be(o)||(n=o,n>=12592&&n<=12687)||(n=>n>=43360&&n<=43391)(o)||(n=>n>=55216&&n<=55295)(o)||(n=>n>=4352&&n<=4607)(o)||ai(o)||wa(o)||xt(o)||(n=>n>=12688&&n<=12703)(o)||Ms(o)||gu(o)||xc(o)&&12540!==o||!(!Er(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!ml(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(n=>n>=5120&&n<=5759)(o)||(n=>n>=6320&&n<=6399)(o)||Xd(o)||(n=>n>=19904&&n<=19967)(o)||_u(o)||Ea(o))));var n}function yu(o){return!(Vi(o)||(n=o,(s=n)>=128&&s<=255&&(167===n||169===n||174===n||177===n||188===n||189===n||190===n||215===n||247===n)||(s=>s>=8192&&s<=8303)(n)&&(8214===n||8224===n||8225===n||8240===n||8241===n||8251===n||8252===n||8258===n||8263===n||8264===n||8265===n||8273===n)||(s=>s>=8448&&s<=8527)(n)||(s=>s>=8528&&s<=8591)(n)||(s=>s>=8960&&s<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||9003===n||n>=9085&&n<=9114||n>=9150&&n<=9165||9167===n||n>=9169&&n<=9179||n>=9186&&n<=9215)||(s=>s>=9216&&s<=9279)(n)&&9251!==n||(s=>s>=9280&&s<=9311)(n)||(s=>s>=9312&&s<=9471)(n)||(s=>s>=9632&&s<=9727)(n)||(s=>s>=9728&&s<=9983)(n)&&!(n>=9754&&n<=9759)||(s=>s>=11008&&s<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||du(n)||xc(n)||(s=>s>=57344&&s<=63743)(n)||fl(n)||ml(n)||Er(n)||8734===n||8756===n||8757===n||n>=9984&&n<=10087||n>=10102&&n<=10131||65532===n||65533===n));var n,s}function Ps(o){return o>=1424&&o<=2303||co(o)||Da(o)}function Kd(o,n){return!(!n&&Ps(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(s=o,s>=6016&&s<=6143));var s}function Yd(o){for(const n of o)if(Ps(n.charCodeAt(0)))return!0;return!1}const is="deferred",p="loading",i="loaded";let c=null,m="unavailable",y=null;const v=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(m="error"),c&&c(o)};function D(){C.fire(new Le("pluginStateChange",{pluginStatus:m,pluginURL:y}))}const C=new $e,A=function(){return m},R=function(){if(m!==is||!y)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");m=p,D(),y&&V({url:y},o=>{o?v(o):(m=i,D())})},L={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>m===i||null!=L.applyArabicShaping,isLoading:()=>m===p,setState(o){m=o.pluginStatus,y=o.pluginURL},isParsed:()=>null!=L.applyArabicShaping&&null!=L.processBidirectionalText&&null!=L.processStyledBidirectionalText,getPluginURL:()=>y};class F{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uu,this.transition={},this.pitch=0)}isSupportedScript(n){return function(s,l){for(const h of s)if(!Kd(h.charCodeAt(0),l))return!1;return!0}(n,L.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),l=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*s}}}class U{constructor(n,s){this.property=n,this.value=s,this.expression=function(l,h){if(Ss(l))return new Do(l,h);if(Bi(l)){const f=hc(l,h);if("error"===f.result)throw new Error(f.value.map(_=>`${_.key}: ${_.message}`).join(", "));return f.value}{let f=l;return"string"==typeof l&&"color"===h.type&&(f=Vt.parse(l)),{kind:"constant",evaluate:()=>f}}}(void 0===s?n.specification.default:s,n.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(n,s,l){return this.property.possiblyEvaluate(this,n,s,l)}}class H{constructor(n){this.property=n,this.value=new U(n,void 0)}transitioned(n,s){return new G(this.property,this.value,s,Vn({},n.transition,this.transition),n.now)}untransitioned(){return new G(this.property,this.value,null,{},0)}}class Z{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return cr(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new H(this._values[n].property)),this._values[n].value=new U(this._values[n].property,null===s?void 0:cr(s))}getTransition(n){return cr(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new H(this._values[n].property)),this._values[n].transition=cr(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(n[s]=l);const h=this.getTransition(s);void 0!==h&&(n[`${s}-transition`]=h)}return n}transitioned(n,s){const l=new Q(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(n,s._values[h]);return l}untransitioned(){const n=new Q(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class G{constructor(n,s,l,h,f){const _=h.delay||0,x=h.duration||0;f=f||0,this.property=n,this.value=s,this.begin=f+_,this.end=this.begin+x,n.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(n,s,l){const h=n.now||0,f=this.value.possiblyEvaluate(n,s,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return _.possiblyEvaluate(n,s,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,l),f,Vo(x))}}return f}}class Q{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,l){const h=new re(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(n,s,l);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class q{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return cr(this._values[n].value)}setValue(n,s){this._values[n]=new U(this._values[n].property,null===s?void 0:cr(s))}serialize(){const n={};for(const s of Object.keys(this._values)){const l=this.getValue(s);void 0!==l&&(n[s]=l)}return n}possiblyEvaluate(n,s,l){const h=new re(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(n,s,l);return h}}class ee{constructor(n,s,l){this.property=n,this.value=s,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(n){return"constant"===this.value.kind?this.value.value:n}evaluate(n,s,l,h){return this.property.evaluate(this.value,this.parameters,n,s,l,h)}}class re{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class W{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,l){const h=ii[this.specification.type];return h?h(n,s,l):n}}class ie{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,l,h){return new ee(this,"constant"===n.expression.kind||"camera"===n.expression.kind?{kind:"constant",value:n.expression.evaluate(s,null,{},l,h)}:n.expression,s)}interpolate(n,s,l){if("constant"!==n.value.kind||"constant"!==s.value.kind)return n;if(void 0===n.value.value||void 0===s.value.value)return new ee(this,{kind:"constant",value:void 0},n.parameters);const h=ii[this.specification.type];return h?new ee(this,{kind:"constant",value:h(n.value.value,s.value.value,l)},n.parameters):n}evaluate(n,s,l,h,f,_){return"constant"===n.kind?n.value:n.evaluate(s,l,h,f,_)}}class ae extends ie{possiblyEvaluate(n,s,l,h){if(void 0===n.value)return new ee(this,{kind:"constant",value:void 0},s);if("constant"===n.expression.kind){const f=n.expression.evaluate(s,null,{},l,h),_="resolvedImage"===n.property.specification.type&&"string"!=typeof f?f.name:f,x=this._calculate(_,_,_,s);return new ee(this,{kind:"constant",value:x},s)}if("camera"===n.expression.kind){const f=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new ee(this,{kind:"constant",value:f},s)}return new ee(this,n.expression,s)}evaluate(n,s,l,h,f,_){if("source"===n.kind){const x=n.evaluate(s,l,h,f,_);return this._calculate(x,x,x,s)}return"composite"===n.kind?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},l,h),n.evaluate({zoom:Math.floor(s.zoom)},l,h),n.evaluate({zoom:Math.floor(s.zoom)+1},l,h),s):n.value}_calculate(n,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:n,to:s,other:l}:{from:l,to:s,other:n}}interpolate(n){return n}}class be{constructor(n){this.specification=n}possiblyEvaluate(n,s,l,h){if(void 0!==n.value){if("constant"===n.expression.kind){const f=n.expression.evaluate(s,null,{},l,h);return this._calculate(f,f,f,s)}return this._calculate(n.expression.evaluate(new F(Math.floor(s.zoom-1),s)),n.expression.evaluate(new F(Math.floor(s.zoom),s)),n.expression.evaluate(new F(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:l,to:s}}interpolate(n){return n}}class xe{constructor(n){this.specification=n}possiblyEvaluate(n,s,l,h){return!!n.expression.evaluate(s,null,{},l,h)}interpolate(){return!1}}class Ce{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const l=n[s];l.specification.overridable&&this.overridableProperties.push(s);const h=this.defaultPropertyValues[s]=new U(l,void 0),f=this.defaultTransitionablePropertyValues[s]=new H(l);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate({})}}}function Se(o,n){return 256*(o=en(Math.floor(o),0,255))+en(Math.floor(n),0,255)}Ye("DataDrivenProperty",ie),Ye("DataConstantProperty",W),Ye("CrossFadedDataDrivenProperty",ae),Ye("CrossFadedProperty",be),Ye("ColorRampProperty",xe);const Ve={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class we{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ue{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function ve(o,n=1){let s=0,l=0;return{members:o.map(h=>{const f=Ve[h.type].BYTES_PER_ELEMENT,_=s=Ge(s,Math.max(n,f)),x=h.components||1;return l=Math.max(l,f),s+=f*x,{name:h.name,type:h.type,components:x,offset:_}}),size:Ge(s,Math.max(l,n)),alignment:n}}function Ge(o,n){return Math.ceil(o/n)*n}class Je extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.int16[h+0]=s,this.int16[h+1]=l,n}}Je.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",Je);class lt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,l,h)}emplace(n,s,l,h,f){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=f,n}}lt.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",lt);class ht extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,l,h,f,_,x)}emplace(n,s,l,h,f,_,x,w){const T=6*n,I=12*n,M=3*n;return this.int16[T+0]=s,this.int16[T+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=f,this.uint8[I+6]=_,this.uint8[I+7]=x,this.float32[M+2]=w,n}}ht.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4ub1f12",ht);class dt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const f=3*n;return this.float32[f+0]=s,this.float32[f+1]=l,this.float32[f+2]=h,n}}dt.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",dt);class pt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w,T,I){const M=this.length;return this.resize(M+1),this.emplace(M,n,s,l,h,f,_,x,w,T,I)}emplace(n,s,l,h,f,_,x,w,T,I,M){const P=10*n;return this.uint16[P+0]=s,this.uint16[P+1]=l,this.uint16[P+2]=h,this.uint16[P+3]=f,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=w,this.uint16[P+7]=T,this.uint16[P+8]=I,this.uint16[P+9]=M,n}}pt.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",pt);class st extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w){const T=this.length;return this.resize(T+1),this.emplace(T,n,s,l,h,f,_,x,w)}emplace(n,s,l,h,f,_,x,w,T){const I=8*n;return this.uint16[I+0]=s,this.uint16[I+1]=l,this.uint16[I+2]=h,this.uint16[I+3]=f,this.uint16[I+4]=_,this.uint16[I+5]=x,this.uint16[I+6]=w,this.uint16[I+7]=T,n}}st.prototype.bytesPerElement=16,Ye("StructArrayLayout8ui16",st);class ft extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K){const te=this.length;return this.resize(te+1),this.emplace(te,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K)}emplace(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te){const se=16*n;return this.int16[se+0]=s,this.int16[se+1]=l,this.int16[se+2]=h,this.int16[se+3]=f,this.uint16[se+4]=_,this.uint16[se+5]=x,this.uint16[se+6]=w,this.uint16[se+7]=T,this.int16[se+8]=I,this.int16[se+9]=M,this.int16[se+10]=P,this.int16[se+11]=z,this.int16[se+12]=N,this.int16[se+13]=$,this.int16[se+14]=K,this.int16[se+15]=te,n}}ft.prototype.bytesPerElement=32,Ye("StructArrayLayout4i4ui4i4i32",ft);class qt extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}qt.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",qt);class $n extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w,T,I,M,P,z){const N=this.length;return this.resize(N+1),this.emplace(N,n,s,l,h,f,_,x,w,T,I,M,P,z)}emplace(n,s,l,h,f,_,x,w,T,I,M,P,z,N){const $=20*n,K=10*n;return this.int16[$+0]=s,this.int16[$+1]=l,this.int16[$+2]=h,this.int16[$+3]=f,this.int16[$+4]=_,this.float32[K+3]=x,this.float32[K+4]=w,this.float32[K+5]=T,this.float32[K+6]=I,this.int16[$+14]=M,this.uint32[K+8]=P,this.uint16[$+18]=z,this.uint16[$+19]=N,n}}$n.prototype.bytesPerElement=40,Ye("StructArrayLayout5i4f1i1ul2ui40",$n);class Qn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,n,s,l,h,f,_,x)}emplace(n,s,l,h,f,_,x,w){const T=8*n;return this.int16[T+0]=s,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+4]=f,this.int16[T+5]=_,this.int16[T+6]=x,this.int16[T+7]=w,n}}Qn.prototype.bytesPerElement=16,Ye("StructArrayLayout3i2i2i16",Qn);class Dr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,l,h,f)}emplace(n,s,l,h,f,_){const x=4*n,w=8*n;return this.float32[x+0]=s,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=f,this.int16[w+7]=_,n}}Dr.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",Dr);class Fr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,l,h)}emplace(n,s,l,h,f){const _=12*n,x=3*n;return this.uint8[_+0]=s,this.uint8[_+1]=l,this.float32[x+1]=h,this.float32[x+2]=f,n}}Fr.prototype.bytesPerElement=12,Ye("StructArrayLayout2ub2f12",Fr);class Pn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const f=3*n;return this.uint16[f+0]=s,this.uint16[f+1]=l,this.uint16[f+2]=h,n}}Pn.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",Pn);class Io extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he){const fe=this.length;return this.resize(fe+1),this.emplace(fe,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he)}emplace(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he,fe){const Me=30*n,Ee=15*n,Ze=60*n;return this.int16[Me+0]=s,this.int16[Me+1]=l,this.int16[Me+2]=h,this.float32[Ee+2]=f,this.float32[Ee+3]=_,this.uint16[Me+8]=x,this.uint16[Me+9]=w,this.uint32[Ee+5]=T,this.uint32[Ee+6]=I,this.uint32[Ee+7]=M,this.uint16[Me+16]=P,this.uint16[Me+17]=z,this.uint16[Me+18]=N,this.float32[Ee+10]=$,this.float32[Ee+11]=K,this.uint8[Ze+48]=te,this.uint8[Ze+49]=se,this.uint8[Ze+50]=ue,this.uint32[Ee+13]=pe,this.int16[Me+28]=he,this.uint8[Ze+58]=fe,n}}Io.prototype.bytesPerElement=60,Ye("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Io);class Wr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he,fe,Me,Ee,Ze,Oe,Ae,ze,Ne,ke){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he,fe,Me,Ee,Ze,Oe,Ae,ze,Ne,ke)}emplace(n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K,te,se,ue,pe,he,fe,Me,Ee,Ze,Oe,Ae,ze,Ne,ke,Ke){const Qe=38*n,yt=19*n;return this.int16[Qe+0]=s,this.int16[Qe+1]=l,this.int16[Qe+2]=h,this.float32[yt+2]=f,this.float32[yt+3]=_,this.int16[Qe+8]=x,this.int16[Qe+9]=w,this.int16[Qe+10]=T,this.int16[Qe+11]=I,this.int16[Qe+12]=M,this.int16[Qe+13]=P,this.uint16[Qe+14]=z,this.uint16[Qe+15]=N,this.uint16[Qe+16]=$,this.uint16[Qe+17]=K,this.uint16[Qe+18]=te,this.uint16[Qe+19]=se,this.uint16[Qe+20]=ue,this.uint16[Qe+21]=pe,this.uint16[Qe+22]=he,this.uint16[Qe+23]=fe,this.uint16[Qe+24]=Me,this.uint16[Qe+25]=Ee,this.uint16[Qe+26]=Ze,this.uint16[Qe+27]=Oe,this.uint16[Qe+28]=Ae,this.uint32[yt+15]=ze,this.float32[yt+16]=Ne,this.float32[yt+17]=ke,this.float32[yt+18]=Ke,n}}Wr.prototype.bytesPerElement=76,Ye("StructArrayLayout3i2f6i15ui1ul3f76",Wr);class mn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}mn.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",mn);class kn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,l){const h=this.length;return this.resize(h+1),this.emplace(h,n,s,l)}emplace(n,s,l,h){const f=3*n;return this.int16[f+0]=s,this.int16[f+1]=l,this.int16[f+2]=h,n}}kn.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",kn);class Ht extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,l,h)}emplace(n,s,l,h,f){const _=6*n;return this.uint32[3*n+0]=s,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=f,n}}Ht.prototype.bytesPerElement=12,Ye("StructArrayLayout1ul3ui12",Ht);class Dn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.uint16[h+0]=s,this.uint16[h+1]=l,n}}Dn.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",Dn);class dr extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}dr.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",dr);class Tn extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const l=this.length;return this.resize(l+1),this.emplace(l,n,s)}emplace(n,s,l){const h=2*n;return this.float32[h+0]=s,this.float32[h+1]=l,n}}Tn.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",Tn);class mi extends Ue{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,l,h)}emplace(n,s,l,h,f){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=f,n}}mi.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",mi);class Mo extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Mo.prototype.size=40;class Or extends $n{get(n){return new Mo(this,n)}}Ye("CollisionBoxArray",Or);class ho extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}ho.prototype.size=60;class _l extends Io{get(n){return new ho(this,n)}}Ye("PlacedSymbolArray",_l);class ks extends we{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}ks.prototype.size=76;class Ta extends Wr{get(n){return new ks(this,n)}}Ye("SymbolInstanceArray",Ta);class vu extends mn{getoffsetX(n){return this.float32[1*n+0]}}Ye("GlyphOffsetArray",vu);class Ca extends kn{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Ye("SymbolLineVertexArray",Ca);class yl extends we{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}yl.prototype.size=12;class Jd extends Ht{get(n){return new yl(this,n)}}Ye("FeatureIndexArray",Jd);class Pf extends we{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Pf.prototype.size=4;class kf extends Dn{get(n){return new Pf(this,n)}}Ye("FillExtrusionCentroidArray",kf);const Dh=ve([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),xu=ve([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Rf=Ar(function(o){o.exports=function(n,s){var l,h,f,_,x,w,T,I;for(h=n.length-(l=3&n.length),f=s,x=3432918353,w=461845907,I=0;I<h;)T=255&n.charCodeAt(I)|(255&n.charCodeAt(++I))<<8|(255&n.charCodeAt(++I))<<16|(255&n.charCodeAt(++I))<<24,++I,f=27492+(65535&(_=5*(65535&(f=(f^=T=(65535&(T=(T=(65535&T)*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(T=0,l){case 3:T^=(255&n.charCodeAt(I+2))<<16;case 2:T^=(255&n.charCodeAt(I+1))<<8;case 1:f^=T=(65535&(T=(T=(65535&(T^=255&n.charCodeAt(I)))*x+(((T>>>16)*x&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}}),Lf=Ar(function(o){o.exports=function(n,s){for(var l,h=n.length,f=s^h,_=0;h>=4;)l=1540483477*(65535&(l=255&n.charCodeAt(_)|(255&n.charCodeAt(++_))<<8|(255&n.charCodeAt(++_))<<16|(255&n.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:f^=(255&n.charCodeAt(_+2))<<16;case 2:f^=(255&n.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}}),wc=Rf,Ec=Lf;wc.murmur3=Rf,wc.murmur2=Ec;class Th{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,l,h){this.ids.push(Ch(n)),this.positions.push(s,l,h)}getPositions(n){const s=Ch(n);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=s?h=_:l=_+1}const f=[];for(;this.ids[l]===s;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(n,s){const l=new Float64Array(n.ids),h=new Uint32Array(n.positions);return bu(l,h,0,l.length-1),s&&s.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(n){const s=new Th;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function Ch(o){const n=+o;return!isNaN(n)&&n<=ui?n:wc(String(o))}function bu(o,n,s,l){for(;s<l;){const h=o[s+l>>1];let f=s-1,_=l+1;for(;;){do{f++}while(o[f]<h);do{_--}while(o[_]>h);if(f>=_)break;Rs(o,f,_),Rs(n,3*f,3*_),Rs(n,3*f+1,3*_+1),Rs(n,3*f+2,3*_+2)}_-s<l-_?(bu(o,n,s,_),s=_+1):(bu(o,n,_+1,l),l=_)}}function Rs(o,n,s){const l=o[n];o[n]=o[s],o[s]=l}Ye("FeaturePositionMap",Th);class Si{constructor(n,s){this.gl=n.gl,this.location=s}}class Ls extends Si{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Qd extends Si{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Sh extends Si{constructor(n,s){super(n,s),this.current=Vt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Dc=new Float32Array(16),Mv=new Float32Array(9),Rg=new Float32Array(4);function rn(o){return[Se(255*o.r,255*o.g),Se(255*o.b,255*o.a)]}class Ih{constructor(n,s,l){this.value=n,this.uniformNames=s.map(h=>`u_${h}`),this.type=l}setUniform(n,s,l){n.set(l.constantOr(this.value))}getBinding(n,s,l){return"color"===this.type?new Sh(n,s):new Ls(n,s)}}class wu{constructor(n,s){this.uniformNames=s.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=s.tl.concat(s.br),this.patternTo=n.tl.concat(n.br)}setUniform(n,s,l,h){const f="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;f&&n.set(f)}getBinding(n,s,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new Qd(n,s):new Ls(n,s)}}class Sa{constructor(n,s,l,h){this.expression=n,this.type=l,this.maxValue=0,this.paintVertexAttributes=s.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,s,l,h,f,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new F(0),s,{},f,h,_);this.paintVertexArray.resize(n),this._setPaintValue(x,n,w)}updatePaintArray(n,s,l,h,f){const _=this.expression.evaluate({zoom:0},l,h,void 0,f);this._setPaintValue(n,s,_)}_setPaintValue(n,s,l){if("color"===this.type){const h=rn(l);for(let f=n;f<s;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=n;h<s;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class os{constructor(n,s,l,h,f,_){this.expression=n,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,l,h,f,_){const x=this.expression.evaluate(new F(this.zoom),s,{},f,h,_),w=this.expression.evaluate(new F(this.zoom+1),s,{},f,h,_),T=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(T,n,x,w)}updatePaintArray(n,s,l,h,f){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,f);this._setPaintValue(n,s,_,x)}_setPaintValue(n,s,l,h){if("color"===this.type){const f=rn(l),_=rn(h);for(let x=n;x<s;x++)this.paintVertexArray.emplace(x,f[0],f[1],_[0],_[1])}else{for(let f=n;f<s;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const l=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,h=en(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(h)}getBinding(n,s,l){return new Ls(n,s)}}class vl{constructor(n,s,l,h,f,_,x){this.expression=n,this.type=l,this.useIntegerZoom=h,this.zoom=f,this.layerId=x,this.paintVertexAttributes=("array"===l?xu:Dh).members;for(let w=0;w<s.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(n,s,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(h,n,s.patterns&&s.patterns[this.layerId],l)}updatePaintArray(n,s,l,h,f,_){this._setPaintValues(n,s,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(n,s,l,h){if(!h||!l)return;const{min:f,mid:_,max:x}=l,w=h[f],T=h[_],I=h[x];if(w&&T&&I)for(let M=n;M<s;M++)this._setPaintValue(this.zoomInPaintVertexArray,M,T,w),this._setPaintValue(this.zoomOutPaintVertexArray,M,T,I)}_setPaintValue(n,s,l,h){n.emplace(s,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ia{constructor(n,s,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const f in n.paint._values){if(!l(f))continue;const _=n.paint.get(f);if(!(_ instanceof ee&&vn(_.property.specification)))continue;const x=Av(f,n.type),w=_.value,T=_.property.specification.type,I=_.property.useIntegerZoom,M=_.property.specification["property-type"],P="cross-faded"===M||"cross-faded-data-driven"===M,z="line-dasharray"===String(f)&&"constant"!==n.layout.get("line-cap").value.kind;if("constant"!==w.kind||z)if("source"===w.kind||z||P){const N=Cc(f,T,"source");this.binders[f]=P?new vl(w,x,T,I,s,N,n.id):new Sa(w,x,T,N),h.push(`/a_${f}`)}else{const N=Cc(f,T,"composite");this.binders[f]=new os(w,x,T,I,s,N),h.push(`/z_${f}`)}else this.binders[f]=P?new wu(w.value,x):new Ih(w.value,x,T),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof Sa||s instanceof os?s.maxValue:0}populatePaintArrays(n,s,l,h,f,_){for(const x in this.binders){const w=this.binders[x];(w instanceof Sa||w instanceof os||w instanceof vl)&&w.populatePaintArray(n,s,l,h,f,_)}}setConstantPatternPositions(n,s){for(const l in this.binders){const h=this.binders[l];h instanceof wu&&h.setConstantPatternPositions(n,s)}}updatePaintArrays(n,s,l,h,f,_){let x=!1;for(const w in n){const T=s.getPositions(w);for(const I of T){const M=l.feature(I.index);for(const P in this.binders){const z=this.binders[P];if((z instanceof Sa||z instanceof os||z instanceof vl)&&!0===z.expression.isStateDependent){const N=h.paint.get(P);z.expression=N.value,z.updatePaintArray(I.start,I.end,M,n[w],f,_),x=!0}}}}return x}defines(){const n=[];for(const s in this.binders){const l=this.binders[s];(l instanceof Ih||l instanceof wu)&&n.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Sa||l instanceof os||l instanceof vl)for(let h=0;h<l.paintVertexAttributes.length;h++)n.push(l.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Ih||l instanceof wu||l instanceof os)for(const h of l.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const l=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Ih||f instanceof wu||f instanceof os)for(const _ of f.uniformNames)if(s[_]){const x=f.getBinding(n,s[_],_);l.push({name:_,property:h,binding:x})}}return l}setUniforms(n,s,l,h){for(const{name:f,property:_,binding:x}of s)this.binders[_].setUniform(x,h,l.get(_),f)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const l=this.binders[s];if(n&&l instanceof vl){const h=2===n.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Sa||l instanceof os)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(n){for(const s in this.binders){const l=this.binders[s];(l instanceof Sa||l instanceof os||l instanceof vl)&&l.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof Sa||s instanceof os||s instanceof vl)&&s.destroy()}}}class Tc{constructor(n,s,l=(()=>!0)){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new Ia(h,s,l);this.needsUpload=!1,this._featureMap=new Th,this._bufferOffset=0}populatePaintArrays(n,s,l,h,f,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(n,s,h,f,_,x);void 0!==s.id&&this._featureMap.add(s.id,l,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,l,h,f){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,s,_,h,f)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Eu={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Av(o,n){return Eu[o]||[o.replace(`${n}-`,"").replace(/-/g,"_")]}const Tr={"line-pattern":{source:pt,composite:pt},"fill-pattern":{source:pt,composite:pt},"fill-extrusion-pattern":{source:pt,composite:pt},"line-dasharray":{source:st,composite:st}},ep={color:{source:Tn,composite:mi},number:{source:mn,composite:Tn}};function Cc(o,n,s){const l=Tr[o];return l&&l[s]||ep[n][s]}Ye("ConstantBinder",Ih),Ye("CrossFadedConstantBinder",wu),Ye("SourceExpressionBinder",Sa),Ye("CrossFadedCompositeBinder",vl),Ye("CompositeExpressionBinder",os),Ye("ProgramConfiguration",Ia,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",Tc);const tp="-transition";class Ao extends $e{constructor(n,s){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==n.type&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,"background"!==n.type&&"sky"!==n.type&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),s.layout&&(this._unevaluatedLayout=new q(s.layout)),s.paint)){this._transitionablePaint=new Z(s.paint);for(const l in n.paint)this.setPaintProperty(l,n.paint[l],{validate:!1});for(const l in n.layout)this.setLayoutProperty(l,n.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new re(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return"visibility"===n?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s,l={}){null!=s&&this._validate(Fn,`layers.${this.id}.layout.${n}`,n,s,l)||("visibility"!==n?this._unevaluatedLayout.setValue(n,s):this.visibility=s)}getPaintProperty(n){return Hn(n,tp)?this._transitionablePaint.getTransition(n.slice(0,-tp.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,l={}){if(null!=s&&this._validate(lu,`layers.${this.id}.paint.${n}`,n,s,l))return!1;if(Hn(n,tp))return this._transitionablePaint.setTransition(n.slice(0,-tp.length),s||void 0),!1;{const h=this._transitionablePaint._values[n],f="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const w=this._transitionablePaint._values[n].value;return w.isDataDriven()||_||f||this._handleOverridablePaintPropertyUpdate(n,x,w)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,s,l){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||"none"===this.visibility}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Wi(n,(s,l)=>!(void 0===s||"layout"===l&&!Object.keys(s).length||"paint"===l&&!Object.keys(s).length))}_validate(n,s,l,h,f={}){return(!f||!1!==f.validate)&&cu(this,n.call(Co,{key:s,layerType:this.type,objectKey:l,value:h,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof ee&&vn(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=fc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const po=ve([{name:"a_pos",components:2,type:"Int16"}],4),{members:ss}=po;class pr{constructor(n=[]){this.segments=n}prepareSegment(n,s,l,h){let f=this.segments[this.segments.length-1];return n>pr.MAX_VERTEX_ARRAY_LENGTH&&En(`Max vertices per segment is ${pr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!f||f.vertexLength+n>pr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:s.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,l,h){return new pr([{vertexOffset:n,primitiveOffset:s,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}pr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",pr);var Rt=8192;class Po{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):4===n.length?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof dn?new dn(n.lng,n.lat):dn.convert(n),this}setSouthWest(n){return this._sw=n instanceof dn?new dn(n.lng,n.lat):dn.convert(n),this}extend(n){const s=this._sw,l=this._ne;let h,f;if(n instanceof dn)h=n,f=n;else{if(!(n instanceof Po))return Array.isArray(n)?4===n.length||n.every(Array.isArray)?this.extend(Po.convert(n)):this.extend(dn.convert(n)):this;if(h=n._sw,f=n._ne,!h||!f)return this}return s||l?(s.lng=Math.min(h.lng,s.lng),s.lat=Math.min(h.lat,s.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new dn(h.lng,h.lat),this._ne=new dn(f.lng,f.lat)),this}getCenter(){return new dn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new dn(this.getWest(),this.getNorth())}getSouthEast(){return new dn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:l}=dn.convert(n);let h=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(n){return!n||n instanceof Po?n:new Po(n)}}const np=6371008.8;class dn{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dn(xo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,l=this.lat*s,h=n.lat*s,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((n.lng-this.lng)*s);return np*Math.acos(Math.min(f,1))}toBounds(n=0){const s=360*n/40075017,l=s/Math.cos(Math.PI/180*this.lat);return new Po(new dn(this.lng-l,this.lat-s),new dn(this.lng+l,this.lat+s))}static convert(n){if(n instanceof dn)return n;if(Array.isArray(n)&&(2===n.length||3===n.length))return new dn(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&"object"==typeof n&&null!==n)return new dn(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ff=2*Math.PI*np;function Lg(o){return Ff*Math.cos(o*Math.PI/180)}function Of(o){return(180+o)/360}function Mh(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function gi(o,n){return o/Lg(n)}function Fs(o){return 360*o-180}function _i(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function zf(o,n){return o*Lg(_i(n))}const Os=85.051129;class Ah{constructor(n,s,l=0){this.x=+n,this.y=+s,this.z=+l}static fromLngLat(n,s=0){const l=dn.convert(n);return new Ah(Of(l.lng),Mh(l.lat),gi(s,l.lat))}toLngLat(){return new dn(Fs(this.x),_i(this.y))}toAltitude(){return zf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ff*(n=_i(this.y),1/Math.cos(n*Math.PI/180));var n}}function rp(o,n,s,l,h,f,_,x,w){const T=(n+l)/2,I=(s+h)/2,M=new Ie(T,I);x(M),function(P,z,N,$,K,te){const se=N-K,ue=$-te;return Math.abs(($-z)*se-(N-P)*ue)/Math.hypot(se,ue)}(M.x,M.y,f.x,f.y,_.x,_.y)>=w?(rp(o,n,s,T,I,f,M,x,w),rp(o,T,I,l,h,M,_,x,w)):o.push(_)}function Fg(o,n,s){const l=[];let h,f,_;for(const x of o){const{x:w,y:T}=x;n(x),_?rp(l,h,f,w,T,_,x,n,s):l.push(x),h=w,f=T,_=x}return l}const ip=Math.pow(2,14)-1,Bf=-ip-1;function Nf(o,n){const s=Math.round(o.x*n),l=Math.round(o.y*n);return o.x=en(s,Bf,ip),o.y=en(l,Bf,ip),(s<o.x||s>o.x+1||l<o.y||l>o.y+1)&&En("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function ko(o,n,s){const l=o.loadGeometry(),h=o.extent,f=Rt/h;if(n&&s&&"mercator"!==s.projection.name){const _=1<<n.z,{scale:x,x:w,y:T,projection:I}=s,M=P=>{const z=Fs((n.x+P.x/h)/_),N=_i((n.y+P.y/h)/_),$=I.project(z,N);P.x=($.x*x-w)*h,P.y=($.y*x-T)*h};for(let P=0;P<l.length;P++)if(1!==o.type)l[P]=Fg(l[P],M,1);else{const z=[];for(const N of l[P])N.x<0||N.x>=h||N.y<0||N.y>=h||(M(N),z.push(N));l[P]=z}}for(const _ of l)for(const x of _)Nf(x,f);return l}function as(o,n){return{type:o.type,id:o.id,properties:o.properties,geometry:n?ko(o):[]}}function op(o,n,s,l,h){o.emplaceBack(2*n+(l+1)/2,2*s+(h+1)/2)}class xl{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Je,this.indexArray=new Pn,this.segments=new pr,this.programConfigurations=new Tc(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){const f=this.layers[0],_=[];let x=null;"circle"===f.type&&(x=f.layout.get("circle-sort-key"));for(const{feature:w,id:T,index:I,sourceLayerIndex:M}of n){const P=this.layers[0]._featureFilter.needGeometry,z=as(w,P);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),z,l))continue;const N=x?x.evaluate(z,{},l):void 0,$={id:T,properties:w.properties,type:w.type,sourceLayerIndex:M,index:I,geometry:P?z.geometry:ko(w,l,h),patterns:{},sortKey:N};_.push($)}x&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:I,sourceLayerIndex:M}=w,P=n[I].feature;this.addFeature(w,T,I,s.availableImages,l),s.featureIndex.insert(P,T,I,M,this.index)}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ss),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,l,h,f){for(const _ of s)for(const x of _){const w=x.x,T=x.y;if(w<0||w>=Rt||T<0||T>=Rt)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),M=I.vertexLength;op(this.layoutVertexArray,w,T,-1,-1),op(this.layoutVertexArray,w,T,1,-1),op(this.layoutVertexArray,w,T,1,1),op(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+3,M+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,{},h,f)}}function Ph(o,n){for(let s=0;s<o.length;s++)if(Ic(n,o[s]))return!0;for(let s=0;s<n.length;s++)if(Ic(o,n[s]))return!0;return!!sp(o,n)}function kh(o,n,s){return!!Ic(o,n)||!!ap(n,o,s)}function Vf(o,n){if(1===o.length)return lp(n,o[0]);for(let s=0;s<n.length;s++){const l=n[s];for(let h=0;h<l.length;h++)if(Ic(o,l[h]))return!0}for(let s=0;s<o.length;s++)if(lp(n,o[s]))return!0;for(let s=0;s<n.length;s++)if(sp(o,n[s]))return!0;return!1}function Og(o,n,s){if(o.length>1){if(sp(o,n))return!0;for(let l=0;l<n.length;l++)if(ap(n[l],o,s))return!0}for(let l=0;l<o.length;l++)if(ap(o[l],n,s))return!0;return!1}function sp(o,n){if(0===o.length||0===n.length)return!1;for(let s=0;s<o.length-1;s++){const l=o[s],h=o[s+1];for(let f=0;f<n.length-1;f++)if(Uf(l,h,n[f],n[f+1]))return!0}return!1}function Uf(o,n,s,l){return hi(o,s,l)!==hi(n,s,l)&&hi(o,n,s)!==hi(o,n,l)}function ap(o,n,s){const l=s*s;if(1===n.length)return o.distSqr(n[0])<l;for(let h=1;h<n.length;h++)if(Sc(o,n[h-1],n[h])<l)return!0;return!1}function Sc(o,n,s){const l=n.distSqr(s);if(0===l)return o.distSqr(n);const h=((o.x-n.x)*(s.x-n.x)+(o.y-n.y)*(s.y-n.y))/l;return o.distSqr(h<0?n:h>1?s:s.sub(n)._mult(h)._add(n))}function lp(o,n){let s,l,h,f=!1;for(let _=0;_<o.length;_++){s=o[_];for(let x=0,w=s.length-1;x<s.length;w=x++)l=s[x],h=s[w],l.y>n.y!=h.y>n.y&&n.x<(h.x-l.x)*(n.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function Ic(o,n){let s=!1;for(let l=0,h=o.length-1;l<o.length;h=l++){const f=o[l],_=o[h];f.y>n.y!=_.y>n.y&&n.x<(_.x-f.x)*(n.y-f.y)/(_.y-f.y)+f.x&&(s=!s)}return s}function Lt(o,n,s,l,h){for(const _ of o)if(n<=_.x&&s<=_.y&&l>=_.x&&h>=_.y)return!0;const f=[new Ie(n,s),new Ie(n,h),new Ie(l,h),new Ie(l,s)];if(o.length>2)for(const _ of f)if(Ic(o,_))return!0;for(let _=0;_<o.length-1;_++)if(jf(o[_],o[_+1],f))return!0;return!1}function jf(o,n,s){const l=s[0],h=s[2];if(o.x<l.x&&n.x<l.x||o.x>h.x&&n.x>h.x||o.y<l.y&&n.y<l.y||o.y>h.y&&n.y>h.y)return!1;const f=hi(o,n,s[0]);return f!==hi(o,n,s[1])||f!==hi(o,n,s[2])||f!==hi(o,n,s[3])}function Du(o,n,s){const l=n.paint.get(o).value;return"constant"===l.kind?l.value:s.programConfigurations.get(n.id).getMaxValue(o)}function Mc(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ac(o,n,s,l,h){if(!n[0]&&!n[1])return o;const f=Ie.convert(n)._mult(h);"viewport"===s&&f._rotate(-l);const _=[];for(let x=0;x<o.length;x++)_.push(o[x].sub(f));return _}function $f(o,n,s,l){const h=Ie.convert(o)._mult(l);return"viewport"===n&&h._rotate(-s),h}Ye("CircleBucket",xl,{omit:["layers"]});const zg=new Ce({"circle-sort-key":new ie(de.layout_circle["circle-sort-key"])});var Bg={paint:new Ce({"circle-radius":new ie(de.paint_circle["circle-radius"]),"circle-color":new ie(de.paint_circle["circle-color"]),"circle-blur":new ie(de.paint_circle["circle-blur"]),"circle-opacity":new ie(de.paint_circle["circle-opacity"]),"circle-translate":new W(de.paint_circle["circle-translate"]),"circle-translate-anchor":new W(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new W(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new W(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ie(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ie(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ie(de.paint_circle["circle-stroke-opacity"])}),layout:zg},Cr="undefined"!=typeof Float32Array?Float32Array:Array;function bl(){var o=new Cr(9);return Cr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Rh(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Pc(o,n,s){var l=n[0],h=n[1],f=n[2],_=n[3],x=n[4],w=n[5],T=n[6],I=n[7],M=n[8],P=n[9],z=n[10],N=n[11],$=n[12],K=n[13],te=n[14],se=n[15],ue=s[0],pe=s[1],he=s[2],fe=s[3];return o[0]=ue*l+pe*x+he*M+fe*$,o[1]=ue*h+pe*w+he*P+fe*K,o[2]=ue*f+pe*T+he*z+fe*te,o[3]=ue*_+pe*I+he*N+fe*se,o[4]=(ue=s[4])*l+(pe=s[5])*x+(he=s[6])*M+(fe=s[7])*$,o[5]=ue*h+pe*w+he*P+fe*K,o[6]=ue*f+pe*T+he*z+fe*te,o[7]=ue*_+pe*I+he*N+fe*se,o[8]=(ue=s[8])*l+(pe=s[9])*x+(he=s[10])*M+(fe=s[11])*$,o[9]=ue*h+pe*w+he*P+fe*K,o[10]=ue*f+pe*T+he*z+fe*te,o[11]=ue*_+pe*I+he*N+fe*se,o[12]=(ue=s[12])*l+(pe=s[13])*x+(he=s[14])*M+(fe=s[15])*$,o[13]=ue*h+pe*w+he*P+fe*K,o[14]=ue*f+pe*T+he*z+fe*te,o[15]=ue*_+pe*I+he*N+fe*se,o}Math.hypot||(Math.hypot=function(){for(var o=0,n=arguments.length;n--;)o+=arguments[n]*arguments[n];return Math.sqrt(o)});var Ng=Pc;function Tu(){var o=new Cr(3);return Cr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Lh(o){return Math.hypot(o[0],o[1],o[2])}function zs(o,n,s){var l=new Cr(3);return l[0]=o,l[1]=n,l[2]=s,l}function cp(o,n,s){return o[0]=n[0]-s[0],o[1]=n[1]-s[1],o[2]=n[2]-s[2],o}function Gf(o,n,s){return o[0]=n[0]*s[0],o[1]=n[1]*s[1],o[2]=n[2]*s[2],o}function Hf(o,n,s,l){return o[0]=n[0]+s[0]*l,o[1]=n[1]+s[1]*l,o[2]=n[2]+s[2]*l,o}function wl(o,n){var s=n[0],l=n[1],h=n[2],f=s*s+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),o[0]=n[0]*f,o[1]=n[1]*f,o[2]=n[2]*f,o}function kc(o,n,s){var l=s[0],h=s[1],f=s[2],_=n[0],x=n[1],w=n[2],T=h*w-f*x,I=f*_-l*w,M=l*x-h*_,P=h*M-f*I,z=f*T-l*M,N=l*I-h*T,$=2*s[3];return I*=$,M*=$,z*=2,N*=2,o[0]=_+(T*=$)+(P*=2),o[1]=x+I+z,o[2]=w+M+N,o}var Cu,o,Pv=cp,qf=Gf,Vg=Lh;function Fh(o,n,s){var l=n[0],h=n[1],f=n[2],_=n[3];return o[0]=s[0]*l+s[4]*h+s[8]*f+s[12]*_,o[1]=s[1]*l+s[5]*h+s[9]*f+s[13]*_,o[2]=s[2]*l+s[6]*h+s[10]*f+s[14]*_,o[3]=s[3]*l+s[7]*h+s[11]*f+s[15]*_,o}function up(){var o=new Cr(4);return Cr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Zf(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Wf(o,n,s){s*=.5;var l=n[0],h=n[1],f=n[2],_=n[3],x=Math.sin(s),w=Math.cos(s);return o[0]=l*w+_*x,o[1]=h*w+f*x,o[2]=f*w-h*x,o[3]=_*w-l*x,o}function Su(o,n){return o[0]===n[0]&&o[1]===n[1]}function Oh(o,n,s,l,h,f,_,x,w){if(f&&o.queryGeometry.isAboveHorizon)return!1;f&&(w*=o.pixelToTileUnitsFactor);for(const T of n)for(const I of T){const M=I.add(x),P=h&&s.elevation?s.elevation.exaggeration()*h.getElevationAt(M.x,M.y,!0):0,z=f?M:Rc(M,P,l),N=f?o.tilespaceRays.map(K=>kv(K,P)):o.queryGeometry.screenGeometry,$=Fh([],[I.x,I.y,P,1],l);if(!_&&f?w*=$[3]/s.cameraToCenterDistance:_&&!f&&(w*=s.cameraToCenterDistance/$[3]),kh(N,z,w))return!0}return!1}function Rc(o,n,s){const l=Fh([],[o.x,o.y,n,1],s);return new Ie(l[0]/l[3],l[1]/l[3])}Tu(),Cu=new Cr(4),Cr!=Float32Array&&(Cu[0]=0,Cu[1]=0,Cu[2]=0,Cu[3]=0),Tu(),zs(1,0,0),zs(0,1,0),up(),up(),bl(),o=new Cr(2),Cr!=Float32Array&&(o[0]=0,o[1]=0);const Xf=zs(0,0,0),Ug=zs(0,0,1);function kv(o,n){const s=Tu();return Xf[2]=n,o.intersectsPlane(Xf,Ug,s),new Ie(s[0],s[1])}class Iu extends xl{}function Mu(o,{width:n,height:s},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*s*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*s*l);return o.width=n,o.height=s,o.data=h,o}function hp(o,{width:n,height:s},l){if(n===o.width&&s===o.height)return;const h=Mu({},{width:n,height:s},l);zh(o,h,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,n),height:Math.min(o.height,s)},l),o.width=n,o.height=s,o.data=h.data}function zh(o,n,s,l,h,f){if(0===h.width||0===h.height)return n;if(h.width>o.width||h.height>o.height||s.x>o.width-h.width||s.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||l.x>n.width-h.width||l.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=o.data,x=n.data;for(let w=0;w<h.height;w++){const T=((s.y+w)*o.width+s.x)*f,I=((l.y+w)*n.width+l.x)*f;for(let M=0;M<h.width*f;M++)x[I+M]=_[T+M]}return n}Ye("HeatmapBucket",Iu,{omit:["layers"]});class Bs{constructor(n,s){Mu(this,n,1,s)}resize(n){hp(this,n,1)}clone(){return new Bs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,l,h,f){zh(n,s,l,h,f,1)}}class Ii{constructor(n,s){Mu(this,n,4,s)}resize(n){hp(this,n,4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ii({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,l,h,f){zh(n,s,l,h,f,4)}}Ye("AlphaImage",Bs),Ye("RGBAImage",Ii);var jg={paint:new Ce({"heatmap-radius":new ie(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ie(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new W(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xe(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new W(de.paint_heatmap["heatmap-opacity"])})};function dp(o){const n={},s=o.resolution||256,l=o.clips?o.clips.length:1,h=o.image||new Ii({width:s,height:l}),f=(_,x,w)=>{n[o.evaluationKey]=w;const T=o.expression.evaluate(n);h.data[_+x+0]=Math.floor(255*T.r/T.a),h.data[_+x+1]=Math.floor(255*T.g/T.a),h.data[_+x+2]=Math.floor(255*T.b/T.a),h.data[_+x+3]=Math.floor(255*T.a)};if(o.clips)for(let _=0,x=0;_<l;++_,x+=4*s)for(let w=0,T=0;w<s;w++,T+=4){const I=w/(s-1),{start:M,end:P}=o.clips[_];f(x,T,M*(1-I)+P*I)}else for(let _=0,x=0;_<s;_++,x+=4)f(0,x,_/(s-1));return h}var $g={paint:new Ce({"hillshade-illumination-direction":new W(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new W(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new W(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new W(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new W(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new W(de.paint_hillshade["hillshade-accent-color"])})};const Gg=ve([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hg}=Gg;var Ro=Bh,Au=Bh;function Bh(o,n,s){s=s||2;var l,h,f,_,x,w,T,I=n&&n.length,M=I?n[0]*s:o.length,P=qg(o,0,M,s,!0),z=[];if(!P||P.next===P.prev)return z;if(I&&(P=function($,K,te,se){var ue,pe,he,fe=[];for(ue=0,pe=K.length;ue<pe;ue++)(he=qg($,K[ue]*se,ue<pe-1?K[ue+1]*se:$.length,se,!1))===he.next&&(he.steiner=!0),fe.push(Yg(he));for(fe.sort(Wg),ue=0;ue<fe.length;ue++)te=El(te=Xg(fe[ue],te),te.next);return te}(o,n,P,s)),o.length>80*s){l=f=o[0],h=_=o[1];for(var N=s;N<M;N+=s)(x=o[N])<l&&(l=x),(w=o[N+1])<h&&(h=w),x>f&&(f=x),w>_&&(_=w);T=0!==(T=Math.max(f-l,_-h))?1/T:0}return Nh(P,z,s,l,h,T),z}function qg(o,n,s,l,h){var f,_;if(h===Lu(o,n,s,l)>0)for(f=n;f<s;f+=l)_=Qg(f,o[f],o[f+1],_);else for(f=s-l;f>=n;f-=l)_=Qg(f,o[f],o[f+1],_);return _&&Ma(_,_.next)&&(Dl(_),_=_.next),_}function El(o,n){if(!o)return o;n||(n=o);var s,l=o;do{if(s=!1,l.steiner||!Ma(l,l.next)&&0!==pn(l.prev,l,l.next))l=l.next;else{if(Dl(l),(l=n=l.prev)===l.next)break;s=!0}}while(s||l!==n);return n}function Nh(o,n,s,l,h,f,_){if(o){!_&&f&&function(I,M,P,z){var N=I;do{null===N.z&&(N.z=Yf(N.x,N.y,M,P,z)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==I);N.prevZ.nextZ=null,N.prevZ=null,function($){var K,te,se,ue,pe,he,fe,Me,Ee=1;do{for(te=$,$=null,pe=null,he=0;te;){for(he++,se=te,fe=0,K=0;K<Ee&&(fe++,se=se.nextZ);K++);for(Me=Ee;fe>0||Me>0&&se;)0!==fe&&(0===Me||!se||te.z<=se.z)?(ue=te,te=te.nextZ,fe--):(ue=se,se=se.nextZ,Me--),pe?pe.nextZ=ue:$=ue,ue.prevZ=pe,pe=ue;te=se}pe.nextZ=null,Ee*=2}while(he>1)}(N)}(o,l,h,f);for(var x,w,T=o;o.prev!==o.next;)if(x=o.prev,w=o.next,f?Lv(o,l,h,f):Rv(o))n.push(x.i/s),n.push(o.i/s),n.push(w.i/s),Dl(o),o=w.next,T=w.next;else if((o=w)===T){_?1===_?Nh(o=Kf(El(o),n,s),n,s,l,h,f,2):2===_&&Zg(o,n,s,l,h,f):Nh(El(o),n,s,l,h,f,1);break}}}function Rv(o){var n=o.prev,s=o,l=o.next;if(pn(n,s,l)>=0)return!1;for(var h=o.next.next;h!==o.prev;){if(Ns(n.x,n.y,s.x,s.y,l.x,l.y,h.x,h.y)&&pn(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Lv(o,n,s,l){var h=o.prev,f=o,_=o.next;if(pn(h,f,_)>=0)return!1;for(var x=h.x>f.x?h.x>_.x?h.x:_.x:f.x>_.x?f.x:_.x,w=h.y>f.y?h.y>_.y?h.y:_.y:f.y>_.y?f.y:_.y,T=Yf(h.x<f.x?h.x<_.x?h.x:_.x:f.x<_.x?f.x:_.x,h.y<f.y?h.y<_.y?h.y:_.y:f.y<_.y?f.y:_.y,n,s,l),I=Yf(x,w,n,s,l),M=o.prevZ,P=o.nextZ;M&&M.z>=T&&P&&P.z<=I;){if(M!==o.prev&&M!==o.next&&Ns(h.x,h.y,f.x,f.y,_.x,_.y,M.x,M.y)&&pn(M.prev,M,M.next)>=0||(M=M.prevZ,P!==o.prev&&P!==o.next&&Ns(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&pn(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;M&&M.z>=T;){if(M!==o.prev&&M!==o.next&&Ns(h.x,h.y,f.x,f.y,_.x,_.y,M.x,M.y)&&pn(M.prev,M,M.next)>=0)return!1;M=M.prevZ}for(;P&&P.z<=I;){if(P!==o.prev&&P!==o.next&&Ns(h.x,h.y,f.x,f.y,_.x,_.y,P.x,P.y)&&pn(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Kf(o,n,s){var l=o;do{var h=l.prev,f=l.next.next;!Ma(h,f)&&pp(h,l,l.next,f)&&Vh(h,f)&&Vh(f,h)&&(n.push(h.i/s),n.push(l.i/s),n.push(f.i/s),Dl(l),Dl(l.next),l=o=f),l=l.next}while(l!==o);return El(l)}function Zg(o,n,s,l,h,f){var _=o;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&Jf(_,x)){var w=Jg(_,x);return _=El(_,_.next),w=El(w,w.next),Nh(_,n,s,l,h,f),void Nh(w,n,s,l,h,f)}x=x.next}_=_.next}while(_!==o)}function Wg(o,n){return o.x-n.x}function Xg(o,n){var s=function(f,_){var x,w=_,T=f.x,I=f.y,M=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var P=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=T&&P>M){if(M=P,P===T){if(I===w.y)return w;if(I===w.next.y)return w.next}x=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!x)return null;if(T===M)return x;var z,N=x,$=x.x,K=x.y,te=1/0;w=x;do{T>=w.x&&w.x>=$&&T!==w.x&&Ns(I<K?T:M,I,$,K,I<K?M:T,I,w.x,w.y)&&(z=Math.abs(I-w.y)/(T-w.x),Vh(w,f)&&(z<te||z===te&&(w.x>x.x||w.x===x.x&&Kg(x,w)))&&(x=w,te=z)),w=w.next}while(w!==N);return x}(o,n);if(!s)return n;var l=Jg(s,o),h=El(s,s.next);return El(l,l.next),n===s?h:n}function Kg(o,n){return pn(o.prev,o,n.prev)<0&&pn(n.next,o,o.next)<0}function Yf(o,n,s,l,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-s)*h)|o<<8))|o<<4))|o<<2))|o<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-l)*h)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Yg(o){var n=o,s=o;do{(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next}while(n!==o);return s}function Ns(o,n,s,l,h,f,_,x){return(h-_)*(n-x)-(o-_)*(f-x)>=0&&(o-_)*(l-x)-(s-_)*(n-x)>=0&&(s-_)*(f-x)-(h-_)*(l-x)>=0}function Jf(o,n){return o.next.i!==n.i&&o.prev.i!==n.i&&!function(s,l){var h=s;do{if(h.i!==s.i&&h.next.i!==s.i&&h.i!==l.i&&h.next.i!==l.i&&pp(h,h.next,s,l))return!0;h=h.next}while(h!==s);return!1}(o,n)&&(Vh(o,n)&&Vh(n,o)&&function(s,l){var h=s,f=!1,_=(s.x+l.x)/2,x=(s.y+l.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next}while(h!==s);return f}(o,n)&&(pn(o.prev,o,n.prev)||pn(o,n.prev,n))||Ma(o,n)&&pn(o.prev,o,o.next)>0&&pn(n.prev,n,n.next)>0)}function pn(o,n,s){return(n.y-o.y)*(s.x-n.x)-(n.x-o.x)*(s.y-n.y)}function Ma(o,n){return o.x===n.x&&o.y===n.y}function pp(o,n,s,l){var h=ku(pn(o,n,s)),f=ku(pn(o,n,l)),_=ku(pn(s,l,o)),x=ku(pn(s,l,n));return h!==f&&_!==x||!(0!==h||!Pu(o,s,n))||!(0!==f||!Pu(o,l,n))||!(0!==_||!Pu(s,o,l))||!(0!==x||!Pu(s,n,l))}function Pu(o,n,s){return n.x<=Math.max(o.x,s.x)&&n.x>=Math.min(o.x,s.x)&&n.y<=Math.max(o.y,s.y)&&n.y>=Math.min(o.y,s.y)}function ku(o){return o>0?1:o<0?-1:0}function Vh(o,n){return pn(o.prev,o,o.next)<0?pn(o,n,o.next)>=0&&pn(o,o.prev,n)>=0:pn(o,n,o.prev)<0||pn(o,o.next,n)<0}function Jg(o,n){var s=new Ru(o.i,o.x,o.y),l=new Ru(n.i,n.x,n.y),h=o.next,f=n.prev;return o.next=n,n.prev=o,s.next=h,h.prev=s,l.next=s,s.prev=l,f.next=l,l.prev=f,l}function Qg(o,n,s,l){var h=new Ru(o,n,s);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Dl(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Ru(o,n,s){this.i=o,this.x=n,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Lu(o,n,s,l){for(var h=0,f=n,_=s-l;f<s;f+=l)h+=(o[_]-o[f])*(o[f+1]+o[_+1]),_=f;return h}function Fv(o,n,s,l,h){e_(o,n,s||0,l||o.length-1,h||t_)}function e_(o,n,s,l,h){for(;l>s;){if(l-s>600){var f=l-s+1,_=n-s+1,x=Math.log(f),w=.5*Math.exp(2*x/3),T=.5*Math.sqrt(x*w*(f-w)/f)*(_-f/2<0?-1:1);e_(o,n,Math.max(s,Math.floor(n-_*w/f+T)),Math.min(l,Math.floor(n+(f-_)*w/f+T)),h)}var I=o[n],M=s,P=l;for(Lc(o,s,n),h(o[l],I)>0&&Lc(o,s,l);M<P;){for(Lc(o,M,P),M++,P--;h(o[M],I)<0;)M++;for(;h(o[P],I)>0;)P--}0===h(o[s],I)?Lc(o,s,P):Lc(o,++P,l),P<=n&&(s=P+1),n<=P&&(l=P-1)}}function Lc(o,n,s){var l=o[n];o[n]=o[s],o[s]=l}function t_(o,n){return o<n?-1:o>n?1:0}function fp(o,n){const s=o.length;if(s<=1)return[o];const l=[];let h,f;for(let _=0;_<s;_++){const x=Zl(o[_]);0!==x&&(o[_].area=Math.abs(x),void 0===f&&(f=x<0),f===x<0?(h&&l.push(h),h=[o[_]]):h.push(o[_]))}if(h&&l.push(h),n>1)for(let _=0;_<l.length;_++)l[_].length<=n||(Fv(l[_],n,1,l[_].length-1,n_),l[_]=l[_].slice(0,n));return l}function n_(o,n){return n.area-o.area}function mp(o,n,s){const l=s.patternDependencies;let h=!1;for(const f of n){const _=f.paint.get(`${o}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,l[x.to]=!0,l[x.from]=!0)}return h}function Uh(o,n,s,l,h){const f=h.patternDependencies;for(const _ of n){const x=_.paint.get(`${o}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:l-1},s,{},h.availableImages),T=x.evaluate({zoom:l},s,{},h.availableImages),I=x.evaluate({zoom:l+1},s,{},h.availableImages);w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,I=I&&I.name?I.name:I,f[w]=!0,f[T]=!0,f[I]=!0,s.patterns[_.id]={min:w,mid:T,max:I}}}return s}Bh.deviation=function(o,n,s,l){var h=n&&n.length,f=Math.abs(Lu(o,0,h?n[0]*s:o.length,s));if(h)for(var _=0,x=n.length;_<x;_++)f-=Math.abs(Lu(o,n[_]*s,_<x-1?n[_+1]*s:o.length,s));var w=0;for(_=0;_<l.length;_+=3){var T=l[_]*s,I=l[_+1]*s,M=l[_+2]*s;w+=Math.abs((o[T]-o[M])*(o[I+1]-o[T+1])-(o[T]-o[I])*(o[M+1]-o[T+1]))}return 0===f&&0===w?0:Math.abs((w-f)/f)},Bh.flatten=function(o){for(var n=o[0][0].length,s={vertices:[],holes:[],dimensions:n},l=0,h=0;h<o.length;h++){for(var f=0;f<o[h].length;f++)for(var _=0;_<n;_++)s.vertices.push(o[h][f][_]);h>0&&s.holes.push(l+=o[h-1].length)}return s},Ro.default=Au;class Tl{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Je,this.indexArray=new Pn,this.indexArray2=new Dn,this.programConfigurations=new Tc(n.layers,n.zoom),this.segments=new pr,this.segments2=new pr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){this.hasPattern=mp("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:w,index:T,sourceLayerIndex:I}of n){const M=this.layers[0]._featureFilter.needGeometry,P=as(x,M);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),P,l))continue;const z=f?f.evaluate(P,{},l,s.availableImages):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:M?P.geometry:ko(x,l,h),patterns:{},sortKey:z};_.push(N)}f&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const M=Uh("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(M)}else this.addFeature(x,w,T,l,{},s.availableImages);s.featureIndex.insert(n[T].feature,w,T,I,this.index)}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}addFeatures(n,s,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Hg),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,l,h,f,_=[]){for(const x of fp(s,500)){let w=0;for(const N of x)w+=N.length;const T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=T.vertexLength,M=[],P=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&P.push(M.length/2);const $=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),K=$.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(K+N.length-1,K),M.push(N[0].x),M.push(N[0].y);for(let te=1;te<N.length;te++)this.layoutVertexArray.emplaceBack(N[te].x,N[te].y),this.indexArray2.emplaceBack(K+te-1,K+te),M.push(N[te].x),M.push(N[te].y);$.vertexLength+=N.length,$.primitiveLength+=N.length}const z=Ro(M,P);for(let N=0;N<z.length;N+=3)this.indexArray.emplaceBack(I+z[N],I+z[N+1],I+z[N+2]);T.vertexLength+=w,T.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,_,h)}}Ye("FillBucket",Tl,{omit:["layers","patternFeatures"]});const r_=new Ce({"fill-sort-key":new ie(de.layout_fill["fill-sort-key"])});var gp={paint:new Ce({"fill-antialias":new W(de.paint_fill["fill-antialias"]),"fill-opacity":new ie(de.paint_fill["fill-opacity"]),"fill-color":new ie(de.paint_fill["fill-color"]),"fill-outline-color":new ie(de.paint_fill["fill-outline-color"]),"fill-translate":new W(de.paint_fill["fill-translate"]),"fill-translate-anchor":new W(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new ae(de.paint_fill["fill-pattern"])}),layout:r_};const i_=ve([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),fr=ve([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:o_}=i_;var Qf=Cl;function Cl(o,n,s,l,h){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=l,this._values=h,o.readFields(em,this,n)}function em(o,n,s){1==o?n.id=s.readVarint():2==o?function(l,h){for(var f=l.readVarint()+l.pos;l.pos<f;){var _=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[_]=x}}(s,n):3==o?n.type=s.readVarint():4==o&&(n._geometry=s.pos)}function s_(o){for(var n,s,l=0,h=0,f=o.length,_=f-1;h<f;_=h++)l+=((s=o[_]).x-(n=o[h]).x)*(n.y+s.y);return l}Cl.types=["Unknown","Point","LineString","Polygon"],Cl.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var n,s=o.readVarint()+o.pos,l=1,h=0,f=0,_=0,x=[];o.pos<s;){if(h<=0){var w=o.readVarint();l=7&w,h=w>>3}if(h--,1===l||2===l)f+=o.readSVarint(),_+=o.readSVarint(),1===l&&(n&&x.push(n),n=[]),n.push(new Ie(f,_));else{if(7!==l)throw new Error("unknown command "+l);n&&n.push(n[0].clone())}}return n&&x.push(n),x},Cl.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var n=o.readVarint()+o.pos,s=1,l=0,h=0,f=0,_=1/0,x=-1/0,w=1/0,T=-1/0;o.pos<n;){if(l<=0){var I=o.readVarint();s=7&I,l=I>>3}if(l--,1===s||2===s)(h+=o.readSVarint())<_&&(_=h),h>x&&(x=h),(f+=o.readSVarint())<w&&(w=f),f>T&&(T=f);else if(7!==s)throw new Error("unknown command "+s)}return[_,w,x,T]},Cl.prototype.toGeoJSON=function(o,n,s){var l,h,f=this.extent*Math.pow(2,s),_=this.extent*o,x=this.extent*n,w=this.loadGeometry(),T=Cl.types[this.type];function I(z){for(var N=0;N<z.length;N++){var $=z[N];z[N]=[360*($.x+_)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*($.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(l=0;l<w.length;l++)M[l]=w[l][0];I(w=M);break;case 2:for(l=0;l<w.length;l++)I(w[l]);break;case 3:for(w=function(z){var N=z.length;if(N<=1)return[z];for(var $,K,te=[],se=0;se<N;se++){var ue=s_(z[se]);0!==ue&&(void 0===K&&(K=ue<0),K===ue<0?($&&te.push($),$=[z[se]]):$.push(z[se]))}return $&&te.push($),te}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)I(w[l][h])}1===w.length?w=w[0]:T="Multi"+T;var P={type:"Feature",geometry:{type:T,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var tm=nm;function nm(o,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(a_,this,n),this.length=this._features.length}function a_(o,n,s){15===o?n.version=s.readVarint():1===o?n.name=s.readString():5===o?n.extent=s.readVarint():2===o?n._features.push(s.pos):3===o?n._keys.push(s.readString()):4===o&&n._values.push(function(l){for(var h=null,f=l.readVarint()+l.pos;l.pos<f;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(s))}function l_(o,n,s){if(3===o){var l=new tm(s,s.readVarint()+s.pos);l.length&&(n[l.name]=l)}}nm.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var n=this._pbf.readVarint()+this._pbf.pos;return new Qf(this._pbf,n,this.extent,this._keys,this._values)};var Fc={VectorTile:function(o,n){this.layers=o.readFields(l_,{},n)},VectorTileFeature:Qf,VectorTileLayer:tm};const Ov=Fc.VectorTileFeature.types,Fu=Math.pow(2,13);function Sr(o,n,s,l,h,f,_,x){o.emplaceBack((n<<1)+_,(s<<1)+f,(Math.floor(l*Fu)<<1)+h,Math.round(x))}class jh{constructor(){this.acc=new Ie(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ie(n.x,n.y),this.max=new Ie(n.x,n.y))}append(n,s){this.currentPolyCount.edges++,this.acc._add(n);let l=!!this.borders;const h=this.min,f=this.max;n.x<h.x?(h.x=n.x,l=!0):n.x>f.x&&(f.x=n.x,l=!0),n.y<h.y?(h.y=n.y,l=!0):n.y>f.y&&(f.y=n.y,l=!0),((0===n.x||n.x===Rt)&&n.x===s.x)!=((0===n.y||n.y===Rt)&&n.y===s.y)&&this.processBorderOverlap(n,s),l&&this.checkBorderIntersection(n,s)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,Jt(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>Rt!=n.x>Rt&&this.addBorderIntersection(1,Jt(s.y,n.y,(Rt-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,Jt(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>Rt!=n.y>Rt&&this.addBorderIntersection(3,Jt(s.x,n.x,(Rt-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[n];s<l[0]&&(l[0]=s),s>l[1]&&(l[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const l=0===n.x?0:1;this.addBorderIntersection(l,s.y),this.addBorderIntersection(l,n.y)}else{const l=0===n.y?2:3;this.addBorderIntersection(l,s.x),this.addBorderIntersection(l,n.x)}}centroid(){const n=this.polyCount.reduce((s,l)=>s+l.edges,0);return 0!==n?this.acc.div(n)._round():new Ie(0,0)}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0)}}class $h{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new lt,this.centroidVertexArray=new kf,this.indexArray=new Pn,this.programConfigurations=new Tc(n.layers,n.zoom),this.segments=new pr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=n.enableTerrain}populate(n,s,l,h){this.features=[],this.hasPattern=mp("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(f){const _=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*_/(_*_+1)/Rt/(1<<f.z)}(l);for(const{feature:f,id:_,index:x,sourceLayerIndex:w}of n){const T=this.layers[0]._featureFilter.needGeometry,I=as(f,T);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),I,l))continue;const M={id:_,sourceLayerIndex:w,index:x,geometry:T?I.geometry:ko(f,l,h),properties:f.properties,type:f.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Uh("fill-extrusion",this.layers,M,this.zoom,s)):this.addFeature(M,M.geometry,x,l,{},s.availableImages),s.featureIndex.insert(f,M.geometry,x,w,this.index,P)}this.sortBorders()}addFeatures(n,s,l,h){for(const f of this.features){const{geometry:_}=f;this.addFeature(f,_,f.index,s,l,h)}this.sortBorders()}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,o_),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,fr.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,l,h,f,_){const x=this.enableTerrain?new jh:null;for(const T of fp(s,500)){let I=0,M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(w=T[0]).every(K=>K.x<=0)||w.every(K=>K.x>=Rt)||w.every(K=>K.y<=0)||w.every(K=>K.y>=Rt))continue;for(let K=0;K<T.length;K++){const te=T[K];if(0===te.length)continue;I+=te.length;let se=0;x&&x.startRing(te[0]);for(let ue=0;ue<te.length;ue++){const pe=te[ue];if(ue>=1){const he=te[ue-1];if(!rm(pe,he)){x&&x.append(pe,he),M.vertexLength+4>pr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const fe=pe.sub(he)._perp(),Me=fe.x/(Math.abs(fe.x)+Math.abs(fe.y)),Ee=fe.y>0?1:0,Ze=he.dist(pe);se+Ze>32768&&(se=0),Sr(this.layoutVertexArray,pe.x,pe.y,Me,Ee,0,0,se),Sr(this.layoutVertexArray,pe.x,pe.y,Me,Ee,0,1,se),se+=Ze,Sr(this.layoutVertexArray,he.x,he.y,Me,Ee,0,0,se),Sr(this.layoutVertexArray,he.x,he.y,Me,Ee,0,1,se);const Oe=M.vertexLength;this.indexArray.emplaceBack(Oe,Oe+2,Oe+1),this.indexArray.emplaceBack(Oe+1,Oe+2,Oe+3),M.vertexLength+=4,M.primitiveLength+=2}}}}if(M.vertexLength+I>pr.MAX_VERTEX_ARRAY_LENGTH&&(M=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==Ov[n.type])continue;const P=[],z=[],N=M.vertexLength;for(let K=0;K<T.length;K++){const te=T[K];if(0!==te.length){te!==T[0]&&z.push(P.length/2);for(let se=0;se<te.length;se++){const ue=te[se];Sr(this.layoutVertexArray,ue.x,ue.y,0,0,1,1,0),P.push(ue.x),P.push(ue.y),x&&x.currentPolyCount.top++}}}const $=Ro(P,z);for(let K=0;K<$.length;K+=3)this.indexArray.emplaceBack(N+$[K],N+$[K+2],N+$[K+1]);M.primitiveLength+=$.length/3,M.vertexLength+=I}var w;if(x&&x.polyCount.length>0){if(x.borders){x.vertexArrayOffset=this.centroidVertexArray.length;const T=x.borders,I=this.featuresOnBorder.push(x)-1;for(let M=0;M<4;M++)T[M][0]!==Number.MAX_VALUE&&this.borders[M].push(I)}this.encodeCentroid(x.borders?void 0:x.centroid(),x)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,_,h)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((s,l)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[l].borders[n][0])}encodeCentroid(n,s,l=!0){let h,f;if(n)if(0!==n.y){const x=s.span()._mult(this.tileToMeter);h=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(n.x+450)),f=0;else h=0,f=+l;let _=l?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(_++,0,f),this.centroidVertexArray.emplace(_++,h,f);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(_++,h,f)}}}function rm(o,n){return o.x===n.x&&(o.x<0||o.x>Rt)||o.y===n.y&&(o.y<0||o.y>Rt)}Ye("FillExtrusionBucket",$h,{omit:["layers","features"]}),Ye("PartMetadata",jh);var li={paint:new Ce({"fill-extrusion-opacity":new W(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ie(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new W(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new W(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ae(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ie(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ie(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new W(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Vs(o,n){return o.x*n.x+o.y*n.y}function Gh(o,n){if(1===o.length){let s=0;const l=n[s++];let h;for(;!h||l.equals(h);)if(h=n[s++],!h)return 1/0;for(;s<n.length;s++){const f=n[s],_=o[0],x=h.sub(l),w=f.sub(l),T=_.sub(l),I=Vs(x,x),M=Vs(x,w),P=Vs(w,w),z=Vs(T,x),N=Vs(T,w),$=I*P-M*M,K=(P*z-M*N)/$,te=(I*N-M*z)/$,se=l.z*(1-K-te)+h.z*K+f.z*te;if(isFinite(se))return se}return 1/0}{let s=1/0;for(const l of n)s=Math.min(s,l.z);return s}}function im(o){const n=new Ie(o[0],o[1]);return n.z=o[2],n}function c_(o,n,s,l,h,f,_,x){const w=_*h.getElevationAt(o,n,!0,!0),T=0!==f[0],I=T?0===f[1]?_*(f[0]/7-450):_*function(M,P,z){const N=Math.floor(P[0]/8),$=Math.floor(P[1]/8),K=10*(P[0]-8*N),te=10*(P[1]-8*$),se=M.getElevationAt(N,$,!0,!0),ue=M.getMeterToDEM(z),pe=Math.floor(.5*(K*ue-1)),he=Math.floor(.5*(te*ue-1)),fe=M.tileCoordToPixel(N,$),Me=2*pe+1,Ee=2*he+1,Ze=(gn=Me,ut=Ee,[(Ke=M).getElevationAtPixel(Qe=fe.x-pe,yt=fe.y-he,!0),Ke.getElevationAtPixel(Qe+ut,yt,!0),Ke.getElevationAtPixel(Qe,yt+ut,!0),Ke.getElevationAtPixel(Qe+gn,yt+ut,!0)]),Oe=Math.abs(Ze[0]-Ze[1]),Ae=Math.abs(Ze[2]-Ze[3]),ze=Math.abs(Ze[0]-Ze[2])+Math.abs(Ze[1]-Ze[3]),Ne=Math.min(.25,.5*ue*(Oe+Ae)/Me),ke=Math.min(.25,.5*ue*ze/Ee);var Ke,Qe,yt,gn,ut;return se+Math.max(Ne*K,ke*te)}(h,f,x):w;return{base:w+(0===s)?-1:s,top:T?Math.max(I+l,w+s+2):w+l}}const om=ve([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:u_}=om,sm=ve([{name:"a_packed",components:3,type:"Float32"}]),{members:h_}=sm,am=Fc.VectorTileFeature.types,d_=Math.cos(Math.PI/180*37.5);class Hh{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new ht,this.layoutVertexArray2=new dt,this.indexArray=new Pn,this.programConfigurations=new Tc(n.layers,n.zoom),this.segments=new pr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,l,h){this.hasPattern=mp("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:I,id:M,index:P,sourceLayerIndex:z}of n){const N=this.layers[0]._featureFilter.needGeometry,$=as(I,N);if(!this.layers[0]._featureFilter.filter(new F(this.zoom),$,l))continue;const K=f?f.evaluate($,{},l):void 0,te={id:M,properties:I.properties,type:I.type,sourceLayerIndex:z,index:P,geometry:N?$.geometry:ko(I,l,h),patterns:{},sortKey:K};_.push(te)}f&&_.sort((I,M)=>I.sortKey-M.sortKey);const{lineAtlas:x,featureIndex:w}=s,T=this.addConstantDashes(x);for(const I of _){const{geometry:M,index:P,sourceLayerIndex:z}=I;if(T&&this.addFeatureDashes(I,x),this.hasPattern){const N=Uh("line",this.layers,I,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(I,M,P,l,x.positions,s.availableImages);w.insert(n[P].feature,M,P,z,this.index)}}addConstantDashes(n){let s=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==f.kind)s=!0;else{const _=f.value,x=h.value;if(!x)continue;n.addDash(x.from,_),n.addDash(x.to,_),x.other&&n.addDash(x.other,_)}}return s}addFeatureDashes(n,s){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===_.kind)continue;let x,w,T,I,M,P;if("constant"===f.kind){const K=f.value;if(!K)continue;x=K.other||K.to,w=K.to,T=K.from}else x=f.evaluate({zoom:l-1},n),w=f.evaluate({zoom:l},n),T=f.evaluate({zoom:l+1},n);"constant"===_.kind?I=M=P=_.value:(I=_.evaluate({zoom:l-1},n),M=_.evaluate({zoom:l},n),P=_.evaluate({zoom:l+1},n)),s.addDash(x,I),s.addDash(w,M),s.addDash(T,P);const z=s.getKey(x,I),N=s.getKey(w,M),$=s.getKey(T,P);n.patterns[h.id]={min:z,mid:N,max:$}}}update(n,s,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,l,h)}addFeatures(n,s,l,h){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,s,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,h_)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,u_),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,l,h,f,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(n,{}),T=x.get("line-cap").evaluate(n,{}),I=x.get("line-miter-limit"),M=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const P of s)this.addLine(P,n,w,T,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,l,f,_,h)}addLine(n,s,l,h,f,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let te=0;te<n.length-1;te++)this.totalDistance+=n[te].dist(n[te+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===am[s.type];let w=n.length;for(;w>=2&&n[w-1].equals(n[w-2]);)w--;let T=0;for(;T<w-1&&n[T].equals(n[T+1]);)T++;if(w<(x?3:2))return;"bevel"===l&&(f=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,z,N,$,K;this.e1=this.e2=-1,x&&(P=n[w-2],K=n[T].sub(P)._unit()._perp());for(let te=T;te<w;te++){if(N=te===w-1?x?n[T+1]:void 0:n[te+1],N&&n[te].equals(N))continue;K&&($=K),P&&(z=P),P=n[te],K=N?N.sub(P)._unit()._perp():$,$=$||K;let se=$.add(K);0===se.x&&0===se.y||se._unit();const ue=$.x*K.x+$.y*K.y,pe=se.x*K.x+se.y*K.y,he=0!==pe?1/pe:1/0,fe=2*Math.sqrt(2-2*pe),Me=pe<d_&&z&&N,Ee=$.x*K.y-$.y*K.x>0;if(Me&&te>T){const Ae=P.dist(z);if(Ae>2*I){const ze=P.sub(P.sub(z)._mult(I/Ae)._round());this.updateDistance(z,ze),this.addCurrentVertex(ze,$,0,0,M),z=ze}}const Ze=z&&N;let Oe=Ze?l:x?"butt":h;if(Ze&&"round"===Oe&&(he<_?Oe="miter":he<=2&&(Oe="fakeround")),"miter"===Oe&&he>f&&(Oe="bevel"),"bevel"===Oe&&(he>2&&(Oe="flipbevel"),he<f&&(Oe="miter")),z&&this.updateDistance(z,P),"miter"===Oe)se._mult(he),this.addCurrentVertex(P,se,0,0,M);else if("flipbevel"===Oe){if(he>100)se=K.mult(-1);else{const Ae=he*$.add(K).mag()/$.sub(K).mag();se._perp()._mult(Ae*(Ee?-1:1))}this.addCurrentVertex(P,se,0,0,M),this.addCurrentVertex(P,se.mult(-1),0,0,M)}else if("bevel"===Oe||"fakeround"===Oe){const Ae=-Math.sqrt(he*he-1),ze=Ee?Ae:0,Ne=Ee?0:Ae;if(z&&this.addCurrentVertex(P,$,ze,Ne,M),"fakeround"===Oe){const ke=Math.round(180*fe/Math.PI/20);for(let Ke=1;Ke<ke;Ke++){let Qe=Ke/ke;if(.5!==Qe){const gn=Qe-.5;Qe+=Qe*gn*(Qe-1)*((1.0904+ue*(ue*(3.55645-1.43519*ue)-3.2452))*gn*gn+(.848013+ue*(.215638*ue-1.06021)))}const yt=K.sub($)._mult(Qe)._add($)._unit()._mult(Ee?-1:1);this.addHalfVertex(P,yt.x,yt.y,!1,Ee,0,M)}}N&&this.addCurrentVertex(P,K,-ze,-Ne,M)}else if("butt"===Oe)this.addCurrentVertex(P,se,0,0,M);else if("square"===Oe){const Ae=z?1:-1;z||this.addCurrentVertex(P,se,Ae,Ae,M),this.addCurrentVertex(P,se,0,0,M),z&&this.addCurrentVertex(P,se,Ae,Ae,M)}else"round"===Oe&&(z&&(this.addCurrentVertex(P,$,0,0,M),this.addCurrentVertex(P,$,1,1,M,!0)),N&&(this.addCurrentVertex(P,K,-1,-1,M,!0),this.addCurrentVertex(P,K,0,0,M)));if(Me&&te<w-1){const Ae=P.dist(N);if(Ae>2*I){const ze=P.add(N.sub(P)._mult(I/Ae)._round());this.updateDistance(P,ze),this.addCurrentVertex(ze,K,0,0,M),P=ze}}}}addCurrentVertex(n,s,l,h,f,_=!1){const x=s.y*h-s.x,w=-s.y-s.x*h;this.addHalfVertex(n,s.x+s.y*l,s.y-s.x*l,_,!1,l,f),this.addHalfVertex(n,x,w,_,!0,-h,f)}addHalfVertex({x:n,y:s},l,h,f,_,x,w){this.layoutVertexArray.emplaceBack((n<<1)+(f?1:0),(s<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const T=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,T),w.primitiveLength++),_?this.e2=T:this.e1=T}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}Ye("LineBucket",Hh,{omit:["layers","patternFeatures"]});const p_=new Ce({"line-cap":new ie(de.layout_line["line-cap"]),"line-join":new ie(de.layout_line["line-join"]),"line-miter-limit":new W(de.layout_line["line-miter-limit"]),"line-round-limit":new W(de.layout_line["line-round-limit"]),"line-sort-key":new ie(de.layout_line["line-sort-key"])});var qh={paint:new Ce({"line-opacity":new ie(de.paint_line["line-opacity"]),"line-color":new ie(de.paint_line["line-color"]),"line-translate":new W(de.paint_line["line-translate"]),"line-translate-anchor":new W(de.paint_line["line-translate-anchor"]),"line-width":new ie(de.paint_line["line-width"]),"line-gap-width":new ie(de.paint_line["line-gap-width"]),"line-offset":new ie(de.paint_line["line-offset"]),"line-blur":new ie(de.paint_line["line-blur"]),"line-dasharray":new ae(de.paint_line["line-dasharray"]),"line-pattern":new ae(de.paint_line["line-pattern"]),"line-gradient":new xe(de.paint_line["line-gradient"])}),layout:p_};const lm=new class extends ie{possiblyEvaluate(o,n){return n=new F(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(o,n)}evaluate(o,n,s,l){return n=Vn({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(o,n,s,l)}}(qh.paint.properties["line-width"].specification);function cm(o,n){return n>0?n+2*o:o}lm.useIntegerZoom=!0;const zv=ve([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),_p=ve([{name:"a_projected_pos",components:3,type:"Float32"}],4);ve([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const f_=ve([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),m_=ve([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Sl=ve([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),g_=ve([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ve([{name:"triangle",components:3,type:"Uint16"}]),ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ve([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ve([{type:"Float32",name:"offsetX"}]),ve([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ls=128;function yp(o,n){const{expression:s}=n;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new F(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=s;let f=0;for(;f<l.length&&l[f]<=o;)f++;f=Math.max(0,f-1);let _=f;for(;_<l.length&&l[_]<o+1;)_++;_=Math.min(l.length-1,_);const x=l[f],w=l[_];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:s.evaluate(new F(x)),maxSize:s.evaluate(new F(w)),interpolationType:h}}}function Zh(o,{uSize:n,uSizeT:s},{lowerSize:l,upperSize:h}){return"source"===o.kind?l/ls:"composite"===o.kind?Jt(l/ls,h/ls,s):n}function Il(o,n){let s=0,l=0;if("constant"===o.kind)l=o.layoutSize;else if("source"!==o.kind){const{interpolationType:h,minZoom:f,maxZoom:_}=o,x=h?en(pi.interpolationFactor(h,n,f,_),0,1):0;"camera"===o.kind?l=Jt(o.minSize,o.maxSize,x):s=x}return{uSizeT:s,uSize:l}}var __=Object.freeze({__proto__:null,getSizeData:yp,evaluateSizeForFeature:Zh,evaluateSizeForZoom:Il,SIZE_PACK_FACTOR:ls});function y_(o,n,s){return o.sections.forEach(l=>{l.text=function(h,f,_){const x=f.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),L.applyArabicShaping&&(h=L.applyArabicShaping(h)),h}(l.text,n,s)}),o}const Ou={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function v_(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function um(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var hm=function(o,n,s,l,h){var f,_,x=8*h-l-1,w=(1<<x)-1,T=w>>1,I=-7,M=s?h-1:0,P=s?-1:1,z=o[n+M];for(M+=P,f=z&(1<<-I)-1,z>>=-I,I+=x;I>0;f=256*f+o[n+M],M+=P,I-=8);for(_=f&(1<<-I)-1,f>>=-I,I+=l;I>0;_=256*_+o[n+M],M+=P,I-=8);if(0===f)f=1-T;else{if(f===w)return _?NaN:1/0*(z?-1:1);_+=Math.pow(2,l),f-=T}return(z?-1:1)*_*Math.pow(2,f-l)},dm=function(o,n,s,l,h,f){var _,x,w,T=8*f-h-1,I=(1<<T)-1,M=I>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,z=l?0:f-1,N=l?1:-1,$=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(x=isNaN(n)?1:0,_=I):(_=Math.floor(Math.log(n)/Math.LN2),n*(w=Math.pow(2,-_))<1&&(_--,w*=2),(n+=_+M>=1?P/w:P*Math.pow(2,1-M))*w>=2&&(_++,w/=2),_+M>=I?(x=0,_=I):_+M>=1?(x=(n*w-1)*Math.pow(2,h),_+=M):(x=n*Math.pow(2,M-1)*Math.pow(2,h),_=0));h>=8;o[s+z]=255&x,z+=N,x/=256,h-=8);for(_=_<<h|x,T+=h;T>0;o[s+z]=255&_,z+=N,_/=256,T-=8);o[s+z-N]|=128*$},zu=Zt;function Zt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Zt.Varint=0,Zt.Fixed64=1,Zt.Bytes=2,Zt.Fixed32=5;var fo=4294967296,x_=1/fo,b_="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function cs(o){return o.type===Zt.Bytes?o.readVarint()+o.pos:o.pos+1}function Mi(o,n,s){var l=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(l);for(var h=s.pos-1;h>=o;h--)s.buf[h+l]=s.buf[h]}function vp(o,n){for(var s=0;s<o.length;s++)n.writeVarint(o[s])}function xp(o,n){for(var s=0;s<o.length;s++)n.writeSVarint(o[s])}function w_(o,n){for(var s=0;s<o.length;s++)n.writeFloat(o[s])}function pm(o,n){for(var s=0;s<o.length;s++)n.writeDouble(o[s])}function Nu(o,n){for(var s=0;s<o.length;s++)n.writeBoolean(o[s])}function fm(o,n){for(var s=0;s<o.length;s++)n.writeFixed32(o[s])}function mm(o,n){for(var s=0;s<o.length;s++)n.writeSFixed32(o[s])}function bp(o,n){for(var s=0;s<o.length;s++)n.writeFixed64(o[s])}function wp(o,n){for(var s=0;s<o.length;s++)n.writeSFixed64(o[s])}function Vu(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+16777216*o[n+3]}function Uu(o,n,s){o[s]=n,o[s+1]=n>>>8,o[s+2]=n>>>16,o[s+3]=n>>>24}function Ml(o,n){return(o[n]|o[n+1]<<8|o[n+2]<<16)+(o[n+3]<<24)}function Ep(o,n,s){n.glyphs=[],1===o&&s.readMessage(gm,n)}function gm(o,n,s){if(3===o){const{id:l,bitmap:h,width:f,height:_,left:x,top:w,advance:T}=s.readMessage(E_,{});n.glyphs.push({id:l,bitmap:new Bs({width:f+6,height:_+6},h),metrics:{width:f,height:_,left:x,top:w,advance:T}})}else 4===o?n.ascender=s.readSVarint():5===o&&(n.descender=s.readSVarint())}function E_(o,n,s){1===o?n.id=s.readVarint():2===o?n.bitmap=s.readBytes():3===o?n.width=s.readVarint():4===o?n.height=s.readVarint():5===o?n.left=s.readSVarint():6===o?n.top=s.readSVarint():7===o&&(n.advance=s.readVarint())}function ju(o){let n=0,s=0;for(const _ of o)n+=_.w*_.h,s=Math.max(s,_.w);o.sort((_,x)=>x.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let h=0,f=0;for(const _ of o)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,f=Math.max(f,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const T=l.pop();x<l.length&&(l[x]=T)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:f,fill:n/(h*f)||0}}Zt.prototype={destroy:function(){this.buf=null},readFields:function(o,n,s){for(s=s||this.length;this.pos<s;){var l=this.readVarint(),h=l>>3,f=this.pos;this.type=7&l,o(h,n,this),this.pos===f&&this.skip(l)}return n},readMessage:function(o,n){return this.readFields(o,n,this.readVarint()+this.pos)},readFixed32:function(){var o=Vu(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=Ml(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Vu(this.buf,this.pos)+Vu(this.buf,this.pos+4)*fo;return this.pos+=8,o},readSFixed64:function(){var o=Vu(this.buf,this.pos)+Ml(this.buf,this.pos+4)*fo;return this.pos+=8,o},readFloat:function(){var o=hm(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=hm(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var n,s,l=this.buf;return n=127&(s=l[this.pos++]),s<128?n:(n|=(127&(s=l[this.pos++]))<<7,s<128?n:(n|=(127&(s=l[this.pos++]))<<14,s<128?n:(n|=(127&(s=l[this.pos++]))<<21,s<128?n:function(h,f,_){var x,w,T=_.buf;if(x=(112&(w=T[_.pos++]))>>4,w<128||(x|=(127&(w=T[_.pos++]))<<3,w<128)||(x|=(127&(w=T[_.pos++]))<<10,w<128)||(x|=(127&(w=T[_.pos++]))<<17,w<128)||(x|=(127&(w=T[_.pos++]))<<24,w<128)||(x|=(1&(w=T[_.pos++]))<<31,w<128))return function Bu(o,n,s){return s?4294967296*n+(o>>>0):4294967296*(n>>>0)+(o>>>0)}(h,x,f);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(s=l[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,n=this.pos;return this.pos=o,o-n>=12&&b_?b_.decode(this.buf.subarray(n,o)):function(s,l,h){for(var f="",_=l;_<h;){var x,w,T,I=s[_],M=null,P=I>239?4:I>223?3:I>191?2:1;if(_+P>h)break;1===P?I<128&&(M=I):2===P?128==(192&(x=s[_+1]))&&(M=(31&I)<<6|63&x)<=127&&(M=null):3===P?(w=s[_+2],128==(192&(x=s[_+1]))&&128==(192&w)&&((M=(15&I)<<12|(63&x)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):4===P&&(w=s[_+2],T=s[_+3],128==(192&(x=s[_+1]))&&128==(192&w)&&128==(192&T)&&((M=(15&I)<<18|(63&x)<<12|(63&w)<<6|63&T)<=65535||M>=1114112)&&(M=null)),null===M?(M=65533,P=1):M>65535&&(M-=65536,f+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),f+=String.fromCharCode(M),_+=P}return f}(this.buf,n,o)},readBytes:function(){var o=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,o);return this.pos=o,n},readPackedVarint:function(o,n){if(this.type!==Zt.Bytes)return o.push(this.readVarint(n));var s=cs(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(n));return o},readPackedSVarint:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSVarint());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Zt.Bytes)return o.push(this.readBoolean());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFloat());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Zt.Bytes)return o.push(this.readDouble());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed32());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed32());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readFixed64());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Zt.Bytes)return o.push(this.readSFixed64());var n=cs(this);for(o=o||[];this.pos<n;)o.push(this.readSFixed64());return o},skip:function(o){var n=7&o;if(n===Zt.Varint)for(;this.buf[this.pos++]>127;);else if(n===Zt.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Zt.Fixed32)this.pos+=4;else{if(n!==Zt.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(o,n){this.writeVarint(o<<3|n)},realloc:function(o){for(var n=this.length||16;n<this.pos+o;)n*=2;if(n!==this.length){var s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Uu(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Uu(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Uu(this.buf,-1&o,this.pos),Uu(this.buf,Math.floor(o*x_),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Uu(this.buf,-1&o,this.pos),Uu(this.buf,Math.floor(o*x_),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(n,s){var l,h,f,x;if(n>=0?(l=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(l=~(-n%4294967296))?l=l+1|0:(l=0,h=h+1|0)),n>=0x10000000000000000||n<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),f=l,(x=s).buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7),function(f,_){var x=(7&f)<<4;_.buf[_.pos++]|=x|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))}(h,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var n=this.pos;this.pos=function(l,h,f){for(var _,x,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!x){_>56319||w+1===h.length?(l[f++]=239,l[f++]=191,l[f++]=189):x=_;continue}if(_<56320){l[f++]=239,l[f++]=191,l[f++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(l[f++]=239,l[f++]=191,l[f++]=189,x=null);_<128?l[f++]=_:(_<2048?l[f++]=_>>6|192:(_<65536?l[f++]=_>>12|224:(l[f++]=_>>18|240,l[f++]=_>>12&63|128),l[f++]=_>>6&63|128),l[f++]=63&_|128)}return f}(this.buf,o,this.pos);var s=this.pos-n;s>=128&&Mi(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),dm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),dm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var n=o.length;this.writeVarint(n),this.realloc(n);for(var s=0;s<n;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,n){this.pos++;var s=this.pos;o(n,this);var l=this.pos-s;l>=128&&Mi(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l},writeMessage:function(o,n,s){this.writeTag(o,Zt.Bytes),this.writeRawMessage(n,s)},writePackedVarint:function(o,n){n.length&&this.writeMessage(o,vp,n)},writePackedSVarint:function(o,n){n.length&&this.writeMessage(o,xp,n)},writePackedBoolean:function(o,n){n.length&&this.writeMessage(o,Nu,n)},writePackedFloat:function(o,n){n.length&&this.writeMessage(o,w_,n)},writePackedDouble:function(o,n){n.length&&this.writeMessage(o,pm,n)},writePackedFixed32:function(o,n){n.length&&this.writeMessage(o,fm,n)},writePackedSFixed32:function(o,n){n.length&&this.writeMessage(o,mm,n)},writePackedFixed64:function(o,n){n.length&&this.writeMessage(o,bp,n)},writePackedSFixed64:function(o,n){n.length&&this.writeMessage(o,wp,n)},writeBytesField:function(o,n){this.writeTag(o,Zt.Bytes),this.writeBytes(n)},writeFixed32Field:function(o,n){this.writeTag(o,Zt.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(o,n){this.writeTag(o,Zt.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(o,n){this.writeTag(o,Zt.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(o,n){this.writeTag(o,Zt.Fixed64),this.writeSFixed64(n)},writeVarintField:function(o,n){this.writeTag(o,Zt.Varint),this.writeVarint(n)},writeSVarintField:function(o,n){this.writeTag(o,Zt.Varint),this.writeSVarint(n)},writeStringField:function(o,n){this.writeTag(o,Zt.Bytes),this.writeString(n)},writeFloatField:function(o,n){this.writeTag(o,Zt.Fixed32),this.writeFloat(n)},writeDoubleField:function(o,n){this.writeTag(o,Zt.Fixed64),this.writeDouble(n)},writeBooleanField:function(o,n){this.writeVarintField(o,Boolean(n))}};class Dp{constructor(n,{pixelRatio:s,version:l,stretchX:h,stretchY:f,content:_}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=h,this.stretchY=f,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class _m{constructor(n,s){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(n,l,f),this.addImages(s,h,f);const{w:_,h:x}=ju(f),w=new Ii({width:_||1,height:x||1});for(const T in n){const I=n[T],M=l[T].paddedRect;Ii.copy(I.data,w,{x:0,y:0},{x:M.x+1,y:M.y+1},I.data)}for(const T in s){const I=s[T],M=h[T].paddedRect,P=M.x+1,z=M.y+1,N=I.data.width,$=I.data.height;Ii.copy(I.data,w,{x:0,y:0},{x:P,y:z},I.data),Ii.copy(I.data,w,{x:0,y:$-1},{x:P,y:z-1},{width:N,height:1}),Ii.copy(I.data,w,{x:0,y:0},{x:P,y:z+$},{width:N,height:1}),Ii.copy(I.data,w,{x:N-1,y:0},{x:P-1,y:z},{width:1,height:$}),Ii.copy(I.data,w,{x:0,y:0},{x:P+N,y:z},{width:1,height:$})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(n,s,l){for(const h in n){const f=n[h],_={x:0,y:0,w:f.data.width+2,h:f.data.height+2};l.push(_),s[h]=new Dp(_,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,s){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in n.updatedImages)this.patchUpdatedImage(this.iconPositions[l],n.getImage(l),s),this.patchUpdatedImage(this.patternPositions[l],n.getImage(l),s)}patchUpdatedImage(n,s,l){if(!n||!s||n.version===s.version)return;n.version=s.version;const[h,f]=n.tl;l.update(s.data,void 0,{x:h,y:f})}}Ye("ImagePosition",Dp),Ye("ImageAtlas",_m);const Ui={horizontal:1,vertical:2,horizontalOnly:3};class $u{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const l=new $u;return l.scale=n||1,l.fontStack=s,l}static forImage(n){const s=new $u;return s.imageName=n,s}}class Oc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const l=new Oc;for(let h=0;h<n.sections.length;h++){const f=n.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,s)}return l}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(s,l){let h="";for(let f=0;f<s.length;f++){const _=s.charCodeAt(f+1)||null,x=s.charCodeAt(f-1)||null;h+=!l&&(_&&yu(_)&&!Ou[s[f+1]]||x&&yu(x)&&!Ou[s[f-1]])||!Ou[s[f]]?s[f]:Ou[s[f]]}return h}(this.text,n)}trim(){let n=0;for(let l=0;l<this.text.length&&Gu[this.text.charCodeAt(l)];l++)n++;let s=this.text.length;for(let l=this.text.length-1;l>=0&&l>=n&&Gu[this.text.charCodeAt(l)];l--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const l=new Oc;return l.text=this.text.substring(n,s),l.sectionIndex=this.sectionIndex.slice(n,s),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push($u.forText(n.scale,n.fontStack||s));const l=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(l)}addImageSection(n){const s=n.image?n.image.name:"";if(0===s.length)return void En("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push($u.forImage(s)),this.sectionIndex.push(this.sections.length-1)):En("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tp(o,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$){const K=Oc.fromFeature(o,h);let te;M===Ui.vertical&&K.verticalizePunctuation(P);const{processBidirectionalText:se,processStyledBidirectionalText:ue}=L;if(se&&1===K.sections.length){te=[];const fe=se(K.toString(),Xh(K,T,f,n,l,z,N));for(const Me of fe){const Ee=new Oc;Ee.text=Me,Ee.sections=K.sections;for(let Ze=0;Ze<Me.length;Ze++)Ee.sectionIndex.push(0);te.push(Ee)}}else if(ue){te=[];const fe=ue(K.text,K.sectionIndex,Xh(K,T,f,n,l,z,N));for(const Me of fe){const Ee=new Oc;Ee.text=Me[0],Ee.sectionIndex=Me[1],Ee.sections=K.sections,te.push(Ee)}}else te=function(fe,Me){const Ee=[],Ze=fe.text;let Oe=0;for(const Ae of Me)Ee.push(fe.substring(Oe,Ae)),Oe=Ae;return Oe<Ze.length&&Ee.push(fe.substring(Oe,Ze.length)),Ee}(K,Xh(K,T,f,n,l,z,N));const pe=[],he={positionedLines:pe,text:K.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Me,Ee,Ze,Oe,Ae,ze,Ne,ke,Ke,Qe,yt){let gn=0,ut=0,Wt=0;const He="right"===Ne?1:"left"===Ne?0:.5;let sn=!1;for(const on of Oe){const Ut=on.getSections();for(const Rn of Ut){if(Rn.imageName)continue;const gr=Me[Rn.fontStack];if(gr&&(sn=void 0!==gr.ascender&&void 0!==gr.descender,!sn))break}if(!sn)break}let Xt=0;for(const on of Oe){on.trim();const Ut=on.getMaxScale(),Rn=24*(Ut-1),gr={positionedGlyphs:[],lineOffset:0};fe.positionedLines[Xt]=gr;const Xn=gr.positionedGlyphs;let sr=0;if(!on.length()){ut+=Ae,++Xt;continue}let Ir=0,zn=0;for(let bn=0;bn<on.length();bn++){const tr=on.getSection(bn),Kn=on.getSectionIndex(bn),In=on.getCharCode(bn);let Bn=tr.scale,ar=null,wn=null,nr=null,Oo=24,$i=0;const _o=!(ke===Ui.horizontal||!Qe&&!Vi(In)||Qe&&(Gu[In]||(er=In,vc(er)||Eh(er)||So(er)||co(er)||Da(er))));if(tr.imageName){const Gi=Ze[tr.imageName];if(!Gi)continue;nr=tr.imageName,fe.iconsInText=fe.iconsInText||!0,wn=Gi.paddedRect;const Cn=Gi.displaySize;Bn=24*Bn/yt,ar={width:Cn[0],height:Cn[1],left:1,top:-3,advance:_o?Cn[1]:Cn[0],localGlyph:!1},$i=sn?-ar.height*Bn:24*Ut-17-Cn[1]*Bn,Oo=ar.advance;const zo=(_o?Cn[0]:Cn[1])*Bn-24*Ut;zo>0&&zo>sr&&(sr=zo)}else{const Gi=Ee[tr.fontStack];if(!Gi)continue;Gi[In]&&(wn=Gi[In]);const Cn=Me[tr.fontStack];if(!Cn)continue;const zo=Cn.glyphs[In];if(!zo)continue;if(ar=zo.metrics,Oo=8203!==In?24:0,sn){const zl=void 0!==Cn.ascender?Math.abs(Cn.ascender):0,Bl=void 0!==Cn.descender?Math.abs(Cn.descender):0,Nl=(zl+Bl)*Bn;Ir<Nl&&(Ir=Nl,zn=(zl-Bl)/2*Bn),$i=-zl*Bn}else $i=24*(Ut-Bn)-17}_o?(fe.verticalizable=!0,Xn.push({glyph:In,imageName:nr,x:gn,y:ut+$i,vertical:_o,scale:Bn,localGlyph:ar.localGlyph,fontStack:tr.fontStack,sectionIndex:Kn,metrics:ar,rect:wn}),gn+=Oo*Bn+Ke):(Xn.push({glyph:In,imageName:nr,x:gn,y:ut+$i,vertical:_o,scale:Bn,localGlyph:ar.localGlyph,fontStack:tr.fontStack,sectionIndex:Kn,metrics:ar,rect:wn}),gn+=ar.advance*Bn+Ke)}0!==Xn.length&&(Wt=Math.max(gn-Ke,Wt),sn?Mp(Xn,He,sr,zn,Ae*Ut/2):Mp(Xn,He,sr,0,Ae/2)),gn=0;const Kr=Ae*Ut+sr;gr.lineOffset=Math.max(sr,Rn),ut+=Kr,++Xt}var er;const or=ut,{horizontalAlign:Wn,verticalAlign:mr}=Us(ze);(function(on,Ut,Rn,gr,Xn,sr){const Ir=(Ut-Rn)*Xn,zn=-sr*gr;for(const Kr of on)for(const bn of Kr.positionedGlyphs)bn.x+=Ir,bn.y+=zn})(fe.positionedLines,He,Wn,mr,Wt,or),fe.top+=-mr*or,fe.bottom=fe.top+or,fe.left+=-Wn*Wt,fe.right=fe.left+Wt,fe.hasBaseline=sn}(he,n,s,l,te,_,x,w,M,T,P,$),!function(fe){for(const Me of fe)if(0!==Me.positionedGlyphs.length)return!1;return!0}(pe)&&he}const Gu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cp={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Sp(o,n,s,l,h,f){if(n.imageName){const _=l[n.imageName];return _?_.displaySize[0]*n.scale*24/f+h:0}{const _=s[n.fontStack],x=_&&_.glyphs[o];return x?x.metrics.advance*n.scale+h:0}}function Wh(o,n,s,l){const h=Math.pow(o-n,2);return l?o<n?h/2:2*h:h+Math.abs(s)*s}function D_(o,n,s){let l=0;return 10===o&&(l-=1e4),s&&(l+=150),40!==o&&65288!==o||(l+=50),41!==n&&65289!==n||(l+=50),l}function ym(o,n,s,l,h,f){let _=null,x=Wh(n,s,h,f);for(const w of l){const T=Wh(n-w.x,s,h,f)+w.badness;T<=x&&(_=w,x=T)}return{index:o,x:n,priorBreak:_,badness:x}}function Ip(o){return o?Ip(o.priorBreak).concat(o.index):[]}function Xh(o,n,s,l,h,f,_){if("point"!==f)return[];if(!o)return[];const x=[],w=function(P,z,N,$,K,te){let se=0;for(let ue=0;ue<P.length();ue++){const pe=P.getSection(ue);se+=Sp(P.getCharCode(ue),pe,$,K,z,te)}return se/Math.max(1,Math.ceil(se/N))}(o,n,s,l,h,_),T=o.text.indexOf("\u200b")>=0;let I=0;for(let P=0;P<o.length();P++){const z=o.getSection(P),N=o.getCharCode(P);if(Gu[N]||(I+=Sp(N,z,l,h,n,_)),P<o.length()-1){const $=!((M=N)<11904||!(fu(M)||pu(M)||fl(M)||bc(M)||$t(M)||hu(M)||mu(M)||du(M)||As(M)||On(M)||Be(M)||Er(M)||wa(M)||xt(M)||Ms(M)||gu(M)||xc(M)||Xd(M)||Ea(M)||_u(M)));(Cp[N]||$||z.imageName)&&x.push(ym(P+1,I,w,x,D_(N,o.getCharCode(P+1),$&&T),!1))}}var M;return Ip(ym(o.length(),I,w,x,0,!0))}function Us(o){let n=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function Mp(o,n,s,l,h){if(!(n||s||l||h))return;const f=o.length-1,_=o[f],x=(_.x+_.metrics.advance*_.scale)*n;for(let w=0;w<=f;w++)o[w].x-=x,o[w].y+=s+l+h}function vm(o,n,s){const{horizontalAlign:l,verticalAlign:h}=Us(s),f=n[0]-o.displaySize[0]*l,_=n[1]-o.displaySize[1]*h;return{image:o,top:_,bottom:_+o.displaySize[1],left:f,right:f+o.displaySize[0]}}function xm(o,n,s,l,h,f){const _=o.image;let x;if(_.content){const K=_.content,te=_.pixelRatio||1;x=[K[0]/te,K[1]/te,_.displaySize[0]-K[2]/te,_.displaySize[1]-K[3]/te]}const w=n.left*f,T=n.right*f;let I,M,P,z;"width"===s||"both"===s?(z=h[0]+w-l[3],M=h[0]+T+l[1]):(z=h[0]+(w+T-_.displaySize[0])/2,M=z+_.displaySize[0]);const N=n.top*f,$=n.bottom*f;return"height"===s||"both"===s?(I=h[1]+N-l[0],P=h[1]+$+l[2]):(I=h[1]+(N+$-_.displaySize[1])/2,P=I+_.displaySize[1]),{image:_,top:I,right:M,bottom:P,left:z,collisionPadding:x}}class Lo extends Ie{constructor(n,s,l,h,f){super(n,s),this.angle=h,this.z=l,void 0!==f&&(this.segment=f)}clone(){return new Lo(this.x,this.y,this.z,this.angle,this.segment)}}function bm(o,n,s,l,h){if(void 0===n.segment)return!0;let f=n,_=n.segment+1,x=0;for(;x>-s/2;){if(_--,_<0)return!1;x-=o[_].dist(f),f=o[_]}x+=o[_].dist(o[_+1]),_++;const w=[];let T=0;for(;x<s/2;){const I=o[_],M=o[_+1];if(!M)return!1;let P=o[_-1].angleTo(I)-I.angleTo(M);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:P}),T+=P;x-w[0].distance>l;)T-=w.shift().angleDelta;if(T>h)return!1;_++,x+=I.dist(M)}return!0}function Ap(o){let n=0;for(let s=0;s<o.length-1;s++)n+=o[s].dist(o[s+1]);return n}function Pp(o,n,s){return o?.6*n*s:0}function kp(o,n){return Math.max(o?o.right-o.left:0,n?n.right-n.left:0)}function Rp(o,n,s,l,h,f){const _=Pp(s,h,f),x=kp(s,l)*f;let w=0;const T=Ap(o)/2;for(let I=0;I<o.length-1;I++){const M=o[I],P=o[I+1],z=M.dist(P);if(w+z>T){const N=(T-w)/z,$=Jt(M.x,P.x,N),K=Jt(M.y,P.y,N),te=new Lo($,K,0,P.angleTo(M),I);return!_||bm(o,te,x,_,n)?te:void 0}w+=z}}function wm(o,n,s,l,h,f,_,x,w){const T=Pp(l,f,_),I=kp(l,h),M=I*_,P=0===o[0].x||o[0].x===w||0===o[0].y||o[0].y===w;return n-M<n/4&&(n=M+n/4),Hu(o,P?n/2*x%n:(I/2+2*f)*_*x%n,n,T,s,M,P,!1,w)}function Hu(o,n,s,l,h,f,_,x,w){const T=f/2,I=Ap(o);let M=0,P=n-s,z=[];for(let N=0;N<o.length-1;N++){const $=o[N],K=o[N+1],te=$.dist(K),se=K.angleTo($);for(;P+s<M+te;){P+=s;const ue=(P-M)/te,pe=Jt($.x,K.x,ue),he=Jt($.y,K.y,ue);if(pe>=0&&pe<w&&he>=0&&he<w&&P-T>=0&&P+T<=I){const fe=new Lo(pe,he,0,se,N);fe._round(),l&&!bm(o,fe,f,l,h)||z.push(fe)}}M+=te}return x||z.length||_||(z=Hu(o,M/2,s,l,h,f,_,!0,w)),z}function qu(o,n,s,l,h){const f=[];for(let _=0;_<o.length;_++){const x=o[_];let w;for(let T=0;T<x.length-1;T++){let I=x[T],M=x[T+1];I.x<n&&M.x<n||(I.x<n?I=new Ie(n,I.y+(n-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x<n&&(M=new Ie(n,I.y+(n-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y<s&&M.y<s||(I.y<s?I=new Ie(I.x+(s-I.y)/(M.y-I.y)*(M.x-I.x),s)._round():M.y<s&&(M=new Ie(I.x+(s-I.y)/(M.y-I.y)*(M.x-I.x),s)._round()),I.x>=l&&M.x>=l||(I.x>=l?I=new Ie(l,I.y+(l-I.x)/(M.x-I.x)*(M.y-I.y))._round():M.x>=l&&(M=new Ie(l,I.y+(l-I.x)/(M.x-I.x)*(M.y-I.y))._round()),I.y>=h&&M.y>=h||(I.y>=h?I=new Ie(I.x+(h-I.y)/(M.y-I.y)*(M.x-I.x),h)._round():M.y>=h&&(M=new Ie(I.x+(h-I.y)/(M.y-I.y)*(M.x-I.x),h)._round()),w&&I.equals(w[w.length-1])||(w=[I],f.push(w)),w.push(M)))))}}return f}Ye("Anchor",Lo);const zc=1e20;function Kh(o,n,s,l,h,f,_,x,w){for(let T=n;T<n+l;T++)Lp(o,s*f+T,f,h,_,x,w);for(let T=s;T<s+h;T++)Lp(o,T*f+n,1,l,_,x,w)}function Lp(o,n,s,l,h,f,_){f[0]=0,_[0]=-zc,_[1]=zc,h[0]=o[n];for(let x=1,w=0,T=0;x<l;x++){h[x]=o[n+x*s];const I=x*x;do{const M=f[w];T=(h[x]-h[M]+I-M*M)/(x-M)/2}while(T<=_[w]&&--w>-1);w++,f[w]=x,_[w]=T,_[w+1]=zc}for(let x=0,w=0;x<l;x++){for(;_[w+1]<x;)w++;const T=f[w],I=x-T;o[n+x*s]=h[T]+I*I}}const Zu={none:0,ideographs:1,all:2};class us{constructor(n,s,l){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,s){const l=[];for(const h in n)for(const f of n[h])l.push({stack:h,id:f});Uo(l,({stack:h,id:f},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[f];if(void 0!==w)return void _(null,{stack:h,id:f,glyph:w});if(w=this._tinySDF(x,h,f),w)return x.glyphs[f]=w,void _(null,{stack:h,id:f,glyph:w});const T=Math.floor(f/256);if(256*T>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void _(null,{stack:h,id:f,glyph:w});let I=x.requests[T];I||(I=x.requests[T]=[],us.loadGlyphRange(h,T,this.url,this.requestManager,(M,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const z in P.glyphs)this._doesCharSupportLocalGlyph(+z)||(x.glyphs[+z]=P.glyphs[+z]);x.ranges[T]=!0}for(const z of I)z(M,P);delete x.requests[T]})),I.push((M,P)=>{M?_(M):P&&_(null,{stack:h,id:f,glyph:P.glyphs[f]||null})})},(h,f)=>{if(h)s(h);else if(f){const _={};for(const{stack:x,id:w,glyph:T}of f)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[w]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;s(null,_)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Zu.none&&(this.localGlyphMode===Zu.all?!!this.localFontFamily:!!this.localFontFamily&&(On(n)||ai(n)||wa(n)||xc(n))||du(n))}_tinySDF(n,s,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=n.tinySDF;if(!f){let $="400";/bold/i.test(s)?$="900":/medium/i.test(s)?$="500":/light/i.test(s)&&($="200"),f=n.tinySDF=new us.TinySDF({fontFamily:h,fontWeight:$,fontSize:48,buffer:6,radius:16}),f.fontWeight=$}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const _=String.fromCharCode(l),{data:x,width:w,height:T,glyphWidth:I,glyphHeight:M,glyphLeft:P,glyphTop:z,glyphAdvance:N}=f.draw(_);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Bs({width:w,height:T},x),metrics:{width:I/2,height:M/2,left:P/2,top:z/2-27,advance:N/2,localGlyph:!0}}}}function Em(o,n,s,l){const h=[],f=o.image,_=f.pixelRatio,x=f.paddedRect.w-2,w=f.paddedRect.h-2,T=o.right-o.left,I=o.bottom-o.top,M=f.stretchX||[[0,x]],P=f.stretchY||[[0,w]],z=(Ae,ze)=>Ae+ze[1]-ze[0],N=M.reduce(z,0),$=P.reduce(z,0),K=x-N,te=w-$;let se=0,ue=N,pe=0,he=$,fe=0,Me=K,Ee=0,Ze=te;if(f.content&&l){const Ae=f.content;se=Wu(M,0,Ae[0]),pe=Wu(P,0,Ae[1]),ue=Wu(M,Ae[0],Ae[2]),he=Wu(P,Ae[1],Ae[3]),fe=Ae[0]-se,Ee=Ae[1]-pe,Me=Ae[2]-Ae[0]-ue,Ze=Ae[3]-Ae[1]-he}const Oe=(Ae,ze,Ne,ke)=>{const Ke=Yh(Ae.stretch-se,ue,T,o.left),Qe=Xu(Ae.fixed-fe,Me,Ae.stretch,N),yt=Yh(ze.stretch-pe,he,I,o.top),gn=Xu(ze.fixed-Ee,Ze,ze.stretch,$),ut=Yh(Ne.stretch-se,ue,T,o.left),Wt=Xu(Ne.fixed-fe,Me,Ne.stretch,N),He=Yh(ke.stretch-pe,he,I,o.top),sn=Xu(ke.fixed-Ee,Ze,ke.stretch,$),Xt=new Ie(Ke,yt),er=new Ie(ut,yt),or=new Ie(ut,He),Wn=new Ie(Ke,He),mr=new Ie(Qe/_,gn/_),on=new Ie(Wt/_,sn/_),Ut=n*Math.PI/180;if(Ut){const Xn=Math.sin(Ut),sr=Math.cos(Ut),Ir=[sr,-Xn,Xn,sr];Xt._matMult(Ir),er._matMult(Ir),Wn._matMult(Ir),or._matMult(Ir)}const Rn=Ae.stretch+Ae.fixed,gr=ze.stretch+ze.fixed;return{tl:Xt,tr:er,bl:Wn,br:or,tex:{x:f.paddedRect.x+1+Rn,y:f.paddedRect.y+1+gr,w:Ne.stretch+Ne.fixed-Rn,h:ke.stretch+ke.fixed-gr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:mr,pixelOffsetBR:on,minFontScaleX:Me/_/T,minFontScaleY:Ze/_/I,isSDF:s}};if(l&&(f.stretchX||f.stretchY)){const Ae=Dm(M,K,N),ze=Dm(P,te,$);for(let Ne=0;Ne<Ae.length-1;Ne++){const ke=Ae[Ne],Ke=Ae[Ne+1];for(let Qe=0;Qe<ze.length-1;Qe++)h.push(Oe(ke,ze[Qe],Ke,ze[Qe+1]))}}else h.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function Wu(o,n,s){let l=0;for(const h of o)l+=Math.max(n,Math.min(s,h[1]))-Math.max(n,Math.min(s,h[0]));return l}function Dm(o,n,s){const l=[{fixed:-1,stretch:0}];for(const[h,f]of o){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(f-h)})}return l.push({fixed:n+1,stretch:s}),l}function Yh(o,n,s,l){return o/n*s+l}function Xu(o,n,s,l){return o-n*s/l}function Fp(o,n,s,l){const h=n+o.positionedLines[l].lineOffset;return 0===l?s+h/2:s+(h+(n+o.positionedLines[l-1].lineOffset))/2}us.loadGlyphRange=function(o,n,s,l,h){const f=256*n,_=f+255,x=l.transformRequest(l.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${f}-${_}`),xs.Glyphs);V(x,(w,T)=>{if(w)h(w);else if(T){const I={},M=new zu(T).readFields(Ep,{});for(const P of M.glyphs)I[P.id]=P;h(null,{glyphs:I,ascender:M.ascender,descender:M.descender})}})},us.TinySDF=class{constructor({fontSize:o=24,buffer:n=3,radius:s=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}){this.buffer=n,this.cutoff=l,this.radius=s;const x=this.size=o+4*n,w=this._createCanvas(x),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${_} ${f} ${o}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const n=document.createElement("canvas");return n.width=n.height=o,n}draw(o){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(o),_=Math.floor(s),x=Math.min(this.size-this.buffer,Math.ceil(f-h)),w=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(l)),T=x+2*this.buffer,I=w+2*this.buffer,M=T*I,P=new Uint8ClampedArray(M),z={data:P,width:T,height:I,glyphWidth:x,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(0===x||0===w)return z;const{ctx:N,buffer:$,gridInner:K,gridOuter:te}=this;N.clearRect($,$,x,w),N.fillText(o,$,$+_+1);const se=N.getImageData($,$,x,w);te.fill(zc,0,M),K.fill(0,0,M);for(let ue=0;ue<w;ue++)for(let pe=0;pe<x;pe++){const he=se.data[4*(ue*x+pe)+3]/255;if(0===he)continue;const fe=(ue+$)*T+pe+$;if(1===he)te[fe]=0,K[fe]=zc;else{const Me=.5-he;te[fe]=Me>0?Me*Me:0,K[fe]=Me<0?Me*Me:0}}Kh(te,0,0,T,I,T,this.f,this.v,this.z),Kh(K,$,$,x,w,T,this.f,this.v,this.z);for(let ue=0;ue<M;ue++){const pe=Math.sqrt(te[ue])-Math.sqrt(K[ue]);P[ue]=Math.round(255-255*(pe/this.radius+this.cutoff))}return z}};class Tm{constructor(n=[],s=Bv){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:l}=this,h=s[n];for(;n>0;){const f=n-1>>1,_=s[f];if(l(h,_)>=0)break;s[n]=_,n=f}s[n]=h}_down(n){const{data:s,compare:l}=this,h=this.length>>1,f=s[n];for(;n<h;){let _=1+(n<<1),x=s[_];const w=_+1;if(w<this.length&&l(s[w],x)<0&&(_=w,x=s[w]),l(x,f)>=0)break;s[n]=x,n=_}s[n]=f}}function Bv(o,n){return o<n?-1:o>n?1:0}function Cm(o,n=1,s=!1){let l=1/0,h=1/0,f=-1/0,_=-1/0;const x=o[0];for(let z=0;z<x.length;z++){const N=x[z];(!z||N.x<l)&&(l=N.x),(!z||N.y<h)&&(h=N.y),(!z||N.x>f)&&(f=N.x),(!z||N.y>_)&&(_=N.y)}const w=Math.min(f-l,_-h);let T=w/2;const I=new Tm([],T_);if(0===w)return new Ie(l,h);for(let z=l;z<f;z+=w)for(let N=h;N<_;N+=w)I.push(new Al(z+T,N+T,T,o));let M=function(z){let N=0,$=0,K=0;const te=z[0];for(let se=0,ue=te.length,pe=ue-1;se<ue;pe=se++){const he=te[se],fe=te[pe],Me=he.x*fe.y-fe.x*he.y;$+=(he.x+fe.x)*Me,K+=(he.y+fe.y)*Me,N+=3*Me}return new Al($/N,K/N,0,z)}(o),P=I.length;for(;I.length;){const z=I.pop();(z.d>M.d||!M.d)&&(M=z,s&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,P)),z.max-M.d<=n||(T=z.h/2,I.push(new Al(z.p.x-T,z.p.y-T,T,o)),I.push(new Al(z.p.x+T,z.p.y-T,T,o)),I.push(new Al(z.p.x-T,z.p.y+T,T,o)),I.push(new Al(z.p.x+T,z.p.y+T,T,o)),P+=4)}return s&&(console.log(`num probes: ${P}`),console.log(`best distance: ${M.d}`)),M.p}function T_(o,n){return n.max-o.max}function Al(o,n,s,l){this.p=new Ie(o,n),this.h=s,this.d=function(h,f){let _=!1,x=1/0;for(let w=0;w<f.length;w++){const T=f[w];for(let I=0,M=T.length,P=M-1;I<M;P=I++){const z=T[I],N=T[P];z.y>h.y!=N.y>h.y&&h.x<(N.x-z.x)*(h.y-z.y)/(N.y-z.y)+z.x&&(_=!_),x=Math.min(x,Sc(h,z,N))}}return(_?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Op=Number.POSITIVE_INFINITY,C_=Math.sqrt(2);function mo(o,n){return n[1]!==Op?function(s,l,h){let f=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),s){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(s){case"top-right":case"bottom-right":case"right":f=-l;break;case"top-left":case"bottom-left":case"left":f=l}return[f,_]}(o,n[0],n[1]):function(s,l){let h=0,f=0;l<0&&(l=0);const _=l/C_;switch(s){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-l;break;case"top":f=l-7}switch(s){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,f]}(o,n[0])}function S_(o,n,s,l,h,f,_,x,w){o.createArrays(),o.tilePixelRatio=Rt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const T=o.layers[0].layout,I=o.layers[0]._unevaluatedLayout._values,M={};if("composite"===o.textSizeData.kind){const{minZoom:N,maxZoom:$}=o.textSizeData;M.compositeTextSizes=[I["text-size"].possiblyEvaluate(new F(N),x),I["text-size"].possiblyEvaluate(new F($),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:N,maxZoom:$}=o.iconSizeData;M.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new F(N),x),I["icon-size"].possiblyEvaluate(new F($),x)]}M.layoutTextSize=I["text-size"].possiblyEvaluate(new F(w+1),x),M.layoutIconSize=I["icon-size"].possiblyEvaluate(new F(w+1),x),M.textMaxSize=I["text-size"].possiblyEvaluate(new F(18),x);const P="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),z=T.get("text-size");for(const N of o.features){const $=T.get("text-font").evaluate(N,{},x).join(","),K=z.evaluate(N,{},x),te=M.layoutTextSize.evaluate(N,{},x),se=(M.layoutIconSize.evaluate(N,{},x),{horizontal:{},vertical:void 0}),ue=N.text;let pe,he=[0,0];if(ue){const Ee=ue.toString(),Ze=24*T.get("text-letter-spacing").evaluate(N,{},x),Oe=24*T.get("text-line-height").evaluate(N,{},x),Ae=gl(Ee)?Ze:0,ze=T.get("text-anchor").evaluate(N,{},x),Ne=T.get("text-variable-anchor");if(!Ne){const ut=T.get("text-radial-offset").evaluate(N,{},x);he=ut?mo(ze,[24*ut,Op]):T.get("text-offset").evaluate(N,{},x).map(Wt=>24*Wt)}let ke=P?"center":T.get("text-justify").evaluate(N,{},x);const Ke=T.get("symbol-placement"),Qe="point"===Ke,yt="point"===Ke?24*T.get("text-max-width").evaluate(N,{},x):0,gn=ut=>{o.allowVerticalPlacement&&Lr(Ee)&&(se.vertical=Tp(ue,n,s,h,$,yt,Oe,ze,ut,Ae,he,Ui.vertical,!0,Ke,te,K))};if(!P&&Ne){const ut="auto"===ke?Ne.map(He=>Jh(He)):[ke];let Wt=!1;for(let He=0;He<ut.length;He++){const sn=ut[He];if(!se.horizontal[sn])if(Wt)se.horizontal[sn]=se.horizontal[0];else{const Xt=Tp(ue,n,s,h,$,yt,Oe,"center",sn,Ae,he,Ui.horizontal,!1,Ke,te,K);Xt&&(se.horizontal[sn]=Xt,Wt=1===Xt.positionedLines.length)}}gn("left")}else{if("auto"===ke&&(ke=Jh(ze)),Qe||T.get("text-writing-mode").indexOf("horizontal")>=0||!Lr(Ee)){const ut=Tp(ue,n,s,h,$,yt,Oe,ze,ke,Ae,he,Ui.horizontal,!1,Ke,te,K);ut&&(se.horizontal[ke]=ut)}gn("point"===Ke?"left":ke)}}let fe=!1;if(N.icon&&N.icon.name){const Ee=l[N.icon.name];Ee&&(pe=vm(h[N.icon.name],T.get("icon-offset").evaluate(N,{},x),T.get("icon-anchor").evaluate(N,{},x)),fe=Ee.sdf,void 0===o.sdfIcons?o.sdfIcons=Ee.sdf:o.sdfIcons!==Ee.sdf&&En("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ee.pixelRatio!==o.pixelRatio||0!==T.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const Me=Im(se.horizontal)||se.vertical;o.iconsInText||(o.iconsInText=!!Me&&Me.iconsInText),(Me||pe)&&I_(o,N,se,pe,l,M,te,0,he,fe,_,x)}f&&o.generateCollisionDebugBuffers(w,o.collisionBoxArray)}function Jh(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function I_(o,n,s,l,h,f,_,x,w,T,I,M){let P=f.textMaxSize.evaluate(n,{},M);void 0===P&&(P=_);const z=o.layers[0].layout,N=z.get("icon-offset").evaluate(n,{},M),$=Im(s.horizontal)||s.vertical,K=_/24,te=o.tilePixelRatio*P/24,se=o.tilePixelRatio*z.get("symbol-spacing"),ue=z.get("text-padding")*o.tilePixelRatio,pe=z.get("icon-padding")*o.tilePixelRatio,he=yn(z.get("text-max-angle")),fe="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),Me="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),Ee=z.get("symbol-placement"),Ze=se/2,Oe=z.get("icon-text-fit");let Ae;l&&"none"!==Oe&&(o.allowVerticalPlacement&&s.vertical&&(Ae=xm(l,s.vertical,Oe,z.get("icon-text-fit-padding"),N,K)),$&&(l=xm(l,$,Oe,z.get("icon-text-fit-padding"),N,K)));const ze=(Ne,ke)=>{ke.x<0||ke.x>=Rt||ke.y<0||ke.y>=Rt||function(Ke,Qe,yt,gn,ut,Wt,He,sn,Xt,er,or,Wn,mr,on,Ut,Rn,gr,Xn,sr,Ir,zn,Kr,bn,tr,Kn){const In=Ke.addToLineVertexArray(Qe,gn);let Bn,ar,wn,nr,Oo,$i,_o,Gi=0,Cn=0,zo=0,zl=0,Bl=-1,Nl=-1;const Bo={};let Gm=wc(""),Yp=0,Jp=0;if(void 0===Xt._unevaluatedLayout.getValue("text-radial-offset")?[Yp,Jp]=Xt.layout.get("text-offset").evaluate(zn,{},Kn).map(vi=>24*vi):(Yp=24*Xt.layout.get("text-radial-offset").evaluate(zn,{},Kn),Jp=Op),Ke.allowVerticalPlacement&&ut.vertical){const vi=ut.vertical;if(Ut)$i=zp(vi),sn&&(_o=zp(sn));else{const Ai=Xt.layout.get("text-rotate").evaluate(zn,{},Kn)+90;wn=Ku(er,yt,Qe,or,Wn,mr,vi,on,Ai,Rn),sn&&(nr=Ku(er,yt,Qe,or,Wn,mr,sn,Xn,Ai))}}if(Wt){const vi=Xt.layout.get("icon-rotate").evaluate(zn,{},Kn),Ai="none"!==Xt.layout.get("icon-text-fit"),ih=Em(Wt,vi,bn,Ai),Hm=sn?Em(sn,vi,bn,Ai):void 0;ar=Ku(er,yt,Qe,or,Wn,mr,Wt,Xn,vi),Gi=4*ih.length;const j_=Ke.iconSizeData;let Zs=null;"source"===j_.kind?(Zs=[ls*Xt.layout.get("icon-size").evaluate(zn,{},Kn)],Zs[0]>Aa&&En(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===j_.kind&&(Zs=[ls*Kr.compositeIconSizes[0].evaluate(zn,{},Kn),ls*Kr.compositeIconSizes[1].evaluate(zn,{},Kn)],(Zs[0]>Aa||Zs[1]>Aa)&&En(`${Ke.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Ke.addSymbols(Ke.icon,ih,Zs,Ir,sr,zn,!1,yt,Qe,In.lineStartIndex,In.lineLength,-1,tr,Kn),Bl=Ke.icon.placedSymbolArray.length-1,Hm&&(Cn=4*Hm.length,Ke.addSymbols(Ke.icon,Hm,Zs,Ir,sr,zn,Ui.vertical,yt,Qe,In.lineStartIndex,In.lineLength,-1,tr,Kn),Nl=Ke.icon.placedSymbolArray.length-1)}for(const vi in ut.horizontal){const Ai=ut.horizontal[vi];Bn||(Gm=wc(Ai.text),Ut?Oo=zp(Ai):Bn=Ku(er,yt,Qe,or,Wn,mr,Ai,on,Xt.layout.get("text-rotate").evaluate(zn,{},Kn),Rn));const ih=1===Ai.positionedLines.length;if(zo+=Sm(Ke,yt,Qe,Ai,He,Xt,Ut,zn,Rn,In,ut.vertical?Ui.horizontal:Ui.horizontalOnly,ih?Object.keys(ut.horizontal):[vi],Bo,Bl,Kr,tr,Kn),ih)break}ut.vertical&&(zl+=Sm(Ke,yt,Qe,ut.vertical,He,Xt,Ut,zn,Rn,In,Ui.vertical,["vertical"],Bo,Nl,Kr,tr,Kn));let Ra=-1;const fd=(vi,Ai)=>vi?Math.max(vi,Ai):Ai;Ra=fd(Oo,Ra),Ra=fd($i,Ra),Ra=fd(_o,Ra);const Gv=Ra>-1?1:0;Ke.glyphOffsetArray.length>=$s.MAX_GLYPHS&&En("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==zn.sortKey&&Ke.addToSortKeyRanges(Ke.symbolInstances.length,zn.sortKey),Ke.symbolInstances.emplaceBack(yt.x,yt.y,yt.z,Qe.x,Qe.y,Bo.right>=0?Bo.right:-1,Bo.center>=0?Bo.center:-1,Bo.left>=0?Bo.left:-1,Bo.vertical>=0?Bo.vertical:-1,Bl,Nl,Gm,void 0!==Bn?Bn:Ke.collisionBoxArray.length,void 0!==Bn?Bn+1:Ke.collisionBoxArray.length,void 0!==wn?wn:Ke.collisionBoxArray.length,void 0!==wn?wn+1:Ke.collisionBoxArray.length,void 0!==ar?ar:Ke.collisionBoxArray.length,void 0!==ar?ar+1:Ke.collisionBoxArray.length,nr||Ke.collisionBoxArray.length,nr?nr+1:Ke.collisionBoxArray.length,or,zo,zl,Gi,Cn,Gv,0,Yp,Jp,Ra)}(o,ke,ke,Ne,s,l,h,Ae,o.layers[0],o.collisionBoxArray,n.index,n.sourceLayerIndex,o.index,ue,fe,w,0,pe,Me,N,n,f,T,I,M)};if("line"===Ee)for(const Ne of qu(n.geometry,0,0,Rt,Rt)){const ke=wm(Ne,se,he,s.vertical||$,l,24,te,o.overscaling,Rt);for(const Ke of ke){const Qe=$;Qe&&M_(o,Qe.text,Ze,Ke)||ze(Ne,Ke)}}else if("line-center"===Ee){for(const Ne of n.geometry)if(Ne.length>1){const ke=Rp(Ne,he,s.vertical||$,l,24,te);ke&&ze(Ne,ke)}}else if("Polygon"===n.type)for(const Ne of fp(n.geometry,0)){const ke=Cm(Ne,16);ze(Ne[0],new Lo(ke.x,ke.y,0,0,void 0))}else if("LineString"===n.type)for(const Ne of n.geometry)ze(Ne,new Lo(Ne[0].x,Ne[0].y,0,0,void 0));else if("Point"===n.type)for(const Ne of n.geometry)for(const ke of Ne)ze([ke],new Lo(ke.x,ke.y,0,0,void 0))}const Aa=32640;function Sm(o,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$,K){const te=function(pe,he,fe,Me,Ee,Ze,Oe,Ae){const ze=[];if(0===he.positionedLines.length)return ze;const Ne=Me.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,ke=function(ut){const Wt=ut[0],He=ut[1],sn=Wt*He;return sn>0?[Wt,-He]:sn<0?[-Wt,He]:0===Wt?[He,Wt]:[He,-Wt]}(fe);let Ke=Math.abs(he.top-he.bottom);for(const ut of he.positionedLines)Ke-=ut.lineOffset;const Qe=he.positionedLines.length,yt=Ke/Qe;let gn=he.top-fe[1];for(let ut=0;ut<Qe;++ut){const Wt=he.positionedLines[ut];gn=Fp(he,yt,gn,ut);for(const He of Wt.positionedGlyphs){if(!He.rect)continue;const sn=He.rect||{};let Xt=4,er=!0,or=1,Wn=0;if(He.imageName){const wn=Oe[He.imageName];if(!wn)continue;if(wn.sdf){En("SDF images are not supported in formatted text and will be ignored.");continue}er=!1,or=wn.pixelRatio,Xt=1/or}const mr=(Ee||Ae)&&He.vertical,on=He.metrics.advance*He.scale/2,Ut=He.metrics,Rn=He.rect;if(null===Rn)continue;Ae&&he.verticalizable&&(Wn=He.imageName?on-He.metrics.width*He.scale/2:0);const gr=Ee?[He.x+on,He.y]:[0,0];let Xn=[0,0],sr=[0,0],Ir=!1;Ee||(mr?(sr=[He.x+on+ke[0],He.y+ke[1]-Wn],Ir=!0):Xn=[He.x+on+fe[0],He.y+fe[1]-Wn]);const zn=Rn.w*He.scale/(or*(He.localGlyph?2:1)),Kr=Rn.h*He.scale/(or*(He.localGlyph?2:1));let bn,tr,Kn,In;if(mr){const wn=He.y-gn,nr=new Ie(-on,on-wn),Oo=-Math.PI/2,$i=new Ie(...sr);bn=new Ie(-on+Xn[0],Xn[1]),bn._rotateAround(Oo,nr)._add($i),bn.x+=-wn+on,bn.y-=(Ut.left-Xt)*He.scale;const _o=He.imageName?Ut.advance*He.scale:24*He.scale,Gi=String.fromCharCode(He.glyph);v_(Gi)?bn.x+=(1-Xt)*He.scale:um(Gi)?bn.x+=_o-Ut.height*He.scale+(-Xt-1)*He.scale:bn.x+=He.imageName||Ut.width+2*Xt===Rn.w&&Ut.height+2*Xt===Rn.h?(_o-Kr)/2:(_o-(Ut.height+2*Xt)*He.scale)/2,tr=new Ie(bn.x,bn.y-zn),Kn=new Ie(bn.x+Kr,bn.y),In=new Ie(bn.x+Kr,bn.y-zn)}else{const wn=(Ut.left-Xt)*He.scale-on+Xn[0],nr=(-Ut.top-Xt)*He.scale+Xn[1],Oo=wn+zn,$i=nr+Kr;bn=new Ie(wn,nr),tr=new Ie(Oo,nr),Kn=new Ie(wn,$i),In=new Ie(Oo,$i)}if(Ne){let wn;wn=Ee?new Ie(0,0):Ir?new Ie(ke[0],ke[1]):new Ie(fe[0],fe[1]),bn._rotateAround(Ne,wn),tr._rotateAround(Ne,wn),Kn._rotateAround(Ne,wn),In._rotateAround(Ne,wn)}const Bn=new Ie(0,0),ar=new Ie(0,0);ze.push({tl:bn,tr,bl:Kn,br:In,tex:sn,writingMode:he.writingMode,glyphOffset:gr,sectionIndex:He.sectionIndex,isSDF:er,pixelOffsetTL:Bn,pixelOffsetBR:ar,minFontScaleX:0,minFontScaleY:0})}}return ze}(0,l,w,f,_,x,h,o.allowVerticalPlacement),se=o.textSizeData;let ue=null;"source"===se.kind?(ue=[ls*f.layout.get("text-size").evaluate(x,{},K)],ue[0]>Aa&&En(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===se.kind&&(ue=[ls*N.compositeTextSizes[0].evaluate(x,{},K),ls*N.compositeTextSizes[1].evaluate(x,{},K)],(ue[0]>Aa||ue[1]>Aa)&&En(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,te,ue,w,_,x,I,n,s,T.lineStartIndex,T.lineLength,z,$,K);for(const pe of M)P[pe]=o.text.placedSymbolArray.length-1;return 4*te.length}function Im(o){for(const n in o)return o[n];return null}function Ku(o,n,s,l,h,f,_,x,w,T){let I=_.top,M=_.bottom,P=_.left,z=_.right;const N=_.collisionPadding;if(N&&(P-=N[0],I-=N[1],z+=N[2],M+=N[3]),w){const $=new Ie(P,I),K=new Ie(z,I),te=new Ie(P,M),se=new Ie(z,M),ue=yn(w);let pe=new Ie(0,0);T&&(pe=new Ie(T[0],T[1])),$._rotateAround(ue,pe),K._rotateAround(ue,pe),te._rotateAround(ue,pe),se._rotateAround(ue,pe),P=Math.min($.x,K.x,te.x,se.x),z=Math.max($.x,K.x,te.x,se.x),I=Math.min($.y,K.y,te.y,se.y),M=Math.max($.y,K.y,te.y,se.y)}return o.emplaceBack(n.x,n.y,n.z,s.x,s.y,P,I,z,M,x,l,h,f),o.length-1}function zp(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const n=o.bottom-o.top;return n>0?Math.max(10,n):null}function M_(o,n,s,l){const h=o.compareText;if(n in h){const f=h[n];for(let _=f.length-1;_>=0;_--)if(l.dist(f[_])<s)return!0}else h[n]=[];return h[n].push(l),!1}const A_=Fc.VectorTileFeature.types,St=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function js(o,n,s,l,h,f,_,x,w,T,I,M,P,z,N,$){const K=I?Math.min(Aa,Math.round(I[0])):0,te=I?Math.min(Aa,Math.round(I[1])):0;o.emplaceBack(n,s,Math.round(32*_),Math.round(32*x),w,T,(K<<1)+(M?1:0),te,16*P,16*z,256*N,256*$,l,h,f,0)}function Qh(o,n,s){o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s),o.emplaceBack(n.x,n.y,s)}function Mm(o){for(const n of o.sections)if(Yd(n.text))return!0;return!1}class Bc{constructor(n){this.layoutVertexArray=new ft,this.indexArray=new Pn,this.programConfigurations=n,this.segments=new pr,this.dynamicLayoutVertexArray=new dt,this.opacityVertexArray=new qt,this.placedSymbolArray=new _l}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(n,s,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,_p.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,St,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",Bc);class ji{constructor(n,s,l){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new l,this.segments=new pr,this.collisionVertexArray=new Fr,this.collisionVertexArrayExt=new dt}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,f_.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,m_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ye("CollisionBuffers",ji);class $s{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rh([]),this.placementViewportMatrix=Rh([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=yp(this.zoom,s["text-size"]),this.iconSizeData=yp(this.zoom,s["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Ui[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID}createArrays(){this.text=new Bc(new Tc(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Bc(new Tc(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new vu,this.lineVertexArray=new Ca,this.symbolInstances=new Ta}calculateGlyphDependencies(n,s,l,h,f){for(let _=0;_<n.length;_++)if(s[n.charCodeAt(_)]=!0,h&&f){const x=Ou[n.charAt(_)];x&&(s[x.charCodeAt(0)]=!0)}}populate(n,s,l,h){const f=this.layers[0],_=f.layout,x=_.get("text-font"),w=_.get("text-field"),T=_.get("icon-image"),I=("constant"!==w.value.kind||w.value.value instanceof Pr&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&("constant"!==x.value.kind||x.value.value.length>0),M="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,P=_.get("symbol-sort-key");if(this.features=[],!I&&!M)return;const z=s.iconDependencies,N=s.glyphDependencies,$=s.availableImages,K=new F(this.zoom);for(const{feature:te,id:se,index:ue,sourceLayerIndex:pe}of n){const he=f._featureFilter.needGeometry,fe=as(te,he);if(!f._featureFilter.filter(K,fe,l))continue;let Me,Ee;if(he||(fe.geometry=ko(te,l,h)),I){const Oe=f.getValueAndResolveTokens("text-field",fe,l,$),Ae=Pr.factory(Oe);Mm(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===A()||this.hasRTLText&&L.isParsed())&&(Me=y_(Ae,f,fe))}if(M){const Oe=f.getValueAndResolveTokens("icon-image",fe,l,$);Ee=Oe instanceof Li?Oe:Li.fromString(Oe)}if(!Me&&!Ee)continue;const Ze=this.sortFeaturesByKey?P.evaluate(fe,{},l):void 0;if(this.features.push({id:se,text:Me,icon:Ee,index:ue,sourceLayerIndex:pe,geometry:fe.geometry,properties:te.properties,type:A_[te.type],sortKey:Ze}),Ee&&(z[Ee.name]=!0),Me){const Oe=x.evaluate(fe,{},l).join(","),Ae="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ui.vertical)>=0;for(const ze of Me.sections)if(ze.image)z[ze.image.name]=!0;else{const Ne=Lr(Me.toString()),ke=ze.fontStack||Oe,Ke=N[ke]=N[ke]||{};this.calculateGlyphDependencies(ze.text,Ke,Ae,this.allowVerticalPlacement,Ne)}}}"line"===_.get("symbol-placement")&&(this.features=function(te){const se={},ue={},pe=[];let he=0;function fe(Oe){pe.push(te[Oe]),he++}function Me(Oe,Ae,ze){const Ne=ue[Oe];return delete ue[Oe],ue[Ae]=Ne,pe[Ne].geometry[0].pop(),pe[Ne].geometry[0]=pe[Ne].geometry[0].concat(ze[0]),Ne}function Ee(Oe,Ae,ze){const Ne=se[Ae];return delete se[Ae],se[Oe]=Ne,pe[Ne].geometry[0].shift(),pe[Ne].geometry[0]=ze[0].concat(pe[Ne].geometry[0]),Ne}function Ze(Oe,Ae,ze){const Ne=ze?Ae[0][Ae[0].length-1]:Ae[0][0];return`${Oe}:${Ne.x}:${Ne.y}`}for(let Oe=0;Oe<te.length;Oe++){const Ae=te[Oe],ze=Ae.geometry,Ne=Ae.text?Ae.text.toString():null;if(!Ne){fe(Oe);continue}const ke=Ze(Ne,ze),Ke=Ze(Ne,ze,!0);if(ke in ue&&Ke in se&&ue[ke]!==se[Ke]){const Qe=Ee(ke,Ke,ze),yt=Me(ke,Ke,pe[Qe].geometry);delete se[ke],delete ue[Ke],ue[Ze(Ne,pe[yt].geometry,!0)]=yt,pe[Qe].geometry=null}else ke in ue?Me(ke,Ke,ze):Ke in se?Ee(ke,Ke,ze):(fe(Oe),se[ke]=he-1,ue[Ke]=he-1)}return pe.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,se)=>te.sortKey-se.sortKey)}update(n,s,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const l=this.lineVertexArray.length;if(void 0!==n.segment){let h=n.dist(s[n.segment+1]),f=n.dist(s[n.segment]);const _={};for(let x=n.segment+1;x<s.length;x++)_[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:h},x<s.length-1&&(h+=s[x+1].dist(s[x]));for(let x=n.segment||0;x>=0;x--)_[x]={x:s[x].x,y:s[x].y,tileUnitDistanceFromAnchor:f},x>0&&(f+=s[x-1].dist(s[x]));for(let x=0;x<s.length;x++){const w=_[x];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(n,s,l,h,f,_,x,w,T,I,M,P,z,N){const $=n.indexArray,K=n.layoutVertexArray,te=n.segments.prepareSegment(4*s.length,K,$,this.canOverlap?_.sortKey:void 0),se=this.glyphOffsetArray.length,ue=te.vertexLength,pe=this.allowVerticalPlacement&&x===Ui.vertical?Math.PI/2:0,he=_.text&&_.text.sections;for(let fe=0;fe<s.length;fe++){const{tl:Me,tr:Ee,bl:Ze,br:Oe,tex:Ae,pixelOffsetTL:ze,pixelOffsetBR:Ne,minFontScaleX:ke,minFontScaleY:Ke,glyphOffset:Qe,isSDF:yt,sectionIndex:gn}=s[fe],ut=te.vertexLength,Wt=Qe[1];js(K,w.x,w.y,w.z,T.x,T.y,Me.x,Wt+Me.y,Ae.x,Ae.y,l,yt,ze.x,ze.y,ke,Ke),js(K,w.x,w.y,w.z,T.x,T.y,Ee.x,Wt+Ee.y,Ae.x+Ae.w,Ae.y,l,yt,Ne.x,ze.y,ke,Ke),js(K,w.x,w.y,w.z,T.x,T.y,Ze.x,Wt+Ze.y,Ae.x,Ae.y+Ae.h,l,yt,ze.x,Ne.y,ke,Ke),js(K,w.x,w.y,w.z,T.x,T.y,Oe.x,Wt+Oe.y,Ae.x+Ae.w,Ae.y+Ae.h,l,yt,Ne.x,Ne.y,ke,Ke),Qh(n.dynamicLayoutVertexArray,w,pe),$.emplaceBack(ut,ut+1,ut+2),$.emplaceBack(ut+1,ut+2,ut+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qe[0]),fe!==s.length-1&&gn===s[fe+1].sectionIndex||n.programConfigurations.populatePaintArrays(K.length,_,_.index,{},z,N,he&&he[gn])}n.placedSymbolArray.emplaceBack(w.x,w.y,w.z,T.x,T.y,se,this.glyphOffsetArray.length-se,ue,I,M,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(n,s,l,h,f,_,x){n.emplaceBack(s,l,h,f,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(n,s,l,h,f,_,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),T=w.vertexLength,I=x.tileAnchorX,M=x.tileAnchorY;for(let z=0;z<4;z++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(s,-n.padding,-n.padding),l.collisionVertexArrayExt.emplaceBack(s,n.padding,-n.padding),l.collisionVertexArrayExt.emplaceBack(s,n.padding,n.padding),l.collisionVertexArrayExt.emplaceBack(s,-n.padding,n.padding),this._commitLayoutVertex(l.layoutVertexArray,h,f,_,I,M,new Ie(n.x1,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,_,I,M,new Ie(n.x2,n.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,_,I,M,new Ie(n.x2,n.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,_,I,M,new Ie(n.x1,n.y2)),w.vertexLength+=4;const P=l.indexArray;P.emplaceBack(T,T+1),P.emplaceBack(T+1,T+2),P.emplaceBack(T+2,T+3),P.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,l,h,f,_){for(let x=h;x<f;x++){const w=l.get(x),T=this.getSymbolInstanceTextSize(n,_,s,x);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,s,l,h,f,_){for(let x=h;x<f;x++){const w=l.get(x),T=this.getSymbolInstanceIconSize(n,s,x);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ji(Qn,Sl.members,Dn),this.iconCollisionBox=new ji(Qn,Sl.members,Dn);const l=Il(this.iconSizeData,n),h=Il(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,s,l,h){const f=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:h),_=Zh(this.textSizeData,n,f)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,s,l){const h=this.icon.placedSymbolArray.get(l),f=Zh(this.iconSizeData,n,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(n,s,l){n.emplaceBack(s,-l,-l),n.emplaceBack(s,l,-l),n.emplaceBack(s,l,l),n.emplaceBack(s,-l,l)}_updateTextDebugCollisionBoxes(n,s,l,h,f,_){for(let x=h;x<f;x++){const w=l.get(x),T=this.getSymbolInstanceTextSize(n,_,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,T,w.padding)}}_updateIconDebugCollisionBoxes(n,s,l,h,f){for(let _=h;_<f;_++){const x=l.get(_),w=this.getSymbolInstanceIconSize(n,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Il(this.iconSizeData,n),h=Il(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,l,h,f,_,x,w,T){const I={};for(let M=s;M<l;M++){const P=n.get(M);I.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.textFeatureIndex=P.featureIndex;break}for(let M=h;M<f;M++){const P=n.get(M);I.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalTextFeatureIndex=P.featureIndex;break}for(let M=_;M<x;M++){const P=n.get(M);I.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.iconFeatureIndex=P.featureIndex;break}for(let M=w;M<T;M++){const P=n.get(M);I.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},I.verticalIconFeatureIndex=P.featureIndex;break}return I}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const l=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const l=n.placedSymbolArray.get(s),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)n.indexArray.emplaceBack(f,f+1,f+2),n.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(n),l=Math.cos(n),h=[],f=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(s*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return _.sort((x,w)=>h[x]-h[w]||f[w]-f[x]),_}addToSortKeyRanges(n,s){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===s?l.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const l=this.symbolInstances.get(s);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,f,_)=>{h>=0&&_.indexOf(h)===f&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ye("SymbolBucket",$s,{omit:["layers","collisionBoxArray","features","compareText"]}),$s.MAX_GLYPHS=65535,$s.addDynamicAttributes=Qh;const P_=new Ce({"symbol-placement":new W(de.layout_symbol["symbol-placement"]),"symbol-spacing":new W(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new W(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ie(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new W(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new W(de.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new W(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new W(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new W(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new ie(de.layout_symbol["icon-size"]),"icon-text-fit":new W(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new W(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new ie(de.layout_symbol["icon-image"]),"icon-rotate":new ie(de.layout_symbol["icon-rotate"]),"icon-padding":new W(de.layout_symbol["icon-padding"]),"icon-keep-upright":new W(de.layout_symbol["icon-keep-upright"]),"icon-offset":new ie(de.layout_symbol["icon-offset"]),"icon-anchor":new ie(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new W(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new W(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new W(de.layout_symbol["text-rotation-alignment"]),"text-field":new ie(de.layout_symbol["text-field"]),"text-font":new ie(de.layout_symbol["text-font"]),"text-size":new ie(de.layout_symbol["text-size"]),"text-max-width":new ie(de.layout_symbol["text-max-width"]),"text-line-height":new ie(de.layout_symbol["text-line-height"]),"text-letter-spacing":new ie(de.layout_symbol["text-letter-spacing"]),"text-justify":new ie(de.layout_symbol["text-justify"]),"text-radial-offset":new ie(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new W(de.layout_symbol["text-variable-anchor"]),"text-anchor":new ie(de.layout_symbol["text-anchor"]),"text-max-angle":new W(de.layout_symbol["text-max-angle"]),"text-writing-mode":new W(de.layout_symbol["text-writing-mode"]),"text-rotate":new ie(de.layout_symbol["text-rotate"]),"text-padding":new W(de.layout_symbol["text-padding"]),"text-keep-upright":new W(de.layout_symbol["text-keep-upright"]),"text-transform":new ie(de.layout_symbol["text-transform"]),"text-offset":new ie(de.layout_symbol["text-offset"]),"text-allow-overlap":new W(de.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new W(de.layout_symbol["text-ignore-placement"]),"text-optional":new W(de.layout_symbol["text-optional"])});var Yu={paint:new Ce({"icon-opacity":new ie(de.paint_symbol["icon-opacity"]),"icon-color":new ie(de.paint_symbol["icon-color"]),"icon-halo-color":new ie(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new ie(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ie(de.paint_symbol["icon-halo-blur"]),"icon-translate":new W(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new W(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new ie(de.paint_symbol["text-opacity"]),"text-color":new ie(de.paint_symbol["text-color"],{runtimeType:qn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ie(de.paint_symbol["text-halo-color"]),"text-halo-width":new ie(de.paint_symbol["text-halo-width"]),"text-halo-blur":new ie(de.paint_symbol["text-halo-blur"]),"text-translate":new W(de.paint_symbol["text-translate"]),"text-translate-anchor":new W(de.paint_symbol["text-translate-anchor"])}),layout:P_};class hs{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Yi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",hs,{omit:["defaultValue"]});class Nc extends Ao{constructor(n){super(n,Yu)}recalculate(n,s){super.recalculate(n,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,s,l,h){const f=this.layout.get(n).evaluate(s,{},l,h),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Bi(_.value)||!f?f:(x=s.properties,f.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):""));var x}createBucket(n){return new $s(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Yu.paint.overridableProperties){if(!Nc.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),l=new hs(s),h=new xn(l,s.property.specification);let f=null;f="constant"===s.value.kind||"source"===s.value.kind?new br("source",h):new si("composite",h,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new ee(s.property,f,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,l){return!(!this.layout||s.isDataDriven()||l.isDataDriven())&&Nc.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const l=n.get("text-field"),h=Yu.paint.properties[s];let f=!1;const _=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if("constant"===l.value.kind&&l.value.value instanceof Pr)_(l.value.value.sections);else if("source"===l.value.kind){const x=T=>{f||(T instanceof Ds&&Yt(T.value)===Xo?_(T.value.sections):T instanceof tc?_(T.sections):T.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return f}getProgramConfiguration(n){return new Ia(this,n)}}var Am={paint:new Ce({"background-color":new W(de.paint_background["background-color"]),"background-pattern":new be(de.paint_background["background-pattern"]),"background-opacity":new W(de.paint_background["background-opacity"])})},Bp={paint:new Ce({"raster-opacity":new W(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new W(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new W(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new W(de.paint_raster["raster-brightness-max"]),"raster-saturation":new W(de.paint_raster["raster-saturation"]),"raster-contrast":new W(de.paint_raster["raster-contrast"]),"raster-resampling":new W(de.paint_raster["raster-resampling"]),"raster-fade-duration":new W(de.paint_raster["raster-fade-duration"])})};class Nv extends Ao{constructor(n){super(n,{}),this.implementation=n}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var Pm={paint:new Ce({"sky-type":new W(de.paint_sky["sky-type"]),"sky-atmosphere-sun":new W(de.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new W(de.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new W(de.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new W(de.paint_sky["sky-gradient-radius"]),"sky-gradient":new xe(de.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new W(de.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new W(de.paint_sky["sky-atmosphere-color"]),"sky-opacity":new W(de.paint_sky["sky-opacity"])})};function km(o,n,s){const l=zs(0,0,1),h=Zf(up());return function(f,_,x){x*=.5;var w=_[0],T=_[1],I=_[2],M=_[3],P=Math.sin(x),z=Math.cos(x);f[0]=w*z-I*P,f[1]=T*z+M*P,f[2]=I*z+w*P,f[3]=M*z-T*P}(h,h,s?-yn(o)+Math.PI:yn(o)),Wf(h,h,-yn(n)),kc(l,l,h),wl(l,l)}const ed={circle:class extends Ao{constructor(o){super(o,Bg)}createBucket(o){return new xl(o)}queryRadius(o){const n=o;return Du("circle-radius",this,n)+Du("circle-stroke-width",this,n)+Mc(this.paint.get("circle-translate"))}queryIntersectsFeature(o,n,s,l,h,f,_,x){const w=$f(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return Oh(o,l,f,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,T)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Ia(this,o)}},heatmap:class extends Ao{createBucket(o){return new Iu(o)}constructor(o){super(o,jg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return Du("heatmap-radius",this,o)}queryIntersectsFeature(o,n,s,l,h,f,_,x){const w=this.paint.get("heatmap-radius").evaluate(n,s);return Oh(o,l,f,_,x,!0,!0,new Ie(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Ia(this,o)}},hillshade:class extends Ao{constructor(o){super(o,$g)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(o){return new Ia(this,o)}},fill:class extends Ao{constructor(o){super(o,gp)}getProgramIds(){const o=this.paint.get("fill-pattern"),n=o&&o.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Ia(this,o)}recalculate(o,n){super.recalculate(o,n);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Tl(o)}queryRadius(){return Mc(this.paint.get("fill-translate"))}queryIntersectsFeature(o,n,s,l,h,f){return!o.queryGeometry.isAboveHorizon&&Vf(Ac(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Ao{constructor(o){super(o,li)}createBucket(o){return new $h(o)}queryRadius(){return Mc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Ia(this,o)}queryIntersectsFeature(o,n,s,l,h,f,_,x,w){const T=$f(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(n,s),M=this.paint.get("fill-extrusion-base").evaluate(n,s),P=[0,0],z=x&&f.elevation,N=f.elevation?f.elevation.exaggeration():1;if(z){const te=o.tile.getBucket(this).centroidVertexArray,se=w+1;if(se<te.length){const ue=te.get(se);P[0]=ue.a_centroid_pos0,P[1]=ue.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;const $=(te=l,se=M,ue=I,pe=T,he=_,(fe=z?x:null)?function(Oe,Ae,ze,Ne,ke,Ke,Qe,yt,gn){const ut=[],Wt=[],He=[0,0,0,1];for(const sn of Oe){const Xt=[],er=[];for(const or of sn){const Wn=or.x+Ne.x,mr=or.y+Ne.y,on=c_(Wn,mr,Ae,ze,Ke,Qe,yt,gn);He[0]=Wn,He[1]=mr,He[2]=on.base,He[3]=1,Fh(He,He,ke),He[3]=Math.max(He[3],1e-5);const Ut=im([He[0]/He[3],He[1]/He[3],He[2]/He[3]]);He[0]=Wn,He[1]=mr,He[2]=on.top,He[3]=1,Fh(He,He,ke),He[3]=Math.max(He[3],1e-5);const Rn=im([He[0]/He[3],He[1]/He[3],He[2]/He[3]]);Xt.push(Ut),er.push(Rn)}ut.push(Xt),Wt.push(er)}return[ut,Wt]}(te,se,ue,pe,he,fe,P,N,f.center.lat):function(Oe,Ae,ze,Ne,ke){const Ke=[],Qe=[],yt=ke[8]*Ae,gn=ke[9]*Ae,ut=ke[10]*Ae,Wt=ke[11]*Ae,He=ke[8]*ze,sn=ke[9]*ze,Xt=ke[10]*ze,er=ke[11]*ze;for(const or of Oe){const Wn=[],mr=[];for(const on of or){const Ut=on.x+Ne.x,Rn=on.y+Ne.y,gr=ke[0]*Ut+ke[4]*Rn+ke[12],Xn=ke[1]*Ut+ke[5]*Rn+ke[13],sr=ke[2]*Ut+ke[6]*Rn+ke[14],Ir=ke[3]*Ut+ke[7]*Rn+ke[15],zn=gr+yt,Kr=Xn+gn,bn=sr+ut,tr=Math.max(Ir+Wt,1e-5),Kn=gr+He,In=Xn+sn,Bn=sr+Xt,ar=Math.max(Ir+er,1e-5),wn=new Ie(zn/tr,Kr/tr);wn.z=bn/tr,Wn.push(wn);const nr=new Ie(Kn/ar,In/ar);nr.z=Bn/ar,mr.push(nr)}Ke.push(Wn),Qe.push(mr)}return[Ke,Qe]}(te,se,ue,pe,he)),K=o.queryGeometry;var te,se,ue,pe,he,fe;return function(te,se,ue){let pe=1/0;Vf(ue,se)&&(pe=Gh(ue,se[0]));for(let he=0;he<se.length;he++){const fe=se[he],Me=te[he];for(let Ee=0;Ee<fe.length-1;Ee++){const Ze=fe[Ee],Oe=[Ze,fe[Ee+1],Me[Ee+1],Me[Ee],Ze];Ph(ue,Oe)&&(pe=Math.min(pe,Gh(ue,Oe)))}}return pe!==1/0&&pe}($[0],$[1],K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends Ao{constructor(o){super(o,qh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof ic,this.gradientVersion=(this.gradientVersion+1)%ui}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,n){super.recalculate(o,n),this.paint._values["line-floorwidth"]=lm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Hh(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Ia(this,o)}queryRadius(o){const n=o,s=cm(Du("line-width",this,n),Du("line-gap-width",this,n)),l=Du("line-offset",this,n);return s/2+Math.abs(l)+Mc(this.paint.get("line-translate"))}queryIntersectsFeature(o,n,s,l,h,f){if(o.queryGeometry.isAboveHorizon)return!1;const _=Ac(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*cm(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),w=this.paint.get("line-offset").evaluate(n,s);return w&&(l=function(T,I){const M=[],P=new Ie(0,0);for(let z=0;z<T.length;z++){const N=T[z],$=[];for(let K=0;K<N.length;K++){const te=N[K-1],se=N[K],ue=N[K+1],pe=0===K?P:se.sub(te)._unit()._perp(),he=K===N.length-1?P:ue.sub(se)._unit()._perp(),fe=pe._add(he)._unit();fe._mult(1/(fe.x*he.x+fe.y*he.y)),$.push(fe._mult(I)._add(se))}M.push($)}return M}(l,w*o.pixelToTileUnitsFactor)),function(T,I,M){for(let P=0;P<I.length;P++){const z=I[P];if(T.length>=3)for(let N=0;N<z.length;N++)if(Ic(T,z[N]))return!0;if(Og(T,z,M))return!0}return!1}(_,l,x)}isTileClipped(){return!0}},symbol:Nc,background:class extends Ao{constructor(o){super(o,Am)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ao{constructor(o){super(o,Bp)}getProgramIds(){return["raster"]}},sky:class extends Ao{constructor(o){super(o,Pm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=dp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}}getCenter(o,n){const s=this.paint.get("sky-type");if("atmosphere"===s){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=o.style.light,_=f.properties.get("position");return h&&"viewport"===f.properties.get("anchor")&&En("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?km(_.azimuthal,90-_.polar,n):km(l[0],90-l[1],n)}if("gradient"===s){const l=this.paint.get("sky-gradient-center");return km(l[0],90-l[1],n)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}},{HTMLImageElement:Ju,HTMLCanvasElement:td,HTMLVideoElement:nd,ImageData:rd,ImageBitmap:Np}=nt;class id{constructor(n,s,l,h){this.context=n,this.format=l,this.texture=n.gl.createTexture(),this.update(s,h)}update(n,s,l){const{width:h,height:f}=n,{context:_}=this,{gl:x}=_;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||!1!==s.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===f){const{x:w,y:T}=l||{x:0,y:0};n instanceof Ju||n instanceof td||n instanceof nd||n instanceof rd||Np&&n instanceof Np?x.texSubImage2D(x.TEXTURE_2D,0,w,T,x.RGBA,x.UNSIGNED_BYTE,n):x.texSubImage2D(x.TEXTURE_2D,0,w,T,h,f,x.RGBA,x.UNSIGNED_BYTE,n.data)}else this.size=[h,f],n instanceof Ju||n instanceof td||n instanceof nd||n instanceof rd||Np&&n instanceof Np?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,n):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,n.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(n,s){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?n===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:n),this.filter=n),s!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,s),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Vp{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Bs({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const l=this.getKey(n,s);return this.positions[l]}trim(){const n=this.width,s=this.height=ra(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,l){const h=[];let f=n.length%2==1?-n[n.length-1]*l:0,_=n[0]*l,x=!0;h.push({left:f,right:_,isDash:x,zeroLength:0===n[0]});let w=n[0];for(let T=1;T<n.length;T++){x=!x;const I=n[T];f=w*l,w+=I,_=w*l,h.push({left:f,right:_,isDash:x,zeroLength:0===I})}return h}addRoundDash(n,s,l){const h=s/2;for(let f=-l;f<=l;f++){const _=this.width*(this.nextRow+l+f);let x=0,w=n[x];for(let T=0;T<this.width;T++){T/w.right>1&&(w=n[++x]);const I=Math.abs(T-w.left),M=Math.abs(T-w.right),P=Math.min(I,M);let z;const N=f/l*(h+1);if(w.isDash){const $=h-Math.abs(N);z=Math.sqrt(P*P+$*$)}else z=h-Math.sqrt(P*P+N*N);this.image.data[_+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(n,s){for(let w=n.length-1;w>=0;--w){const T=n[w],I=n[w+1];T.zeroLength?n.splice(w,1):I&&I.isDash===T.isDash&&(I.left=T.left,n.splice(w,1))}const l=n[0],h=n[n.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let _=0,x=n[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=n[++_]);const T=Math.abs(w-x.left),I=Math.abs(w-x.right),M=Math.min(T,I);this.image.data[f+w]=Math.max(0,Math.min(255,(x.isDash?M:-M)+s+128))}}addDash(n,s){const l=this.getKey(n,s);if(this.positions[l])return this.positions[l];const h="round"===s,f=h?7:0,_=2*f+1;if(this.nextRow+_>this.height)return En("LineAtlas out of space"),null;0===n.length&&n.push(1);let x=0;for(let I=0;I<n.length;I++)n[I]<0&&(En("Negative value is found in line dasharray, replacing values with 0"),n[I]=0),x+=n[I];if(0!==x){const I=this.width/x,M=this.getDashRanges(n,this.width,I);h?this.addRoundDash(M,I,f):this.addRegularDash(M,"square"===s?.5*I:0)}const w=this.nextRow+f;this.nextRow+=_;const T={tl:[w,f],br:[x,0]};return this.positions[l]=T,T}}Ye("LineAtlas",Vp);class k_{constructor(n){this._callback=n,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const R_=nt.performance;function Up(o){const n=o?o.url.toString():void 0;return R_.getEntriesByName(n)}class Vv{constructor(){this.tasks={},this.taskQueue=[],$o(["process"],this),this.invoker=new k_(this.process),this.nextId=0}add(n,s){const l=this.nextId++,h=function({type:f,isSymbolTile:_,zoom:x}){return x=x||0,"message"===f?0:"maybePrepare"!==f||_?"parseTile"!==f||_?"parseTile"===f&&_?300-x:"maybePrepare"===f&&_?400-x:500:200-x:100-x}(s);if(0===h){yr();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:n,metadata:s,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){yr();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const n=this.pick();if(null===n)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<s&&(s=f.priority,n=h)}if(null===n)return null;const l=this.taskQueue[n];return this.taskQueue.splice(n,1),l}remove(){this.invoker.remove()}}function od(o,n){const s=Math.pow(2,-o.z),l=o.x*s,h=(o.x+1)*s,f=o.y*s,_=(o.y+1)*s;if("mercator"===n.name)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:n};const x=Fs(l),w=Fs(h),T=_i(f),I=_i(_),M=n.project(x,T),P=n.project(w,T),z=n.project(w,I),N=n.project(x,I);let $=Math.min(M.x,P.x,z.x,N.x),K=Math.min(M.y,P.y,z.y,N.y),te=Math.max(M.x,P.x,z.x,N.x),se=Math.max(M.y,P.y,z.y,N.y);const ue=s/16;function pe(fe,Me,Ee,Ze,Oe,Ae){const ze=(Ee+Oe)/2,Ne=(Ze+Ae)/2,ke=n.project(Fs(ze),_i(Ne)),Ke=Math.max(0,$-ke.x,K-ke.y,ke.x-te,ke.y-se);$=Math.min($,ke.x),te=Math.max(te,ke.x),K=Math.min(K,ke.y),se=Math.max(se,ke.y),Ke>ue&&(pe(fe,ke,Ee,Ze,ze,Ne),pe(ke,Me,ze,Ne,Oe,Ae))}pe(M,P,l,f,h,f),pe(P,z,h,f,h,_),pe(z,N,h,_,l,_),pe(N,M,l,_,l,f),$-=ue,K-=ue,te+=ue,se+=ue;const he=1/Math.max(te-$,se-K);return{scale:he,x:$*he,y:K*he,x2:te*he,y2:se*he,projection:n}}function L_(o,n,s){var l=2*Math.PI*6378137/256/Math.pow(2,s);return[o*l-2*Math.PI*6378137/2,n*l-2*Math.PI*6378137/2]}class sd{constructor(n,s,l){this.z=n,this.x=s,this.y=l,this.key=Pl(0,n,n,s,l)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const l=(f=this.y,_=this.z,x=L_(256*(h=this.x),256*(f=Math.pow(2,_)-f-1),_),w=L_(256*(h+1),256*(f+1),_),x[0]+","+x[1]+","+w[0]+","+w[1]);var h,f,_,x,w;const T=function(I,M,P){let z,N="";for(let $=I;$>0;$--)z=1<<$-1,N+=(M&z?1:0)+(P&z?2:0);return N}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",T).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jp{constructor(n,s){this.wrap=n,this.canonical=s,this.key=Pl(n,s.z,s.z,s.x,s.y)}}class yi{constructor(n,s,l,h,f){this.overscaledZ=n,this.wrap=s,this.canonical=new sd(l,+h,+f),this.key=0===s&&n===l?this.canonical.key:Pl(s,n,l,h,f)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new yi(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yi(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return Pl(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-n;return Pl(this.wrap*+s,n,n,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return 0===n.overscaledZ||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new yi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new yi(s,this.wrap,s,l,h),new yi(s,this.wrap,s,l+1,h),new yi(s,this.wrap,s,l,h+1),new yi(s,this.wrap,s,l+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new yi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new yi(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jp(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pl(o,n,s,l,h){const f=1<<Math.min(s,22);let _=f*(h%f)+l%f;return o&&s<22&&(_+=f*f*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*_+s)+(n-s)}Ye("CanonicalTileID",sd),Ye("OverscaledTileID",yi,{omit:["projMatrix"]});class F_{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const l=n[s];this._stringToNumber[l]=s,this._numberToString[s]=l}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}class O_{constructor(n,s,l,h,f){this.type="Feature",this._vectorTileFeature=n,n._z=s,n._x=l,n._y=h,this.properties=n.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const s in this)"_geometry"!==s&&"_vectorTileFeature"!==s&&(n[s]=this[s]);return n}}var Uv=ve([{name:"a_pos",type:"Int16",components:2}]);const kl=new Uint16Array(8184);for(let o=0;o<2046;o++){let n=o+2,s=0,l=0,h=0,f=0,_=0,x=0;for(1&n?h=f=_=32:s=l=x=32;(n>>=1)>1;){const T=s+h>>1,I=l+f>>1;1&n?(h=s,f=l,s=_,l=x):(s=h,l=f,h=_,f=x),_=T,x=I}const w=4*o;kl[w+0]=s,kl[w+1]=l,kl[w+2]=h,kl[w+3]=f}const Hs=new Uint16Array(2178),Rl=new Uint8Array(1089),$p=new Uint16Array(1089);function z_(o){return 0===o?-.03125:32===o?.03125:0}var ds=ve([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ad={type:2,extent:Rt,loadGeometry:()=>[[new Ie(0,0),new Ie(8193,0),new Ie(8193,8193),new Ie(0,8193),new Ie(0,0)]]};class Rm{constructor(n,s,l,h,f){this.tileID=n,this.uid=_s(),this.uses=0,this.tileSize=s,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<Ei.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=od(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,l){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,f){const _={};if(!f)return _;for(const x of h){const w=x.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(T=>w.filter(I=>I.id===T)[0]));for(const T of w)_[T.id]=x}}return _}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof $s){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof $s&&f.hasRTLText){this.hasRTLText=!0,L.isLoading()||L.isLoaded()||"deferred"!==A()||R();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(h).queryRadius(f))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new Or}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(n)}const s=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new id(n,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new id(n,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new id(n,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,s,l,h,f,_,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:f,tileTransform:this.tileTransform},n,s,l):{}}querySourceFeatures(n,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=s?s.sourceLayer:"",_=h._geojsonTileLayer||h[f];if(!_)return;const x=fc(s&&s.filter),{z:w,x:T,y:I}=this.tileID.canonical,M={z:w,x:T,y:I};for(let P=0;P<_.length;P++){const z=_.feature(P);if(x.needGeometry){const K=as(z,!0);if(!x.filter(new F(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!x.filter(new F(this.tileID.overscaledZ),z))continue;const N=l.getId(z,f),$=new O_(z,w,T,I,N);$.tile=M,n.push($)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const l=wi(n.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(s)if(this.expirationTime<s)h=!0;else{const f=this.expirationTime-s;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(n).length||!s)return;const l=this.latestFeatureIndex.loadVTLayers(),h=s.style.listImages();for(const f in this.buckets){if(!s.style.hasLayer(f))continue;const _=this.buckets[f],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],T=n[x];if(!w||!T||0===Object.keys(T).length)continue;if(_.update(T,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Hh||_ instanceof Tl){const M=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&M&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(M.id,this.tileID)}const I=s&&s.style&&s.style.getLayer(f);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ei.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Ei.now()+n}setDependencies(n,s){const l={};for(const h of s)l[h]=!0;this.dependencies[n]=l}hasDependency(n,s){for(const l of n){const h=this.dependencies[l];if(h)for(const f of s)if(h[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const l=ko(ad,this.tileID.canonical,this.tileTransform)[0],h=new Je,f=new dr;for(let _=0;_<l.length;_++){const{x,y:w}=l[_];h.emplaceBack(x,w),f.emplaceBack(_)}f.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(f),this._tileDebugBuffer=n.createVertexBuffer(h,ds.members),this._tileDebugSegments=pr.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const l=ko(ad,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const _=function(x,w){const T=od(x,w),I=Math.pow(2,x.z);for(let K=0;K<33;K++)for(let te=0;te<33;te++){const se=Fs((x.x+(te+z_(te))/32)/I),ue=_i((x.y+(K+z_(K))/32)/I),pe=w.project(se,ue),he=33*K+te;Hs[2*he+0]=Math.round((pe.x*T.scale-T.x)*Rt),Hs[2*he+1]=Math.round((pe.y*T.scale-T.y)*Rt)}Rl.fill(0),$p.fill(0);for(let K=2045;K>=0;K--){const te=4*K,se=kl[te+0],ue=kl[te+1],pe=kl[te+2],he=kl[te+3],fe=se+pe>>1,Me=ue+he>>1,Ee=fe+Me-ue,Ze=Me+se-fe,Oe=33*ue+se,Ae=33*he+pe,ze=33*Me+fe,Ne=Math.hypot((Hs[2*Oe+0]+Hs[2*Ae+0])/2-Hs[2*ze+0],(Hs[2*Oe+1]+Hs[2*Ae+1])/2-Hs[2*ze+1])>=16;if(Rl[ze]=Rl[ze]||(Ne?1:0),K<1022){const ke=33*(ue+Ze>>1)+(se+Ee>>1),Ke=33*(he+Ze>>1)+(pe+Ee>>1);Rl[ze]=Rl[ze]||Rl[ke]||Rl[Ke]}}const M=new lt,P=new Pn;let z=0;function N(K,te){const se=33*te+K;return 0===$p[se]&&(M.emplaceBack(Hs[2*se+0],Hs[2*se+1],K*Rt/32,te*Rt/32),$p[se]=++z),$p[se]-1}function $(K,te,se,ue,pe,he){const fe=K+se>>1,Me=te+ue>>1;if(Math.abs(K-pe)+Math.abs(te-he)>1&&Rl[33*Me+fe])$(pe,he,K,te,fe,Me),$(se,ue,pe,he,fe,Me);else{const Ee=N(K,te),Ze=N(se,ue),Oe=N(pe,he);P.emplaceBack(Ee,Ze,Oe)}}return $(0,0,32,32,32,0),$(32,32,0,0,0,32),{vertices:M,indices:P}}(this.tileID.canonical,s);h=_.vertices,f=_.indices}else{h=new lt,f=new Pn;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const _=Ro(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)f.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,ds.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(f),this._tileBoundsSegments=pr.simpleSegment(0,0,h.length,f.length)}}class Lm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,l){const h=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Vn(this.stateChanges[n][h],l),null===this.deletedStates[n]){this.deletedStates[n]={};for(const f in this.state[n])f!==h&&(this.deletedStates[n][f]=null)}else if(this.deletedStates[n]&&null===this.deletedStates[n][h]){this.deletedStates[n][h]={};for(const f in this.state[n][h])l[f]||(this.deletedStates[n][h][f]=null)}else for(const f in l)this.deletedStates[n]&&this.deletedStates[n][h]&&null===this.deletedStates[n][h][f]&&delete this.deletedStates[n][h][f]}removeFeatureState(n,s,l){if(null===this.deletedStates[n])return;const h=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},l&&void 0!==s)null!==this.deletedStates[n][h]&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][l]=null);else if(void 0!==s)if(this.stateChanges[n]&&this.stateChanges[n][h])for(l in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][l]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,s){const l=String(s),h=Vn({},(this.state[n]||{})[l],(this.stateChanges[n]||{})[l]);if(null===this.deletedStates[n])return{};if(this.deletedStates[n]){const f=this.deletedStates[n][s];if(null===f)return{};for(const _ in f)delete h[_]}return h}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),Vn(this.state[h][_],this.stateChanges[h][_]),f[_]=this.state[h][_];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(null===this.deletedStates[h])for(const _ in this.state[h])f[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];f[_]=this.state[h][_]}l[h]=l[h]||{},Vn(l[h],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in n)n[h].setFeatureState(l,s)}}class ld{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const l=this.toIdx(n,s);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function Gp(o,n,s,l){let h=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(s[_]<o[_]||s[_]>n[_])return null}else{const x=1/l[_];let w=(o[_]-s[_])*x,T=(n[_]-s[_])*x;if(w>T){const I=w;w=T,T=I}if(w>h&&(h=w),T<f&&(f=T),h>f)return null}return h}function cd(o,n,s,l,h,f,_,x,w,T,I){const M=l-o,P=h-n,z=f-s,N=_-o,$=x-n,K=w-s,te=I[1]*K-I[2]*$,se=I[2]*N-I[0]*K,ue=I[0]*$-I[1]*N,pe=M*te+P*se+z*ue;if(Math.abs(pe)<1e-15)return null;const he=1/pe,fe=T[0]-o,Me=T[1]-n,Ee=T[2]-s,Ze=(fe*te+Me*se+Ee*ue)*he;if(Ze<0||Ze>1)return null;const Oe=Me*z-Ee*P,Ae=Ee*M-fe*z,ze=fe*P-Me*M,Ne=(I[0]*Oe+I[1]*Ae+I[2]*ze)*he;return Ne<0||Ze+Ne>1?null:(N*Oe+$*Ae+K*ze)*he}function Fm(o,n,s){return(o-n)/(s-n)}function qs(o,n,s,l,h,f,_,x,w){const T=1<<s,I=f-l,M=_-h,P=(o+1)/T*I+l,z=(n+0)/T*M+h,N=(n+1)/T*M+h;x[0]=(o+0)/T*I+l,x[1]=z,w[0]=P,w[1]=N}class Hp{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(f){const _=Math.ceil(Math.log2(f.dim/8)),x=[];let w=Math.ceil(Math.pow(2,_));const T=1/w,I=(z,N,$,K,te)=>{const se=K?1:0,ue=(z+1)*$-se,pe=N*$,he=(N+1)*$-se;te[0]=z*$,te[1]=pe,te[2]=ue,te[3]=he};let M=new ld(w);const P=[];for(let z=0;z<w*w;z++){I(z%w,Math.floor(z/w),T,!1,P);const N=ps(P[0],P[1],f),$=ps(P[2],P[1],f),K=ps(P[2],P[3],f),te=ps(P[0],P[3],f);M.minimums.push(Math.min(N,$,K,te)),M.maximums.push(Math.max(N,$,K,te)),M.leaves.push(1)}for(x.push(M),w/=2;w>=1;w/=2){const z=x[x.length-1];M=new ld(w);for(let N=0;N<w*w;N++){I(N%w,Math.floor(N/w),2,!0,P);const $=z.getElevation(P[0],P[1]),K=z.getElevation(P[2],P[1]),te=z.getElevation(P[2],P[3]),se=z.getElevation(P[0],P[3]),ue=z.isLeaf(P[0],P[1]),pe=z.isLeaf(P[2],P[1]),he=z.isLeaf(P[2],P[3]),fe=z.isLeaf(P[0],P[3]),Me=Math.min($.min,K.min,te.min,se.min),Ee=Math.max($.max,K.max,te.max,se.max),Ze=ue&&pe&&he&&fe;M.maximums.push(Ee),M.minimums.push(Me),M.leaves.push(Ee-Me<=5&&Ze?1:0)}x.push(M)}return x}(this.dem),l=s.length-1,h=s[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(s,0,0,l,0)}raycastRoot(n,s,l,h,f,_,x=1){return Gp([n,s,-100],[l,h,this.maximums[0]*x],f,_)}raycast(n,s,l,h,f,_,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(n,s,l,h,f,_,x);if(null==w)return null;const T=[],I=[],M=[],P=[],z=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:N,t:$,nodex:K,nodey:te,depth:se}=z.pop();if(this.leaves[N]){qs(K,te,se,n,s,l,h,M,P);const pe=1<<se,he=(K+0)/pe,fe=(K+1)/pe,Me=(te+0)/pe,Ee=(te+1)/pe,Ze=ps(he,Me,this.dem)*x,Oe=ps(fe,Me,this.dem)*x,Ae=ps(fe,Ee,this.dem)*x,ze=ps(he,Ee,this.dem)*x,Ne=cd(M[0],M[1],Ze,P[0],M[1],Oe,P[0],P[1],Ae,f,_),ke=cd(P[0],P[1],Ae,M[0],P[1],ze,M[0],M[1],Ze,f,_),Ke=Math.min(null!==Ne?Ne:Number.MAX_VALUE,null!==ke?ke:Number.MAX_VALUE);if(Ke!==Number.MAX_VALUE)return Ke;{const Qe=Hf([],f,_,$);if(Om(Ze,Oe,ze,Ae,Fm(Qe[0],M[0],P[0]),Fm(Qe[1],M[1],P[1]))>=Qe[2])return $}continue}let ue=0;for(let pe=0;pe<this._siblingOffset.length;pe++){qs((K<<1)+this._siblingOffset[pe][0],(te<<1)+this._siblingOffset[pe][1],se+1,n,s,l,h,M,P),M[2]=-100,P[2]=this.maximums[this.childOffsets[N]+pe]*x;const he=Gp(M,P,f,_);if(null!=he){const fe=he;T[pe]=fe;let Me=!1;for(let Ee=0;Ee<ue&&!Me;Ee++)fe>=T[I[Ee]]&&(I.splice(Ee,0,pe),Me=!0);Me||(I[ue]=pe),ue++}}for(let pe=0;pe<ue;pe++){const he=I[pe];z.push({idx:this.childOffsets[N]+he,t:T[he],nodex:(K<<1)+this._siblingOffset[he][0],nodey:(te<<1)+this._siblingOffset[he][1],depth:se+1})}}return null}_addNode(n,s,l){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,l,h,f){if(1===n[h].isLeaf(s,l))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=h-1,x=n[_];let w,T=0;for(let I=0;I<this._siblingOffset.length;I++){const M=2*s+this._siblingOffset[I][0],P=2*l+this._siblingOffset[I][1],z=x.getElevation(M,P),N=x.isLeaf(M,P),$=this._addNode(z.min,z.max,N);N&&(T|=1<<I),w||(w=$)}for(let I=0;I<this._siblingOffset.length;I++)T&1<<I||this._construct(n,2*s+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],_,w+I)}}function Om(o,n,s,l,h,f){return Jt(Jt(o,s,f),Jt(n,l,f),h)}function ps(o,n,s){const l=s.dim,h=en(o*l-.5,0,l-1),f=en(n*l-.5,0,l-1),_=Math.floor(h),x=Math.floor(f),w=Math.min(_+1,l-1),T=Math.min(x+1,l-1);return Om(s.get(_,x),s.get(w,x),s.get(_,T),s.get(w,T),h-_,f-x)}const zm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Qu{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,l,h=!1,f=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return En(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2;if(this.data=new Uint32Array(s.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let x=0;x<_;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(_,x)]=this.data[this._idx(_-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,_)]=this.data[this._idx(x,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Hp(this)}get(n,s,l=!1){const h=new Uint8Array(this.data.buffer);l&&(n=en(n,-1,this.dim),s=en(s,-1,this.dim));const f=4*this._idx(n,s);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(h[f],h[f+1],h[f+2])}static getUnpackVector(n){return zm[n]}get unpackVector(){return zm[this.encoding]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}_unpackMapbox(n,s,l){return(256*n*256+256*s+l)/10-1e4}_unpackTerrarium(n,s,l){return 256*n+s+l/256-32768}static pack(n,s){const l=[0,0,0,0],h=Qu.getUnpackVector(s);let f=Math.floor((n+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new Ii({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,s,l){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=s*this.dim,f=s*this.dim+this.dim,_=l*this.dim,x=l*this.dim+this.dim;switch(s){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:_=x-1;break;case 1:x=_+1}const w=-s*this.dim,T=-l*this.dim;for(let I=_;I<x;I++)for(let M=h;M<f;M++)this.data[this._idx(M,I)]=n.data[this._idx(M+w,I+T)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ye("DEMData",Qu),Ye("DemMinMaxQuadTree",Hp,{omit:["dem"]});class B_{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,l){const h=n.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const f={value:s,timeout:void 0};if(void 0!==l&&(f.timeout=setTimeout(()=>{this.remove(n,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[n].length&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const l=n.wrapped().key,h=void 0===s?0:this.data[l].indexOf(s),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const l in this.data)for(const h of this.data[l])n(h.value)||s.push(h);for(const l of s)this.remove(l.value.tileID,l)}}class Vc{constructor(n,s,l){this.func=n,this.mask=s,this.range=l}}Vc.ReadOnly=!1,Vc.ReadWrite=!0,Vc.disabled=new Vc(519,Vc.ReadOnly,[0,1]);class Pa{constructor(n,s,l,h,f,_){this.test=n,this.ref=s,this.mask=l,this.fail=h,this.depthFail=f,this.pass=_}}Pa.disabled=new Pa({func:519,mask:0},0,0,7680,7680,7680);class go{constructor(n,s,l){this.blendFunction=n,this.blendColor=s,this.mask=l}}go.Replace=[1,0],go.disabled=new go(go.Replace,Vt.transparent,[!1,!1,!1,!1]),go.unblended=new go(go.Replace,Vt.transparent,[!0,!0,!0,!0]),go.alphaBlended=new go([1,771],Vt.transparent,[!0,!0,!0,!0]);class ci{constructor(n,s,l){this.enable=n,this.mode=s,this.frontFace=l}}ci.disabled=new ci(!1,1029,2305),ci.backCCW=new ci(!0,1029,2305),ci.backCW=new ci(!0,1029,2304),ci.frontCW=new ci(!0,1028,2304),ci.frontCCW=new ci(!0,1028,2305);class Ol extends $e{constructor(n,s,l){super(),this.id=n,this._onlySymbols=l,s.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new B_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Lm}onAdd(n){this.map=n,this._maxTileCacheSize=n?n._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(n),l.prepare(this.map.style.imageManager)}}getIds(){return jo(this._tiles).map(n=>n.tileID).sort(qp).map(n=>n.key)}getRenderableIds(n){const s=[];for(const l in this._tiles)this._isIdRenderable(+l,n)&&s.push(this._tiles[l]);return n?s.sort((l,h)=>{const f=l.tileID,_=h.tileID,x=new Ie(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),w=new Ie(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(qp).map(l=>l.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)"errored"!==this._tiles[n].state&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const l=this._tiles[n];l&&("loading"!==l.state&&(l.state=s),this._loadTile(l,this._tileLoaded.bind(this,l,n,s)))}_tileLoaded(n,s,l,h){if(h)return n.state="errored",void(404!==h.status?this._source.fire(new ot(h,{tile:n})):this.update(this.transform));n.timeAdded=Ei.now(),"expired"===l&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),"raster-dem"===this.getSource().type&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Le("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let h=0;h<s.length;h++){const f=s[h];if(n.neighboringTiles&&n.neighboringTiles[f]){const _=this.getTileByID(f);l(n,_),l(_,n)}}function l(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),T=f.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,_,x),h.neighboringTiles&&h.neighboringTiles[T]&&(h.neighboringTiles[T].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,l,h){for(const f in this._tiles){let _=this._tiles[f];if(h[f]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>l)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const T=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[T.key],_&&_.hasData()&&(x=T)}let w=x;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),n[w.key]){h[x.key]=x;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const l=this._loadedParentTiles[n.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=n.overscaledZ-1;l>=s;l--){const h=n.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const l=Math.ceil(n.width/s)+1,h=Math.ceil(n.height/s)+1,f=Math.floor(l*h*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(_)}handleWrapJump(n){const s=Math.round((n-(void 0===this._prevLng?n:this._prevLng))/360);if(this._prevLng=n,s){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,s,l){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(n,s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new yi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const f=this._updateRetainedTiles(h);if(Zp(this._source.type)&&0!==h.length){const x={},w={},T=Object.keys(f);for(const M of T){const P=f[M],z=this._tiles[M];if(!z||z.fadeEndTime&&z.fadeEndTime<=Ei.now())continue;const N=this.findLoadedParent(P,Math.max(P.overscaledZ-Ol.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),w[M]=P}const I=h[h.length-1].overscaledZ;for(const M in this._tiles){const P=this._tiles[M];if(f[M]||!P.hasData())continue;let z=P.tileID;for(;z.overscaledZ>I;){z=z.scaledTo(z.overscaledZ-1);const N=this._tiles[z.key];if(N&&N.hasData()&&w[z.key]){f[M]=P.tileID;break}}}for(const M in x)f[M]||(this._coveredTiles[M]=!0,f[M]=x[M])}for(const x in f)this._tiles[x].clearFadeHold();const _=function(x,w){const T=[];for(const I in x)I in w||T.push(I);return T}(this._tiles,f);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(0===n.length)return s;const l={},h=n.reduce((T,I)=>Math.min(T,I.overscaledZ),1/0),f=n[0].overscaledZ,_=Math.max(f-Ol.maxOverzooming,this._source.minzoom),x=Math.max(f+Ol.maxUnderzooming,this._source.minzoom),w={};for(const T of n){const I=this._addTile(T);s[T.key]=T,I.hasData()||h<this._source.maxzoom&&(w[T.key]=T)}this._retainLoadedChildren(w,h,x,s);for(const T of n){let I=this._tiles[T.key];if(I.hasData())continue;if(T.canonical.z>=this._source.maxzoom){const P=T.children(this._source.maxzoom)[0],z=this.getTile(P);if(z&&z.hasData()){s[P.key]=P;continue}}else{const P=T.children(this._source.maxzoom);if(s[P[0].key]&&s[P[1].key]&&s[P[2].key]&&s[P[3].key])continue}let M=I.wasRequested();for(let P=T.overscaledZ-1;P>=_;--P){const z=T.scaledTo(P);if(l[z.key]||(l[z.key]=!0,I=this.getTile(z),!I&&M&&(I=this._addTile(z)),I&&(s[z.key]=z,M=I.wasRequested(),I.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let l,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}s.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of s)this._loadedParentTiles[f]=l}}_addTile(n){let s=this._tiles[n.key];if(s)return s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const l=Boolean(s);if(!l){const h=this.map?this.map.painter:null;s=new Rm(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,h,"raster"===this._source.type||"raster-dem"===this._source.type),this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,l||this._source.fire(new Le("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const l=s.getExpiryTimeout();l&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},l))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(n,s,l){const h=[],f=this.transform;if(!f)return h;for(const _ in this._tiles){const x=this._tiles[_];if(l&&x.clearQueryDebugViz(),x.holdingForFade())continue;const w=n.containsTile(x,f,s);w&&h.push(w)}return h}getVisibleCoordinates(n){const s=this.getRenderableIds(n).map(l=>this._tiles[l].tileID);for(const l of s)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Zp(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=Ei.now())return!0}return!1}setFeatureState(n,s,l){this._state.updateState(n=n||"_geojsonTileLayer",s,l)}removeFeatureState(n,s,l){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,l)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,l){const h=this._tiles[n];h&&h.setDependencies(s,l)}reloadTilesForDependencies(n,s){for(const l in this._tiles)this._tiles[l].hasDependency(n,s)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(n,s))}}function qp(o,n){const s=Math.abs(2*o.wrap)-+(o.wrap<0),l=Math.abs(2*n.wrap)-+(n.wrap<0);return o.overscaledZ-n.overscaledZ||l-s||n.canonical.y-o.canonical.y||n.canonical.x-o.canonical.x}function Zp(o){return"raster"===o||"image"===o||"video"===o}Ol.maxOverzooming=10,Ol.maxUnderzooming=3;class Uc{constructor(n,s,l){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=l}static create(n,s,l){const h=l||n.findDEMTileFor(s);if(!h||!h.dem)return;const f=h.dem,_=h.tileID,x=1<<s.canonical.z-_.canonical.z;return new Uc(h,h.tileSize/Rt/x,[(s.canonical.x/x-_.canonical.x)*f.dim,(s.canonical.y/x-_.canonical.y)*f.dim])}tileCoordToPixel(n,s){const l=s*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),f=Math.floor(l);return new Ie(h,f)}getElevationAt(n,s,l,h){const f=n*this._scale+this._offset[0],_=s*this._scale+this._offset[1],x=Math.floor(f),w=Math.floor(_),T=this._dem;return h=!!h,l?Jt(Jt(T.get(x,w,h),T.get(x,w+1,h),_-w),Jt(T.get(x+1,w,h),T.get(x+1,w+1,h),_-w),f-x):T.get(x,w,h)}getElevationAtPixel(n,s,l){return this._dem.get(n,s,!!l)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*gi(1,n)*this._dem.stride}}class ud{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ba(Rt,16,0),this.featureIndexArray=new Jd,this.promoteId=s}insert(n,s,l,h,f,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,_);const w=this.grid;for(let T=0;T<s.length;T++){const I=s[T],M=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){const z=I[P];M[0]=Math.min(M[0],z.x),M[1]=Math.min(M[1],z.y),M[2]=Math.max(M[2],z.x),M[3]=Math.max(M[3],z.y)}M[0]<Rt&&M[1]<Rt&&M[2]>=0&&M[3]>=0&&w.insert(x,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fc.VectorTile(new zu(this.rawTileData)).layers,this.sourceLayerCoder=new F_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,l,h){this.loadVTLayers();const f=n.params||{},_=fc(f.filter),x=n.tileResult,w=n.transform,T=x.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(N,$,K,te)=>Lt(x.bufferedTilespaceGeometry,N,$,K,te));I.sort(hd);let M=null;w.elevation&&I.length>0&&(M=Uc.create(w.elevation,this.tileID));const P={};let z;for(let N=0;N<I.length;N++){const $=I[N];if($===z)continue;z=$;const K=this.featureIndexArray.get($);let te=null;this.loadMatchingFeature(P,K,_,f.layers,f.availableImages,s,l,h,(se,ue,pe,he=0)=>(te||(te=ko(se,this.tileID.canonical,n.tileTransform)),ue.queryIntersectsFeature(x,se,pe,te,this.z,n.transform,n.pixelPosMatrix,M,he)))}return P}loadMatchingFeature(n,s,l,h,f,_,x,w,T){const{featureIndex:I,bucketIndex:M,sourceLayerIndex:P,layoutVertexArrayOffset:z}=s,N=this.bucketLayerIDs[M];if(h&&!function(se,ue){for(let pe=0;pe<se.length;pe++)if(ue.indexOf(se[pe])>=0)return!0;return!1}(h,N))return;const $=this.sourceLayerCoder.decode(P),K=this.vtLayers[$].feature(I);if(l.needGeometry){const se=as(K,!0);if(!l.filter(new F(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!l.filter(new F(this.tileID.overscaledZ),K))return;const te=this.getId(K,$);for(let se=0;se<N.length;se++){const ue=N[se];if(h&&h.indexOf(ue)<0)continue;const pe=_[ue];if(!pe)continue;let he={};void 0!==te&&w&&(he=w.getState(pe.sourceLayer||"_geojsonTileLayer",te));const fe=Vn({},x[ue]);fe.paint=Wp(fe.paint,pe.paint,K,he,f),fe.layout=Wp(fe.layout,pe.layout,K,he,f);const Me=!T||T(K,pe,he,z);if(!Me)continue;const Ee=new O_(K,this.z,this.x,this.y,te);Ee.layer=fe;let Ze=n[ue];void 0===Ze&&(Ze=n[ue]=[]),Ze.push({featureIndex:I,feature:Ee,intersectionZ:Me})}}lookupSymbolFeatures(n,s,l,h,f,_,x,w){const T={};this.loadVTLayers();const I=fc(f);for(const M of n)this.loadMatchingFeature(T,{bucketIndex:l,sourceLayerIndex:h,featureIndex:M,layoutVertexArrayOffset:0},I,_,x,w,s);return T}loadFeature(n){const{featureIndex:s,sourceLayerIndex:l}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[s])return f[s];const _=this.vtLayers[h].feature(s);return f[s]=_,_}hasLayer(n){for(const s of this.bucketLayerIDs)for(const l of s)if(n===l)return!0;return!1}getId(n,s){let l=n.id;return this.promoteId&&(l=n.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[s]],"boolean"==typeof l&&(l=Number(l))),l}}function Wp(o,n,s,l,h){return Zi(o,(f,_)=>{const x=n instanceof re?n.get(_):null;return x&&x.evaluate?x.evaluate(s,l,h):x})}function hd(o,n){return n-o}Ye("FeatureIndex",ud,{omit:["rawTileData","sourceLayerCoder"]});class Bm{constructor(n){const s={},l=[];for(const x in n){const w=n[x],T=s[x]={};for(const I in w.glyphs){const M=w.glyphs[+I];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const P=M.metrics.localGlyph?2:1,z={x:0,y:0,w:M.bitmap.width+2*P,h:M.bitmap.height+2*P};l.push(z),T[I]=z}}const{w:h,h:f}=ju(l),_=new Bs({width:h||1,height:f||1});for(const x in n){const w=n[x];for(const T in w.glyphs){const I=w.glyphs[+T];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const M=s[x][T],P=I.metrics.localGlyph?2:1;Bs.copy(I.bitmap,_,{x:0,y:0},{x:M.x+P,y:M.y+P},I.bitmap)}}this.image=_,this.positions=s}}Ye("GlyphAtlas",Bm);class Nm{constructor(n){this.tileID=new yi(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,n.projection&&(this.tileTransform=od(n.tileID.canonical,n.projection))}parse(n,s,l,h,f){this.status="parsing",this.data=n,this.collisionBoxArray=new Or;const _=new F_(Object.keys(n.layers).sort()),x=new ud(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},T=new Vp(256,256),I={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:T,availableImages:l},M=s.familiesBySource[this.source];for(const he in M){const fe=n.layers[he];if(!fe)continue;let Me=!1,Ee=!1;for(const Ae of M[he])"symbol"===Ae[0].type?Me=!0:Ee=!0;if(!0===this.isSymbolTile&&!Me||!1===this.isSymbolTile&&!Ee)continue;1===fe.version&&En(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ze=_.encode(he),Oe=[];for(let Ae=0;Ae<fe.length;Ae++){const ze=fe.feature(Ae),Ne=x.getId(ze,he);Oe.push({feature:ze,id:Ne,index:Ae,sourceLayerIndex:Ze})}for(const Ae of M[he]){const ze=Ae[0];void 0!==this.isSymbolTile&&"symbol"===ze.type!==this.isSymbolTile||ze.minzoom&&this.zoom<Math.floor(ze.minzoom)||ze.maxzoom&&this.zoom>=ze.maxzoom||"none"!==ze.visibility&&(Vm(Ae,this.zoom,l),(w[ze.id]=ze.createBucket({index:x.bucketLayerIDs.length,layers:Ae,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ze,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:l})).populate(Oe,I,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Ae.map(Ne=>Ne.id)))}}let P,z,N,$;T.trim();const K={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},te=Zi(I.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(te).length?h.send("getGlyphs",{uid:this.uid,stacks:te},(he,fe)=>{P||(P=he,z=fe,pe.call(this))},void 0,!1,K):z={};const se=Object.keys(I.iconDependencies);se.length?h.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(he,fe)=>{P||(P=he,N=fe,pe.call(this))},void 0,!1,K):N={};const ue=Object.keys(I.patternDependencies);function pe(){if(P)return f(P);if(z&&N&&$){const he=new Bm(z),fe=new _m(N,$);for(const Me in w){const Ee=w[Me];Ee instanceof $s?(Vm(Ee.layers,this.zoom,l),S_(Ee,z,he.positions,N,fe.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom)):Ee.hasPattern&&(Ee instanceof Hh||Ee instanceof Tl||Ee instanceof $h)&&(Vm(Ee.layers,this.zoom,l),Ee.addFeatures(I,this.tileID.canonical,fe.patternPositions,l))}this.status="done",f(null,{buckets:jo(w).filter(Me=>!Me.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:T,imageAtlas:fe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?he.positions:null})}}ue.length?h.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(he,fe)=>{P||(P=he,$=fe,pe.call(this))},void 0,!1,K):$={},pe.call(this)}}function Vm(o,n,s){const l=new F(n);for(const h of o)h.recalculate(l,s)}class Xp{constructor(n){this.entries={},this.scheduler=n}request(n,s,l,h){const f=this.entries[n]=this.entries[n]||{callbacks:[]};if(f.result){const[_,x]=f.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},s):h(_,x),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=l((_,x)=>{f.result=[_,x];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,x)},s):w(_,x);setTimeout(()=>delete this.entries[n],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==h),f.callbacks.length||(f.cancel(),delete this.entries[n]))}}}function Kp(o,n,s){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const f=V(o.request,(_,x,w,T)=>{_?h(_):x&&h(null,{vectorTile:s?void 0:new Fc.VectorTile(new zu(x)),rawData:x,cacheControl:w,expires:T})});return()=>{f.cancel(),h()}},n)}var N_={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],conic:!0,initializeConstants(){if(this.constants&&Su(this.parallels,this.constants.parallels))return;const o=Math.sin(yn(this.parallels[0])),n=(o+Math.sin(yn(this.parallels[1])))/2,s=1+o*(2*n-o),l=Math.sqrt(s)/n;this.constants={n,c:s,r0:l,parallels:this.parallels}},project(o,n){this.initializeConstants();const s=yn(o-this.center[0]),l=yn(n),{n:h,c:f,r0:_}=this.constants,x=Math.sqrt(f-2*h*Math.sin(l))/h;return{x:x*Math.sin(s*h),y:x*Math.cos(s*h)-_}},unproject(o,n){this.initializeConstants();const{n:s,c:l,r0:h}=this.constants,f=h+n;let _=Math.atan2(o,Math.abs(f))*Math.sign(f);f*s<0&&(_-=Math.PI*Math.sign(o)*Math.sign(f));const x=yn(this.center[0])*s;_=xo(_,-Math.PI-x,Math.PI-x);const w=ti(_/s)+this.center[0],T=Math.asin(en((l-(o*o+f*f)*s*s)/(2*s),-1,1)),I=en(ti(T),-85.051129,Os);return new dn(w,I)}};const jc=1.340264,eh=-.081106,th=893e-6,Xr=.003796,dd=Math.sqrt(3)/2;var V_={name:"equalEarth",center:[0,0],range:[3.5,7],project(o,n){n=n/180*Math.PI,o=o/180*Math.PI;const s=Math.asin(dd*Math.sin(n)),l=s*s,h=l*l*l;return{x:.5*(o*Math.cos(s)/(dd*(jc+3*eh*l+h*(7*th+9*Xr*l)))/Math.PI+.5),y:1-.5*(s*(jc+eh*l+h*(th+Xr*l))/Math.PI+1)}},unproject(o,n){o=(2*o-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=s*s,h=l*l*l;for(let T,I,M,P=0;P<12&&(I=s*(jc+eh*l+h*(th+Xr*l))-n,M=jc+3*eh*l+h*(7*th+9*Xr*l),T=I/M,s=en(s-T,-Math.PI/3,Math.PI/3),l=s*s,h=l*l*l,!(Math.abs(T)<1e-12));++P);const f=dd*o*(jc+3*eh*l+h*(7*th+9*Xr*l))/Math.cos(s),_=Math.asin(Math.sin(s)/dd),x=en(180*f/Math.PI,-180,180),w=en(180*_/Math.PI,-85.051129,Os);return new dn(x,w)}},jv={name:"equirectangular",wrap:!0,center:[0,0],range:[3.5,7],project:(o,n)=>({x:.5+o/360,y:.5-n/360}),unproject(o,n){const s=360*(o-.5),l=en(360*(.5-n),-85.051129,Os);return new dn(s,l)}};const nh=Math.PI/2;function rh(o){return Math.tan((nh+o)/2)}var $v={name:"lambertConformalConic",range:[3.5,7],center:[0,30],parallels:[30,30],conic:!0,initializeConstants(){if(this.constants&&Su(this.parallels,this.constants.parallels))return;const o=yn(this.parallels[0]),n=yn(this.parallels[1]),s=Math.cos(o),l=o===n?Math.sin(o):Math.log(s/Math.cos(n))/Math.log(rh(n)/rh(o)),h=s*Math.pow(rh(o),l)/l;this.constants={n:l,f:h,parallels:this.parallels}},project(o,n){this.initializeConstants(),n=yn(n),o=yn(o-this.center[0]);const s=1e-6,{n:l,f:h}=this.constants;h>0?n<-nh+s&&(n=-nh+s):n>nh-s&&(n=nh-s);const f=h/Math.pow(rh(n),l),_=f*Math.sin(l*o),x=h-f*Math.cos(l*o);return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+.5)}},unproject(o,n){this.initializeConstants(),o=(2*o-.5)*Math.PI,n=(2*(1-n)-.5)*Math.PI;const{n:s,f:l}=this.constants,h=l-n,f=Math.sign(h),_=Math.sign(s)*Math.sqrt(o*o+h*h);let x=Math.atan2(o,Math.abs(h))*f;h*s<0&&(x-=Math.PI*Math.sign(o)*f);const w=en(ti(x/s)+this.center[0],-180,180),T=en(ti(2*Math.atan(Math.pow(l/_,1/s))-nh),-85.051129,Os);return new dn(w,T)}},U_={name:"mercator",wrap:!0,center:[0,0],project:(o,n)=>({x:Of(o),y:Mh(n)}),unproject(o,n){const s=Fs(o),l=_i(n);return new dn(s,l)}};const pd=yn(Os);var Um={name:"naturalEarth",center:[0,0],range:[3.5,7],project(o,n){const s=(n=yn(n))*n,l=s*s;return{x:.5*((o=yn(o))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1)}},unproject(o,n){o=(2*o-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,l=25,h=0,f=s*s;do{f=s*s;const w=f*f;h=(s*(1.007226+f*(.015085+w*(.028874*f-.044475-.005916*w)))-n)/(1.007226+f*(.045255+w*(.259866*f-.311325-.005916*11*w))),s=en(s-h,-pd,pd)}while(Math.abs(h)>1e-6&&--l>0);f=s*s;const _=en(ti(o/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=ti(s);return new dn(_,x)}};const jm=yn(Os),$m={albers:N_,equalEarth:V_,equirectangular:jv,lambertConformalConic:$v,mercator:U_,naturalEarth:Um,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],project(o,n){n=yn(n),o=yn(o);const s=Math.cos(n),l=2/Math.PI,h=Math.acos(s*Math.cos(o/2)),f=Math.sin(h)/h,_=.5*(o*l+2*s*Math.sin(o/2)/f)||0,x=.5*(n+Math.sin(n)/f)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(x/Math.PI+1)}},unproject(o,n){let s=o=(2*o-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,h=25;const f=1e-6;let _=0,x=0;do{const w=Math.cos(l),T=Math.sin(l),I=2*T*w,M=T*T,P=w*w,z=Math.cos(s/2),N=Math.sin(s/2),$=2*z*N,K=N*N,te=1-P*z*z,se=te?1/te:0,ue=te?Math.acos(w*z)*Math.sqrt(1/te):0,pe=.5*(2*ue*w*N+2*s/Math.PI)-o,he=.5*(ue*T+l)-n,fe=.5*se*(P*K+ue*w*z*M)+1/Math.PI,Me=se*($*I/4-ue*T*N),Ee=.125*se*(I*N-ue*T*P*$),Ze=.5*se*(M*z+ue*K*w)+.5,Oe=Me*Ee-Ze*fe;_=(he*Me-pe*Ze)/Oe,x=(pe*Ee-he*fe)/Oe,s=en(s-_,-Math.PI,Math.PI),l=en(l-x,-jm,jm)}while((Math.abs(_)>f||Math.abs(x)>f)&&--h>0);return new dn(ti(s),ti(l))}}};d.ARRAY_TYPE=Cr,d.AUTH_ERR_MSG=Ha,d.Actor=class{constructor(o,n,s){this.target=o,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},$o(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=yr()?o:nt,this.scheduler=new Vv}send(o,n,s,l,h=!1,f){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=f,this.callbacks[_]=s);const x=Wl(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:o,hasCallback:!!s,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:lo(n,x)},x),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(o){const n=o.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(n.mustQueue||yr()){const l=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,n),l&&l.metadata||{type:"message"})}else this.processTask(s,n)}processTask(o,n){if("<response>"===n.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(n.error?s(wr(n.error)):s(null,wr(n.data)))}else{const s=Wl(this.globalScope)?void 0:[],l=n.hasCallback?(f,_)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:f?lo(f):null,data:lo(_,s)},s)}:f=>{},h=wr(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,l);else if(this.parent.getWorkerSource){const f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],h.source)[f[1]](h,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=sd,d.Color=Vt,d.ColorMode=go,d.CullFaceMode=ci,d.DEMData=Qu,d.DataConstantProperty=W,d.DedupedRequest=Xp,d.DepthMode=Vc,d.EXTENT=Rt,d.Elevation=class{getAtPointOrZero(o,n=0){return this.getAtPoint(o,n)||0}getAtPoint(o,n,s=!0){null==n&&(n=null);const l=this._source();if(!l||o.y<0||o.y>1)return n;const h=l.getSource().maxzoom,f=1<<h,_=Math.floor(o.x),x=o.x-_,w=new yi(h,_,h,Math.floor(x*f),Math.floor(o.y*f)),T=this.findDEMTileFor(w);if(!T||!T.dem)return n;const I=T.dem,M=1<<T.tileID.canonical.z,P=(x*M-T.tileID.canonical.x)*I.dim,z=(o.y*M-T.tileID.canonical.y)*I.dim,N=Math.floor(P),$=Math.floor(z);return(s?this.exaggeration():1)*Jt(Jt(I.get(N,$),I.get(N,$+1),z-$),Jt(I.get(N+1,$),I.get(N+1,$+1),z-$),P-N)}getAtTileOffset(o,n,s){const l=1<<o.canonical.z;return this.getAtPointOrZero(new Ah(o.wrap+(o.canonical.x+n/Rt)/l,(o.canonical.y+s/Rt)/l))}getForTilePoints(o,n,s,l){const h=Uc.create(this,o,l);return!!h&&(n.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],s)}),!0)}getMinMaxForTile(o){const n=this.findDEMTileFor(o);if(!n||!n.dem)return null;const s=n.dem.tree,l=n.tileID,h=1<<o.canonical.z-l.canonical.z;let f=o.canonical.x/h-l.canonical.x,_=o.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<o.canonical.z-l.canonical.z&&!s.leaves[x];w++){f*=2,_*=2;const T=2*Math.floor(_)+Math.floor(f);x=s.childOffsets[x]+T,f%=1,_%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=ot,d.EvaluationParameters=F,d.Event=Le,d.Evented=$e,d.GlyphManager=us,d.ImagePosition=Dp,d.LineAtlas=Vp,d.LngLat=dn,d.LngLatBounds=Po,d.LocalGlyphMode=Zu,d.MAX_MERCATOR_LATITUDE=Os,d.MAX_SAFE_INTEGER=ui,d.MercatorCoordinate=Ah,d.ONE_EM=24,d.OverscaledTileID=yi,d.Properties=Ce,d.RGBAImage=Ii,d.RequestManager=class{constructor(o,n,s){this._transformRequestFn=o,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ga,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,n){return this._transformRequestFn&&this._transformRequestFn(o,n)||{url:o}}normalizeStyleURL(o,n){if(!ur(o))return o;const s=Di(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(o,n){if(!ur(o))return o;const s=Di(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(o,n){if(!ur(o))return o;const s=Di(o);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||n)}normalizeSpriteURL(o,n,s,l){const h=Di(o);return ur(o)?(h.path=`/styles/v1${h.path}/sprite${n}${s}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${n}${s}`,ri(h))}normalizeTileURL(o,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ur(o))return o;const l=Di(o);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&"raster"!==l.authority&&512===s?"@2x":""}${sa.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${zt.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${zt.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(f){for(const _ of f){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||zt.ACCESS_TOKEN;return zt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(o,n){const s=Di(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let l="mapbox://";s.path.match(/^\/raster\/v1\//)?l+=`raster/${s.path.replace(`/${zt.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${s.path.replace(`/${zt.TILE_URL_VERSION}/`,"")}`;let h=s.params;return n&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(o,n){const s=!!n&&ur(n),l=[];for(const h of o.tiles||[])Ho(h)?l.push(this.canonicalizeTileURL(h,s)):l.push(h);return l}_makeAPIURL(o,n){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=Di(zt.API_URL);if(o.protocol=l.protocol,o.authority=l.authority,"http"===o.protocol){const h=o.params.indexOf("secure");h>=0&&o.params.splice(h,1)}if("/"!==l.path&&(o.path=`${l.path}${o.path}`),!zt.REQUIRE_ACCESS_TOKEN)return ri(o);if(n=n||zt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===n[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(h=>-1===h.indexOf("access_token")),o.params.push(`access_token=${n||""}`),ri(o)}},d.ResourceType=xs,d.SegmentVector=pr,d.SourceCache=Ol,d.StencilMode=Pa,d.StructArrayLayout1ui2=dr,d.StructArrayLayout2f1f2i16=Dr,d.StructArrayLayout2i4=Je,d.StructArrayLayout2ui4=Dn,d.StructArrayLayout3f12=dt,d.StructArrayLayout3ui6=Pn,d.StructArrayLayout4i8=lt,d.Texture=id,d.Tile=Rm,d.Transitionable=Z,d.Uniform1f=Ls,d.Uniform1i=class extends Si{constructor(o,n){super(o,n),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},d.Uniform2f=class extends Si{constructor(o,n){super(o,n),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},d.Uniform3f=class extends Si{constructor(o,n){super(o,n),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},d.Uniform4f=Qd,d.UniformColor=Sh,d.UniformMatrix2f=class extends Si{constructor(o,n){super(o,n),this.current=Rg}set(o){for(let n=0;n<4;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},d.UniformMatrix3f=class extends Si{constructor(o,n){super(o,n),this.current=Mv}set(o){for(let n=0;n<9;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},d.UniformMatrix4f=class extends Si{constructor(o,n){super(o,n),this.current=Dc}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let n=1;n<16;n++)if(o[n]!==this.current[n]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},d.UnwrappedTileID=jp,d.ValidationError=Te,d.VectorTileWorkerSource=class extends $e{constructor(o,n,s,l,h){super(),this.actor=o,this.layerIndex=n,this.availableImages=s,this.loadVectorData=h||Kp,this.loading={},this.loaded={},this.deduped=new Xp(o.scheduler),this.isSpriteLoaded=l,this.scheduler=o.scheduler}loadTile(o,n){const s=o.uid,l=o&&o.request,h=l&&l.collectResourceTiming,f=this.loading[s]=new Nm(o);f.abort=this.loadVectorData(o,(_,x)=>{const w=!this.loading[s];if(delete this.loading[s],w||_||!x)return f.status="done",w||(this.loaded[s]=f),n(_);const T=x.rawData,I={};x.expires&&(I.expires=x.expires),x.cacheControl&&(I.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new Fc.VectorTile(new zu(T));const M=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,z)=>{if(P||!z)return n(P);const N={};if(h){const $=Up(l);$.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify($)))}n(null,Vn({rawTileData:T.slice(0)},z,I,N))})};this.isSpriteLoaded?M():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(M,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):M()}),this.loaded=this.loaded||{},this.loaded[s]=f})}reloadTile(o,n){const s=this.loaded,l=o.uid,h=this;if(s&&s[l]){const f=s[l];f.showCollisionBoxes=o.showCollisionBoxes,f.enableTerrain=!!o.enableTerrain;const _=(x,w)=>{const T=f.reloadCallback;T&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,T)),n(x,w)};"parsing"===f.status?f.reloadCallback=_:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(o,n){const s=o.uid,l=this.loading[s];l&&(l.abort&&l.abort(),delete this.loading[s]),n()}removeTile(o,n){const s=this.loaded,l=o.uid;s&&s[l]&&delete s[l],n()}},d.WritingMode=Ui,d.ZoomHistory=uu,d.add=function(o,n,s){return o[0]=n[0]+s[0],o[1]=n[1]+s[1],o[2]=n[2]+s[2],o},d.addDynamicAttributes=Qh,d.altitudeFromMercatorZ=zf,d.asyncAll=Uo,d.bezier=ni,d.bindAll=$o,d.boundsAttributes=ds,d.bufferConvexPolygon=function(o,n){const s=[];for(let l=0;l<o.length;l++){const h=xo(l-1,-1,o.length-1),f=xo(l+1,-1,o.length-1),_=o[l],x=o[f],w=o[h].sub(_).unit(),T=x.sub(_).unit(),I=T.angleWithSep(w.x,w.y),M=w.add(T).unit().mult(-1*n/Math.sin(I/2));s.push(_.add(M))}return s},d.cacheEntryPossiblyAdded=function(o){Ya++,Ya>Zo&&(o.getActor().send("enforceCacheSizeLimit",Ka),Ya=0)},d.clamp=en,d.clearTileCache=function(o){const n=nt.caches.delete(la);o&&n.catch(o).then(()=>o())},d.clipLine=qu,d.clone=function(o){var n=new Cr(3);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n},d.clone$1=function(o){var n=new Cr(16);return n[0]=o[0],n[1]=o[1],n[2]=o[2],n[3]=o[3],n[4]=o[4],n[5]=o[5],n[6]=o[6],n[7]=o[7],n[8]=o[8],n[9]=o[9],n[10]=o[10],n[11]=o[11],n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n},d.clone$2=cr,d.collisionCircleLayout=g_,d.config=zt,d.conjugate=function(o,n){return o[0]=-n[0],o[1]=-n[1],o[2]=-n[2],o[3]=n[3],o},d.copy=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o},d.create=Tu,d.create$1=function(){var o=new Cr(16);return Cr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},d.create$2=bl,d.createExpression=ya,d.createLayout=ve,d.createStyleLayer=function(o){return"custom"===o.type?new Nv(o):new ed[o.type](o)},d.cross=function(o,n,s){var l=n[0],h=n[1],f=n[2],_=s[0],x=s[1],w=s[2];return o[0]=h*w-f*x,o[1]=f*_-l*w,o[2]=l*x-h*_,o},d.degToRad=yn,d.div=function(o,n,s){return o[0]=n[0]/s[0],o[1]=n[1]/s[1],o[2]=n[2]/s[2],o},d.dot=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]},d.dot$1=function(o,n){return o[0]*n[0]+o[1]*n[1]+o[2]*n[2]+o[3]*n[3]},d.ease=bi,d.easeCubicInOut=Vo,d.emitValidationErrors=cu,d.endsWith=Hn,d.enforceCacheSizeLimit=function(o){Ki(),Ti&&Ti.then(n=>{n.keys().then(s=>{for(let l=0;l<s.length-o;l++)n.delete(s[l])})})},d.evaluateSizeForFeature=Zh,d.evaluateSizeForZoom=Il,d.evaluateVariableOffset=mo,d.evented=C,d.exactEquals=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]&&o[3]===n[3]},d.exactEquals$1=function(o,n){return o[0]===n[0]&&o[1]===n[1]&&o[2]===n[2]},d.exported=Ei,d.exported$1=sa,d.extend=Vn,d.filterObject=Wi,d.fromMat4=function(o,n){return o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[4],o[4]=n[5],o[5]=n[6],o[6]=n[8],o[7]=n[9],o[8]=n[10],o},d.fromQuat=function(o,n){var s=n[0],l=n[1],h=n[2],f=n[3],_=s+s,x=l+l,w=h+h,T=s*_,I=l*_,M=l*x,P=h*_,z=h*x,N=h*w,$=f*_,K=f*x,te=f*w;return o[0]=1-M-N,o[1]=I+te,o[2]=P-K,o[3]=0,o[4]=I-te,o[5]=1-T-N,o[6]=z+$,o[7]=0,o[8]=P+K,o[9]=z-$,o[10]=1-T-M,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},d.fromRotation=function(o,n){var s=Math.sin(n),l=Math.cos(n);return o[0]=l,o[1]=s,o[2]=0,o[3]=-s,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},d.fromScaling=function(o,n){return o[0]=n[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=n[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},d.furthestTileCorner=function(o){const n=Math.round((o+45+360)%360/90)%4;return Hl[n]},d.getAABBPointSquareDist=function(o,n,s){let l=0;for(let h=0;h<2;++h){const f=s?s[h]:0;o[h]>f&&(l+=(o[h]-f)*(o[h]-f)),n[h]<f&&(l+=(f-n[h])*(f-n[h]))}return l},d.getAnchorAlignment=Us,d.getAnchorJustification=Jh,d.getBounds=function(o){let n=1/0,s=1/0,l=-1/0,h=-1/0;for(const f of o)n=Math.min(n,f.x),s=Math.min(s,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new Ie(n,s),max:new Ie(l,h)}},d.getImage=_e,d.getJSON=function(o,n){return O(Vn(o,{type:"json"}),n)},d.getMapSessionAPI=Xa,d.getPerformanceMeasurement=Up,d.getProjection=function(o){const n=$m[o.name];if(!n)throw new Error(`Invalid projection name: ${o.name}`);return n.conic?function(s,l){if(l.parallels&&Math.abs(l.parallels[0]+l.parallels[1])<.01){let h=function(f){const _=Math.max(.01,Math.cos(yn(f))),x=1/(2*Math.max(Math.PI*_,1/_));return{wrap:!0,project(w,T){const I=yn(w)*_,M=Math.sin(yn(T))/_;return{x:I*x+.5,y:-M*x+.5}},unproject(w,T){const I=-(T-.5)/x,M=en(ti((w-.5)/x)/_,-180,180),P=Math.asin(en(I*_,-1,1)),z=en(ti(P),-85.051129,Os);return new dn(M,z)}}}(l.parallels[0]);if("lambertConformalConic"===l.name){const{project:f,unproject:_}=$m.mercator;h={wrap:!0,project:f,unproject:_}}return Vn({},s,l,h)}return Vn({},s,l)}(n,o):n},d.getRTLTextPluginStatus=A,d.getReferrer=Y,d.getTilePoint=function(o,{x:n,y:s},l=0){return new Ie(((n-l)*o.scale-o.x)*Rt,(s*o.scale-o.y)*Rt)},d.getTileVec3=function(o,n,s=0){return zs(((n.x-s)*o.scale-o.x)*Rt,(n.y*o.scale-o.y)*Rt,zf(n.z,n.y))},d.getVideo=function(o,n){const s=nt.document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let l=0;l<o.length;l++){const h=nt.document.createElement("source");le(o[l])||(s.crossOrigin="Anonymous"),h.src=o[l],s.appendChild(h)}return{cancel:()=>{}}},d.identity=Rh,d.identity$1=Zf,d.invert=function(o,n){var s=n[0],l=n[1],h=n[2],f=n[3],_=n[4],x=n[5],w=n[6],T=n[7],I=n[8],M=n[9],P=n[10],z=n[11],N=n[12],$=n[13],K=n[14],te=n[15],se=s*x-l*_,ue=s*w-h*_,pe=s*T-f*_,he=l*w-h*x,fe=l*T-f*x,Me=h*T-f*w,Ee=I*$-M*N,Ze=I*K-P*N,Oe=I*te-z*N,Ae=M*K-P*$,ze=M*te-z*$,Ne=P*te-z*K,ke=se*Ne-ue*ze+pe*Ae+he*Oe-fe*Ze+Me*Ee;return ke?(o[0]=(x*Ne-w*ze+T*Ae)*(ke=1/ke),o[1]=(h*ze-l*Ne-f*Ae)*ke,o[2]=($*Me-K*fe+te*he)*ke,o[3]=(P*fe-M*Me-z*he)*ke,o[4]=(w*Oe-_*Ne-T*Ze)*ke,o[5]=(s*Ne-h*Oe+f*Ze)*ke,o[6]=(K*pe-N*Me-te*ue)*ke,o[7]=(I*Me-P*pe+z*ue)*ke,o[8]=(_*ze-x*Oe+T*Ee)*ke,o[9]=(l*Oe-s*ze-f*Ee)*ke,o[10]=(N*fe-$*pe+te*se)*ke,o[11]=(M*pe-I*fe-z*se)*ke,o[12]=(x*Ze-_*Ae-w*Ee)*ke,o[13]=(s*Ae-l*Ze+h*Ee)*ke,o[14]=($*ue-N*he-K*se)*ke,o[15]=(I*he-M*ue+P*se)*ke,o):null},d.isMapAuthenticated=function(o){return Eo.has(o)},d.isMapboxURL=ur,d.latFromMercatorY=_i,d.len=Vg,d.length=Lh,d.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},d.loadVectorTile=Kp,d.makeRequest=O,d.mercatorXfromLng=Of,d.mercatorYfromLat=Mh,d.mercatorZfromAltitude=gi,d.mul=function(o,n,s){return o[0]=n[0]*s[0],o[1]=n[1]*s[1],o[2]=n[2]*s[2],o[3]=n[3]*s[3],o},d.mul$1=Ng,d.mul$2=qf,d.multiply=Pc,d.multiply$1=Gf,d.nextPowerOfTwo=ra,d.normalize=wl,d.normalize$1=function(o,n){var s=n[0],l=n[1],h=n[2],f=n[3],_=s*s+l*l+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),o[0]=s*_,o[1]=l*_,o[2]=h*_,o[3]=f*_,o},d.number=Jt,d.ortho=function(o,n,s,l,h,f,_){var x=1/(n-s),w=1/(l-h),T=1/(f-_);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*T,o[11]=0,o[12]=(n+s)*x,o[13]=(h+l)*w,o[14]=(_+f)*T,o[15]=1,o},d.pbf=zu,d.perspective=function(o,n,s,l,h){var f,_=1/Math.tan(n/2);return o[0]=_/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=h&&h!==1/0?(o[10]=(h+l)*(f=1/(l-h)),o[14]=2*h*l*f):(o[10]=-1,o[14]=-2*l),o},d.pick=function(o,n){const s={};for(let l=0;l<n.length;l++){const h=n[l];h in o&&(s[h]=o[h])}return s},d.plugin=L,d.pointGeometry=Ie,d.polygonIntersectsBox=Lt,d.polygonIntersectsPolygon=Ph,d.polygonizeBounds=function(o,n,s=0,l=!0){const h=new Ie(s,s),f=o.sub(h),_=n.add(h),x=[f,new Ie(_.x,f.y),_,new Ie(f.x,_.y)];return l&&x.push(f),x},d.posAttributes=Uv,d.postMapLoadEvent=Jl,d.postTurnstileEvent=Yl,d.potpack=ju,d.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},d.radToDeg=ti,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(o){return o({pluginStatus:m,pluginURL:y}),C.on("pluginStateChange",o),o},d.removeAuthState=function(o){Eo.delete(o)},d.renderColorRamp=dp,d.rotateX=function(o,n,s){var l=Math.sin(s),h=Math.cos(s),f=n[4],_=n[5],x=n[6],w=n[7],T=n[8],I=n[9],M=n[10],P=n[11];return n!==o&&(o[0]=n[0],o[1]=n[1],o[2]=n[2],o[3]=n[3],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[4]=f*h+T*l,o[5]=_*h+I*l,o[6]=x*h+M*l,o[7]=w*h+P*l,o[8]=T*h-f*l,o[9]=I*h-_*l,o[10]=M*h-x*l,o[11]=P*h-w*l,o},d.rotateX$1=Wf,d.rotateY=function(o,n,s){var l=Math.sin(s),h=Math.cos(s),f=n[0],_=n[1],x=n[2],w=n[3],T=n[8],I=n[9],M=n[10],P=n[11];return n!==o&&(o[4]=n[4],o[5]=n[5],o[6]=n[6],o[7]=n[7],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=f*h-T*l,o[1]=_*h-I*l,o[2]=x*h-M*l,o[3]=w*h-P*l,o[8]=f*l+T*h,o[9]=_*l+I*h,o[10]=x*l+M*h,o[11]=w*l+P*h,o},d.rotateZ=function(o,n,s){var l=Math.sin(s),h=Math.cos(s),f=n[0],_=n[1],x=n[2],w=n[3],T=n[4],I=n[5],M=n[6],P=n[7];return n!==o&&(o[8]=n[8],o[9]=n[9],o[10]=n[10],o[11]=n[11],o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15]),o[0]=f*h+T*l,o[1]=_*h+I*l,o[2]=x*h+M*l,o[3]=w*h+P*l,o[4]=T*h-f*l,o[5]=I*h-_*l,o[6]=M*h-x*l,o[7]=P*h-w*l,o},d.rotateZ$1=function(o,n,s){s*=.5;var l=n[0],h=n[1],f=n[2],_=n[3],x=Math.sin(s),w=Math.cos(s);return o[0]=l*w+h*x,o[1]=h*w-l*x,o[2]=f*w+_*x,o[3]=_*w-f*x,o},d.scale=function(o,n,s){return o[0]=n[0]*s,o[1]=n[1]*s,o[2]=n[2]*s,o},d.scale$1=function(o,n,s){var l=s[0],h=s[1],f=s[2];return o[0]=n[0]*l,o[1]=n[1]*l,o[2]=n[2]*l,o[3]=n[3]*l,o[4]=n[4]*h,o[5]=n[5]*h,o[6]=n[6]*h,o[7]=n[7]*h,o[8]=n[8]*f,o[9]=n[9]*f,o[10]=n[10]*f,o[11]=n[11]*f,o[12]=n[12],o[13]=n[13],o[14]=n[14],o[15]=n[15],o},d.scale$2=function(o,n,s){return o[0]=n[0]*s,o[1]=n[1]*s,o[2]=n[2]*s,o[3]=n[3]*s,o},d.scaleAndAdd=Hf,d.setCacheLimits=function(o,n){Ka=o,Zo=n},d.setRTLTextPlugin=function(o,n,s=!1){if(m===is||m===p||m===i)throw new Error("setRTLTextPlugin cannot be called multiple times.");y=Ei.resolveURL(o),m=is,c=n,D(),s||R()},d.smoothstep=function(o,n,s){return(s=en((s-o)/(n-o),0,1))*s*(3-2*s)},d.spec=de,d.storeAuthState=function(o,n){n?Eo.add(o):Eo.delete(o)},d.sub=Pv,d.subtract=cp,d.symbolSize=__,d.tileTransform=od,d.transformMat3=function(o,n,s){var l=n[0],h=n[1],f=n[2];return o[0]=l*s[0]+h*s[3]+f*s[6],o[1]=l*s[1]+h*s[4]+f*s[7],o[2]=l*s[2]+h*s[5]+f*s[8],o},d.transformMat4=Fh,d.transformMat4$1=function(o,n,s){var l=n[0],h=n[1],f=n[2],_=s[3]*l+s[7]*h+s[11]*f+s[15];return o[0]=(s[0]*l+s[4]*h+s[8]*f+s[12])/(_=_||1),o[1]=(s[1]*l+s[5]*h+s[9]*f+s[13])/_,o[2]=(s[2]*l+s[6]*h+s[10]*f+s[14])/_,o},d.transformQuat=kc,d.translate=function(o,n,s){var l,h,f,_,x,w,T,I,M,P,z,N,$=s[0],K=s[1],te=s[2];return n===o?(o[12]=n[0]*$+n[4]*K+n[8]*te+n[12],o[13]=n[1]*$+n[5]*K+n[9]*te+n[13],o[14]=n[2]*$+n[6]*K+n[10]*te+n[14],o[15]=n[3]*$+n[7]*K+n[11]*te+n[15]):(h=n[1],f=n[2],_=n[3],x=n[4],w=n[5],T=n[6],I=n[7],M=n[8],P=n[9],z=n[10],N=n[11],o[0]=l=n[0],o[1]=h,o[2]=f,o[3]=_,o[4]=x,o[5]=w,o[6]=T,o[7]=I,o[8]=M,o[9]=P,o[10]=z,o[11]=N,o[12]=l*$+x*K+M*te+n[12],o[13]=h*$+w*K+P*te+n[13],o[14]=f*$+T*K+z*te+n[14],o[15]=_*$+I*K+N*te+n[15]),o},d.triggerPluginCompletionEvent=v,d.uniqueId=_s,d.validateCustomStyleLayer=function(o){const n=[],s=o.id;return void 0===s&&n.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&n.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},d.validateFog=dl,d.validateLight=Zd,d.validateStyle=Co,d.values=jo,d.vectorTile=Fc,d.version="2.6.1",d.warnOnce=En,d.window=nt,d.wrap=xo}),at(0,function(d){function At(Y){const O=typeof Y;if("number"===O||"boolean"===O||"string"===O||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let J="[";for(const le of Y)J+=`${At(le)},`;return`${J}]`}const V=Object.keys(Y).sort();let X="{";for(let J=0;J<V.length;J++)X+=`${JSON.stringify(V[J])}:${At(Y[V[J]])},`;return`${X}}`}function Bt(Y){let O="";for(const V of d.refProperties)O+=`/${At(Y[V])}`;return O}class Sn{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,V){for(const J of O)this._layerConfigs[J.id]=J,(this._layers[J.id]=d.createStyleLayer(J)).compileFilter(),this.keyCache[J.id]&&delete this.keyCache[J.id];for(const J of V)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const X=function(J,le){const me={};for(let ce=0;ce<J.length;ce++){const _e=le&&le[J[ce].id]||Bt(J[ce]);le&&(le[J[ce].id]=_e);let Pe=me[_e];Pe||(Pe=me[_e]=[]),Pe.push(J[ce])}const ge=[];for(const ce in me)ge.push(me[ce]);return ge}(d.values(this._layerConfigs),this.keyCache);for(const J of X){const le=J.map(We=>this._layers[We.id]),me=le[0];if("none"===me.visibility)continue;const ge=me.source||"";let ce=this.familiesBySource[ge];ce||(ce=this.familiesBySource[ge]={});const _e=me.sourceLayer||"_geojsonTileLayer";let Pe=ce[_e];Pe||(Pe=ce[_e]=[]),Pe.push(le)}}}const{ImageBitmap:Ie}=d.window;class De{loadTile(O,V){const{uid:X,encoding:J,rawImageData:le,padding:me,buildQuadTree:ge}=O,ce=Ie&&le instanceof Ie?this.getImageData(le,me):le;V(null,new d.DEMData(X,ce,J,me<1,ge))}getImageData(O,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const X=this.offscreenCanvasContext.getImageData(-V,-V,O.width+2*V,O.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:X.width,height:X.height},X.data)}}var nt=function Y(O,V){var X,J=O&&O.type;if("FeatureCollection"===J)for(X=0;X<O.features.length;X++)Y(O.features[X],V);else if("GeometryCollection"===J)for(X=0;X<O.geometries.length;X++)Y(O.geometries[X],V);else if("Feature"===J)Y(O.geometry,V);else if("Polygon"===J)ui(O.coordinates,V);else if("MultiPolygon"===J)for(X=0;X<O.coordinates.length;X++)ui(O.coordinates[X],V);return O};function ui(Y,O){if(0!==Y.length){na(Y[0],O);for(var V=1;V<Y.length;V++)na(Y[V],!O)}}function na(Y,O){for(var V=0,X=0,J=0,le=Y.length,me=le-1;J<le;me=J++){var ge=(Y[J][0]-Y[me][0])*(Y[me][1]+Y[J][1]),ce=V+ge;X+=Math.abs(V)>=Math.abs(ge)?V-ce+ge:ge-ce+V,V=ce}V+X>=0!=!!O&&Y.reverse()}const vo=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class yn{constructor(O){this._feature=O,this.extent=d.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(1===this._feature.type){const O=[];for(const V of this._feature.geometry)O.push([new d.pointGeometry(V[0],V[1])]);return O}{const O=[];for(const V of this._feature.geometry){const X=[];for(const J of V)X.push(new d.pointGeometry(J[0],J[1]));O.push(X)}return O}}toGeoJSON(O,V,X){return vo.call(this,O,V,X)}}class ti{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=O.length,this._features=O}feature(O){return new yn(this._features[O])}}var Hl=d.vectorTile.VectorTileFeature,Vo=ni;function ni(Y,O){this.options=O||{},this.features=Y,this.length=Y.length}function bi(Y,O){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=O||4096}ni.prototype.feature=function(Y){return new bi(this.features[Y],this.options.extent)},bi.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var O=0;O<Y.length;O++){for(var V=Y[O],X=[],J=0;J<V.length;J++)X.push(new d.pointGeometry(V[J][0],V[J][1]));this.geometry.push(X)}return this.geometry},bi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,O=1/0,V=-1/0,X=1/0,J=-1/0,le=0;le<Y.length;le++)for(var me=Y[le],ge=0;ge<me.length;ge++){var ce=me[ge];O=Math.min(O,ce.x),V=Math.max(V,ce.x),X=Math.min(X,ce.y),J=Math.max(J,ce.y)}return[O,X,V,J]},bi.prototype.toGeoJSON=Hl.prototype.toGeoJSON;var en=Uo,xo=Vo;function Uo(Y){var O=new d.pbf;return function(V,X){for(var J in V.layers)X.writeMessage(3,jo,V.layers[J])}(Y,O),O.finish()}function jo(Y,O){var V;O.writeVarintField(15,Y.version||1),O.writeStringField(1,Y.name||""),O.writeVarintField(5,Y.extent||4096);var X={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<Y.length;V++)X.feature=Y.feature(V),O.writeMessage(2,Vn,X);var J=X.keys;for(V=0;V<J.length;V++)O.writeStringField(3,J[V]);var le=X.values;for(V=0;V<le.length;V++)O.writeMessage(4,ql,le[V])}function Vn(Y,O){var V=Y.feature;void 0!==V.id&&O.writeVarintField(1,V.id),O.writeMessage(2,Va,Y),O.writeVarintField(3,V.type),O.writeMessage(4,ra,V)}function Va(Y,O){var V=Y.feature,X=Y.keys,J=Y.values,le=Y.keycache,me=Y.valuecache;for(var ge in V.properties){var ce=V.properties[ge],_e=le[ge];if(null!==ce){void 0===_e&&(X.push(ge),le[ge]=_e=X.length-1),O.writeVarint(_e);var Pe=typeof ce;"string"!==Pe&&"boolean"!==Pe&&"number"!==Pe&&(ce=JSON.stringify(ce));var We=Pe+":"+ce,Le=me[We];void 0===Le&&(J.push(ce),me[We]=Le=J.length-1),O.writeVarint(Le)}}}function _s(Y,O){return(O<<3)+(7&Y)}function ys(Y){return Y<<1^Y>>31}function ra(Y,O){for(var V=Y.loadGeometry(),X=Y.type,J=0,le=0,me=V.length,ge=0;ge<me;ge++){var ce=V[ge],_e=1;1===X&&(_e=ce.length),O.writeVarint(_s(1,_e));for(var Pe=3===X?ce.length-1:ce.length,We=0;We<Pe;We++){1===We&&1!==X&&O.writeVarint(_s(2,Pe-1));var Le=ce[We].x-J,ot=ce[We].y-le;O.writeVarint(ys(Le)),O.writeVarint(ys(ot)),J+=Le,le+=ot}3===X&&O.writeVarint(_s(7,1))}}function ql(Y,O){var V=typeof Y;"string"===V?O.writeStringField(1,Y):"boolean"===V?O.writeBooleanField(7,Y):"number"===V&&(Y%1!=0?O.writeDoubleField(3,Y):Y<0?O.writeSVarintField(6,Y):O.writeVarintField(5,Y))}function $o(Y,O,V,X,J,le){if(J-X<=V)return;const me=X+J>>1;Hn(Y,O,me,X,J,le%2),$o(Y,O,V,X,me-1,le+1),$o(Y,O,V,me+1,J,le+1)}function Hn(Y,O,V,X,J,le){for(;J>X;){if(J-X>600){const _e=J-X+1,Pe=V-X+1,We=Math.log(_e),Le=.5*Math.exp(2*We/3),ot=.5*Math.sqrt(We*Le*(_e-Le)/_e)*(Pe-_e/2<0?-1:1);Hn(Y,O,V,Math.max(X,Math.floor(V-Pe*Le/_e+ot)),Math.min(J,Math.floor(V+(_e-Pe)*Le/_e+ot)),le)}const me=O[2*V+le];let ge=X,ce=J;for(Zi(Y,O,X,V),O[2*J+le]>me&&Zi(Y,O,X,J);ge<ce;){for(Zi(Y,O,ge,ce),ge++,ce--;O[2*ge+le]<me;)ge++;for(;O[2*ce+le]>me;)ce--}O[2*X+le]===me?Zi(Y,O,X,ce):(ce++,Zi(Y,O,ce,J)),ce<=V&&(X=ce+1),V<=ce&&(J=ce-1)}}function Zi(Y,O,V,X){Wi(Y,V,X),Wi(O,2*V,2*X),Wi(O,2*V+1,2*X+1)}function Wi(Y,O,V){const X=Y[O];Y[O]=Y[V],Y[V]=X}function cr(Y,O,V,X){const J=Y-V,le=O-X;return J*J+le*le}en.fromVectorTileJs=Uo,en.fromGeojsonVt=function(Y,O){O=O||{};var V={};for(var X in Y)V[X]=new Vo(Y[X].features,O),V[X].name=X,V[X].version=O.version,V[X].extent=O.extent;return Uo({layers:V})},en.GeoJSONWrapper=xo;const ia=Y=>Y[0],En=Y=>Y[1];class hi{constructor(O,V=ia,X=En,J=64,le=Float64Array){this.nodeSize=J,this.points=O;const me=O.length<65536?Uint16Array:Uint32Array,ge=this.ids=new me(O.length),ce=this.coords=new le(2*O.length);for(let _e=0;_e<O.length;_e++)ge[_e]=_e,ce[2*_e]=V(O[_e]),ce[2*_e+1]=X(O[_e]);$o(ge,ce,J,0,ge.length-1,0)}range(O,V,X,J){return function(le,me,ge,ce,_e,Pe,We){const Le=[0,le.length-1,0],ot=[];let $e,de;for(;Le.length;){const Te=Le.pop(),It=Le.pop(),Kt=Le.pop();if(It-Kt<=We){for(let Gt=Kt;Gt<=It;Gt++)$e=me[2*Gt],de=me[2*Gt+1],$e>=ge&&$e<=_e&&de>=ce&&de<=Pe&&ot.push(le[Gt]);continue}const mt=Math.floor((Kt+It)/2);$e=me[2*mt],de=me[2*mt+1],$e>=ge&&$e<=_e&&de>=ce&&de<=Pe&&ot.push(le[mt]);const Nt=(Te+1)%2;(0===Te?ge<=$e:ce<=de)&&(Le.push(Kt),Le.push(mt-1),Le.push(Nt)),(0===Te?_e>=$e:Pe>=de)&&(Le.push(mt+1),Le.push(It),Le.push(Nt))}return ot}(this.ids,this.coords,O,V,X,J,this.nodeSize)}within(O,V,X){return function(J,le,me,ge,ce,_e){const Pe=[0,J.length-1,0],We=[],Le=ce*ce;for(;Pe.length;){const ot=Pe.pop(),$e=Pe.pop(),de=Pe.pop();if($e-de<=_e){for(let Nt=de;Nt<=$e;Nt++)cr(le[2*Nt],le[2*Nt+1],me,ge)<=Le&&We.push(J[Nt]);continue}const Te=Math.floor((de+$e)/2),It=le[2*Te],Kt=le[2*Te+1];cr(It,Kt,me,ge)<=Le&&We.push(J[Te]);const mt=(ot+1)%2;(0===ot?me-ce<=It:ge-ce<=Kt)&&(Pe.push(de),Pe.push(Te-1),Pe.push(mt)),(0===ot?me+ce>=It:ge+ce>=Kt)&&(Pe.push(Te+1),Pe.push($e),Pe.push(mt))}return We}(this.ids,this.coords,O,V,X,this.nodeSize)}}const Zl={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},yr=Math.fround||(wi=new Float32Array(1),Y=>(wi[0]=+Y,wi[0]));var wi;class Xi{constructor(O){this.options=zt(Object.create(Zl),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:V,minZoom:X,maxZoom:J,nodeSize:le}=this.options;V&&console.time("total time");const me=`prepare ${O.length} points`;V&&console.time(me),this.points=O;let ge=[];for(let ce=0;ce<O.length;ce++)O[ce].geometry&&ge.push(Ua(O[ce],ce));this.trees[J+1]=new hi(ge,sa,bo,le,Float32Array),V&&console.timeEnd(me);for(let ce=J;ce>=X;ce--){const _e=+Date.now();ge=this._cluster(ge,ce),this.trees[ce]=new hi(ge,sa,bo,le,Float32Array),V&&console.log("z%d: %d clusters in %dms",ce,ge.length,+Date.now()-_e)}return V&&console.timeEnd("total time"),this}getClusters(O,V){let X=((O[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,O[1]));let le=180===O[2]?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)X=-180,le=180;else if(X>le){const Pe=this.getClusters([X,J,180,me],V),We=this.getClusters([-180,J,le,me],V);return Pe.concat(We)}const ge=this.trees[this._limitZoom(V)],ce=ge.range(oa(X),Ei(me),oa(le),Ei(J)),_e=[];for(const Pe of ce){const We=ge.points[Pe];_e.push(We.numPoints?vs(We):this.points[We.index])}return _e}getChildren(O){const V=this._getOriginId(O),X=this._getOriginZoom(O),J="No cluster with the specified id.",le=this.trees[X];if(!le)throw new Error(J);const me=le.points[V];if(!me)throw new Error(J);const ge=this.options.radius/(this.options.extent*Math.pow(2,X-1)),ce=le.within(me.x,me.y,ge),_e=[];for(const Pe of ce){const We=le.points[Pe];We.parentId===O&&_e.push(We.numPoints?vs(We):this.points[We.index])}if(0===_e.length)throw new Error(J);return _e}getLeaves(O,V,X){const J=[];return this._appendLeaves(J,O,V=V||10,X=X||0,0),J}getTile(O,V,X){const J=this.trees[this._limitZoom(O)],le=Math.pow(2,O),{extent:me,radius:ge}=this.options,ce=ge/me,_e=(X-ce)/le,Pe=(X+1+ce)/le,We={features:[]};return this._addTileFeatures(J.range((V-ce)/le,_e,(V+1+ce)/le,Pe),J.points,V,X,le,We),0===V&&this._addTileFeatures(J.range(1-ce/le,_e,1,Pe),J.points,le,X,le,We),V===le-1&&this._addTileFeatures(J.range(0,_e,ce/le,Pe),J.points,-1,X,le,We),We.features.length?We:null}getClusterExpansionZoom(O){let V=this._getOriginZoom(O)-1;for(;V<=this.options.maxZoom;){const X=this.getChildren(O);if(V++,1!==X.length)break;O=X[0].properties.cluster_id}return V}_appendLeaves(O,V,X,J,le){const me=this.getChildren(V);for(const ge of me){const ce=ge.properties;if(ce&&ce.cluster?le+ce.point_count<=J?le+=ce.point_count:le=this._appendLeaves(O,ce.cluster_id,X,J,le):le<J?le++:O.push(ge),O.length===X)break}return le}_addTileFeatures(O,V,X,J,le,me){for(const ge of O){const ce=V[ge],_e=ce.numPoints;let Pe,We,Le;if(_e)Pe=Wl(ce),We=ce.x,Le=ce.y;else{const de=this.points[ce.index];Pe=de.properties,We=oa(de.geometry.coordinates[0]),Le=Ei(de.geometry.coordinates[1])}const ot={type:1,geometry:[[Math.round(this.options.extent*(We*le-X)),Math.round(this.options.extent*(Le*le-J))]],tags:Pe};let $e;_e?$e=ce.id:this.options.generateId?$e=ce.index:this.points[ce.index].id&&($e=this.points[ce.index].id),void 0!==$e&&(ot.id=$e),me.features.push(ot)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,V){const X=[],{radius:J,extent:le,reduce:me,minPoints:ge}=this.options,ce=J/(le*Math.pow(2,V));for(let _e=0;_e<O.length;_e++){const Pe=O[_e];if(Pe.zoom<=V)continue;Pe.zoom=V;const We=this.trees[V+1],Le=We.within(Pe.x,Pe.y,ce),ot=Pe.numPoints||1;let $e=ot;for(const de of Le){const Te=We.points[de];Te.zoom>V&&($e+=Te.numPoints||1)}if($e>ot&&$e>=ge){let de=Pe.x*ot,Te=Pe.y*ot,It=me&&ot>1?this._map(Pe,!0):null;const Kt=(_e<<5)+(V+1)+this.points.length;for(const mt of Le){const Nt=We.points[mt];if(Nt.zoom<=V)continue;Nt.zoom=V;const Gt=Nt.numPoints||1;de+=Nt.x*Gt,Te+=Nt.y*Gt,Nt.parentId=Kt,me&&(It||(It=this._map(Pe,!0)),me(It,this._map(Nt)))}Pe.parentId=Kt,X.push(Ot(de/$e,Te/$e,Kt,$e,It))}else if(X.push(Pe),$e>1)for(const de of Le){const Te=We.points[de];Te.zoom<=V||(Te.zoom=V,X.push(Te))}}return X}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,V){if(O.numPoints)return V?zt({},O.properties):O.properties;const X=this.points[O.index].properties,J=this.options.map(X);return V&&J===X?zt({},J):J}}function Ot(Y,O,V,X,J){return{x:yr(Y),y:yr(O),zoom:1/0,id:V,parentId:-1,numPoints:X,properties:J}}function Ua(Y,O){const[V,X]=Y.geometry.coordinates;return{x:yr(oa(V)),y:yr(Ei(X)),zoom:1/0,index:O,parentId:-1}}function vs(Y){return{type:"Feature",id:Y.id,properties:Wl(Y),geometry:{type:"Point",coordinates:[(O=Y.x,360*(O-.5)),ja(Y.y)]}};var O}function Wl(Y){const O=Y.numPoints,V=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return zt(zt({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:O,point_count_abbreviated:V})}function oa(Y){return Y/360+.5}function Ei(Y){const O=Math.sin(Y*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function ja(Y){const O=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function zt(Y,O){for(const V in O)Y[V]=O[V];return Y}function sa(Y){return Y.x}function bo(Y){return Y.y}function wo(Y,O,V,X){for(var J,le=X,me=V-O>>1,ge=V-O,ce=Y[O],_e=Y[O+1],Pe=Y[V],We=Y[V+1],Le=O+3;Le<V;Le+=3){var ot=aa(Y[Le],Y[Le+1],ce,_e,Pe,We);if(ot>le)J=Le,le=ot;else if(ot===le){var $e=Math.abs(Le-me);$e<ge&&(J=Le,ge=$e)}}le>X&&(J-O>3&&wo(Y,O,J,X),Y[J+2]=le,V-J>3&&wo(Y,J,V,X))}function aa(Y,O,V,X,J,le){var me=J-V,ge=le-X;if(0!==me||0!==ge){var ce=((Y-V)*me+(O-X)*ge)/(me*me+ge*ge);ce>1?(V=J,X=le):ce>0&&(V+=me*ce,X+=ge*ce)}return(me=Y-V)*me+(ge=O-X)*ge}function Go(Y,O,V,X){var J={id:void 0===Y?null:Y,type:O,geometry:V,tags:X,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(le){var me=le.geometry,ge=le.type;if("Point"===ge||"MultiPoint"===ge||"LineString"===ge)$a(le,me);else if("Polygon"===ge||"MultiLineString"===ge)for(var ce=0;ce<me.length;ce++)$a(le,me[ce]);else if("MultiPolygon"===ge)for(ce=0;ce<me.length;ce++)for(var _e=0;_e<me[ce].length;_e++)$a(le,me[ce][_e])}(J),J}function $a(Y,O){for(var V=0;V<O.length;V+=3)Y.minX=Math.min(Y.minX,O[V]),Y.minY=Math.min(Y.minY,O[V+1]),Y.maxX=Math.max(Y.maxX,O[V]),Y.maxY=Math.max(Y.maxY,O[V+1])}function Ga(Y,O,V,X){if(O.geometry){var J=O.geometry.coordinates,le=O.geometry.type,me=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),ge=[],ce=O.id;if(V.promoteId?ce=O.properties[V.promoteId]:V.generateId&&(ce=X||0),"Point"===le)Ha(J,ge);else if("MultiPoint"===le)for(var _e=0;_e<J.length;_e++)Ha(J[_e],ge);else if("LineString"===le)ur(J,ge,me,!1);else if("MultiLineString"===le){if(V.lineMetrics){for(_e=0;_e<J.length;_e++)ur(J[_e],ge=[],me,!1),Y.push(Go(ce,"LineString",ge,O.properties));return}Ho(J,ge,me,!1)}else if("Polygon"===le)Ho(J,ge,me,!0);else{if("MultiPolygon"!==le){if("GeometryCollection"===le){for(_e=0;_e<O.geometry.geometries.length;_e++)Ga(Y,{id:ce,geometry:O.geometry.geometries[_e],properties:O.properties},V,X);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<J.length;_e++){var Pe=[];Ho(J[_e],Pe,me,!0),ge.push(Pe)}}Y.push(Go(ce,le,ge,O.properties))}}function Ha(Y,O){O.push(Wc(Y[0])),O.push(Di(Y[1])),O.push(0)}function ur(Y,O,V,X){for(var J,le,me=0,ge=0;ge<Y.length;ge++){var ce=Wc(Y[ge][0]),_e=Di(Y[ge][1]);O.push(ce),O.push(_e),O.push(0),ge>0&&(me+=X?(J*_e-ce*le)/2:Math.sqrt(Math.pow(ce-J,2)+Math.pow(_e-le,2))),J=ce,le=_e}var Pe=O.length-3;O[2]=1,wo(O,0,Pe,V),O[Pe+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function Ho(Y,O,V,X){for(var J=0;J<Y.length;J++){var le=[];ur(Y[J],le,V,X),O.push(le)}}function Wc(Y){return Y/360+.5}function Di(Y){var O=Math.sin(Y*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function ri(Y,O,V,X,J,le,me,ge){if(X/=O,le>=(V/=O)&&me<X)return Y;if(me<V||le>=X)return null;for(var ce=[],_e=0;_e<Y.length;_e++){var Pe=Y[_e],We=Pe.geometry,Le=Pe.type,ot=0===J?Pe.minX:Pe.minY,$e=0===J?Pe.maxX:Pe.maxY;if(ot>=V&&$e<X)ce.push(Pe);else if(!($e<V||ot>=X)){var de=[];if("Point"===Le||"MultiPoint"===Le)Xl(We,de,V,X,J);else if("LineString"===Le)qa(We,de,V,X,J,!1,ge.lineMetrics);else if("MultiLineString"===Le)Yl(We,de,V,X,J,!1);else if("Polygon"===Le)Yl(We,de,V,X,J,!0);else if("MultiPolygon"===Le)for(var Te=0;Te<We.length;Te++){var It=[];Yl(We[Te],It,V,X,J,!0),It.length&&de.push(It)}if(de.length){if(ge.lineMetrics&&"LineString"===Le){for(Te=0;Te<de.length;Te++)ce.push(Go(Pe.id,Le,de[Te],Pe.tags));continue}"LineString"!==Le&&"MultiLineString"!==Le||(1===de.length?(Le="LineString",de=de[0]):Le="MultiLineString"),"Point"!==Le&&"MultiPoint"!==Le||(Le=3===de.length?"Point":"MultiPoint"),ce.push(Go(Pe.id,Le,de,Pe.tags))}}}return ce.length?ce:null}function Xl(Y,O,V,X,J){for(var le=0;le<Y.length;le+=3){var me=Y[le+J];me>=V&&me<=X&&(O.push(Y[le]),O.push(Y[le+1]),O.push(Y[le+2]))}}function qa(Y,O,V,X,J,le,me){for(var ge,ce,_e=Kl(Y),Pe=0===J?Jl:Wa,We=Y.start,Le=0;Le<Y.length-3;Le+=3){var ot=Y[Le],$e=Y[Le+1],de=Y[Le+2],Te=Y[Le+3],It=Y[Le+4],Kt=0===J?ot:$e,mt=0===J?Te:It,Nt=!1;me&&(ge=Math.sqrt(Math.pow(ot-Te,2)+Math.pow($e-It,2))),Kt<V?mt>V&&(ce=Pe(_e,ot,$e,Te,It,V),me&&(_e.start=We+ge*ce)):Kt>X?mt<X&&(ce=Pe(_e,ot,$e,Te,It,X),me&&(_e.start=We+ge*ce)):Za(_e,ot,$e,de),mt<V&&Kt>=V&&(ce=Pe(_e,ot,$e,Te,It,V),Nt=!0),mt>X&&Kt<=X&&(ce=Pe(_e,ot,$e,Te,It,X),Nt=!0),!le&&Nt&&(me&&(_e.end=We+ge*ce),O.push(_e),_e=Kl(Y)),me&&(We+=ge)}var Gt=Y.length-3;ot=Y[Gt],$e=Y[Gt+1],de=Y[Gt+2],(Kt=0===J?ot:$e)>=V&&Kt<=X&&Za(_e,ot,$e,de),Gt=_e.length-3,le&&Gt>=3&&(_e[Gt]!==_e[0]||_e[Gt+1]!==_e[1])&&Za(_e,_e[0],_e[1],_e[2]),_e.length&&O.push(_e)}function Kl(Y){var O=[];return O.size=Y.size,O.start=Y.start,O.end=Y.end,O}function Yl(Y,O,V,X,J,le){for(var me=0;me<Y.length;me++)qa(Y[me],O,V,X,J,le,!1)}function Za(Y,O,V,X){Y.push(O),Y.push(V),Y.push(X)}function Jl(Y,O,V,X,J,le){var me=(le-O)/(X-O);return Y.push(le),Y.push(V+(J-V)*me),Y.push(1),me}function Wa(Y,O,V,X,J,le){var me=(le-V)/(J-V);return Y.push(O+(X-O)*me),Y.push(le),Y.push(1),me}function Xa(Y,O){for(var V=[],X=0;X<Y.length;X++){var J,le=Y[X],me=le.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)J=Eo(le.geometry,O);else if("MultiLineString"===me||"Polygon"===me){J=[];for(var ge=0;ge<le.geometry.length;ge++)J.push(Eo(le.geometry[ge],O))}else if("MultiPolygon"===me)for(J=[],ge=0;ge<le.geometry.length;ge++){for(var ce=[],_e=0;_e<le.geometry[ge].length;_e++)ce.push(Eo(le.geometry[ge][_e],O));J.push(ce)}V.push(Go(le.id,me,J,le.tags))}return V}function Eo(Y,O){var V=[];V.size=Y.size,void 0!==Y.start&&(V.start=Y.start,V.end=Y.end);for(var X=0;X<Y.length;X+=3)V.push(Y[X]+O,Y[X+1],Y[X+2]);return V}function la(Y,O){if(Y.transformed)return Y;var V,X,J,le=1<<Y.z,me=Y.x,ge=Y.y;for(V=0;V<Y.features.length;V++){var ce=Y.features[V],_e=ce.geometry,Pe=ce.type;if(ce.geometry=[],1===Pe)for(X=0;X<_e.length;X+=2)ce.geometry.push(Ti(_e[X],_e[X+1],O,le,me,ge));else for(X=0;X<_e.length;X++){var We=[];for(J=0;J<_e[X].length;J+=2)We.push(Ti(_e[X][J],_e[X][J+1],O,le,me,ge));ce.geometry.push(We)}}return Y.transformed=!0,Y}function Ti(Y,O,V,X,J,le){return[Math.round(V*(Y*X-J)),Math.round(V*(O*X-le))]}function qo(Y,O,V,X,J){for(var le=O===J.maxZoom?0:J.tolerance/((1<<O)*J.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:X,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<Y.length;ge++){me.numFeatures++,Ka(me,Y[ge],le,J);var ce=Y[ge].minX,_e=Y[ge].minY,Pe=Y[ge].maxX,We=Y[ge].maxY;ce<me.minX&&(me.minX=ce),_e<me.minY&&(me.minY=_e),Pe>me.maxX&&(me.maxX=Pe),We>me.maxY&&(me.maxY=We)}return me}function Ka(Y,O,V,X){var J=O.geometry,le=O.type,me=[];if("Point"===le||"MultiPoint"===le)for(var ge=0;ge<J.length;ge+=3)me.push(J[ge]),me.push(J[ge+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===le)Zo(me,J,Y,V,!1,!1);else if("MultiLineString"===le||"Polygon"===le)for(ge=0;ge<J.length;ge++)Zo(me,J[ge],Y,V,"Polygon"===le,0===ge);else if("MultiPolygon"===le)for(var ce=0;ce<J.length;ce++){var _e=J[ce];for(ge=0;ge<_e.length;ge++)Zo(me,_e[ge],Y,V,!0,0===ge)}if(me.length){var Pe=O.tags||null;if("LineString"===le&&X.lineMetrics){for(var We in Pe={},O.tags)Pe[We]=O.tags[We];Pe.mapbox_clip_start=J.start/J.size,Pe.mapbox_clip_end=J.end/J.size}var Le={geometry:me,type:"Polygon"===le||"MultiPolygon"===le?3:"LineString"===le||"MultiLineString"===le?2:1,tags:Pe};null!==O.id&&(Le.id=O.id),Y.features.push(Le)}}function Zo(Y,O,V,X,J,le){var me=X*X;if(X>0&&O.size<(J?me:X))V.numPoints+=O.length/3;else{for(var ge=[],ce=0;ce<O.length;ce+=3)(0===X||O[ce+2]>me)&&(V.numSimplified++,ge.push(O[ce]),ge.push(O[ce+1])),V.numPoints++;J&&function(_e,Pe){for(var We=0,Le=0,ot=_e.length,$e=ot-2;Le<ot;$e=Le,Le+=2)We+=(_e[Le]-_e[$e])*(_e[Le+1]+_e[$e+1]);if(We>0===Pe)for(Le=0,ot=_e.length;Le<ot/2;Le+=2){var de=_e[Le],Te=_e[Le+1];_e[Le]=_e[ot-2-Le],_e[Le+1]=_e[ot-1-Le],_e[ot-2-Le]=de,_e[ot-1-Le]=Te}}(ge,le),Y.push(ge)}}function Ki(Y,O){var V=(O=this.options=function(J,le){for(var me in le)J[me]=le[me];return J}(Object.create(this.options),O)).debug;if(V&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var J,le,me,ge,ce,_e,X=function(J,le){var me=[];if("FeatureCollection"===J.type)for(var ge=0;ge<J.features.length;ge++)Ga(me,J.features[ge],le,ge);else Ga(me,"Feature"===J.type?J:{geometry:J},le);return me}(Y,O);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(J=X,le=O,me=le.buffer/le.extent,ge=J,ce=ri(J,1,-1-me,me,0,-1,2,le),_e=ri(J,1,1-me,2+me,0,-1,2,le),(ce||_e)&&(ge=ri(J,1,-me,1+me,0,-1,2,le)||[],ce&&(ge=Xa(ce,1).concat(ge)),_e&&(ge=ge.concat(Xa(_e,-1)))),X=ge).length&&this.splitTile(X,0,0,0),V&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ri(Y,O,V){return 32*((1<<Y)*V+O)+Y}function Ya(Y,O){const V=Y.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const X=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!X)return O(null,null);const J=new ti(X.features);let le=en(J);0===le.byteOffset&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),O(null,{vectorTile:J,rawData:le.buffer})}Ki.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ki.prototype.splitTile=function(Y,O,V,X,J,le,me){for(var ge=[Y,O,V,X],ce=this.options,_e=ce.debug;ge.length;){X=ge.pop(),V=ge.pop(),O=ge.pop(),Y=ge.pop();var Pe=1<<O,We=Ri(O,V,X),Le=this.tiles[We];if(!Le&&(_e>1&&console.time("creation"),Le=this.tiles[We]=qo(Y,O,V,X,ce),this.tileCoords.push({z:O,x:V,y:X}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,V,X,Le.numFeatures,Le.numPoints,Le.numSimplified),console.timeEnd("creation"));var ot="z"+O;this.stats[ot]=(this.stats[ot]||0)+1,this.total++}if(Le.source=Y,J){if(O===ce.maxZoom||O===J)continue;var $e=1<<J-O;if(V!==Math.floor(le/$e)||X!==Math.floor(me/$e))continue}else if(O===ce.indexMaxZoom||Le.numPoints<=ce.indexMaxPoints)continue;if(Le.source=null,0!==Y.length){_e>1&&console.time("clipping");var de,Te,It,Kt,mt,Nt,Gt=.5*ce.buffer/ce.extent,Wo=.5-Gt,Yi=.5+Gt,Xe=1+Gt;de=Te=It=Kt=null,mt=ri(Y,Pe,V-Gt,V+Yi,0,Le.minX,Le.maxX,ce),Nt=ri(Y,Pe,V+Wo,V+Xe,0,Le.minX,Le.maxX,ce),Y=null,mt&&(de=ri(mt,Pe,X-Gt,X+Yi,1,Le.minY,Le.maxY,ce),Te=ri(mt,Pe,X+Wo,X+Xe,1,Le.minY,Le.maxY,ce),mt=null),Nt&&(It=ri(Nt,Pe,X-Gt,X+Yi,1,Le.minY,Le.maxY,ce),Kt=ri(Nt,Pe,X+Wo,X+Xe,1,Le.minY,Le.maxY,ce),Nt=null),_e>1&&console.timeEnd("clipping"),ge.push(de||[],O+1,2*V,2*X),ge.push(Te||[],O+1,2*V,2*X+1),ge.push(It||[],O+1,2*V+1,2*X),ge.push(Kt||[],O+1,2*V+1,2*X+1)}}},Ki.prototype.getTile=function(Y,O,V){var X=this.options,J=X.extent,le=X.debug;if(Y<0||Y>24)return null;var me=1<<Y,ge=Ri(Y,O=(O%me+me)%me,V);if(this.tiles[ge])return la(this.tiles[ge],J);le>1&&console.log("drilling down to z%d-%d-%d",Y,O,V);for(var ce,_e=Y,Pe=O,We=V;!ce&&_e>0;)_e--,Pe=Math.floor(Pe/2),We=Math.floor(We/2),ce=this.tiles[Ri(_e,Pe,We)];return ce&&ce.source?(le>1&&console.log("found parent tile z%d-%d-%d",_e,Pe,We),le>1&&console.time("drilling down"),this.splitTile(ce.source,_e,Pe,We,Y,O,V),le>1&&console.timeEnd("drilling down"),this.tiles[ge]?la(this.tiles[ge],J):null):null};class xs extends d.VectorTileWorkerSource{constructor(O,V,X,J,le){super(O,V,X,J,Ya),le&&(this.loadGeoJSON=le)}loadData(O,V){const X=O&&O.request,J=X&&X.collectResourceTiming;this.loadGeoJSON(O,(le,me)=>{if(le||!me)return V(le);if("object"!=typeof me)return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{nt(me,!0);try{if(O.filter){const ce=d.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ce.result)throw new Error(ce.value.map(Pe=>`${Pe.key}: ${Pe.message}`).join(", "));const _e=me.features.filter(Pe=>ce.value.evaluate({zoom:0},Pe));me={type:"FeatureCollection",features:_e}}this._geoJSONIndex=O.cluster?new Xi(function({superclusterOptions:ce,clusterProperties:_e}){if(!_e||!ce)return ce;const Pe={},We={},Le={accumulated:null,zoom:0},ot={properties:null},$e=Object.keys(_e);for(const de of $e){const[Te,It]=_e[de],Kt=d.createExpression(It),mt=d.createExpression("string"==typeof Te?[Te,["accumulated"],["get",de]]:Te);Pe[de]=Kt.value,We[de]=mt.value}return ce.map=de=>{ot.properties=de;const Te={};for(const It of $e)Te[It]=Pe[It].evaluate(Le,ot);return Te},ce.reduce=(de,Te)=>{ot.properties=Te;for(const It of $e)Le.accumulated=de[It],de[It]=We[It].evaluate(Le,ot)},ce}(O)).load(me.features):new Ki(ce=me,O.geojsonVtOptions)}catch(ce){return V(ce)}this.loaded={};const ge={};if(J){const ce=d.getPerformanceMeasurement(X);ce&&(ge.resourceTiming={},ge.resourceTiming[O.source]=JSON.parse(JSON.stringify(ce)))}V(null,ge)}var ce})}reloadTile(O,V){const X=this.loaded;return X&&X[O.uid]?super.reloadTile(O,V):this.loadTile(O,V)}loadGeoJSON(O,V){if(O.request)d.getJSON(O.request,V);else{if("string"!=typeof O.data)return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(O.data))}catch(X){return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(X){V(X)}}getClusterChildren(O,V){try{V(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(X){V(X)}}getClusterLeaves(O,V){try{V(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(X){V(X)}}}class bs{constructor(O){this.self=O,this.actor=new d.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:xs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,X)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=X},this.self.registerRTLTextPlugin=V=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=V.applyArabicShaping,d.plugin.processBidirectionalText=V.processBidirectionalText,d.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(O,V,X){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],X()}checkIfReady(O,V,X){X()}setReferrer(O,V){this.referrer=V}spriteLoaded(O,V){this.isSpriteLoaded[O]=V;for(const X in this.workerSources[O]){const J=this.workerSources[O][X];for(const le in J)J[le]instanceof d.VectorTileWorkerSource&&(J[le].isSpriteLoaded=V,J[le].fire(new d.Event("isSpriteLoaded")))}}setImages(O,V,X){this.availableImages[O]=V;for(const J in this.workerSources[O]){const le=this.workerSources[O][J];for(const me in le)le[me].availableImages=V}X()}enableTerrain(O,V,X){this.terrain=V,X()}setProjection(O,V){this.projections[O]=d.getProjection(V)}setLayers(O,V,X){this.getLayerIndex(O).replace(V),X()}updateLayers(O,V,X){this.getLayerIndex(O).update(V.layers,V.removedIds),X()}loadTile(O,V,X){const J=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;J.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,V.type,V.source).loadTile(J,X)}loadDEMTile(O,V,X){const J=this.enableTerrain?d.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(O,V.source).loadTile(J,X)}reloadTile(O,V,X){const J=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;J.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,V.type,V.source).reloadTile(J,X)}abortTile(O,V,X){this.getWorkerSource(O,V.type,V.source).abortTile(V,X)}removeTile(O,V,X){this.getWorkerSource(O,V.type,V.source).removeTile(V,X)}removeSource(O,V,X){if(!this.workerSources[O]||!this.workerSources[O][V.type]||!this.workerSources[O][V.type][V.source])return;const J=this.workerSources[O][V.type][V.source];delete this.workerSources[O][V.type][V.source],void 0!==J.removeSource?J.removeSource(V,X):X()}loadWorkerSource(O,V,X){try{this.self.importScripts(V.url),X()}catch(J){X(J.toString())}}syncRTLPluginState(O,V,X){try{d.plugin.setState(V);const J=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=J){this.self.importScripts(J);const le=d.plugin.isParsed();X(le?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),le)}}catch(J){X(J.toString())}}getAvailableImages(O){let V=this.availableImages[O];return V||(V=[]),V}getLayerIndex(O){let V=this.layerIndexes[O];return V||(V=this.layerIndexes[O]=new Sn),V}getWorkerSource(O,V,X){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][V]||(this.workerSources[O][V]={}),this.workerSources[O][V][X]||(this.workerSources[O][V][X]=new this.workerSourceTypes[V]({send:(J,le,me,ge,ce,_e)=>{this.actor.send(J,le,me,O,ce,_e)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][V][X]}getDEMWorkerSource(O,V){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][V]||(this.demWorkerSources[O][V]=new De),this.demWorkerSources[O][V]}enforceCacheSizeLimit(O,V){d.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(O,V,X){X(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bs(self)),bs}),at(0,function(d){var At=Bt;function Bt(p){return i=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,v=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(v);try{y=new Worker(D),m=!0}catch(C){m=!1}return y&&y.terminate(),URL.revokeObjectURL(D),m}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var v=y.getImageData(0,0,1,1);return v&&v.width===m.width}()||(void 0===Sn[c=i&&i.failIfMajorPerformanceCaveat]&&(Sn[c]=function(m){var y,D,C,A,v=(D=m,C=document.createElement("canvas"),(A=Object.create(Bt.webGLContextAttributes)).failIfMajorPerformanceCaveat=D,C.getContext("webgl",A)||C.getContext("experimental-webgl",A));if(!v)return!1;try{y=v.createShader(v.VERTEX_SHADER)}catch(D){return!1}return!(!y||v.isContextLost())&&(v.shaderSource(y,"void main() {}"),v.compileShader(y),!0===v.getShaderParameter(y,v.COMPILE_STATUS))}(c)),!Sn[c]||document.documentMode));var i,c}var Sn={};function Ie(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let c=0;c<p.length;c++)if(!Ie(p[c],i[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==i){if("object"!=typeof i||Object.keys(p).length!==Object.keys(i).length)return!1;for(const c in p)if(!Ie(p[c],i[c]))return!1;return!0}return p===i}Bt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const De={create:function(p,i,c){const m=d.window.document.createElement(p);return void 0!==i&&(m.className=i),c&&c.appendChild(m),m},createNS:function(p,i){return d.window.document.createElementNS(p,i)}},nt=d.window.document&&d.window.document.documentElement.style,ui=nt&&void 0!==nt.userSelect?"userSelect":"WebkitUserSelect";let na;De.disableDrag=function(){nt&&ui&&(na=nt[ui],nt[ui]="none")},De.enableDrag=function(){nt&&ui&&(nt[ui]=na)},De.setTransform=function(p,i){p.style.transform=i};let vo=!1;try{const p=Object.defineProperty({},"passive",{get(){vo=!0}});d.window.addEventListener("test",p,p),d.window.removeEventListener("test",p,p)}catch(p){vo=!1}De.addEventListener=function(p,i,c,m={}){p.addEventListener(i,c,"passive"in m&&vo?m:m.capture)},De.removeEventListener=function(p,i,c,m={}){p.removeEventListener(i,c,"passive"in m&&vo?m:m.capture)};const yn=function(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",yn,!0)};function ti(p,i,c){const m=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new d.pointGeometry((c.clientX-i.left)*m,(c.clientY-i.top)*m)}function Hl(p,i){var c=i[0],m=i[1],y=i[2],v=i[3],D=c*v-y*m;return D?(p[0]=v*(D=1/D),p[1]=-m*D,p[2]=-y*D,p[3]=c*D,p):null}De.suppressClick=function(){d.window.addEventListener("click",yn,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",yn,!0)},0)},De.mousePos=function(p,i){const c=p.getBoundingClientRect();return ti(p,c,i)},De.touchPos=function(p,i){const c=p.getBoundingClientRect(),m=[];for(let y=0;y<i.length;y++)m.push(ti(p,c,i[y]));return m},De.mouseButton=function(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button},De.remove=function(p){p.parentNode&&p.parentNode.removeChild(p)};class Vo{constructor(i,c){this.pos=i,this.dir=c}intersectsPlane(i,c,m){const y=d.dot(c,this.dir);if(Math.abs(y)<1e-6)return!1;const v=d.dot(d.sub(d.create(),i,this.pos),c)/y,D=d.scaleAndAdd(d.create(),this.pos,this.dir,v);return d.copy(m,D),!0}}class ni{constructor(i,c){this.points=i,this.planes=c}static fromInvProjectionMatrix(i,c,m){const y=Math.pow(2,m),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const A=d.transformMat4([],C,i),R=1/A[3]/c*y;return d.mul(A,A,[R,R,1/A[3],R])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const A=d.sub([],v[C[0]],v[C[1]]),R=d.sub([],v[C[2]],v[C[1]]),L=d.normalize([],d.cross([],A,R)),F=-d.dot(L,v[C[1]]);return L.concat(F)});return new ni(v,D)}}class bi{constructor(i,c){this.min=i,this.max=c,this.center=d.scale([],d.add([],this.min,this.max),.5)}quadrant(i){const c=[i%2==0,i<2],m=d.clone(this.min),y=d.clone(this.max);for(let v=0;v<c.length;v++)m[v]=c[v]?this.min[v]:this.center[v],y[v]=c[v]?this.center[v]:this.max[v];return y[2]=this.max[2],new bi(m,y)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}intersects(i){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let y=0;y<i.planes.length;y++){const v=i.planes[y];let D=0;for(let C=0;C<c.length;C++)D+=d.dot$1(v,c[C])>=0;if(0===D)return 0;D!==c.length&&(m=!1)}if(m)return 2;for(let y=0;y<3;y++){let v=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let C=0;C<i.points.length;C++){const A=i.points[C][y]-this.min[y];v=Math.min(v,A),D=Math.max(D,A)}if(D<0||v>this.max[y]-this.min[y])return 0}return 1}}function en(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class xo extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}getImage(i){return this.images[i]}addImage(i,c){this._validate(i,c)&&(this.images[i]=c)}_validate(i,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,c){if(!i)return!0;let m=0;for(const y of i){if(y[0]<m||y[1]<y[0]||c<y[1])return!1;m=y[1]}return!0}_validateContent(i,c){return!(i&&(4!==i.length||i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,c){c.version=this.images[i].version+1,this.images[i]=c,this.updatedImages[i]=!0}removeImage(i){const c=this.images[i];delete this.images[i],delete this.patterns[i],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,c){let m=!0;if(!this.isLoaded())for(const y of i)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(i,c):this.requestors.push({ids:i,callback:c})}_notify(i,c){const m={};for(const y of i){this.images[y]||this.fire(new d.Event("styleimagemissing",{id:y}));const v=this.images[y];v?m[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:Boolean(v.userImage&&v.userImage.render)}:d.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:i,height:c}=this.atlasImage;return{width:i,height:c}}getPattern(i){const c=this.patterns[i],m=this.getImage(i);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},v=new d.ImagePosition(y,m);this.patterns[i]={bin:y,position:v}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const c=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(i,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const v in this.patterns)i.push(this.patterns[v].bin);const{w:c,h:m}=d.potpack(i),y=this.atlasImage;y.resize({width:c||1,height:m||1});for(const v in this.patterns){const{bin:D}=this.patterns[v],C=D.x+1,A=D.y+1,R=this.images[v].data,L=R.width,F=R.height;d.RGBAImage.copy(R,y,{x:0,y:0},{x:C,y:A},{width:L,height:F}),d.RGBAImage.copy(R,y,{x:0,y:F-1},{x:C,y:A-1},{width:L,height:1}),d.RGBAImage.copy(R,y,{x:0,y:0},{x:C,y:A+F},{width:L,height:1}),d.RGBAImage.copy(R,y,{x:L-1,y:0},{x:C-1,y:A},{width:1,height:F}),d.RGBAImage.copy(R,y,{x:0,y:0},{x:C+L,y:A},{width:1,height:F})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const c of i){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];en(m)&&this.updateImage(c,m)}}}const Uo=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,i){return function([c,m,y]){const v=d.degToRad(m+90),D=d.degToRad(y);return{x:c*Math.cos(v)*Math.sin(D),y:c*Math.sin(v)*Math.sin(D),z:c*Math.cos(D),azimuthal:m,polar:y}}(p.expression.evaluate(i))}interpolate(p,i,c){return{x:d.number(p.x,i.x,c),y:d.number(p.y,i.y,c),z:d.number(p.z,i.z,c),azimuthal:d.number(p.azimuthal,i.azimuthal,c),polar:d.number(p.polar,i.polar,c)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),jo="-transition";class Vn extends d.Evented{constructor(i){super(),this._transitionable=new d.Transitionable(Uo),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c={}){if(!this._validate(d.validateLight,i,c))for(const m in i){const y=i[m];d.endsWith(m,jo)?this._transitionable.setTransition(m.slice(0,-jo.length),y):this._transitionable.setValue(m,y)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,i.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Va=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),_s="-transition";class ys extends d.Evented{constructor(i){super(),this._transitionable=new d.Transitionable(Va),this.set(i),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(i){for(const c in i){const m=i[c];d.endsWith(c,_s)?this._transitionable.setTransition(c.slice(0,-_s.length),m):this._transitionable.setValue(c,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function ra(p,i,c,m){const y=d.smoothstep(45,65,c),[v,D]=ql(p,m),C=d.length(i);let A=1-Math.min(1,Math.exp((C-v)/(D-v)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*p.alpha}function ql(p,i){const c=.5/Math.tan(.5*i);return[p.range[0]+c,p.range[1]+c]}const $o=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"])}),Hn="-transition";class Zi extends d.Evented{constructor(i,c){super(),this._transitionable=new d.Transitionable($o),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=c}isSoftDisabled(){return"mercator"!==this._transform.projection.name}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c={}){if(!this._validate(d.validateFog,i,c))for(const m in i){const y=i[m];d.endsWith(m,Hn)?this._transitionable.setTransition(m.slice(0,-Hn.length),y):this._transitionable.setValue(m,y)}}getOpacity(i){if(this.isSoftDisabled())return 0;const c=this.properties&&this.properties.get("color")||1;return d.smoothstep(45,65,i)*c.a}getOpacityAtLatLng(i,c){return this.isSoftDisabled()?0:function(m,y,v){const D=d.MercatorCoordinate.fromLngLat(y),C=v.elevation?v.elevation.getAtPointOrZero(D):0,A=[D.x,D.y,C];return d.transformMat4$1(A,A,v.mercatorFogMatrix),ra(m,A,v.pitch,v._fov)}(this.state,i,c)}getFovAdjustedRange(i){return this.isSoftDisabled()?[0,1]:ql(this.state,i)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,m){return(!m||!1!==m.validate)&&d.emitValidationErrors(this,i.call(d.validateStyle,d.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Wi{constructor(i,c){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const v=new Wi.Actor(m[y],c,this.id);v.name=`Worker ${y}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,c,m){d.asyncAll(this.actors,(y,v)=>{y.send(i,c,v)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function cr(p,i,c){return i*(d.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}Wi.Actor=d.Actor;class ia{constructor(i,c,m,y){this.screenBounds=i,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(v=>y.pointCoordinate3D(v)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(i,c){let m,y;if(i instanceof d.pointGeometry||"number"==typeof i[0]){const v=d.pointGeometry.convert(i);m=[d.pointGeometry.convert(i)],y=c.isPointAboveHorizon(v)}else{const v=d.pointGeometry.convert(i[0]),D=d.pointGeometry.convert(i[1]);m=[v,D],y=d.polygonizeBounds(v,D).every(C=>c.isPointAboveHorizon(C))}return new ia(m,c.getCameraPoint(),y,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],m=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],y=d.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),d.bufferConvexPolygon(y,i)}containsTile(i,c,m){const y=i.queryPadding+1,v=i.tileID.wrap,D=m?this._bufferedCameraMercator(y,c).map(Z=>d.getTilePoint(i.tileTransform,Z,v)):this._bufferedScreenMercator(y,c).map(Z=>d.getTilePoint(i.tileTransform,Z,v)),C=this.screenGeometryMercator.map(Z=>d.getTileVec3(i.tileTransform,Z,v)),A=C.map(Z=>new d.pointGeometry(Z[0],Z[1])),R=c.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),L=d.getTileVec3(i.tileTransform,R,v),F=C.map(Z=>{const G=d.sub(Z,Z,L);return d.normalize(G,G),new Vo(L,G)}),U=cr(i,1,c.zoom);if(d.polygonIntersectsBox(D,0,0,d.EXTENT,d.EXTENT))return{queryGeometry:this,tilespaceGeometry:A,tilespaceRays:F,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(H=d.getBounds(D),H.min.x=d.clamp(H.min.x,0,d.EXTENT),H.min.y=d.clamp(H.min.y,0,d.EXTENT),H.max.x=d.clamp(H.max.x,0,d.EXTENT),H.max.y=d.clamp(H.max.y,0,d.EXTENT),H),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:U};var H}_bufferedScreenMercator(i,c){const m=En(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{const y=this.bufferedScreenGeometry(i).map(v=>c.pointCoordinate3D(v));return this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(i,c){const m=En(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{const y=this.bufferedCameraGeometry(i).map(v=>c.pointCoordinate3D(v));return this._cameraRaycastCache[m]=y,y}}}function En(p){return 100*p|0}function hi(p,i,c){const m=function(y,v){if(y)return c(y);if(v){const D=d.pick(d.extend(v,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(D.vectorLayers=v.vector_layers,D.vectorLayerIds=D.vectorLayers.map(C=>C.id)),D.tiles=i.canonicalizeTileset(D,p.url),c(null,D)}};return p.url?d.getJSON(i.transformRequest(i.normalizeSourceURL(p.url),d.ResourceType.Source),m):d.exported.frame(()=>m(null,p))}class Zl{constructor(i,c,m){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),m=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*c),v=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*c),D=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*c);return i.x>=m&&i.x<v&&i.y>=y&&i.y<D}}class yr{constructor(i,c,m){this.context=i;const y=i.gl;this.buffer=y.createBuffer(),this.dynamicDraw=Boolean(m),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const wi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xi{constructor(i,c,m,y){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=i;const v=i.gl;this.buffer=v.createBuffer(),i.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let m=0;m<this.attributes.length;m++){const y=c.attributes[this.attributes[m].name];void 0!==y&&i.enableVertexAttribArray(y)}}setVertexAttribPointers(i,c,m){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],D=c.attributes[v.name];void 0!==D&&i.vertexAttribPointer(D,v.components,i[wi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ot{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ua extends Ot{getDefault(){return d.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class vs extends Ot{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Wl extends Ot{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class oa extends Ot{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ei extends Ot{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class ja extends Ot{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class zt extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class sa extends Ot{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class bo extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class wo extends Ot{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class aa extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class Go extends Ot{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class $a extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Ga extends Ot{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ha extends Ot{getDefault(){return d.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ur extends Ot{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Ho extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class Wc extends Ot{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Di extends Ot{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class ri extends Ot{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Xl extends Ot{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class qa extends Ot{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Kl extends Ot{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Yl extends Ot{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Za extends Ot{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Jl extends Ot{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Wa extends Ot{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Xa extends Ot{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Eo extends Ot{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class la extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ti extends Ot{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class qo extends Ot{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Ka extends qo{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Zo extends qo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ki extends Zo{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ri{constructor(i,c,m,y){this.context=i,this.width=c,this.height=m;const v=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Ka(i,v),y&&(this.depthAttachment=new Zo(i,v))}destroy(){const i=this.context.gl,c=this.colorAttachment.get();if(c&&i.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&i.deleteRenderbuffer(m)}i.deleteFramebuffer(this.framebuffer)}}class Ya{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ua(this),this.clearDepth=new vs(this),this.clearStencil=new Wl(this),this.colorMask=new oa(this),this.depthMask=new Ei(this),this.stencilMask=new ja(this),this.stencilFunc=new zt(this),this.stencilOp=new sa(this),this.stencilTest=new bo(this),this.depthRange=new wo(this),this.depthTest=new aa(this),this.depthFunc=new Go(this),this.blend=new $a(this),this.blendFunc=new Ga(this),this.blendColor=new Ha(this),this.blendEquation=new ur(this),this.cullFace=new Ho(this),this.cullFaceSide=new Wc(this),this.frontFace=new Di(this),this.program=new ri(this),this.activeTexture=new Xl(this),this.viewport=new qa(this),this.bindFramebuffer=new Kl(this),this.bindRenderbuffer=new Yl(this),this.bindTexture=new Za(this),this.bindVertexBuffer=new Jl(this),this.bindElementBuffer=new Wa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Xa(this),this.pixelStoreUnpack=new Eo(this),this.pixelStoreUnpackPremultiplyAlpha=new la(this),this.pixelStoreUnpackFlipY=new Ti(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c){return new yr(this,i,c)}createVertexBuffer(i,c,m){return new Xi(this,i,c,m)}createRenderbuffer(i,c,m){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,i,c,m),this.bindRenderbuffer.set(null),v}createFramebuffer(i,c,m){return new Ri(this,i,c,m)}clear({color:i,depth:c,stencil:m}){const y=this.gl;let v=0;i&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==m&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(v)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Ie(i.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class xs extends d.Evented{constructor(i,c,m,y){super(),this.id=i,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},c),d.extend(this,d.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(i,c)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new d.ErrorEvent(i)):c&&(d.extend(this,c),c.bounds&&(this.tileBounds=new Zl(c.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(c.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const m=d.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),(v,D,C,A)=>{if(delete i.request,i.aborted)i.state="unloaded",c(null);else if(v)i.state="errored",c(v);else if(D){this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:C,expires:A});const R=this.map.painter.context,L=R.gl;i.texture=this.map.painter.getTileTexture(D.width),i.texture?i.texture.update(D,{useMipmap:!0}):(i.texture=new d.Texture(R,D,L.RGBA,{useMipmap:!0}),i.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE),R.extTextureFilterAnisotropic&&L.texParameterf(L.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),i.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c()}unloadTile(i,c){i.texture&&this.map.painter.saveTileTexture(i.texture),c()}hasTransition(){return!1}}let bs;class Y extends d.Evented{constructor(i,c,m,y){super(),this.id=i,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c}load(i,c){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(m,y)=>{this._loaded=!0,m?this.fire(new d.ErrorEvent(m)):y&&(this.image=d.exported.getImageData(y),i&&(this.coordinates=i),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}setCoordinates(i){this.coordinates=i,delete this._boundsArray;const c=i.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,v=1/0,D=-1/0,C=-1/0;for(const F of m)y=Math.min(y,F.x),v=Math.min(v,F.y),D=Math.max(D,F.x),C=Math.max(C,F.y);const A=Math.max(D-y,C-v),R=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),L=Math.pow(2,R);return new d.CanonicalTileID(R,Math.floor((y+D)/2*L),Math.floor((v+C)/2*L))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const i=d.tileTransform(this.tileID,this.map.transform.projection),c=this.coordinates.map(m=>{const y=i.projection.project(m[0],m[1]);return d.getTilePoint(i,y)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,c=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(i,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}loadTile(i,c){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},c(null)):(i.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const O={vector:class extends d.Evented{constructor(p,i,c,m){if(super(),this.id=p,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(i,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=hi(this._options,this.map._requestManager,(p,i)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new d.ErrorEvent(p)):i&&(d.extend(this,i),i.bounds&&(this.tileBounds=new Zl(i.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(i.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p();const i=this.map.style._getSourceCaches(this.id);for(const c of i)c.clearTiles();this.load()}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,i){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(c,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(m.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=i:p.request=p.actor.send("reloadTile",m,y.bind(this));else if(p.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",m,y.bind(this),void 0,!0);else{const v=d.loadVectorTile.call({deduped:this._deduped},m,(D,C)=>{D||!C?y.call(this,D):(m.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},p.actor&&p.actor.send("loadTile",m,y.bind(this),void 0,!0))},!0);p.request={cancel:v}}function y(v,D){return delete p.request,p.aborted?i(null):v&&404!==v.status?i(v):(D&&D.resourceTiming&&(p.resourceTiming=D.resourceTiming),this.map._refreshExpiredTiles&&D&&p.setExpiryData(D),p.loadVectorData(D,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:xs,"raster-dem":class extends xs{constructor(p,i,c,m){super(p,i,c,m),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,v){y&&(p.state="errored",i(y)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=d.getImage(this.map._requestManager.transformRequest(c,d.ResourceType.Tile),function(y,v,D,C){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(y)p.state="errored",i(y);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:D,expires:C});const A=d.window.ImageBitmap&&v instanceof d.window.ImageBitmap&&(null==bs&&(bs=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),bs),R=1-(v.width-d.prevPowerOfTwo(v.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=A?v:d.exported.getImageData(v,R),F={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:R};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",F,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const i=p.canonical,c=Math.pow(2,i.z),m=(i.x-1+c)%c,y=0===i.x?p.wrap-1:p.wrap,v=(i.x+1+c)%c,D=i.x+1===c?p.wrap+1:p.wrap,C={};return C[new d.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y).key]={backfilled:!1},C[new d.OverscaledTileID(p.overscaledZ,D,i.z,v,i.y).key]={backfilled:!1},i.y>0&&(C[new d.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},C[new d.OverscaledTileID(p.overscaledZ,D,i.z,v,i.y-1).key]={backfilled:!1}),i.y+1<c&&(C[new d.OverscaledTileID(p.overscaledZ,y,i.z,m,i.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},C[new d.OverscaledTileID(p.overscaledZ,D,i.z,v,i.y+1).key]={backfilled:!1}),C}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,i,c,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=i.data,this._options=d.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const y=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*y,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*y,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*y,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},i),this}getClusterLeaves(p,i,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:i,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),i=this._data;"string"==typeof i?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(i),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new d.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new d.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete p.request,p.unloadVectorData(),p.aborted?i(null):m?i(m):(p.loadVectorData(y,this.map.painter,"reloadTile"===c),i(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Y{constructor(p,i,c,m){super(p,i,c,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,d.ResourceType.Source).url);d.getVideo(this.urls,(i,c)=>{this._loaded=!0,i?this.fire(new d.ErrorEvent(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE));for(const c in this.tiles){const m=this.tiles[c];"loaded"!==m.state&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Y,canvas:class extends Y{constructor(p,i,c,m){super(p,i,c,m),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(y=>!Array.isArray(y)||2!==y.length||y.some(v=>"number"!=typeof v))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context,c=i.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,d.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(i,this.canvas,c.RGBA,{premultiply:!0});for(const m in this.tiles){const y=this.tiles[m];"loaded"!==y.state&&(y.state="loaded",y.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}}},V=function(p,i,c,m){const y=new O[i.type](p,i,c,m);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],y),y};function X(p,i){const c=d.identity([]);return d.scale$1(c,c,[.5*p.width,.5*-p.height,1]),d.translate(c,c,[1,-1,0]),d.multiply(c,c,p.calculateProjMatrix(i.toUnwrapped()))}function J(p,i,c,m,y,v,D,C=!1){const A=p.tilesIn(m,D,C);A.sort(me);const R=[];for(const F of A)R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(i,c,p._state,F,y,v,X(p.transform,F.tile.tileID),C)});const L=function(F){const U={},H={};for(const Z of F){const G=Z.queryResults,Q=Z.wrappedTileID,q=H[Q]=H[Q]||{};for(const ee in G){const re=G[ee],W=q[ee]=q[ee]||{},ie=U[ee]=U[ee]||[];for(const ae of re)W[ae.featureIndex]||(W[ae.featureIndex]=!0,ie.push(ae))}}return U}(R);for(const F in L)L[F].forEach(U=>{const H=U.feature,Z=p.getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=Z});return L}function le(p,i){const c=p.getRenderableIds().map(v=>p.getTileByID(v)),m=[],y={};for(let v=0;v<c.length;v++){const D=c[v],C=D.tileID.canonical.key;y[C]||(y[C]=!0,D.querySourceFeatures(m,i))}return m}function me(p,i){const c=p.tileID,m=i.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function ge(){return null!=is.workerClass?new is.workerClass:new d.window.Worker(is.workerUrl)}const ce="mapboxgl_preloaded_worker_pool";class _e{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<_e.workerCount;)this.workers.push(new ge);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ce]}numActive(){return Object.keys(this.active).length}}let Pe;function We(){return Pe||(Pe=new _e),Pe}function Le(p,i){const c={};for(const m in p)"ref"!==m&&(c[m]=p[m]);return d.refProperties.forEach(m=>{m in i&&(c[m]=i[m])}),c}function ot(p){p=p.slice();const i=Object.create(null);for(let c=0;c<p.length;c++)i[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Le(p[c],i[p[c].ref]));return p}_e.workerCount=2;const $e={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function de(p,i,c){c.push({command:$e.addSource,args:[p,i[p]]})}function Te(p,i,c){i.push({command:$e.removeSource,args:[p]}),c[p]=!0}function It(p,i,c,m){Te(p,c,m),de(p,i,c)}function Kt(p,i,c){let m;for(m in p[c])if(p[c].hasOwnProperty(m)&&"data"!==m&&!Ie(p[c][m],i[c][m]))return!1;for(m in i[c])if(i[c].hasOwnProperty(m)&&"data"!==m&&!Ie(p[c][m],i[c][m]))return!1;return!0}function mt(p,i,c,m,y,v){let D;for(D in i=i||{},p=p||{})p.hasOwnProperty(D)&&(Ie(p[D],i[D])||c.push({command:v,args:[m,D,i[D],y]}));for(D in i)i.hasOwnProperty(D)&&!p.hasOwnProperty(D)&&(Ie(p[D],i[D])||c.push({command:v,args:[m,D,i[D],y]}))}function Nt(p){return p.id}function Gt(p,i){return p[i.id]=i,p}class Wo{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=d.clamp(i,0,1);let c=1,m=this._distances[c];const y=i*this.paddedLength+this.padding;for(;m<y&&c<this._distances.length;)m=this._distances[++c];const v=c-1,D=this._distances[v],C=m-D,A=C>0?(y-D)/C:0;return this.points[v].mult(1-A).add(this.points[c].mult(A))}}class Yi{constructor(i,c,m){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(c/m);for(let D=0;D<this.xCellCount*this.yCellCount;D++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,m,y,v){this._forEachCell(c,m,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(i,c,m,y){this._forEachCell(c-y,m-y,c+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(m),this.circles.push(y)}_insertBoxCell(i,c,m,y,v,D){this.boxCells[v].push(D)}_insertCircleCell(i,c,m,y,v,D){this.circleCells[v].push(D)}_query(i,c,m,y,v,D){if(m<0||i>this.width||y<0||c>this.height)return!v&&[];const C=[];if(i<=0&&c<=0&&this.width<=m&&this.height<=y){if(v)return!0;for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const R=this.circles[3*A],L=this.circles[3*A+1],F=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:R-F,y1:L-F,x2:R+F,y2:L+F})}return D?C.filter(D):C}return this._forEachCell(i,c,m,y,this._queryCell,C,{hitTest:v,seenUids:{box:{},circle:{}}},D),v?C.length>0:C}_queryCircle(i,c,m,y,v){const D=i-m,C=i+m,A=c-m,R=c+m;if(C<0||D>this.width||R<0||A>this.height)return!y&&[];const L=[];return this._forEachCell(D,A,C,R,this._queryCellCircle,L,{hitTest:y,circle:{x:i,y:c,radius:m},seenUids:{box:{},circle:{}}},v),y?L.length>0:L}query(i,c,m,y,v){return this._query(i,c,m,y,!1,v)}hitTest(i,c,m,y,v){return this._query(i,c,m,y,!0,v)}hitTestCircle(i,c,m,y){return this._queryCircle(i,c,m,!0,y)}_queryCell(i,c,m,y,v,D,C,A){const R=C.seenUids,L=this.boxCells[v];if(null!==L){const U=this.bboxes;for(const H of L)if(!R.box[H]){R.box[H]=!0;const Z=4*H;if(i<=U[Z+2]&&c<=U[Z+3]&&m>=U[Z+0]&&y>=U[Z+1]&&(!A||A(this.boxKeys[H]))){if(C.hitTest)return D.push(!0),!0;D.push({key:this.boxKeys[H],x1:U[Z],y1:U[Z+1],x2:U[Z+2],y2:U[Z+3]})}}}const F=this.circleCells[v];if(null!==F){const U=this.circles;for(const H of F)if(!R.circle[H]){R.circle[H]=!0;const Z=3*H;if(this._circleAndRectCollide(U[Z],U[Z+1],U[Z+2],i,c,m,y)&&(!A||A(this.circleKeys[H]))){if(C.hitTest)return D.push(!0),!0;{const G=U[Z],Q=U[Z+1],q=U[Z+2];D.push({key:this.circleKeys[H],x1:G-q,y1:Q-q,x2:G+q,y2:Q+q})}}}}}_queryCellCircle(i,c,m,y,v,D,C,A){const R=C.circle,L=C.seenUids,F=this.boxCells[v];if(null!==F){const H=this.bboxes;for(const Z of F)if(!L.box[Z]){L.box[Z]=!0;const G=4*Z;if(this._circleAndRectCollide(R.x,R.y,R.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!A||A(this.boxKeys[Z])))return D.push(!0),!0}}const U=this.circleCells[v];if(null!==U){const H=this.circles;for(const Z of U)if(!L.circle[Z]){L.circle[Z]=!0;const G=3*Z;if(this._circlesCollide(H[G],H[G+1],H[G+2],R.x,R.y,R.radius)&&(!A||A(this.circleKeys[Z])))return D.push(!0),!0}}}_forEachCell(i,c,m,y,v,D,C,A){const R=this._convertToXCellCoord(i),L=this._convertToYCellCoord(c),F=this._convertToXCellCoord(m),U=this._convertToYCellCoord(y);for(let H=R;H<=F;H++)for(let Z=L;Z<=U;Z++)if(v.call(this,i,c,m,y,this.xCellCount*Z+H,D,C,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,m,y,v,D){const C=y-i,A=v-c,R=m+D;return R*R>C*C+A*A}_circleAndRectCollide(i,c,m,y,v,D,C){const A=(D-y)/2,R=Math.abs(i-(y+A));if(R>A+m)return!1;const L=(C-v)/2,F=Math.abs(c-(v+L));if(F>L+m)return!1;if(R<=A||F<=L)return!0;const U=R-A,H=F-L;return U*U+H*H<=m*m}}const Xe=Math.tan(85*Math.PI/180);function Tt(p,i,c,m,y){const v=d.create$1();if(i){const D=Hl([],y);v[0]=D[0],v[1]=D[1],v[4]=D[2],v[5]=D[3],c||d.rotateZ(v,v,m.angle)}else d.multiply(v,m.labelPlaneMatrix,p);return v}function Ct(p,i,c,m,y){if(i){const v=d.clone$1(p),D=d.identity([]);return D[0]=y[0],D[1]=y[1],D[4]=y[2],D[5]=y[3],d.multiply(v,v,D),c||d.rotateZ(v,v,-m.angle),v}return m.glCoordMatrix}function qn(p,i,c=0){const m=[p.x,p.y,c,1];c?d.transformMat4(m,m,i):Ar(m,m,i);const y=m[3];return{point:new d.pointGeometry(m[0]/y,m[1]/y),signedDistanceFromCamera:y}}function ws(p,i){return Math.min(.5+p/i*.5,1.5)}function Et(p,i){const c=p[0]/p[3],m=p[1]/p[3];return c>=-i[0]&&c<=i[0]&&m>=-i[1]&&m<=i[1]}function cn(p,i,c,m,y,v,D,C,A){const R=m?p.textSizeData:p.iconSizeData,L=d.evaluateSizeForZoom(R,c.transform.zoom),F=[256/c.width*2+1,256/c.height*2+1],U=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;U.clear();const H=p.lineVertexArray,Z=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,G=c.transform.width/c.transform.height;let Q=!1;for(let q=0;q<Z.length;q++){const ee=Z.get(q);if(ee.writingMode!==d.WritingMode.vertical||Q||0!==q&&Z.get(q-1).writingMode===d.WritingMode.horizontal||(Q=!0),ee.hidden||ee.writingMode===d.WritingMode.vertical&&!Q){Ji(ee.numGlyphs,U);continue}Q=!1;const re=new d.pointGeometry(ee.tileAnchorX,ee.tileAnchorY),W=A?A(re):0,ie=[re.x,re.y,W],ae=[...ie,1];if(d.transformMat4(ae,ae,i),!Et(ae,F)){Ji(ee.numGlyphs,U);continue}const be=ws(c.transform.cameraToCenterDistance,ae[3]),xe=d.evaluateSizeForFeature(R,L,ee),Ce=D?xe/be:xe*be,Se=qn(new d.pointGeometry(ie[0],ie[1]),y,ie[2]);if(Se.signedDistanceFromCamera<=0){Ji(ee.numGlyphs,U);continue}let Ve={};const we=D?null:A,Ue=Ur(ee,Ce,!1,C,i,y,v,p.glyphOffsetArray,H,U,Se.point,re,Ve,G,we);Q=Ue.useVertical,we&&Ue.needsFlipping&&(Ve={}),(Ue.notEnoughRoom||Q||Ue.needsFlipping&&Ur(ee,Ce,!0,C,i,y,v,p.glyphOffsetArray,H,U,Se.point,re,Ve,G,we).notEnoughRoom)&&Ji(ee.numGlyphs,U)}m?p.text.dynamicLayoutVertexBuffer.updateData(U):p.icon.dynamicLayoutVertexBuffer.updateData(U)}function Xo(p,i,c,m,y,v,D,C,A,R,L,F,U){const H=C.glyphStartIndex+C.numGlyphs,Z=C.lineStartIndex,G=C.lineStartIndex+C.lineLength,Q=i.getoffsetX(C.glyphStartIndex),q=i.getoffsetX(H-1),ee=gt(p*Q,c,m,y,v,D,C.segment,Z,G,A,R,L,F,U,!0);if(!ee)return null;const re=gt(p*q,c,m,y,v,D,C.segment,Z,G,A,R,L,F,U,!0);return re?{first:ee,last:re}:null}function Pt(p,i,c,m){return p.writingMode===d.WritingMode.horizontal&&Math.abs(c.y-i.y)>Math.abs(c.x-i.x)*m?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?i.y<c.y?{needsFlipping:!0}:null:0!==p.flipState&&function(y,v,D){const C=(v.x-y.x)*D;return 0===C||Math.abs((v.y-y.y)/C)>Xe}(i,c,m)?1===p.flipState?{needsFlipping:!0}:null:i.x>c.x?{needsFlipping:!0}:null}function Ur(p,i,c,m,y,v,D,C,A,R,L,F,U,H,Z){const G=i/24,Q=p.lineOffsetX*G,q=p.lineOffsetY*G;let ee;if(p.numGlyphs>1){const re=p.glyphStartIndex+p.numGlyphs,W=p.lineStartIndex,ie=p.lineStartIndex+p.lineLength,ae=Xo(G,C,Q,q,c,L,F,p,A,v,U,Z,!1);if(!ae)return{notEnoughRoom:!0};const be=qn(ae.first.point,D).point,xe=qn(ae.last.point,D).point;if(m&&!c){const Ce=Pt(p,be,xe,H);if(p.flipState=Ce&&Ce.needsFlipping?1:2,Ce)return Ce}ee=[ae.first];for(let Ce=p.glyphStartIndex+1;Ce<re-1;Ce++)ee.push(gt(G*C.getoffsetX(Ce),Q,q,c,L,F,p.segment,W,ie,A,v,U,Z,!1,!1));ee.push(ae.last)}else{if(m&&!c){const W=qn(F,y).point,ie=p.lineStartIndex+p.segment+1,ae=new d.pointGeometry(A.getx(ie),A.gety(ie)),be=qn(ae,y),xe=Pt(p,W,be.signedDistanceFromCamera>0?be.point:Ql(F,ae,W,1,y,void 0),H);if(p.flipState=xe&&xe.needsFlipping?1:2,xe)return xe}const re=gt(G*C.getoffsetX(p.glyphStartIndex),Q,q,c,L,F,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,v,U,Z,!1,!1);if(!re)return{notEnoughRoom:!0};ee=[re]}for(const re of ee)d.addDynamicAttributes(R,re.point,re.angle);return{}}function Mn(p,i,c){const m={x:p.x,y:p.y,z:0};if(!c)return qn(m,i,m.z);const y=c(p);return qn(new d.pointGeometry(m.x,m.y),i,m.z+y)}function Ql(p,i,c,m,y,v){const D=Mn(p.add(p.sub(i)._unit()),y,v).point,C=c.sub(D);return c.add(C._mult(m/C.mag()))}function gt(p,i,c,m,y,v,D,C,A,R,L,F,U,H,Z){const G=m?p-i:p+i;let Q=G>0?1:-1,q=0;m&&(Q*=-1,q=Math.PI),Q<0&&(q+=Math.PI);let ee=Q>0?C+D:C+D+1,re=y,W=y,ie=0,ae=0;const be=Math.abs(G),xe=[],Ce=[];let Se=v;const Ve=()=>{const lt=ee-Q;return 0===ie?v:new d.pointGeometry(R.getx(lt),R.gety(lt))},we=()=>Ql(Ve(),Se,W,be-ie+1,L,U);for(;ie+ae<=be;){if(ee+=Q,ee<C||ee>=A)return null;if(W=re,xe.push(re),H&&Ce.push(Se||Ve()),re=F[ee],void 0===re){Se=new d.pointGeometry(R.getx(ee),R.gety(ee));const lt=Mn(Se,L,U);re=lt.signedDistanceFromCamera>0?F[ee]=lt.point:we()}else Se=null;ie+=ae,ae=W.dist(re)}Z&&U&&(Se=Se||new d.pointGeometry(R.getx(ee),R.gety(ee)),F[ee]=re=void 0===F[ee]?re:we(),ae=W.dist(re));const Ue=(be-ie)/ae,ve=re.sub(W),Ge=ve.mult(Ue)._add(W);c&&Ge._add(ve._unit()._perp()._mult(c*Q));const Je=q+Math.atan2(re.y-W.y,re.x-W.x);return xe.push(Ge),H&&(Se=Se||new d.pointGeometry(R.getx(ee),R.gety(ee)),Ce.push(function(lt,ht,dt){const pt=1-dt;return new d.pointGeometry(lt.x*pt+ht.x*dt,lt.y*pt+ht.y*dt)}(Ce.length>0?Ce[Ce.length-1]:Se,Se,Ue))),{point:Ge,angle:Je,path:xe,tilePath:Ce}}const ec=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ji(p,i){for(let c=0;c<p;c++){const m=i.length;i.resize(m+4),i.float32.set(ec,3*m)}}function Ar(p,i,c){const m=i[0],y=i[1];return p[0]=c[0]*m+c[4]*y+c[12],p[1]=c[1]*m+c[5]*y+c[13],p[3]=c[3]*m+c[7]*y+c[15],p}const Qi=100;class Vt{constructor(i,c,m=new Yi(i.width+200,i.height+200,25),y=new Yi(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Qi,this.screenBottomBoundary=i.height+Qi,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,m,y,v,D,C){let A=c.projectedAnchorZ;c.elevation&&(A+=c.elevation);const R=this.projectAndGetPerspectiveRatio(D,c.projectedAnchorX,c.projectedAnchorY,A,c.tileID),L=v*R.perspectiveRatio,F=(c.x1*i+m.x-c.padding)*L+R.point.x,U=(c.y1*i+m.y-c.padding)*L+R.point.y,H=(c.x2*i+m.x+c.padding)*L+R.point.x,Z=(c.y2*i+m.y+c.padding)*L+R.point.y,G=R.perspectiveRatio<=.55||R.aboveHorizon;return!this.isInsideGrid(F,U,H,Z)||!y&&this.grid.hitTest(F,U,H,Z,C)||G?{box:[],offscreen:!1}:{box:[F,U,H,Z],offscreen:this.isOffscreen(F,U,H,Z)}}placeCollisionCircles(i,c,m,y,v,D,C,A,R,L,F,U,H,Z){const G=[],Q=this.transform.elevation,q=Q?we=>Q.getAtTileOffset(Z,we.x,we.y):we=>0,ee=new d.pointGeometry(c.tileAnchorX,c.tileAnchorY),re=q(ee),W=this.projectAndGetPerspectiveRatio(D,ee.x,ee.y,re,Z),{perspectiveRatio:ie}=W,ae=(L?v/ie:v*ie)/d.ONE_EM,be=qn(ee,C,re).point,xe=W.signedDistanceFromCamera>0?Xo(ae,y,c.lineOffsetX*ae,c.lineOffsetY*ae,!1,be,ee,c,m,C,{},Q&&!L?q:null,L&&!!Q):null;let Ce=!1,Se=!1,Ve=!0;if(xe&&!W.aboveHorizon){const we=.5*U*ie+H,Ue=new d.pointGeometry(-100,-100),ve=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ge=new Wo,Je=xe.first,lt=xe.last;let ht=[];for(let st=Je.path.length-1;st>=1;st--)ht.push(Je.path[st]);for(let st=1;st<lt.path.length;st++)ht.push(lt.path[st]);const dt=2.5*we;if(A){const st=ht.map(Q?(ft,qt)=>{const $n=q(qt<Je.path.length-1?Je.tilePath[Je.path.length-1-qt]:lt.tilePath[qt-Je.path.length+2]);return qn(ft,A,$n)}:ft=>qn(ft,A));ht=st.some(ft=>ft.signedDistanceFromCamera<=0)?[]:st.map(ft=>ft.point)}let pt=[];if(ht.length>0){const st=ht[0].clone(),ft=ht[0].clone();for(let qt=1;qt<ht.length;qt++)st.x=Math.min(st.x,ht[qt].x),st.y=Math.min(st.y,ht[qt].y),ft.x=Math.max(ft.x,ht[qt].x),ft.y=Math.max(ft.y,ht[qt].y);pt=st.x>=Ue.x&&ft.x<=ve.x&&st.y>=Ue.y&&ft.y<=ve.y?[ht]:ft.x<Ue.x||st.x>ve.x||ft.y<Ue.y||st.y>ve.y?[]:d.clipLine([ht],Ue.x,Ue.y,ve.x,ve.y)}for(const st of pt){Ge.reset(st,.25*we);let ft=0;ft=Ge.length<=.5*we?1:Math.ceil(Ge.paddedLength/dt)+1;for(let qt=0;qt<ft;qt++){const $n=qt/Math.max(ft-1,1),Qn=Ge.lerp($n),Dr=Qn.x+Qi,Fr=Qn.y+Qi;G.push(Dr,Fr,we,0);const Pn=Dr-we,Io=Fr-we,Wr=Dr+we,mn=Fr+we;if(Ve=Ve&&this.isOffscreen(Pn,Io,Wr,mn),Se=Se||this.isInsideGrid(Pn,Io,Wr,mn),!i&&this.grid.hitTestCircle(Dr,Fr,we,F)&&(Ce=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!R&&Ce||!Se?[]:G,offscreen:Ve,collisionDetected:Ce}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let m=1/0,y=1/0,v=-1/0,D=-1/0;for(const L of i){const F=new d.pointGeometry(L.x+Qi,L.y+Qi);m=Math.min(m,F.x),y=Math.min(y,F.y),v=Math.max(v,F.x),D=Math.max(D,F.y),c.push(F)}const C=this.grid.query(m,y,v,D).concat(this.ignoredGrid.query(m,y,v,D)),A={},R={};for(const L of C){const F=L.key;if(void 0===A[F.bucketInstanceId]&&(A[F.bucketInstanceId]={}),A[F.bucketInstanceId][F.featureIndex])continue;const U=[new d.pointGeometry(L.x1,L.y1),new d.pointGeometry(L.x2,L.y1),new d.pointGeometry(L.x2,L.y2),new d.pointGeometry(L.x1,L.y2)];d.polygonIntersectsPolygon(c,U)&&(A[F.bucketInstanceId][F.featureIndex]=!0,void 0===R[F.bucketInstanceId]&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(i,c,m,y,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:v},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,m,y,v){const D=c?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:y,collisionGroupID:v};for(let A=0;A<i.length;A+=4)D.insertCircle(C,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,c,m,y,v){const D=[c,m,y||0,1];let C=!1;if(y||this.transform.pitch>0){d.transformMat4(D,D,i);let A=!1;this.fogState&&v&&(A=function(R,L,F,U,H,Z){const G=Z.calculateFogTileMatrix(H),Q=[L,F,U];return d.transformMat4$1(Q,Q,G),ra(R,Q,Z.pitch,Z._fov)}(this.fogState,c,m,y||0,v.toUnwrapped(),this.transform)>.9),C=D[2]>D[3]||A}else Ar(D,D,i);return{point:new d.pointGeometry((D[0]/D[3]+1)/2*this.transform.width+Qi,(-D[1]/D[3]+1)/2*this.transform.height+Qi),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/D[3]*.5,1.5),signedDistanceFromCamera:D[3],aboveHorizon:C}}isOffscreen(i,c,m,y){return m<Qi||i>=this.screenRightBoundary||y<Qi||c>this.screenBottomBoundary}isInsideGrid(i,c,m,y){return m>=0&&i<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i}}class vt{constructor(i,c,m,y){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):y&&m?1:0,this.placed=m}isHidden(){return 0===this.opacity&&!this.placed}}class Zn{constructor(i,c,m,y,v,D=!1){this.text=new vt(i?i.text:null,c,m,v),this.icon=new vt(i?i.icon:null,c,y,v),this.clipped=D}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Pr{constructor(i,c,m,y=!1){this.text=i,this.icon=c,this.skipFade=m,this.clipped=y}}class Li{constructor(){this.invProjMatrix=d.create$1(),this.viewportMatrix=d.create$1(),this.circles=[]}}class Nd{constructor(i,c,m,y,v){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=v}}class Es{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[i]}}function Yt(p,i,c,m,y){const{horizontalAlign:v,verticalAlign:D}=d.getAnchorAlignment(p),C=-(v-.5)*i,A=-(D-.5)*c,R=d.evaluateVariableOffset(p,m);return new d.pointGeometry(C+R[0]*y,A+R[1]*y)}function ca(p,i,c,m,y){const v=new d.pointGeometry(p,i);return c&&v._rotate(m?y:-y),v}class Ds{constructor(i,c,m,y,v){this.transform=i.clone(),this.collisionIndex=new Vt(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Es(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,m,y){const v=m.getBucket(c),D=m.latestFeatureIndex;if(!v||!D||c.id!==v.layerIds[0])return;const C=v.layers[0].layout,A=m.collisionBoxArray,R=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),L=m.tileSize/d.EXTENT,F=m.tileID.toUnwrapped(),U=this.transform.calculateProjMatrix(F),H="map"===C.get("text-pitch-alignment"),Z="map"===C.get("text-rotation-alignment");c.compileFilter();const G=c.dynamicFilter(),Q=c.dynamicFilterNeedsFeature(),q=this.transform.calculatePixelsToTileUnitsMatrix(m),ee=Tt(U,H,Z,this.transform,q);let re=null;if(H){const ae=Ct(U,H,Z,this.transform,q);re=d.multiply([],this.transform.labelPlaneMatrix,ae)}let W=null;G&&m.latestFeatureIndex&&(W={unwrappedTileID:F,dynamicFilter:G,dynamicFilterNeedsFeature:Q,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new Nd(v.bucketInstanceId,D,v.sourceLayerIndex,v.index,m.tileID);const ie={bucket:v,layout:C,posMatrix:U,textLabelPlaneMatrix:ee,labelToScreenMatrix:re,clippingData:W,scale:R,textPixelRatio:L,holdingForFade:m.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(y)for(const ae of v.sortKeyRanges){const{sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Ce}=ae;i.push({sortKey:be,symbolInstanceStart:xe,symbolInstanceEnd:Ce,parameters:ie})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(i,c,m,y,v,D,C,A,R,L,F,U,H,Z,G,Q,q,ee){const re=[U.textOffset0,U.textOffset1],W=Yt(i,m,y,re,v),ie=this.collisionIndex.placeCollisionBox(v,c,ca(W.x,W.y,D,C,this.transform.angle),F,A,R,L.predicate);if((!Q||0!==this.collisionIndex.placeCollisionBox(Z.getSymbolInstanceIconSize(ee,this.transform.zoom,H),Q,ca(W.x,W.y,D,C,this.transform.angle),F,A,R,L.predicate).box.length)&&ie.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(ae=this.prevPlacement.variableOffsets[U.crossTileID].anchor),this.variableOffsets[U.crossTileID]={textOffset:re,width:m,height:y,anchor:i,textScale:v,prevAnchor:ae},this.markUsedJustification(Z,i,U,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,U),this.placedOrientations[U.crossTileID]=G),{shift:W,placedGlyphBoxes:ie}}}placeLayerBucketPart(i,c,m,y){const{bucket:v,layout:D,posMatrix:C,textLabelPlaneMatrix:A,labelToScreenMatrix:R,clippingData:L,textPixelRatio:F,holdingForFade:U,collisionBoxArray:H,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:G,collisionGroup:Q}=i.parameters,q=D.get("text-optional"),ee=D.get("icon-optional"),re=D.get("text-allow-overlap"),W=D.get("icon-allow-overlap"),ie="map"===D.get("text-rotation-alignment"),ae="map"===D.get("text-pitch-alignment"),be="none"!==D.get("icon-text-fit"),xe="viewport-y"===D.get("symbol-z-order"),Ce=re&&(W||!v.hasIconData()||ee),Se=W&&(re||!v.hasTextData()||q);!v.collisionArrays&&H&&v.deserializeCollisionBoxes(H),m&&y&&v.updateCollisionDebugBuffers(this.transform.zoom,H);const Ve=(we,Ue,ve)=>{if(L){const mn={zoom:this.transform.zoom,pitch:this.transform.pitch};let kn=null;if(L.dynamicFilterNeedsFeature){const Ht=this.retainedQueryData[v.bucketInstanceId];kn=L.featureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:Ht.bucketIndex,sourceLayerIndex:Ht.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(mn,kn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new d.pointGeometry(we.tileAnchorX,we.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[we.crossTileID]=new Pr(!1,!1,!1,!0),void(c[we.crossTileID]=!0)}if(c[we.crossTileID])return;if(U)return void(this.placements[we.crossTileID]=new Pr(!1,!1,!1));let Ge=!1,Je=!1,lt=!0,ht=null,dt={box:null,offscreen:null},pt={box:null,offscreen:null},st=null,ft=null,qt=null,$n=0,Qn=0,Dr=0;ve.textFeatureIndex?$n=ve.textFeatureIndex:we.useRuntimeCollisionCircles&&($n=we.featureIndex),ve.verticalTextFeatureIndex&&(Qn=ve.verticalTextFeatureIndex);const Fr=mn=>{mn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID,(this.transform.elevation||mn.elevation)&&(mn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[v.bucketInstanceId].tileID,mn.tileAnchorX,mn.tileAnchorY):0)},Pn=ve.textBox;if(Pn){Fr(Pn);const mn=Ht=>{let Dn=d.WritingMode.horizontal;if(v.allowVerticalPlacement&&!Ht&&this.prevPlacement){const dr=this.prevPlacement.placedOrientations[we.crossTileID];dr&&(this.placedOrientations[we.crossTileID]=dr,Dn=dr,this.markUsedOrientation(v,Dn,we))}return Dn},kn=(Ht,Dn)=>{if(v.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&ve.verticalTextBox){for(const dr of v.writingModes)if(dr===d.WritingMode.vertical?(dt=Dn(),pt=dt):dt=Ht(),dt&&dt.box&&dt.box.length)break}else dt=Ht()};if(D.get("text-variable-anchor")){let Ht=D.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]){const Tn=this.prevPlacement.variableOffsets[we.crossTileID];Ht.indexOf(Tn.anchor)>0&&(Ht=Ht.filter(mi=>mi!==Tn.anchor),Ht.unshift(Tn.anchor))}const Dn=(Tn,mi,Mo)=>{const Or=v.getSymbolInstanceTextSize(Z,we,this.transform.zoom,Ue),ho=(Tn.x2-Tn.x1)*Or+2*Tn.padding,_l=(Tn.y2-Tn.y1)*Or+2*Tn.padding,ks=be&&!W?mi:null;ks&&Fr(ks);let Ta={box:[],offscreen:!1};const vu=re?2*Ht.length:Ht.length;for(let Ca=0;Ca<vu;++Ca){const yl=this.attemptAnchorPlacement(Ht[Ca%Ht.length],Tn,ho,_l,Or,ie,ae,F,C,Q,Ca>=Ht.length,we,Ue,v,Mo,ks,Z,G);if(yl&&(Ta=yl.placedGlyphBoxes,Ta&&Ta.box&&Ta.box.length)){Ge=!0,ht=yl.shift;break}}return Ta};kn(()=>Dn(Pn,ve.iconBox,d.WritingMode.horizontal),()=>{const Tn=ve.verticalTextBox;return Tn&&Fr(Tn),v.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&we.numVerticalGlyphVertices>0&&Tn?Dn(Tn,ve.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),dt&&(Ge=dt.box,lt=dt.offscreen);const dr=mn(dt&&dt.box);if(!Ge&&this.prevPlacement){const Tn=this.prevPlacement.variableOffsets[we.crossTileID];Tn&&(this.variableOffsets[we.crossTileID]=Tn,this.markUsedJustification(v,Tn.anchor,we,dr))}}else{const Ht=(Dn,dr)=>{const Tn=v.getSymbolInstanceTextSize(Z,we,this.transform.zoom,Ue),mi=this.collisionIndex.placeCollisionBox(Tn,Dn,new d.pointGeometry(0,0),re,F,C,Q.predicate);return mi&&mi.box&&mi.box.length&&(this.markUsedOrientation(v,dr,we),this.placedOrientations[we.crossTileID]=dr),mi};kn(()=>Ht(Pn,d.WritingMode.horizontal),()=>{const Dn=ve.verticalTextBox;return v.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&Dn?(Fr(Dn),Ht(Dn,d.WritingMode.vertical)):{box:null,offscreen:null}}),mn(dt&&dt.box&&dt.box.length)}}if(st=dt,Ge=st&&st.box&&st.box.length>0,lt=st&&st.offscreen,we.useRuntimeCollisionCircles){const mn=v.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),kn=d.evaluateSizeForFeature(v.textSizeData,Z,mn),Ht=D.get("text-padding");ft=this.collisionIndex.placeCollisionCircles(re,mn,v.lineVertexArray,v.glyphOffsetArray,kn,C,A,R,m,ae,Q.predicate,we.collisionCircleDiameter*kn/d.ONE_EM,Ht,this.retainedQueryData[v.bucketInstanceId].tileID),Ge=re||ft.circles.length>0&&!ft.collisionDetected,lt=lt&&ft.offscreen}if(ve.iconFeatureIndex&&(Dr=ve.iconFeatureIndex),ve.iconBox){const mn=kn=>{Fr(kn);const Ht=be&&ht?ca(ht.x,ht.y,ie,ae,this.transform.angle):new d.pointGeometry(0,0),Dn=v.getSymbolInstanceIconSize(G,this.transform.zoom,Ue);return this.collisionIndex.placeCollisionBox(Dn,kn,Ht,W,F,C,Q.predicate)};pt&&pt.box&&pt.box.length&&ve.verticalIconBox?(qt=mn(ve.verticalIconBox),Je=qt.box.length>0):(qt=mn(ve.iconBox),Je=qt.box.length>0),lt=lt&&qt.offscreen}const Io=q||0===we.numHorizontalGlyphVertices&&0===we.numVerticalGlyphVertices,Wr=ee||0===we.numIconVertices;if(Io||Wr?Wr?Io||(Je=Je&&Ge):Ge=Je&&Ge:Je=Ge=Je&&Ge,Ge&&st&&st.box&&this.collisionIndex.insertCollisionBox(st.box,D.get("text-ignore-placement"),v.bucketInstanceId,pt&&pt.box&&Qn?Qn:$n,Q.ID),Je&&qt&&this.collisionIndex.insertCollisionBox(qt.box,D.get("icon-ignore-placement"),v.bucketInstanceId,Dr,Q.ID),ft&&(Ge&&this.collisionIndex.insertCollisionCircles(ft.circles,D.get("text-ignore-placement"),v.bucketInstanceId,$n,Q.ID),m)){const mn=v.bucketInstanceId;let kn=this.collisionCircleArrays[mn];void 0===kn&&(kn=this.collisionCircleArrays[mn]=new Li);for(let Ht=0;Ht<ft.circles.length;Ht+=4)kn.circles.push(ft.circles[Ht+0]),kn.circles.push(ft.circles[Ht+1]),kn.circles.push(ft.circles[Ht+2]),kn.circles.push(ft.collisionDetected?1:0)}this.placements[we.crossTileID]=new Pr(Ge||Ce,Je||Se,lt||v.justReloaded),c[we.crossTileID]=!0};if(xe){const we=v.getSortedSymbolIndexes(this.transform.angle);for(let Ue=we.length-1;Ue>=0;--Ue){const ve=we[Ue];Ve(v.symbolInstances.get(ve),ve,v.collisionArrays[ve])}}else for(let we=i.symbolInstanceStart;we<i.symbolInstanceEnd;we++)Ve(v.symbolInstances.get(we),we,v.collisionArrays[we]);if(m&&v.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[v.bucketInstanceId];d.invert(we.invProjMatrix,C),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(i,c,m,y){let v;v=y===d.WritingMode.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(c)];const D=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const C of D)C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=v>=0&&C!==v?0:m.crossTileID)}markUsedOrientation(i,c,m){const y=c===d.WritingMode.horizontal||c===d.WritingMode.horizontalOnly?c:0,v=c===d.WritingMode.vertical?c:0,D=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const C of D)i.text.placedSymbolArray.get(C).placedOrientation=y;m.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(i):1,v=c?c.opacities:{},D=c?c.variableOffsets:{},C=c?c.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],L=v[A];L?(this.opacities[A]=new Zn(L,y,R.text,R.icon,null,R.clipped),m=m||R.text!==L.text.placed||R.icon!==L.icon.placed):(this.opacities[A]=new Zn(null,y,R.text,R.icon,R.skipFade,R.clipped),m=m||R.text||R.icon)}for(const A in v){const R=v[A];if(!this.opacities[A]){const L=new Zn(R,y,!1,!1);L.isHidden()||(this.opacities[A]=L,m=m||R.text.placed||R.icon.placed)}}for(const A in D)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=D[A]);for(const A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);m?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c){const m={};for(const y of c){const v=y.getBucket(i);v&&y.latestFeatureIndex&&i.id===v.layerIds[0]&&this.updateBucketOpacities(v,m,y.collisionBoxArray)}}updateBucketOpacities(i,c,m){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const y=i.layers[0].layout,v=!!i.layers[0].dynamicFilter(),D=new Zn(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),R=y.get("text-variable-anchor"),L="map"===y.get("text-rotation-alignment"),F="map"===y.get("text-pitch-alignment"),U="none"!==y.get("icon-text-fit"),H=new Zn(null,0,C&&(A||!i.hasIconData()||y.get("icon-optional")),A&&(C||!i.hasTextData()||y.get("text-optional")),!0);!i.collisionArrays&&m&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(m);const Z=(G,Q,q)=>{for(let ee=0;ee<Q/4;ee++)G.opacityVertexArray.emplaceBack(q)};for(let G=0;G<i.symbolInstances.length;G++){const Q=i.symbolInstances.get(G),{numHorizontalGlyphVertices:q,numVerticalGlyphVertices:ee,crossTileID:re}=Q;let W=this.opacities[re];c[re]?W=D:W||(W=H,this.opacities[re]=W),c[re]=!0;const ie=Q.numIconVertices>0,ae=this.placedOrientations[Q.crossTileID],be=ae===d.WritingMode.vertical,xe=ae===d.WritingMode.horizontal||ae===d.WritingMode.horizontalOnly;if(q>0||ee>0){const Ce=Kc(W.text);Z(i.text,q,be?jr:Ce),Z(i.text,ee,xe?jr:Ce);const Se=W.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(Ue=>{Ue>=0&&(i.text.placedSymbolArray.get(Ue).hidden=Se||be?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Se||xe?1:0);const Ve=this.variableOffsets[Q.crossTileID];Ve&&this.markUsedJustification(i,Ve.anchor,Q,ae);const we=this.placedOrientations[Q.crossTileID];we&&(this.markUsedJustification(i,"left",Q,we),this.markUsedOrientation(i,we,Q))}if(ie){const Ce=Kc(W.icon);Q.placedIconSymbolIndex>=0&&(Z(i.icon,Q.numIconVertices,be?jr:Ce),i.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=W.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(Z(i.icon,Q.numVerticalIconVertices,xe?jr:Ce),i.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=W.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ce=i.collisionArrays[G];if(Ce){let Se=new d.pointGeometry(0,0),Ve=!0;if(Ce.textBox||Ce.verticalTextBox){if(R){const Ue=this.variableOffsets[re];Ue?(Se=Yt(Ue.anchor,Ue.width,Ue.height,Ue.textOffset,Ue.textScale),L&&Se._rotate(F?this.transform.angle:-this.transform.angle)):Ve=!1}v&&(Ve=!W.clipped),Ce.textBox&&rr(i.textCollisionBox.collisionVertexArray,W.text.placed,!Ve||be,Se.x,Se.y),Ce.verticalTextBox&&rr(i.textCollisionBox.collisionVertexArray,W.text.placed,!Ve||xe,Se.x,Se.y)}const we=Ve&&Boolean(!xe&&Ce.verticalIconBox);Ce.iconBox&&rr(i.iconCollisionBox.collisionVertexArray,W.icon.placed,we,U?Se.x:0,U?Se.y:0),Ce.verticalIconBox&&rr(i.iconCollisionBox.collisionVertexArray,W.icon.placed,!we,U?Se.x:0,U?Se.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const G=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=G.invProjMatrix,i.placementViewportMatrix=G.viewportMatrix,i.collisionCircleArray=G.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function rr(p,i,c,m,y){p.emplaceBack(i?1:0,c?1:0,m||0,y||0),p.emplaceBack(i?1:0,c?1:0,m||0,y||0),p.emplaceBack(i?1:0,c?1:0,m||0,y||0),p.emplaceBack(i?1:0,c?1:0,m||0,y||0)}const Fi=Math.pow(2,25),eo=Math.pow(2,24),tc=Math.pow(2,17),Xc=Math.pow(2,16),Sf=Math.pow(2,9),Ko=Math.pow(2,8),If=Math.pow(2,1);function Kc(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const i=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Fi+i*eo+c*tc+i*Xc+c*Sf+i*Ko+c*If+i}const jr=0;class kr{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,c,m,y,v){const D=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(D,y,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((C,A)=>C.sortKey-A.sortKey));this._currentPartIndex<D.length;){const C=D[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,m,0===C.symbolInstanceStart),this._currentPartIndex++,v())return!0}return!1}}class tn{constructor(i,c,m,y,v,D,C,A){this.placement=new Ds(i,v,D,C,A),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(i,c,m){const y=d.exported.now(),v=()=>{const D=d.exported.now()-y;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=c[i[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if("symbol"===D.type&&(!D.minzoom||D.minzoom<=C)&&(!D.maxzoom||D.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new kr(D)),this._inProgressLayer.continuePlacement(m[D.source],this.placement,this._showCollisionBoxes,D,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const hh=512/d.EXTENT/2;class Yc{constructor(i,c,m){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let y=0;y<c.length;y++){const v=c.get(y),D=v.key;this.indexedSymbolInstances[D]||(this.indexedSymbolInstances[D]=[]),this.indexedSymbolInstances[D].push({crossTileID:v.crossTileID,coord:this.getScaledCoordinates(v,i)})}}getScaledCoordinates(i,c){const m=hh/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*d.EXTENT+i.tileAnchorX)*m),y:Math.floor((c.canonical.y*d.EXTENT+i.tileAnchorY)*m)}}findMatches(i,c,m){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let v=0;v<i.length;v++){const D=i.get(v);if(D.crossTileID)continue;const C=this.indexedSymbolInstances[D.key];if(!C)continue;const A=this.getScaledCoordinates(D,c);for(const R of C)if(Math.abs(R.coord.x-A.x)<=y&&Math.abs(R.coord.y-A.y)<=y&&!m[R.crossTileID]){m[R.crossTileID]=!0,D.crossTileID=R.crossTileID;break}}}}class Mf{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(0!==c)for(const m in this.indexes){const y=this.indexes[m],v={};for(const D in y){const C=y[D];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+c),v[C.tileID.key]=C}this.indexes[m]=v}this.lng=i}addBucket(i,c,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const y=this.usedCrossTileIDs[i.overscaledZ];for(const v in this.indexes){const D=this.indexes[v];if(Number(v)>i.overscaledZ)for(const C in D){const A=D[C];A.tileID.isChildOf(i)&&A.findMatches(c.symbolInstances,i,y)}else{const C=D[i.scaledTo(Number(v)).key];C&&C.findMatches(c.symbolInstances,i,y)}}for(let v=0;v<c.symbolInstances.length;v++){const D=c.symbolInstances.get(v);D.crossTileID||(D.crossTileID=m.generate(),y[D.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Yc(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const m in c.indexedSymbolInstances)for(const y of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[i][y.crossTileID]}removeStaleBuckets(i){let c=!1;for(const m in this.indexes){const y=this.indexes[m];for(const v in y)i[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[v]),delete y[v],c=!0)}return c}}class Jc{constructor(){this.layerIndexes={},this.crossTileIDs=new Mf,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,m){let y=this.layerIndexes[i.id];void 0===y&&(y=this.layerIndexes[i.id]=new nn);let v=!1;const D={};y.handleWrapJump(m);for(const C of c){const A=C.getBucket(i);A&&i.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(C.tileID,A,this.crossTileIDs)&&(v=!0),D[A.bucketInstanceId]=!0)}return y.removeStaleBuckets(D)&&(v=!0),v}pruneUnusedLayers(i){const c={};i.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const Ci=(p,i)=>d.emitValidationErrors(p,i&&i.filter(c=>"source.canvas"!==c.identifier)),nc=d.pick($e,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),dh=d.pick($e,["setCenter","setZoom","setBearing","setPitch"]),ph=function(){const p={},i=d.spec.$version;for(const c in d.spec.$root){const m=d.spec.$root[c];if(m.required){let y=null;y="version"===c?i:"array"===m.type?[]:{},null!=y&&(p[c]=y)}}return p}(),Vd={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class di extends d.Evented{constructor(i,c={}){super(),this.map=i,this.dispatcher=new Wi(We(),this),this.imageManager=new xo,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(i._requestManager,c.localFontFamily?d.LocalGlyphMode.all:c.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new Jc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const m=this;this._rtlTextPluginCallback=di.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,D)=>{if(d.triggerPluginCompletionEvent(v),D&&D.every(C=>C))for(const C in m._sourceCaches){const A=m._sourceCaches[C],R=A.getSource().type;"vector"!==R&&"geojson"!==R||A.reload()}})}),this.on("data",y=>{if("source"!==y.dataType||"metadata"!==y.sourceDataType)return;const v=this.getSource(y.sourceId);if(v&&v.vectorLayerIds)for(const D in this._layers){const C=this._layers[D];C.source===v.id&&this._validateLayer(C)}})}loadURL(i,c={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const m="boolean"==typeof c.validate?c.validate:!d.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,c.accessToken);const y=this.map._requestManager.transformRequest(i,d.ResourceType.Style);this._request=d.getJSON(y,(v,D)=>{this._request=null,v?this.fire(new d.ErrorEvent(v)):D&&this._load(D,m)})}loadJSON(i,c={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(i,!1!==c.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(ph,!1)}_updateLayerCount(i,c){const m=c?1:-1;i.is3D()&&(this._num3DLayers+=m),"circle"===i.type&&(this._numCircleLayers+=m),"symbol"===i.type&&(this._numSymbolLayers+=m)}_load(i,c){if(c&&Ci(this,d.validateStyle(i)))return;this._loaded=!0,this.stylesheet=i,this.updateProjection();for(const y in i.sources)this.addSource(y,i.sources[y],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const m=ot(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(let y of m)y=d.createStyleLayer(y),y.setEventedParent(this,{layer:{id:y.id}}),this._layers[y.id]=y,this._serializedLayers[y.id]=y.serialize(),this._updateLayerCount(y,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Vn(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const i=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0));if(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),i){this.map.painter.clearBackgroundTiles();for(const c in this._sourceCaches)this._sourceCaches[c].clearTiles();this.map._update(!0)}}_loadSprite(i){this._spriteRequest=function(c,m,y){let v,D,C;const A=d.exported.devicePixelRatio>1?"@2x":"";let R=d.getJSON(m.transformRequest(m.normalizeSpriteURL(c,A,".json"),d.ResourceType.SpriteJSON),(U,H)=>{R=null,C||(C=U,v=H,F())}),L=d.getImage(m.transformRequest(m.normalizeSpriteURL(c,A,".png"),d.ResourceType.SpriteImage),(U,H)=>{L=null,C||(C=U,D=H,F())});function F(){if(C)y(C);else if(v&&D){const U=d.exported.getImageData(D),H={};for(const Z in v){const{width:G,height:Q,x:q,y:ee,sdf:re,pixelRatio:W,stretchX:ie,stretchY:ae,content:be}=v[Z],xe=new d.RGBAImage({width:G,height:Q});d.RGBAImage.copy(U,xe,{x:q,y:ee},{x:0,y:0},{width:G,height:Q}),H[Z]={data:xe,pixelRatio:W,sdf:re,stretchX:ie,stretchY:ae,content:be}}y(null,H)}}return{cancel(){R&&(R.cancel(),R=null),L&&(L.cancel(),L=null)}}}(i,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new d.ErrorEvent(c));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(i){const c=this.getSource(i.source);if(!c)return;const m=i.sourceLayer;m&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(m))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const c=[];for(const m of i){const y=this._layers[m];"custom"!==y.type&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Vd[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(y.length||v.length)&&this._updateWorkerLayers(y,v);for(const D in this._updatedSources){const C=this._updatedSources[D];"reload"===C?this._reloadSource(D):"clear"===C&&this._clearSource(D)}this._updateTilesForChangedImages();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const v=this._sourceCaches[y];m[y]=v.used,v.used=!1}for(const y of this._order){const v=this._layers[y];if(v.recalculate(i,this._availableImages),!v.isHidden(i.zoom)){const C=this._getLayerSourceCache(v);C&&(C.used=!0)}const D=this.map.painter;if(D){const C=v.getProgramIds();if(!C)continue;const A=v.getProgramConfiguration(i.zoom);for(const R of C)D.useProgram(R,A)}}for(const y in m){const v=this._sourceCaches[y];m[y]!==v.used&&v.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:v.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Ci(this,d.validateStyle(i)))return!1;(i=d.clone$2(i)).layers=ot(i.layers);const c=function(y,v){if(!y)return[{command:$e.setStyle,args:[v]}];let D=[];try{if(!Ie(y.version,v.version))return[{command:$e.setStyle,args:[v]}];Ie(y.center,v.center)||D.push({command:$e.setCenter,args:[v.center]}),Ie(y.zoom,v.zoom)||D.push({command:$e.setZoom,args:[v.zoom]}),Ie(y.bearing,v.bearing)||D.push({command:$e.setBearing,args:[v.bearing]}),Ie(y.pitch,v.pitch)||D.push({command:$e.setPitch,args:[v.pitch]}),Ie(y.sprite,v.sprite)||D.push({command:$e.setSprite,args:[v.sprite]}),Ie(y.glyphs,v.glyphs)||D.push({command:$e.setGlyphs,args:[v.glyphs]}),Ie(y.transition,v.transition)||D.push({command:$e.setTransition,args:[v.transition]}),Ie(y.light,v.light)||D.push({command:$e.setLight,args:[v.light]}),Ie(y.fog,v.fog)||D.push({command:$e.setFog,args:[v.fog]}),Ie(y.projection,v.projection)||D.push({command:$e.setProjection,args:[v.projection]});const C={},A=[];!function(F,U,H,Z){let G;for(G in U=U||{},F=F||{})F.hasOwnProperty(G)&&(U.hasOwnProperty(G)||Te(G,H,Z));for(G in U)U.hasOwnProperty(G)&&(F.hasOwnProperty(G)?Ie(F[G],U[G])||("geojson"===F[G].type&&"geojson"===U[G].type&&Kt(F,U,G)?H.push({command:$e.setGeoJSONSourceData,args:[G,U[G].data]}):It(G,U,H,Z)):de(G,U,H))}(y.sources,v.sources,A,C);const R=[];y.layers&&y.layers.forEach(F=>{C[F.source]?D.push({command:$e.removeLayer,args:[F.id]}):R.push(F)});let L=y.terrain;L&&C[L.source]&&(D.push({command:$e.setTerrain,args:[void 0]}),L=void 0),D=D.concat(A),Ie(L,v.terrain)||D.push({command:$e.setTerrain,args:[v.terrain]}),function(F,U,H){U=U||[];const Z=(F=F||[]).map(Nt),G=U.map(Nt),Q=F.reduce(Gt,{}),q=U.reduce(Gt,{}),ee=Z.slice(),re=Object.create(null);let W,ie,ae,be,xe,Ce,Se;for(W=0,ie=0;W<Z.length;W++)ae=Z[W],q.hasOwnProperty(ae)?ie++:(H.push({command:$e.removeLayer,args:[ae]}),ee.splice(ee.indexOf(ae,ie),1));for(W=0,ie=0;W<G.length;W++)ae=G[G.length-1-W],ee[ee.length-1-W]!==ae&&(Q.hasOwnProperty(ae)?(H.push({command:$e.removeLayer,args:[ae]}),ee.splice(ee.lastIndexOf(ae,ee.length-ie),1)):ie++,Ce=ee[ee.length-W],H.push({command:$e.addLayer,args:[q[ae],Ce]}),ee.splice(ee.length-W,0,ae),re[ae]=!0);for(W=0;W<G.length;W++)if(ae=G[W],be=Q[ae],xe=q[ae],!re[ae]&&!Ie(be,xe))if(Ie(be.source,xe.source)&&Ie(be["source-layer"],xe["source-layer"])&&Ie(be.type,xe.type)){for(Se in mt(be.layout,xe.layout,H,ae,null,$e.setLayoutProperty),mt(be.paint,xe.paint,H,ae,null,$e.setPaintProperty),Ie(be.filter,xe.filter)||H.push({command:$e.setFilter,args:[ae,xe.filter]}),Ie(be.minzoom,xe.minzoom)&&Ie(be.maxzoom,xe.maxzoom)||H.push({command:$e.setLayerZoomRange,args:[ae,xe.minzoom,xe.maxzoom]}),be)be.hasOwnProperty(Se)&&"layout"!==Se&&"paint"!==Se&&"filter"!==Se&&"metadata"!==Se&&"minzoom"!==Se&&"maxzoom"!==Se&&(0===Se.indexOf("paint.")?mt(be[Se],xe[Se],H,ae,Se.slice(6),$e.setPaintProperty):Ie(be[Se],xe[Se])||H.push({command:$e.setLayerProperty,args:[ae,Se,xe[Se]]}));for(Se in xe)xe.hasOwnProperty(Se)&&!be.hasOwnProperty(Se)&&"layout"!==Se&&"paint"!==Se&&"filter"!==Se&&"metadata"!==Se&&"minzoom"!==Se&&"maxzoom"!==Se&&(0===Se.indexOf("paint.")?mt(be[Se],xe[Se],H,ae,Se.slice(6),$e.setPaintProperty):Ie(be[Se],xe[Se])||H.push({command:$e.setLayerProperty,args:[ae,Se,xe[Se]]}))}else H.push({command:$e.removeLayer,args:[ae]}),Ce=ee[ee.lastIndexOf(ae)+1],H.push({command:$e.addLayer,args:[xe,Ce]})}(R,v.layers,D)}catch(C){console.warn("Unable to compute style diff:",C),D=[{command:$e.setStyle,args:[v]}]}return D}(this.serialize(),i).filter(y=>!(y.command in dh));if(0===c.length)return!1;const m=c.filter(y=>!(y.command in nc));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{"setTransition"!==y.command&&this[y.command].apply(this,y.args)}),this.stylesheet=i,!0}addImage(i,c){if(this.getImage(i))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(i,c),this._afterImageUpdated(i)}updateImage(i,c){this.imageManager.updateImage(i,c)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,c,m={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(d.validateStyle.source,`sources.${i}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=V(i,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:y.serialize(),sourceId:i}));const v=D=>{const C=(D?"symbol:":"other:")+i,A=this._sourceCaches[C]=new d.SourceCache(C,y,D);(D?this._symbolSourceCaches:this._otherSourceCaches)[i]=A,A.style=this,A.onAdd(this.map)};v(!1),"vector"!==c.type&&"geojson"!==c.type||v(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const c=this.getSource(i);if(void 0===c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===i)return this.fire(new d.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new d.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(i);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getSource(i).setData(c),this._changed=!0}getSource(i){const c=this._getSourceCache(i);return c&&c.getSource()}addLayer(i,c,m={}){this._checkLoaded();const y=i.id;if(this.getLayer(y))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let v;if("custom"===i.type){if(Ci(this,d.validateCustomStyleLayer(i)))return;v=d.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(y,i.source),i=d.clone$2(i),i=d.extend(i,{source:y})),this._validate(d.validateStyle.layer,`layers.${y}`,i,{arrayIndex:-1},m))return;v=d.createStyleLayer(i),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0)}const D=c?this._order.indexOf(c):this._order.length;if(c&&-1===D)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(D,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const C=this._getLayerSourceCache(v);if(this._removedLayers[y]&&v.source&&C&&"custom"!==v.type){const A=this._removedLayers[y];delete this._removedLayers[y],A.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",C.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,c){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===c)return;const m=this._order.indexOf(i);this._order.splice(m,1);const y=c?this._order.indexOf(c):this._order.length;c&&-1===y?this.fire(new d.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const c=this._layers[i];if(!c)return void this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(i);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=c,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,m){this._checkLoaded();const y=this.getLayer(i);y?y.minzoom===c&&y.maxzoom===m||(null!=c&&(y.minzoom=c),null!=m&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,c,m={}){this._checkLoaded();const y=this.getLayer(i);if(y){if(!Ie(y.filter,c))return null==c?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(d.validateStyle.filter,`layers.${y.id}.filter`,c,{layerType:y.type},m)||(y.filter=d.clone$2(c),this._updateLayer(y)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){return d.clone$2(this.getLayer(i).filter)}setLayoutProperty(i,c,m,y={}){this._checkLoaded();const v=this.getLayer(i);v?Ie(v.getLayoutProperty(c),m)||(v.setLayoutProperty(c,m,y),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,c){const m=this.getLayer(i);if(m)return m.getLayoutProperty(c);this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,c,m,y={}){this._checkLoaded();const v=this.getLayer(i);v?Ie(v.getPaintProperty(c),m)||(v.setPaintProperty(c,m,y)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,c){return this.getLayer(i).getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const m=i.source,y=i.sourceLayer,v=this.getSource(m);if(void 0===v)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const D=v.type;if("geojson"===D&&y)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===D&&!y)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const C=this._getSourceCaches(m);for(const A of C)A.setFeatureState(y,i.id,c)}removeFeatureState(i,c){this._checkLoaded();const m=i.source,y=this.getSource(m);if(void 0===y)return void this.fire(new d.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const v=y.type,D="vector"===v?i.sourceLayer:void 0;if("vector"===v&&!D)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const C=this._getSourceCaches(m);for(const A of C)A.removeFeatureState(D,i.id,c)}getFeatureState(i){this._checkLoaded();const c=i.source,m=i.sourceLayer,y=this.getSource(c);if(void 0!==y){if("vector"!==y.type||m)return void 0===i.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,i.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();i[m.id]||(i[m.id]=m.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(i){this._updatedLayers[i.id]=!0;const c=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[i.source]="reload",c.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=D=>"fill-extrusion"===this._layers[D].type,m={},y=[];for(let D=this._order.length-1;D>=0;D--){const C=this._order[D];if(c(C)){m[C]=D;for(const A of i){const R=A[C];if(R)for(const L of R)y.push(L)}}}y.sort((D,C)=>C.intersectionZ-D.intersectionZ);const v=[];for(let D=this._order.length-1;D>=0;D--){const C=this._order[D];if(c(C))for(let A=y.length-1;A>=0;A--){const R=y[A].feature;if(m[R.layer.id]<D)break;v.push(R),y.pop()}else for(const A of i){const R=A[C];if(R)for(const L of R)v.push(L.feature)}}return v}queryRenderedFeatures(i,c,m){c&&c.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of c.layers){const R=this._layers[A];if(!R)return this.fire(new d.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];y[R.source]=!0}}const v=[];c.availableImages=this._availableImages;const D=c&&c.layers?c.layers.some(A=>{const R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),C=ia.createFromScreenPoints(i,m);for(const A in this._sourceCaches){const R=this._sourceCaches[A].getSource().id;c.layers&&!y[R]||v.push(J(this._sourceCaches[A],this._layers,this._serializedLayers,C,c,m,D,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(A,R,L,F,U,H,Z){const G={},Q=H.queryRenderedSymbols(F),q=[];for(const ee of Object.keys(Q).map(Number))q.push(Z[ee]);q.sort(me);for(const ee of q){const re=ee.featureIndex.lookupSymbolFeatures(Q[ee.bucketInstanceId],R,ee.bucketIndex,ee.sourceLayerIndex,U.filter,U.layers,U.availableImages,A);for(const W in re){const ie=G[W]=G[W]||[],ae=re[W];ae.sort((be,xe)=>{const Ce=ee.featureSortOrder;if(Ce){const Se=Ce.indexOf(be.featureIndex);return Ce.indexOf(xe.featureIndex)-Se}return xe.featureIndex-be.featureIndex});for(const be of ae)ie.push(be)}}for(const ee in G)G[ee].forEach(re=>{const W=re.feature,ie=L(A[ee]).getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=ie});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(i,c){c&&c.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(i);let y=[];for(const v of m)y=y.concat(le(v,c));return y}addSourceType(i,c,m){return di.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(di.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(i,c={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const D in i)if(!Ie(i[D],m[D])){y=!0;break}if(!y)return;const v={now:d.exported.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,c),this.light.updateTransitions(v)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(i){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof i.source){const c="terrain-dem-src";this.addSource(c,i.source),i=d.clone$2(i),i=d.extend(i,{source:c})}if(!this._validate(d.validateStyle.terrain,"terrain",i)){if(this.terrain){const c=this.terrain,m=c.get();for(const y in i)if(!Ie(i[y],m[y])){c.set(i),this.stylesheet.terrain=i;const v={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(v);break}}else this._createTerrain(i);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(i){const c=this.fog=new Zi(i,this.map.transform);this.stylesheet.fog=i;const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();for(const y in i)if(!Ie(i[y],m[y])){c.set(i),this.stylesheet.fog=i;const v={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(v);break}}else this._createFog(i);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i){const c=this.terrain=new ys(i);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const m={now:d.exported.now(),transition:d.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(m)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];"fill-extrusion"===c.type&&this._updateLayer(c)}}_validate(i,c,m,y,v={}){return(!v||!1!==v.validate)&&Ci(this,i.call(d.validateStyle,d.extend({key:c,style:this.serialize(),value:m,styleSpec:d.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const c=this._getSourceCaches(i);for(const m of c)m.clearTiles()}_reloadSource(i){const c=this._getSourceCaches(i);for(const m of c)m.resume(),m.reload()}_updateSources(i){for(const c in this._sourceCaches)this._sourceCaches[c].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,m,y,v=!1){let D=!1,C=!1;const A={};for(const R of this._order){const L=this._layers[R];if("symbol"!==L.type)continue;if(!A[L.source]){const U=this._getLayerSourceCache(L);if(!U)continue;A[L.source]=U.getRenderableIds(!0).map(H=>U.getTileByID(H)).sort((H,Z)=>Z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Z.tileID)?-1:1))}const F=this.crossTileSymbolIndex.addLayer(L,A[L.source],i.center.lng);D=D||F}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),v=v||this._layerOrderChanged||0===m,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),i.zoom))&&(this.pauseablePlacement=new tn(i,this._order,v,c,m,y,this.placement,this.fog&&!this.fog.isSoftDisabled()?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),C=!0),D&&this.pauseablePlacement.placement.setStale()),C||D)for(const R of this._order){const L=this._layers[R];"symbol"===L.type&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const y=v=>{v&&v.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(i,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(i,c,m){return d.makeRequest(c,m)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}}di.getSourceType=function(p){return O[p]},di.setSourceType=function(p,i){O[p]=i},di.registerForPluginStateChange=d.registerForPluginStateChange;var ua="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ja="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let ha={},da={};ha=Dt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else \nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),da=Dt("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const _t=Dt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Yo=ua;var rc={background:Dt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Dt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Dt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Dt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Dt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));vec3 globePos=a_pos_3+xAxis*extrude.x+yAxis*extrude.y+elevationVector(tilePos)*elevation(tilePos);vec3 mercPos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+xAxis*extrude.x+yAxis*extrude.y;vec3 pos=mix_globe_mercator(globePos,mercPos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Dt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Dt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Dt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Dt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Dt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Dt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Dt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Dt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Dt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Dt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Dt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Dt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Dt("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Dt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Dt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Dt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Dt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Dt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Dt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Dt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Dt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ja),skyboxGradient:Dt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ja),skyboxCapture:Dt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Dt("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:Dt("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Dt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat4 u_up_vector_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying float v_depth;void main() {vec2 uv=a_uv*EXTENT;vec4 up_vector=u_up_vector_matrix*vec4(elevationVector(uv),1.0);float height=elevation(uv);vec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Dt(p,i,c){const m=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,v=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),D=p.match(y),C=i.match(y),A=ua.match(y);let R=C?C.concat(D):D;c||(ha.staticUniforms&&(R=ha.staticUniforms.concat(R)),da.staticUniforms&&(R=da.staticUniforms.concat(R))),R&&(R=R.concat(A));const L={};return{fragmentSource:p=p.replace(m,(F,U,H,Z,G)=>(L[G]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${G}\nvarying ${H} ${Z} ${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`)),vertexSource:i=i.replace(m,(F,U,H,Z,G)=>{const Q="float"===Z?"vec2":"vec4",q=G.match(/color/)?"color":Q;return L[G]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${H} ${Q} a_${G};\nvarying ${H} ${Z} ${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${q}(a_${G}, u_${G}_t);\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:"define"===U?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${H} ${Q} a_${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:"vec4"===q?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = a_${G};\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = unpack_mix_${q}(a_${G}, u_${G}_t);\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`}),staticAttributes:v,staticUniforms:R}}class Qa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,c,m,y,v,D,C,A){this.context=i;let R=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!R&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(R=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===m&&!R&&this.boundIndexBuffer===v&&this.boundVertexOffset===D&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===A?(i.bindVertexArrayOES.set(this.vao),C&&C.bind(),v&&v.dynamicDraw&&v.bind(),A&&A.bind()):this.freshBind(c,m,y,v,D,C,A)}freshBind(i,c,m,y,v,D,C){let A;const R=i.numAttributes,L=this.context,F=L.gl;if(L.extVertexArrayObject)this.vao&&this.destroy(),this.vao=L.extVertexArrayObject.createVertexArrayOES(),L.bindVertexArrayOES.set(this.vao),A=0,this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=C;else{A=L.currentNumAttributes||0;for(let U=R;U<A;U++)F.disableVertexAttribArray(U)}c.enableAttributes(F,i);for(const U of m)U.enableAttributes(F,i);D&&D.enableAttributes(F,i),C&&C.enableAttributes(F,i),c.bind(),c.setVertexAttribPointers(F,i,v);for(const U of m)U.bind(),U.setVertexAttribPointers(F,i,v);D&&(D.bind(),D.setVertexAttribPointers(F,i,v)),y&&y.bind(),C&&(C.bind(),C.setVertexAttribPointers(F,i,v)),L.currentNumAttributes=R}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Qc(p,i){const c=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new d.MercatorCoordinate(0,m/c).toLngLat().lat,new d.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function to(p,i,c,m,y,v,D){const C=p.context,A=C.gl,R=c.fbo;if(!R)return;p.prepareDrawTile(i);const L=p.useProgram("hillshade");C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get());const F=((G,Q,q,ee)=>{const re=q.paint.get("hillshade-shadow-color"),W=q.paint.get("hillshade-highlight-color"),ie=q.paint.get("hillshade-accent-color");let ae=q.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===q.paint.get("hillshade-illumination-anchor")&&(ae-=G.transform.angle);const be=!G.options.moving;return{u_matrix:ee||G.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),be),u_image:0,u_latrange:Qc(0,Q.tileID),u_light:[q.paint.get("hillshade-exaggeration"),ae],u_shadow:re,u_highlight:W,u_accent:ie}})(p,c,m,p.terrain?i.projMatrix:null);p.prepareDrawProgram(C,L,i.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=p.getTileBoundsBuffers(c);L.draw(C,A.TRIANGLES,y,v,D,d.CullFaceMode.disabled,F,m.id,U,H,Z)}function $r(p,i,c){if(!i.needsDEMTextureUpload)return;const m=p.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(c.stride);const v=c.getPixels();i.demTexture?i.demTexture.update(v,{premultiply:!1}):i.demTexture=new d.Texture(m,v,y.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ic(p,i,c,m,y,v){const D=p.context,C=D.gl;if(!i.dem)return;const A=i.dem;if(D.activeTexture.set(C.TEXTURE1),$r(p,i,A),!i.demTexture)return;i.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);const R=A.dim;D.activeTexture.set(C.TEXTURE0);let L=i.fbo;if(!L){const Z=new d.Texture(D,{width:R,height:R,data:null},C.RGBA);Z.bind(C.LINEAR,C.CLAMP_TO_EDGE),L=i.fbo=D.createFramebuffer(R,R,!0),L.colorAttachment.set(Z.texture)}D.bindFramebuffer.set(L.framebuffer),D.viewport.set([0,0,R,R]);const{tileBoundsBuffer:F,tileBoundsIndexBuffer:U,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(D,C.TRIANGLES,m,y,v,d.CullFaceMode.disabled,((Z,G)=>{const Q=G.stride,q=d.create$1();return d.ortho(q,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(q,q,[0,-d.EXTENT,0]),{u_matrix:q,u_image:1,u_dimension:[Q,Q],u_zoom:Z.overscaledZ,u_unpack:G.unpackVector}})(i.tileID,A),c.id,F,U,H),i.needsHillshadePrepare=!1}const Jt=(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image0:new d.Uniform1i(p,i.u_image0),u_skirt_height:new d.Uniform1f(p,i.u_skirt_height)}),ii=(p,i)=>({u_matrix:p,u_image0:0,u_skirt_height:i}),oc=new class{constructor(){this.operations={}}newMorphing(p,i,c,m,y){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[p]={startTime:m,phase:0,duration:y,from:i,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const c=this.operations[i];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},eu={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function fh(p,i){const c=1<<p.z;return!i&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const sc=p=>({u_matrix:p});function un(p,i,c,m,y){if(y>0){const v=d.exported.now(),D=(v-p.timeAdded)/y,C=i?(v-i.timeAdded)/y:-1,A=c.getSource(),R=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),F=L&&p.refreshedUponExpiration?1:d.clamp(L?D:1-C,0,1);return p.refreshedUponExpiration&&D>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Af extends d.SourceCache{constructor(i){const c=V("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Wi(We(),null),i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,m){if(i.freezeTileCoverage)return;this.transform=i;const y=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,D)=>{if(v[D.key]="",!this._tiles[D.key]){const C=new d.Tile(D,this._source.tileSize*D.overscaleFactor(),i.tileZoom);C.state="loaded",this._tiles[D.key]=C}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(i){const c=this.proxyCachedFBO[i];if(void 0!==c){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ud extends d.OverscaledTileID{constructor(i,c,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Jo extends d.Elevation{constructor(i,c){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,v]=function(A){const R=new d.StructArrayLayout4i8,L=new d.StructArrayLayout3ui6,F=131;R.reserve(17161),L.reserve(33800);const U=d.EXTENT/128,H=d.EXTENT+U/2,Z=H+U;for(let Q=-U;Q<Z;Q+=U)for(let q=-U;q<Z;q+=U){const ee=q<0||q>H||Q<0||Q>H?24575:0,re=d.clamp(Math.round(q),0,d.EXTENT),W=d.clamp(Math.round(Q),0,d.EXTENT);R.emplaceBack(re+ee,W,re,W)}const G=(Q,q)=>{const ee=q*F+Q;L.emplaceBack(ee+1,ee,ee+F),L.emplaceBack(ee+F,ee+F+1,ee+1)};for(let Q=1;Q<129;Q++)for(let q=1;q<129;q++)G(q,Q);return[0,129].forEach(Q=>{for(let q=0;q<130;q++)G(q,Q),G(Q,q)}),[R,L,32768]}(),D=i.context;this.gridBuffer=D.createVertexBuffer(m,d.boundsAttributes.members),this.gridIndexBuffer=D.createIndexBuffer(y),this.gridSegments=d.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,m.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Af(c.map),this.orthoMatrix=d.create$1(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const C=D.gl;this._overlapStencilMode=new d.StencilMode({func:C.GEQUAL,mask:255},0,255,C.KEEP,C.KEEP,C.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,c,m){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const y=i.terrain.properties;this.sourceCache=i._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const v=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const D=this.sourceCache.getSource().tileSize/128,C=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(c,D*C,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,v(),this._initializing=!0),v(),c.updateElevation(!m),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=0===m._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(m.center),-1),this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(A=>{const R=c.getTileByID(A).tileID;return R.projMatrix=m.calculateProjMatrix(R.toUnwrapped()),R});(function(A,R){const L=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new d.pointGeometry(L.x,L.y);A.sort((U,H)=>{if(H.overscaledZ-U.overscaledZ)return H.overscaledZ-U.overscaledZ;const Z=new d.pointGeometry(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),G=new d.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Q=F.mult(1<<U.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(Z)-Q.distSqr(G)})})(y,this.painter),this._previousZoom=m.zoom;const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const D=this._style._sourceCaches;for(const A in D){const R=D[A];if(!R.used||(R!==this.sourceCache&&(this._findCoveringTileCache[R.id]={}),this._setupProxiedCoordsForOrtho(R,i[A],v),R.usedForTerrain))continue;const L=i[A];R.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(A=>new Ud(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const C={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const R=this.terrainTileForTile[A.key];if(!R)continue;const L=R.tileID.key;L in C||(this._visibleDemTiles.push(R),C[L]=L)}}_assignTerrainTiles(i){this._initializing||i.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),$r(this.painter,y,v))}}_prepareDemTileUniforms(i,c,m,y){if(!c||null==c.demTexture)return!1;const v=i.tileID.canonical,D=Math.pow(2,c.tileID.canonical.z-v.z),C=y||"";return m[`u_dem_tl${C}`]=[v.x*D%1,v.y*D%1],m[`u_dem_scale${C}`]=D,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let i=0;const c=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const v=y.dem.tree.minimums[0];return v>0&&i++,m+v},0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),y={width:1,height:1,data:new Uint8Array(d.DEMData.pack(m,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new d.Texture(i,y,c.RGBA,{premultiply:!1}),v}setupElevationDraw(i,c,m){const y=this.painter.context,v=y.gl,D=(C=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(C),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var C;D.u_dem_size=this.sourceCache.getSource().tileSize,D.u_exaggeration=this.exaggeration();let A=null,R=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const F=m.morphing.srcDemTile,U=m.morphing.dstDemTile;L=m.morphing.phase,F&&U&&(this._prepareDemTileUniforms(i,F,D,"_prev")&&(R=F),this._prepareDemTileUniforms(i,U,D)&&(A=U))}if(R&&A?(y.activeTexture.set(v.TEXTURE2),A.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),y.activeTexture.set(v.TEXTURE4),R.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE,v.NEAREST),D.u_dem_lerp=L):(A=this.terrainTileForTile[i.tileID.key],y.activeTexture.set(v.TEXTURE2),(this._prepareDemTileUniforms(i,A,D)?A.demTexture:this.emptyDEMTexture).bind(v.NEAREST,v.CLAMP_TO_EDGE)),m&&m.useDepthForOcclusion&&(y.activeTexture.set(v.TEXTURE3),this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),D.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),m&&m.useMeterToDem&&A){const F=(1<<A.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;D.u_meter_to_dem=F}m&&m.labelPlaneMatrixInv&&(D.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(y,D)}renderToBackBuffer(i){const c=this.painter,m=this.painter.context;0!==i.length&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(y,v,D,C,A){const R=y.context,L=R.gl;let F,U;const H=y.options.showTerrainWireframe?2:0,Z=(re,W)=>{if(U===re)return;const ie=[eu[re]];W&&ie.push(eu[H]),F=y.useProgram("terrainRaster",null,ie),U=re},G=y.colorModeForRenderPass(),Q=new d.DepthMode(L.LEQUAL,d.DepthMode.ReadWrite,y.depthRangeFor3D);oc.update(A);const q=y.transform,ee=6*Math.pow(1.5,22-q.zoom)*v.exaggeration();(H?[!1,!0]:[!1]).forEach(re=>{U=-1;const W=re?L.LINES:L.TRIANGLES,[ie,ae]=re?v.getWirefameBuffer():[v.gridIndexBuffer,v.gridSegments];for(const Ce of C){const Se=D.getTile(Ce),Ve=d.StencilMode.disabled,we=v.prevTerrainTileForTile[Ce.key],Ue=v.terrainTileForTile[Ce.key];xe=Ue,null!=(be=we)&&null!=xe&&be.hasData()&&xe.hasData()&&null!=be.demTexture&&null!=xe.demTexture&&be.tileID.key!==xe.tileID.key&&oc.newMorphing(Ce.key,we,Ue,A,250),R.activeTexture.set(L.TEXTURE0),Se.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const ve=oc.getMorphValuesForProxy(Ce.key),Ge=ve?1:0;let Je;ve&&(Je={morphing:{srcDemTile:ve.from,dstDemTile:ve.to,phase:d.easeCubicInOut(ve.phase)}});const lt=ii(Ce.projMatrix,fh(Ce.canonical,q.renderWorldCopies)?ee/10:ee);Z(Ge,re),v.setupElevationDraw(Se,F,Je),y.prepareDrawProgram(R,F,Ce.toUnwrapped()),F.draw(R,W,Q,Ve,G,d.CullFaceMode.backCCW,lt,"terrain_raster",v.gridBuffer,ie,ae)}var be,xe})}(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],D=this._drapedRenderBatches.shift(),C=[],A=c.style.order;let R=0;for(const L of v){const F=y.getTileByID(L.proxyTileKey),U=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][i]:void 0,H=void 0!==U?y.renderCache[U]:this.pool[R++],Z=void 0!==U;if(F.texture=H.tex,Z&&!H.dirty){C.push(F.tileID);continue}let G;m.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(m.clear({color:d.Color.transparent}),H.dirty=!1);for(let Q=D.start;Q<=D.end;++Q){const q=c.style._layers[A[Q]];if(q.isHidden(c.transform.zoom))continue;const ee=c.style._getLayerSourceCache(q),re=ee?this.proxyToSource[L.key][ee.id]:[L];if(!re)continue;const W=re;m.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(ee?ee.id:null)&&(this._setupStencil(H,re,q,ee),G=ee?ee.id:null),c.renderLayer(c,ee,q,W)}this.renderedToTile?(H.dirty=!0,C.push(F.tileID)):Z||--R,5===R&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),D.end+1}postRender(){}renderCacheEfficiency(i){const c=i.order.length;if(0===c)return{efficiency:100};let m,y=0,v=0,D=!1;for(let C=0;C<c;++C){const A=i._layers[i.order[C]];this._style.isLayerDraped(A)?(D&&++y,++v):D||(D=!0,m=A.id)}return 0===v?{efficiency:100}:{efficiency:100*(1-y/v),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{i=Math.min(i,c.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,c,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const D=v.tileID,C=Math.pow(2,D.overscaledZ),{x:A,y:R}=D.canonical,L=A/C,F=(A+1)/C,U=R/C,H=(R+1)/C;return{minx:L,miny:U,maxx:F,maxy:H,t:v.dem.tree.raycastRoot(L,U,F,H,i,c,m),tile:v}});y.sort((v,D)=>(null!==v.t?v.t:Number.MAX_VALUE)-(null!==D.t?D.t:Number.MAX_VALUE));for(const v of y){if(null==v.t)return null;const D=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,i,c,m);if(null!=D)return D}return null}_createFBO(){const i=this.painter.context,c=i.gl,m=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const y=new d.Texture(i,{width:m[0],height:m[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=i.createFramebuffer(m[0],m[1],!1);return v.colorAttachment.set(y.texture),v.depthAttachment=new Ki(i,v.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const c=this._style._layers[i],m=c.isHidden(this.painter.transform.zoom),y=c.getCrossfadeParameters(),v=!!y&&1!==y.t,D=c.hasTransition();return"custom"!==c.type&&!m&&(v||D)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof xs){i=!0;break}if(i)for(let c=0;c<this._style.order.length;++c){const m=this._style._layers[this._style.order[c]],y=m.isHidden(this.painter.transform.zoom),v=this._style._getLayerSourceCache(m);if("raster"!==m.type||y||!v)continue;const D=m.paint.get("raster-fade-duration");for(const C of this.proxyCoords){const A=this.proxyToSource[C.key][v.id];if(A)for(const R of A){const L=un(v.getTile(R),v.findLoadedParent(R,0),v,this.painter.transform,D);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(v.id,R)}}}}_setupDrapedRenderBatches(){const i=this._style.order,c=i.length;if(0===c)return;const m=[];let y,v=0,D=this._style._layers[i[v]];for(;!this._style.isLayerDraped(D)&&D.isHidden(this.painter.transform.zoom)&&++v<c;)D=this._style._layers[i[v]];for(;v<c;++v){const C=this._style._layers[i[v]];C.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(C)?void 0===y&&(y=v):void 0!==y&&(m.push({start:y,end:v-1}),y=void 0))}void 0!==y&&m.push({start:y,end:v-1}),this._drapedRenderBatches=m}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const D=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let C=0;C<D.length;++C){const A=Object.values(D[C]);c.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let D=m.length-1;D>=0;D--){const C=m[D];if(c.getTileByID(C.key),void 0!==c.proxyCachedFBO[C.key]){const A=i[C.key],R=this.proxyToSource[C.key];let L=0;for(const F in R){const U=R[F],H=A[F];if(!H||H.length!==U.length||U.some((Z,G)=>Z!==H[G]||y[F]&&y[F].hasOwnProperty(Z.key))){L=-1;break}++L}for(const F in c.proxyCachedFBO[C.key])c.renderCache[c.proxyCachedFBO[C.key][F]].dirty=L<0||L!==Object.values(A).length}}const v=[...this._drapedRenderBatches];v.sort((D,C)=>C.end-C.start-(D.end-D.start));for(const D of v)for(const C of m){if(c.proxyCachedFBO[C.key])continue;let A=c.renderCachePool.pop();void 0===A&&c.renderCache.length<50&&(A=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==A&&(c.proxyCachedFBO[C.key]={},c.proxyCachedFBO[C.key][D.start]=A,c.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,D=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let C;if(m.isTileClipped())C=c.length,this._overlapStencilMode.test={func:D.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);C=1,this._overlapStencilMode.test={func:D.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+C>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=C,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(i,c){const m=this.painter,y=this.painter.context,v=y.gl;m._tileClippingMaskIDs={},y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const D=m.useProgram("clippingMask");for(const C of i){const A=m._tileClippingMaskIDs[C.key]=--c;D.draw(y,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,sc(C.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const m=[i.x,i.y,1,1];d.transformMat4(m,m,c.pixelMatrixInverse),d.scale$2(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const y=c._camera.position,v=d.mercatorZfromAltitude(1,c.center.lat),D=[y[0],y[1],y[2]/v,0],C=d.subtract([],m.slice(0,3),D);d.normalize(C,C);const A=this.raycast(D,C,this._exaggeration);return null!==A&&A?(d.scaleAndAdd(D,D,C,A),D[3]=D[2],D[2]*=v,D):null}drawDepth(){const i=this.painter,c=i.context,m=this.proxySourceCache,y=Math.ceil(i.width),v=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===v||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const D=c.gl,C=c.createFramebuffer(y,v,!0);c.activeTexture.set(D.TEXTURE0);const A=new d.Texture(c,{width:y,height:v,data:null},D.RGBA);A.bind(D.NEAREST,D.CLAMP_TO_EDGE),C.colorAttachment.set(A.texture);const R=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,v);C.depthAttachment.set(R),this._depthFBO=C,this._depthTexture=A}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,v]),function(D,C,A,R){const L=D.context,F=L.gl;L.clear({depth:1});const U=D.useProgram("terrainDepth"),H=new d.DepthMode(F.LESS,d.DepthMode.ReadWrite,D.depthRangeFor3D);for(const Z of R){const G=A.getTile(Z),Q=ii(Z.projMatrix,0);C.setupElevationDraw(G,U),U.draw(L,F.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,Q,"terrain_depth",C.gridBuffer,C.gridIndexBuffer,C.gridNoSkirtSegments)}}(i,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,c,m){if(i.getSource()instanceof Y)return this._setupProxiedCoordsForImageSource(i,c,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const y=this.proxiedCoords[i.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const A=v[C],R=this._findTileCoveringTileID(A,i);if(R){const L=this._createProxiedId(A,R,m[A.key]&&m[A.key][i.id]);y.push(L),this.proxyToSource[A.key][i.id]=[L]}}let D=!1;for(let C=0;C<c.length;C++){const A=i.getTile(c[C]);if(!A||!A.hasData())continue;const R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){const L=this.proxyToSource[R.tileID.key][i.id],F=this._createProxiedId(R.tileID,A,m[R.tileID.key]&&m[R.tileID.key][i.id]);L?L.splice(L.length-1,0,F):this.proxyToSource[R.tileID.key][i.id]=[F],y.push(F),D=!0}}this._sourceTilesOverlap[i.id]=D}_setupProxiedCoordsForImageSource(i,c,m){if(!i.getSource().loaded())return;const y=this.proxiedCoords[i.id]=[],v=this.proxyCoords,D=i.getSource(),C=new d.pointGeometry(D.tileID.x,D.tileID.y)._div(1<<D.tileID.z),A=D.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((L,F)=>(L.min.x=Math.min(L.min.x,F.x-C.x),L.min.y=Math.min(L.min.y,F.y-C.y),L.max.x=Math.max(L.max.x,F.x-C.x),L.max.y=Math.max(L.max.y,F.y-C.y),L),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(L,F)=>{const U=L.wrap+L.canonical.x/(1<<L.canonical.z),H=L.canonical.y/(1<<L.canonical.z),Z=d.EXTENT/(1<<L.canonical.z),G=F.wrap+F.canonical.x/(1<<F.canonical.z),Q=F.canonical.y/(1<<F.canonical.z);return U+Z<G+A.min.x||U>G+A.max.x||H+Z<Q+A.min.y||H>Q+A.max.y};for(let L=0;L<v.length;L++){const F=v[L];for(let U=0;U<c.length;U++){const H=i.getTile(c[U]);if(!H||!H.hasData()||R(F,H.tileID))continue;const Z=this._createProxiedId(F,H,m[F.key]&&m[F.key][i.id]),G=this.proxyToSource[F.key][i.id];G?G.push(Z):this.proxyToSource[F.key][i.id]=[Z],y.push(Z)}}}_createProxiedId(i,c,m){let y=this.orthoMatrix;if(m){const v=m.find(D=>D.key===c.tileID.key);if(v)return v}if(c.tileID.key!==i.key){const v=i.canonical.z-c.tileID.canonical.z;let D,C,A;y=d.create$1();const R=c.tileID.wrap-i.wrap<<i.overscaledZ;v>0?(D=d.EXTENT>>v,C=D*((c.tileID.canonical.x<<v)-i.canonical.x+R),A=D*((c.tileID.canonical.y<<v)-i.canonical.y)):(D=d.EXTENT<<-v,C=d.EXTENT*(c.tileID.canonical.x-(i.canonical.x+R<<-v)),A=d.EXTENT*(c.tileID.canonical.y-(i.canonical.y<<-v))),d.ortho(y,0,D,0,D,0,1),d.translate(y,y,[C,A,0])}return new Ud(c.tileID,i.key,y)}_findTileCoveringTileID(i,c){let m=c.getTile(i);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[c.id],v=y[i.key];if(m=v?c.getTileByID(v):null,m&&m.hasData()||null===v)return m;let D=m?m.tileID:i,C=D.overscaledZ;const A=c.getSource().minzoom,R=[];if(!v){const F=c.getSource().maxzoom;if(i.canonical.z>=F){const U=i.canonical.z-F;c.getSource().reparseOverscaled?(C=Math.max(i.canonical.z+2,c.transform.tileZoom),D=new d.OverscaledTileID(C,i.wrap,F,i.canonical.x>>U,i.canonical.y>>U)):0!==U&&(C=F,D=new d.OverscaledTileID(C,i.wrap,F,i.canonical.x>>U,i.canonical.y>>U))}D.key!==i.key&&(R.push(D.key),m=c.getTile(D))}const L=F=>{R.forEach(U=>{y[U]=F}),R.length=0};for(C-=1;C>=A&&(!m||!m.hasData());C--){m&&L(m.tileID.key);const F=D.calculateScaledKey(C);if(m=c.getTileByID(F),m&&m.hasData())break;const U=y[F];if(null===U)break;void 0===U?R.push(F):m=c.getTileByID(U)}return L(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(i){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(c){let m,y,v;const D=new d.StructArrayLayout2ui4,C=131;for(y=1;y<129;y++){for(m=1;m<129;m++)v=y*C+m,D.emplaceBack(v,v+1),D.emplaceBack(v,v+C),D.emplaceBack(v+1,v+C),128===y&&D.emplaceBack(v+C,v+C+1);D.emplaceBack(v+1,v+1+C)}return D}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function hn(p){const i=[];for(let c=0;c<p.length;c++){if(null===p[c])continue;const m=p[c].split(" ");i.push(m.pop())}return i}class Ts{static cacheKey(i,c,m){let y=`${i}${m?m.cacheKey:""}`;for(const v of c)y+=`/${v}`;return y}constructor(i,c,m,y,v,D){const C=i.gl;this.program=C.createProgram();const A=hn(m.staticAttributes),R=y?y.getBinderAttributes():[],L=A.concat(R),F=m.staticUniforms?hn(m.staticUniforms):[],U=y?y.getBinderUniforms():[],H=F.concat(U),Z=[];for(const ie of H)Z.indexOf(ie)<0&&Z.push(ie);let G=y?y.defines():[];G=G.concat(D.map(ie=>`#define ${ie}`));const Q=G.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Yo,_t.fragmentSource,da.fragmentSource,m.fragmentSource).join("\n"),q=G.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Yo,_t.vertexSource,da.vertexSource,ha.vertexSource,m.vertexSource).join("\n"),ee=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(ee,Q),C.compileShader(ee),C.attachShader(this.program,ee);const re=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(re,q),C.compileShader(re),C.attachShader(this.program,re),this.attributes={};const W={};this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)L[ie]&&(C.bindAttribLocation(this.program,ie,L[ie]),this.attributes[L[ie]]=ie);C.linkProgram(this.program),C.deleteShader(re),C.deleteShader(ee);for(let ie=0;ie<Z.length;ie++){const ae=Z[ie];if(ae&&!W[ae]){const be=C.getUniformLocation(this.program,ae);be&&(W[ae]=be)}}var ie,ae;this.fixedUniforms=v(i,W),this.binderUniforms=y?y.getUniforms(i,W):[],-1!==D.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(ie=i,(ae=W).u_dem),u_dem_prev:new d.Uniform1i(ie,ae.u_dem_prev),u_dem_unpack:new d.Uniform4f(ie,ae.u_dem_unpack),u_dem_tl:new d.Uniform2f(ie,ae.u_dem_tl),u_dem_scale:new d.Uniform1f(ie,ae.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(ie,ae.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(ie,ae.u_dem_scale_prev),u_dem_size:new d.Uniform1f(ie,ae.u_dem_size),u_dem_lerp:new d.Uniform1f(ie,ae.u_dem_lerp),u_exaggeration:new d.Uniform1f(ie,ae.u_exaggeration),u_depth:new d.Uniform1i(ie,ae.u_depth),u_depth_size_inv:new d.Uniform2f(ie,ae.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(ie,ae.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(ie,ae.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(ie,ae.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(ie,ae.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(ie,ae.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(ie,ae.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(ie,ae.u_tile_up_scale)}),-1!==D.indexOf("FOG")&&(this.fogUniforms=((ie,ae)=>({u_fog_matrix:new d.UniformMatrix4f(ie,ae.u_fog_matrix),u_fog_range:new d.Uniform2f(ie,ae.u_fog_range),u_fog_color:new d.Uniform4f(ie,ae.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(ie,ae.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(ie,ae.u_fog_temporal_offset)}))(i,W))}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const y in c)m[y].set(c[y])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const y in c)m[y].location&&m[y].set(c[y])}}draw(i,c,m,y,v,D,C,A,R,L,F,U,H,Z,G,Q){const q=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(m),i.setStencilMode(y),i.setColorMode(v),i.setCullFace(D);for(const re in this.fixedUniforms)this.fixedUniforms[re].set(C[re]);Z&&Z.setUniforms(i,this.binderUniforms,U,{zoom:H});const ee={[q.LINES]:2,[q.TRIANGLES]:3,[q.LINE_STRIP]:1}[c];for(const re of F.get()){const W=re.vaos||(re.vaos={});(W[A]||(W[A]=new Qa)).bind(i,this,R,Z?Z.getPaintVertexBuffers():[],L,re.vertexOffset,G,Q),q.drawElements(c,re.primitiveLength*ee,q.UNSIGNED_SHORT,re.primitiveOffset*ee*2)}}}function pa(p,i,c){const m=1/cr(c,1,i.transform.tileZoom),y=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,i.transform.tileZoom)/y,D=v*(c.tileID.canonical.x+c.tileID.wrap*y),C=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[m,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[D>>16,C>>16],u_pixel_coord_lower:[65535&D,65535&C]}}const el=(p,i,c,m)=>{const y=i.style.light,v=y.properties.get("position"),D=[v.x,v.y,v.z],C=d.create$2();"viewport"===y.properties.get("anchor")&&(d.fromRotation(C,-i.transform.angle),d.transformMat3(D,D,C));const A=y.properties.get("color");return{u_matrix:p,u_lightpos:D,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+c,u_opacity:m}},tu=(p,i,c,m,y,v,D)=>d.extend(el(p,i,c,m),pa(v,i,D),{u_height_factor:-Math.pow(2,y.overscaledZ)/D.tileSize/8}),no=p=>({u_matrix:p}),ro=(p,i,c,m)=>d.extend(no(p),pa(c,i,m)),tl=(p,i)=>({u_matrix:p,u_world:i}),io=(p,i,c,m,y)=>d.extend(ro(p,i,c,m),{u_world:y}),pi=(p,i,c,m)=>{const y=p.transform;let v;return v="map"===m.paint.get("circle-pitch-alignment")?y.calculatePixelsToTileUnitsMatrix(c):new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]),{u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:p.translatePosMatrix(i.projMatrix,c,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:v}},ac=p=>{const i=[];return"map"===p.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},nl=(p,i,c)=>{const m=d.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.cameraToCenterDistance,u_extrude_scale:[i.pixelsToGLUnits[0]/m,i.pixelsToGLUnits[1]/m]}},fa=(p,i,c=1)=>({u_matrix:p,u_color:i,u_overlay:0,u_overlay_scale:c}),oo=(p,i,c,m)=>({u_matrix:p,u_extrude_scale:cr(i,1,c),u_intensity:m}),nu=(p,i,c,m,y,v)=>{const D=p.transform,C=D.calculatePixelsToTileUnitsMatrix(i),A={u_matrix:vr(p,i,c,y),u_pixels_to_tile_units:C,u_device_pixel_ratio:d.exported.devicePixelRatio,u_units_to_pixels:[1/D.pixelsToGLUnits[0],1/D.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(so(c)){const R=Gr(i,p.transform);A.u_texsize=i.lineAtlasTexture.size,A.u_scale=[R,m.fromScale,m.toScale],A.u_mix=m.t}return A},rl=(p,i,c,m,y)=>{const v=p.transform,D=Gr(i,v);return{u_matrix:vr(p,i,c,y),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:v.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:d.exported.devicePixelRatio,u_image:0,u_scale:[D,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}};function Gr(p,i){return 1/cr(p,1,i.tileZoom)}function vr(p,i,c,m){return p.translatePosMatrix(m||i.tileID.projMatrix,i,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const ir=p=>{const i=[];return so(p)&&i.push("RENDER_LINE_DASH"),p.paint.get("line-gradient")&&i.push("RENDER_LINE_GRADIENT"),i};function so(p){const i=p.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Qo=(p,i,c,m,y)=>{return{u_matrix:p,u_tl_parent:i,u_scale_parent:c,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(D=y.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(v=y.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:xr(y.paint.get("raster-hue-rotate"))};var v,D};function xr(p){p*=Math.PI/180;const i=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const il=(p,i,c,m,y,v,D,C,A,R,L,F,U,H)=>{const Z=y.transform;return{u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Z.cameraToCenterDistance,u_pitch:Z.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:Z.width/Z.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:D,u_coord_matrix:C,u_is_text:+A,u_pitch_with_map:+m,u_texsize:R,u_tile_id:L,u_zoom_transition:F,u_inv_rot_matrix:U,u_merc_center:H,u_texture:0}},lc=(p,i,c,m,y,v,D,C,A,R,L,F,U,H,Z)=>{const{cameraToCenterDistance:G,_pitch:Q}=y.transform;return d.extend(il(p,i,c,m,y,v,D,C,A,R,F,U,H,Z),{u_gamma_scale:m?G*Math.cos(y.terrain?0:Q):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+L})},ol=(p,i,c,m,y,v,D,C,A,R,L,F,U,H)=>d.extend(lc(p,i,c,m,y,v,D,C,!0,A,!0,L,F,U,H),{u_texsize_icon:R,u_texture_icon:1}),cc=(p,i,c)=>({u_matrix:p,u_opacity:i,u_color:c}),Cs=(p,i,c,m,y,v)=>d.extend(function(D,C,A,R){const L=A.imageManager.getPattern(D.from.toString()),F=A.imageManager.getPattern(D.to.toString()),{width:U,height:H}=A.imageManager.getPixelSize(),Z=Math.pow(2,R.tileID.overscaledZ),G=R.tileSize*Math.pow(2,A.transform.tileZoom)/Z,Q=G*(R.tileID.canonical.x+R.tileID.wrap*Z),q=G*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:F.tl,u_pattern_br_b:F.br,u_texsize:[U,H],u_mix:C.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:F.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/cr(R,1,A.transform.tileZoom),u_pixel_coord_upper:[Q>>16,q>>16],u_pixel_coord_lower:[65535&Q,65535&q]}}(m,v,c,y),{u_matrix:p,u_opacity:i}),Rr={fillExtrusion:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_lightpos:new d.Uniform3f(p,i.u_lightpos),u_lightintensity:new d.Uniform1f(p,i.u_lightintensity),u_lightcolor:new d.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,i.u_vertical_gradient),u_opacity:new d.Uniform1f(p,i.u_opacity)}),fillExtrusionPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_lightpos:new d.Uniform3f(p,i.u_lightpos),u_lightintensity:new d.Uniform1f(p,i.u_lightintensity),u_lightcolor:new d.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,i.u_vertical_gradient),u_height_factor:new d.Uniform1f(p,i.u_height_factor),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade),u_opacity:new d.Uniform1f(p,i.u_opacity)}),fill:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),fillPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade)}),fillOutline:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_world:new d.Uniform2f(p,i.u_world)}),fillOutlinePattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_world:new d.Uniform2f(p,i.u_world),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade)}),circle:(p,i)=>({u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(p,i.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),collisionBox:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(p,i.u_extrude_scale)}),collisionCircle:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_inv_matrix:new d.UniformMatrix4f(p,i.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(p,i.u_viewport_size)}),debug:(p,i)=>({u_color:new d.UniformColor(p,i.u_color),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_overlay:new d.Uniform1i(p,i.u_overlay),u_overlay_scale:new d.Uniform1f(p,i.u_overlay_scale)}),clippingMask:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),heatmap:(p,i)=>({u_extrude_scale:new d.Uniform1f(p,i.u_extrude_scale),u_intensity:new d.Uniform1f(p,i.u_intensity),u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),heatmapTexture:(p,i)=>({u_image:new d.Uniform1i(p,i.u_image),u_color_ramp:new d.Uniform1i(p,i.u_color_ramp),u_opacity:new d.Uniform1f(p,i.u_opacity)}),hillshade:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_latrange:new d.Uniform2f(p,i.u_latrange),u_light:new d.Uniform2f(p,i.u_light),u_shadow:new d.UniformColor(p,i.u_shadow),u_highlight:new d.UniformColor(p,i.u_highlight),u_accent:new d.UniformColor(p,i.u_accent)}),hillshadePrepare:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_dimension:new d.Uniform2f(p,i.u_dimension),u_zoom:new d.Uniform1f(p,i.u_zoom),u_unpack:new d.Uniform4f(p,i.u_unpack)}),line:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(p,i.u_units_to_pixels),u_dash_image:new d.Uniform1i(p,i.u_dash_image),u_gradient_image:new d.Uniform1i(p,i.u_gradient_image),u_image_height:new d.Uniform1f(p,i.u_image_height),u_texsize:new d.Uniform2f(p,i.u_texsize),u_scale:new d.Uniform3f(p,i.u_scale),u_mix:new d.Uniform1f(p,i.u_mix)}),linePattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_image:new d.Uniform1i(p,i.u_image),u_units_to_pixels:new d.Uniform2f(p,i.u_units_to_pixels),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade)}),raster:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_tl_parent:new d.Uniform2f(p,i.u_tl_parent),u_scale_parent:new d.Uniform1f(p,i.u_scale_parent),u_buffer_scale:new d.Uniform1f(p,i.u_buffer_scale),u_fade_t:new d.Uniform1f(p,i.u_fade_t),u_opacity:new d.Uniform1f(p,i.u_opacity),u_image0:new d.Uniform1i(p,i.u_image0),u_image1:new d.Uniform1i(p,i.u_image1),u_brightness_low:new d.Uniform1f(p,i.u_brightness_low),u_brightness_high:new d.Uniform1f(p,i.u_brightness_high),u_saturation_factor:new d.Uniform1f(p,i.u_saturation_factor),u_contrast_factor:new d.Uniform1f(p,i.u_contrast_factor),u_spin_weights:new d.Uniform3f(p,i.u_spin_weights)}),symbolIcon:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,i.u_pitch),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_texture:new d.Uniform1i(p,i.u_texture)}),symbolSDF:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,i.u_pitch),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_texture:new d.Uniform1i(p,i.u_texture),u_gamma_scale:new d.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_is_halo:new d.Uniform1i(p,i.u_is_halo)}),symbolTextAndIcon:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_pitch:new d.Uniform1f(p,i.u_pitch),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_texsize_icon:new d.Uniform2f(p,i.u_texsize_icon),u_texture:new d.Uniform1i(p,i.u_texture),u_texture_icon:new d.Uniform1i(p,i.u_texture_icon),u_gamma_scale:new d.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(p,i.u_is_halo)}),background:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_opacity:new d.Uniform1f(p,i.u_opacity),u_color:new d.UniformColor(p,i.u_color)}),backgroundPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_opacity:new d.Uniform1f(p,i.u_opacity),u_image:new d.Uniform1i(p,i.u_image),u_pattern_tl_a:new d.Uniform2f(p,i.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(p,i.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(p,i.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(p,i.u_pattern_br_b),u_texsize:new d.Uniform2f(p,i.u_texsize),u_mix:new d.Uniform1f(p,i.u_mix),u_pattern_size_a:new d.Uniform2f(p,i.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(p,i.u_pattern_size_b),u_scale_a:new d.Uniform1f(p,i.u_scale_a),u_scale_b:new d.Uniform1f(p,i.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(p,i.u_tile_units_to_pixels)}),terrainRaster:Jt,terrainDepth:Jt,skybox:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_sun_direction:new d.Uniform3f(p,i.u_sun_direction),u_cubemap:new d.Uniform1i(p,i.u_cubemap),u_opacity:new d.Uniform1f(p,i.u_opacity),u_temporal_offset:new d.Uniform1f(p,i.u_temporal_offset)}),skyboxGradient:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_color_ramp:new d.Uniform1i(p,i.u_color_ramp),u_center_direction:new d.Uniform3f(p,i.u_center_direction),u_radius:new d.Uniform1f(p,i.u_radius),u_opacity:new d.Uniform1f(p,i.u_opacity),u_temporal_offset:new d.Uniform1f(p,i.u_temporal_offset)}),skyboxCapture:(p,i)=>({u_matrix_3f:new d.UniformMatrix3f(p,i.u_matrix_3f),u_sun_direction:new d.Uniform3f(p,i.u_sun_direction),u_sun_intensity:new d.Uniform1f(p,i.u_sun_intensity),u_color_tint_r:new d.Uniform4f(p,i.u_color_tint_r),u_color_tint_m:new d.Uniform4f(p,i.u_color_tint_m),u_luminance:new d.Uniform1f(p,i.u_luminance)})};let ma;function Hr(p,i,c,m,y,v,D){const C=p.context,A=C.gl,R=p.useProgram("collisionBox"),L=[];let F=0,U=0;for(let re=0;re<m.length;re++){const W=m[re],ie=i.getTile(W),ae=ie.getBucket(c);if(!ae)continue;let be=W.projMatrix;0===y[0]&&0===y[1]||(be=p.translatePosMatrix(W.projMatrix,ie,y,v));const xe=D?ae.textCollisionBox:ae.iconCollisionBox,Ce=ae.collisionCircleArray;if(Ce.length>0){const Se=d.create$1(),Ve=be;d.mul$1(Se,ae.placementInvProjMatrix,p.transform.glCoordMatrix),d.mul$1(Se,Se,ae.placementViewportMatrix),L.push({circleArray:Ce,circleOffset:U,transform:Ve,invTransform:Se}),F+=Ce.length/4,U=F}xe&&(p.terrain&&p.terrain.setupElevationDraw(ie,R),R.draw(C,A.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,nl(be,p.transform,ie),c.id,xe.layoutVertexBuffer,xe.indexBuffer,xe.segments,null,p.transform.zoom,null,xe.collisionVertexBuffer,xe.collisionVertexBufferExt))}if(!D||!L.length)return;const H=p.useProgram("collisionCircle"),Z=new d.StructArrayLayout2f1f2i16;Z.resize(4*F),Z._trim();let G=0;for(const re of L)for(let W=0;W<re.circleArray.length/4;W++){const ie=4*W,ae=re.circleArray[ie+0],be=re.circleArray[ie+1],xe=re.circleArray[ie+2],Ce=re.circleArray[ie+3];Z.emplace(G++,ae,be,xe,Ce,0),Z.emplace(G++,ae,be,xe,Ce,1),Z.emplace(G++,ae,be,xe,Ce,2),Z.emplace(G++,ae,be,xe,Ce,3)}(!ma||ma.length<2*F)&&(ma=function(re){const W=2*re,ie=new d.StructArrayLayout3ui6;ie.resize(W),ie._trim();for(let ae=0;ae<W;ae++){const be=6*ae;ie.uint16[be+0]=4*ae+0,ie.uint16[be+1]=4*ae+1,ie.uint16[be+2]=4*ae+2,ie.uint16[be+3]=4*ae+2,ie.uint16[be+4]=4*ae+3,ie.uint16[be+5]=4*ae+0}return ie}(F));const Q=C.createIndexBuffer(ma,!0),q=C.createVertexBuffer(Z,d.collisionCircleLayout.members,!0);for(const re of L){const W={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ee=p.transform).cameraToCenterDistance,u_viewport_size:[ee.width,ee.height]};H.draw(C,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,W,c.id,q,Q,d.SegmentVector.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,p.transform.zoom,null,null,null)}var ee;q.destroy(),Q.destroy()}const et=d.identity(new Float32Array(16));function kt(p,i,c,m,y,v){const{horizontalAlign:D,verticalAlign:C}=d.getAnchorAlignment(p),A=-(D-.5)*i,R=-(C-.5)*c,L=d.evaluateVariableOffset(p,m);return new d.pointGeometry((A/y+L[0])*v,(R/y+L[1])*v)}function An(p,i,c,m,y,v,D,C,A,R,L,F){const U=p.text.placedSymbolArray,H=p.text.dynamicLayoutVertexArray,Z=p.icon.dynamicLayoutVertexArray,G={};H.clear();for(let Q=0;Q<U.length;Q++){const q=U.get(Q),ee=p.allowVerticalPlacement&&!q.placedOrientation,re=q.hidden||!q.crossTileID||ee?null:m[q.crossTileID];if(re){const W=new d.pointGeometry(q.tileAnchorX,q.tileAnchorY),ie=F(W),ae=qn(W,c?C:D,ie),be=ws(v.cameraToCenterDistance,ae.signedDistanceFromCamera);let xe=y.evaluateSizeForFeature(p.textSizeData,R,q)*be/d.ONE_EM;c&&(xe*=p.tilePixelRatio/A);const{width:Ce,height:Se,anchor:Ve,textOffset:we,textScale:Ue}=re,ve=kt(Ve,Ce,Se,we,Ue,xe),Ge=c?qn(W.add(ve),D,ie).point:ae.point.add(i?ve.rotate(-v.angle):ve),Je=p.allowVerticalPlacement&&q.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let lt=0;lt<q.numGlyphs;lt++)d.addDynamicAttributes(H,Ge,Je);L&&q.associatedIconIndex>=0&&(G[q.associatedIconIndex]={shiftedAnchor:Ge,angle:Je})}else Ji(q.numGlyphs,H)}if(L){Z.clear();const Q=p.icon.placedSymbolArray;for(let q=0;q<Q.length;q++){const ee=Q.get(q);if(ee.hidden)Ji(ee.numGlyphs,Z);else{const re=G[q];if(re)for(let W=0;W<ee.numGlyphs;W++)d.addDynamicAttributes(Z,re.shiftedAnchor,re.angle);else Ji(ee.numGlyphs,Z)}}p.icon.dynamicLayoutVertexBuffer.updateData(Z)}p.text.dynamicLayoutVertexBuffer.updateData(H)}function qr(p,i,c){return c.iconsInText&&i?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function oi(p,i,c,m,y,v,D,C,A,R,L,F){const U=p.context,H=U.gl,Z=p.transform,G="map"===C,Q="map"===A,q=G&&"point"!==c.layout.get("symbol-placement"),ee=G&&!Q&&!q,re=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let W=!1;const ie=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),ae=[0,0],be=c.layout.get("text-variable-anchor"),xe=[],Ce=[];p.terrain&&Q&&Ce.push("PITCH_WITH_MAP_TERRAIN"),q&&Ce.push("PROJECTED_POS_ON_VIEWPORT");for(const Se of m){const Ve=i.getTile(Se),we=Ve.getBucket(c);if(!we)continue;const Ue=y?we.text:we.icon;if(!Ue||!Ue.segments.get().length)continue;const ve=Ue.programConfigurations.get(c.id),Ge=y||we.sdfIcons,Je=y?we.textSizeData:we.iconSizeData,lt=Q||0!==Z.pitch,ht=p.useProgram(qr(Ge,y,we),ve,Ce),dt=d.evaluateSizeForZoom(Je,Z.zoom),pt=[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z];let st,ft,qt,$n,Qn=[0,0],Dr=null;if(y){if(ft=Ve.glyphAtlasTexture,qt=H.LINEAR,st=Ve.glyphAtlasTexture.size,we.iconsInText){Qn=Ve.imageAtlasTexture.size,Dr=Ve.imageAtlasTexture;const Or="composite"===Je.kind||"camera"===Je.kind;$n=lt||p.options.rotating||p.options.zooming||Or?H.LINEAR:H.NEAREST}}else{const Or=1!==c.layout.get("icon-size").constantOr(0)||we.iconsNeedLinear;ft=Ve.imageAtlasTexture,qt=Ge||p.options.rotating||p.options.zooming||Or||lt?H.LINEAR:H.NEAREST,st=Ve.imageAtlasTexture.size}const Fr=p.transform.calculatePixelsToTileUnitsMatrix(Ve),Pn=Tt(Se.projMatrix,Q,G,p.transform,Fr),Io=p.terrain&&Q&&q?d.invert(new Float32Array(16),Pn):et,Wr=Ct(Se.projMatrix,Q,G,p.transform,Fr),mn=be&&we.hasTextData(),kn="none"!==c.layout.get("icon-text-fit")&&mn&&we.hasIconData();if(q){const Or=Z.elevation;cn(we,Se.projMatrix,p,y,Pn,Wr,Q,R,Or?ho=>Or.getAtTileOffset(Se,ho.x,ho.y):null)}const Ht=p.translatePosMatrix(Se.projMatrix,Ve,v,D),Dn=q||y&&be||kn?et:Pn,dr=p.translatePosMatrix(Wr,Ve,v,D,!0),Tn=Ge&&0!==c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1);let mi;mi=Ge?we.iconsInText?ol(Je.kind,dt,ee,Q,p,Ht,Dn,dr,st,Qn,pt,0,p.identityMat,ae):lc(Je.kind,dt,ee,Q,p,Ht,Dn,dr,y,st,!0,pt,0,p.identityMat,ae):il(Je.kind,dt,ee,Q,p,Ht,Dn,dr,y,st,pt,0,p.identityMat,ae);const Mo={program:ht,buffers:Ue,uniformValues:mi,atlasTexture:ft,atlasTextureIcon:Dr,atlasInterpolation:qt,atlasInterpolationIcon:$n,isSDF:Ge,hasHalo:Tn,tile:Ve,labelPlaneMatrixInv:Io};if(re&&we.canOverlap){W=!0;const Or=Ue.segments.get();for(const ho of Or)xe.push({segments:new d.SegmentVector([ho]),sortKey:ho.sortKey,state:Mo})}else xe.push({segments:Ue.segments,sortKey:0,state:Mo})}W&&xe.sort((Se,Ve)=>Se.sortKey-Ve.sortKey);for(const Se of xe){const Ve=Se.state;if(p.terrain&&p.terrain.setupElevationDraw(Ve.tile,Ve.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:Ve.labelPlaneMatrixInv}),U.activeTexture.set(H.TEXTURE0),Ve.atlasTexture.bind(Ve.atlasInterpolation,H.CLAMP_TO_EDGE),Ve.atlasTextureIcon&&(U.activeTexture.set(H.TEXTURE1),Ve.atlasTextureIcon&&Ve.atlasTextureIcon.bind(Ve.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),Ve.isSDF){const we=Ve.uniformValues;Ve.hasHalo&&(we.u_is_halo=1,Yn(Ve.buffers,Se.segments,c,p,Ve.program,ie,L,F,we)),we.u_is_halo=0}Yn(Ve.buffers,Se.segments,c,p,Ve.program,ie,L,F,Ve.uniformValues)}}function Yn(p,i,c,m,y,v,D,C,A){const R=m.context;y.draw(R,R.gl.TRIANGLES,v,D,C,d.CullFaceMode.disabled,A,c.id,p.layoutVertexBuffer,p.indexBuffer,i,c.paint,m.transform.zoom,p.programConfigurations.get(c.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function fi(p,i,c,m,y,v,D){const C=p.context.gl,A=c.paint.get("fill-pattern"),R=A&&A.constantOr(1),L=c.getCrossfadeParameters();let F,U,H,Z,G;D?(U=R&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=C.LINES):(U=R?"fillPattern":"fill",F=C.TRIANGLES);for(const Q of m){const q=i.getTile(Q);if(R&&!q.patternsLoaded())continue;const ee=q.getBucket(c);if(!ee)continue;p.prepareDrawTile(Q);const re=ee.programConfigurations.get(c.id),W=p.useProgram(U,re);R&&(p.context.activeTexture.set(C.TEXTURE0),q.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),re.updatePaintBuffers(L));const ie=A.constantOr(null);if(ie&&q.imageAtlas){const be=q.imageAtlas,xe=be.patternPositions[ie.to.toString()],Ce=be.patternPositions[ie.from.toString()];xe&&Ce&&re.setConstantPatternPositions(xe,Ce)}const ae=p.translatePosMatrix(Q.projMatrix,q,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(D){Z=ee.indexBuffer2,G=ee.segments2;const be=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[C.drawingBufferWidth,C.drawingBufferHeight];H="fillOutlinePattern"===U&&R?io(ae,p,L,q,be):tl(ae,be)}else Z=ee.indexBuffer,G=ee.segments,H=R?ro(ae,p,L,q):no(ae);p.prepareDrawProgram(p.context,W,Q.toUnwrapped()),W.draw(p.context,F,y,p.stencilModeForClipping(Q),v,d.CullFaceMode.disabled,H,c.id,ee.layoutVertexBuffer,Z,G,c.paint,p.transform.zoom,re)}}function vn(p,i,c,m,y,v,D){const C=p.context,A=C.gl,R=c.paint.get("fill-extrusion-pattern"),L=R.constantOr(1),F=c.getCrossfadeParameters(),U=c.paint.get("fill-extrusion-opacity");for(const H of m){const Z=i.getTile(H),G=Z.getBucket(c);if(!G)continue;const Q=G.programConfigurations.get(c.id),q=p.useProgram(L?"fillExtrusionPattern":"fillExtrusion",Q);if(p.terrain){const ae=p.terrain;if(!G.enableTerrain)continue;if(ae.setupElevationDraw(Z,q,{useMeterToDem:!0}),ga(C,i,H,G,c,ae),!G.centroidVertexBuffer){const be=q.attributes.a_centroid_pos;void 0!==be&&A.vertexAttrib2f(be,0,0)}}L&&(p.context.activeTexture.set(A.TEXTURE0),Z.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Q.updatePaintBuffers(F));const ee=R.constantOr(null);if(ee&&Z.imageAtlas){const ae=Z.imageAtlas,be=ae.patternPositions[ee.to.toString()],xe=ae.patternPositions[ee.from.toString()];be&&xe&&Q.setConstantPatternPositions(be,xe)}const re=p.translatePosMatrix(H.projMatrix,Z,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),W=c.paint.get("fill-extrusion-vertical-gradient"),ie=L?tu(re,p,W,U,H,F,Z):el(re,p,W,U);p.prepareDrawProgram(C,q,H.toUnwrapped()),q.draw(C,C.gl.TRIANGLES,y,v,D,d.CullFaceMode.backCCW,ie,c.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,c.paint,p.transform.zoom,Q,p.terrain?G.centroidVertexBuffer:null)}}function ga(p,i,c,m,y,v){const D=[q=>{let ee=q.canonical.x-1,re=q.wrap;return ee<0&&(ee=(1<<q.canonical.z)-1,re--),new d.OverscaledTileID(q.overscaledZ,re,q.canonical.z,ee,q.canonical.y)},q=>{let ee=q.canonical.x+1,re=q.wrap;return ee===1<<q.canonical.z&&(ee=0,re++),new d.OverscaledTileID(q.overscaledZ,re,q.canonical.z,ee,q.canonical.y)},q=>new d.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,(0===q.canonical.y?1<<q.canonical.z:q.canonical.y)-1),q=>new d.OverscaledTileID(q.overscaledZ,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y===(1<<q.canonical.z)-1?0:q.canonical.y+1)],C=q=>{const ee=i.getSource().maxzoom,re=be=>{const xe=i.getTileByID(be);if(xe&&xe.hasData())return xe.getBucket(y)};let W,ie,ae;return(q.overscaledZ===q.canonical.z||q.overscaledZ>=ee)&&(W=re(q.key)),q.overscaledZ>=ee&&(ie=re(q.calculateScaledKey(q.overscaledZ+1))),q.overscaledZ>ee&&(ae=re(q.calculateScaledKey(q.overscaledZ-1))),W||ie||ae},A=[0,0,0],R=(q,ee)=>(A[0]=Math.min(q.min.y,ee.min.y),A[1]=Math.max(q.max.y,ee.max.y),A[2]=d.EXTENT-ee.min.x>q.max.x?ee.min.x-d.EXTENT:q.max.x,A),L=(q,ee)=>(A[0]=Math.min(q.min.x,ee.min.x),A[1]=Math.max(q.max.x,ee.max.x),A[2]=d.EXTENT-ee.min.y>q.max.y?ee.min.y-d.EXTENT:q.max.y,A),F=[(q,ee)=>R(q,ee),(q,ee)=>R(ee,q),(q,ee)=>L(q,ee),(q,ee)=>L(ee,q)],U=new d.pointGeometry(0,0);let H,Z,G;const Q=(q,ee,re,W,ie)=>{const ae=[[W?re:q,W?q:re,0],[W?re:ee,W?ee:re,0]],be=ie<0?d.EXTENT+ie:ie,xe=[W?be:(q+ee)/2,W?(q+ee)/2:be,0];return 0===re&&ie<0||0!==re&&ie>0?v.getForTilePoints(G,[xe],!0,Z):ae.push(xe),v.getForTilePoints(c,ae,!0,H),Math.max(ae[0][2],ae[1][2],xe[2])/v.exaggeration()};for(let q=0;q<4;q++){const ee=m.borders[q];if(0===ee.length&&(m.borderDone[q]=!0),m.borderDone[q])continue;const re=G=D[q](c),W=C(re);if(!(W&&W.enableTerrain&&(Z=v.findDEMTileFor(re),Z&&Z.dem)))continue;if(!H){const xe=v.findDEMTileFor(c);if(!xe||!xe.dem)return;H=xe}const ie=(q<2?1:5)-q,ae=W.borders[ie];let be=0;for(let xe=0;xe<ee.length;xe++){const Ce=m.featuresOnBorder[ee[xe]],Se=Ce.borders[q];let Ve;for(;be<ae.length&&(Ve=W.featuresOnBorder[ae[be]],!(Ve.borders[ie][1]>Se[0]+3));)W.borderDone[ie]||W.encodeCentroid(void 0,Ve,!1),be++;if(Ve&&be<ae.length){const we=be;let Ue=0;for(;!(Ve.borders[ie][0]>Se[1]-3)&&(Ue++,++be!==ae.length);)Ve=W.featuresOnBorder[ae[be]];if(Ve=W.featuresOnBorder[ae[we]],Ce.intersectsCount()>1||Ve.intersectsCount()>1||1!==Ue){1!==Ue&&(be=we),m.encodeCentroid(void 0,Ce,!1),W.borderDone[ie]||W.encodeCentroid(void 0,Ve,!1);continue}const ve=F[q](Ce,Ve),Ge=q%2?d.EXTENT-1:0;U.x=Q(ve[0],Math.min(d.EXTENT-1,ve[1]),Ge,q<2,ve[2]),U.y=0,m.encodeCentroid(U,Ce,!1),W.borderDone[ie]||W.encodeCentroid(U,Ve,!1)}else m.encodeCentroid(void 0,Ce,!1)}m.borderDone[q]=m.needsCentroidUpdate=!0,W.borderDone[ie]||(W.borderDone[ie]=W.needsCentroidUpdate=!0)}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&0!==m.centroidVertexArray.length)&&m.uploadCentroid(p)}const es=new d.Color(1,0,0,1),tt=new d.Color(0,1,0,1),Ss=new d.Color(0,0,1,1),_a=new d.Color(1,0,1,1),uc=new d.Color(0,1,1,1);function Oi(p,i,c,m){ts(p,0,i+c/2,p.transform.width,c,m)}function Zr(p,i,c,m){ts(p,i-c/2,0,c,p.transform.height,m)}function ts(p,i,c,m,y,v){const D=p.context,C=D.gl;C.enable(C.SCISSOR_TEST),C.scissor(i*d.exported.devicePixelRatio,c*d.exported.devicePixelRatio,m*d.exported.devicePixelRatio,y*d.exported.devicePixelRatio),D.clear({color:v}),C.disable(C.SCISSOR_TEST)}function Is(p,i,c){const m=p.context,y=m.gl,v=c.projMatrix,D=p.useProgram("debug"),C=i.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(C,D);const A=d.DepthMode.disabled,R=d.StencilMode.disabled,L=p.colorModeForRenderPass(),F="$debug";m.activeTexture.set(y.TEXTURE0),p.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),C._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const U=C._tileDebugBuffer||p.debugBuffer,H=C._tileDebugIndexBuffer||p.debugIndexBuffer,Z=C._tileDebugSegments||p.debugSegments;D.draw(m,y.LINE_STRIP,A,R,L,d.CullFaceMode.disabled,fa(v,d.Color.red),F,U,H,Z);const G=C.latestRawTileData,Q=Math.floor((G&&G.byteLength||0)/1024),q=i.getTile(c).tileSize,ee=512/Math.min(q,512)*(c.overscaledZ/p.transform.zoom)*.5;let re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(re+=` => ${c.overscaledZ}`),function(W,ie){W.initDebugOverlayCanvas();const ae=W.debugOverlayCanvas,be=W.context.gl,xe=W.debugOverlayCanvas.getContext("2d");xe.clearRect(0,0,ae.width,ae.height),xe.shadowColor="white",xe.shadowBlur=2,xe.lineWidth=1.5,xe.strokeStyle="white",xe.textBaseline="top",xe.font="bold 36px Open Sans, sans-serif",xe.fillText(ie,5,5),xe.strokeText(ie,5,5),W.debugOverlayTexture.update(ae),W.debugOverlayTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE)}(p,`${re} ${Q}kb`),D.draw(m,y.TRIANGLES,A,R,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,fa(v,d.Color.transparent,ee),F,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments)}const zi=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xn}=zi;function Bi(p,i,c,m){p.emplaceBack(i,c,m)}class ya{constructor(i){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,Bi(this.vertexArray,-1,-1,1),Bi(this.vertexArray,1,-1,1),Bi(this.vertexArray,-1,1,1),Bi(this.vertexArray,1,1,1),Bi(this.vertexArray,-1,-1,-1),Bi(this.vertexArray,1,-1,-1),Bi(this.vertexArray,-1,1,-1),Bi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,xn),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function br(p,i,c,m,y,v){const D=p.gl,C=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),R=i.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:d.fromMat4([],m),u_sun_direction:y,u_sun_intensity:R,u_color_tint_r:[(Z=C).r,Z.g,Z.b,Z.a],u_color_tint_m:[(G=A).r,G.g,G.b,G.a],u_luminance:5e-5};var Z,G;D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+v,i.skyboxTexture,0),c.draw(p,D.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,L,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const si={symbol:function(p,i,c,m,y){if("translucent"!==p.renderPass)return;const v=d.StencilMode.disabled,D=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(C,A,R,L,F,U,H){const Z=A.transform,G="map"===F,Q="map"===U;for(const q of C){const ee=L.getTile(q),re=ee.getBucket(R);if(!re||!re.text||!re.text.segments.get().length)continue;const W=d.evaluateSizeForZoom(re.textSizeData,Z.zoom),ie=A.transform.calculatePixelsToTileUnitsMatrix(ee),ae=Tt(q.projMatrix,Q,G,A.transform,ie),be="none"!==R.layout.get("icon-text-fit")&&re.hasIconData();if(W){const xe=Math.pow(2,Z.zoom-ee.tileID.overscaledZ),Ce=Z.elevation;An(re,G,Q,H,d.symbolSize,Z,ae,q.projMatrix,xe,W,be,Ce?Se=>Ce.getAtTileOffset(q,Se.x,Se.y):Se=>0)}}}(m,p,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),0!==c.paint.get("icon-opacity").constantOr(1)&&oi(p,i,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),v,D),0!==c.paint.get("text-opacity").constantOr(1)&&oi(p,i,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),v,D),i.map.showCollisionBoxes&&(Hr(p,i,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Hr(p,i,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,c,m){if("translucent"!==p.renderPass)return;const y=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),D=c.paint.get("circle-stroke-opacity"),C=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===y.constantOr(1)&&(0===v.constantOr(1)||0===D.constantOr(1)))return;const A=p.context,R=A.gl,L=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),F=d.StencilMode.disabled,U=p.colorModeForRenderPass(),H=[];for(let Z=0;Z<m.length;Z++){const G=m[Z],Q=i.getTile(G),q=Q.getBucket(c);if(!q)continue;const ee=q.programConfigurations.get(c.id),re=ac(c),W={programConfiguration:ee,program:p.useProgram("circle",ee,re),layoutVertexBuffer:q.layoutVertexBuffer,indexBuffer:q.indexBuffer,uniformValues:pi(p,G,Q,c),tile:Q};if(C){const ie=q.segments.get();for(const ae of ie)H.push({segments:new d.SegmentVector([ae]),sortKey:ae.sortKey,state:W})}else H.push({segments:q.segments,sortKey:0,state:W})}C&&H.sort((Z,G)=>Z.sortKey-G.sortKey);for(const Z of H){const{programConfiguration:G,program:Q,layoutVertexBuffer:q,indexBuffer:ee,uniformValues:re,tile:W}=Z.state,ie=Z.segments;p.terrain&&p.terrain.setupElevationDraw(W,Q,{useDepthForOcclusion:!0}),p.prepareDrawProgram(A,Q,W.tileID.toUnwrapped()),Q.draw(A,R.TRIANGLES,L,F,U,d.CullFaceMode.disabled,re,c.id,q,ee,ie,c.paint,p.transform.zoom,G)}},heatmap:function(p,i,c,m){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const y=p.context,v=y.gl,D=d.StencilMode.disabled,C=new d.ColorMode([v.ONE,v.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(A,R,L){const F=A.gl;A.activeTexture.set(F.TEXTURE1),A.viewport.set([0,0,R.width/4,R.height/4]);let U=L.heatmapFbo;if(U)F.bindTexture(F.TEXTURE_2D,U.colorAttachment.get()),A.bindFramebuffer.set(U.framebuffer);else{const H=F.createTexture();F.bindTexture(F.TEXTURE_2D,H),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),U=L.heatmapFbo=A.createFramebuffer(R.width/4,R.height/4,!1),function(Z,G,Q,q){const ee=Z.gl;ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,G.width/4,G.height/4,0,ee.RGBA,Z.extRenderToTextureHalfFloat?Z.extTextureHalfFloat.HALF_FLOAT_OES:ee.UNSIGNED_BYTE,null),q.colorAttachment.set(Q)}(A,R,H,U)}})(y,p,c),y.clear({color:d.Color.transparent});for(let A=0;A<m.length;A++){const R=m[A];if(i.hasRenderableParent(R))continue;const L=i.getTile(R),F=L.getBucket(c);if(!F)continue;const U=F.programConfigurations.get(c.id),H=p.useProgram("heatmap",U),{zoom:Z}=p.transform;p.terrain&&p.terrain.setupElevationDraw(L,H),p.prepareDrawProgram(y,H,R.toUnwrapped()),H.draw(y,v.TRIANGLES,d.DepthMode.disabled,D,C,d.CullFaceMode.disabled,oo(R.projMatrix,L,Z,c.paint.get("heatmap-intensity")),c.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,c.paint,p.transform.zoom,U)}y.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,v){const D=y.context,C=D.gl,A=v.heatmapFbo;if(!A)return;D.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),D.activeTexture.set(C.TEXTURE1);let R=v.colorRampTexture;R||(R=v.colorRampTexture=new d.Texture(D,v.colorRamp,C.RGBA)),R.bind(C.LINEAR,C.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(D,C.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,y.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:v.paint.get("heatmap-opacity")},v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(p,c))},line:function(p,i,c,m){if("translucent"!==p.renderPass)return;const y=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(0===y.constantOr(1)||0===v.constantOr(1))return;const D=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),C=p.colorModeForRenderPass(),A=c.paint.get("line-dasharray"),R=A.constantOr(1),L=c.layout.get("line-cap"),F=c.paint.get("line-pattern"),U=F.constantOr(1),H=c.paint.get("line-gradient"),Z=c.getCrossfadeParameters(),G=U?"linePattern":"line",Q=p.context,q=Q.gl;for(const ee of m){const re=i.getTile(ee);if(U&&!re.patternsLoaded())continue;const W=re.getBucket(c);if(!W)continue;p.prepareDrawTile(ee);const ie=W.programConfigurations.get(c.id),ae=ir(c),be=p.useProgram(G,ie,ae),xe=F.constantOr(null);if(xe&&re.imageAtlas){const Ue=re.imageAtlas,ve=Ue.patternPositions[xe.to.toString()],Ge=Ue.patternPositions[xe.from.toString()];ve&&Ge&&ie.setConstantPatternPositions(ve,Ge)}const Ce=A.constantOr(null),Se=L.constantOr(null);if(!U&&Ce&&Se&&re.lineAtlas){const Ue=re.lineAtlas,ve=Ue.getDash(Ce.to,Se),Ge=Ue.getDash(Ce.from,Se);ve&&Ge&&ie.setConstantPatternPositions(ve,Ge)}const Ve=p.terrain?ee.projMatrix:null,we=U?rl(p,re,c,Z,Ve):nu(p,re,c,Z,Ve,W.lineClipsArray.length);if(H){const Ue=W.gradients[c.id];let ve=Ue.texture;if(c.gradientVersion!==Ue.version){let Ge=256;if(c.stepInterpolant){const Je=i.getSource().maxzoom,lt=ee.canonical.z===Je?Math.ceil(1<<p.transform.maxZoom-ee.canonical.z):1;Ge=d.clamp(d.nextPowerOfTwo(W.maxLineLength/d.EXTENT*1024*lt),256,Q.maxTextureSize)}Ue.gradient=d.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ge,image:Ue.gradient||void 0,clips:W.lineClipsArray}),Ue.texture?Ue.texture.update(Ue.gradient):Ue.texture=new d.Texture(Q,Ue.gradient,q.RGBA),Ue.version=c.gradientVersion,ve=Ue.texture}Q.activeTexture.set(q.TEXTURE1),ve.bind(c.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}R&&(Q.activeTexture.set(q.TEXTURE0),re.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),ie.updatePaintBuffers(Z)),U&&(Q.activeTexture.set(q.TEXTURE0),re.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),ie.updatePaintBuffers(Z)),p.prepareDrawProgram(Q,be,ee.toUnwrapped()),be.draw(Q,q.TRIANGLES,D,p.stencilModeForClipping(ee),C,d.CullFaceMode.disabled,we,c.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,c.paint,p.transform.zoom,ie,W.layoutVertexBuffer2)}},fill:function(p,i,c,m){const y=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(0===v.constantOr(1))return;const D=p.colorModeForRenderPass(),C=c.paint.get("fill-pattern"),A=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&1===y.constantOr(d.Color.transparent).a&&1===v.constantOr(0)?"opaque":"translucent";if(p.renderPass===A){const R=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);fi(p,i,c,m,R,D,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const R=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);fi(p,i,c,m,R,D,!0)}},"fill-extrusion":function(p,i,c,m){const y=c.paint.get("fill-extrusion-opacity");if(0!==y&&"translucent"===p.renderPass){const v=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==y||c.paint.get("fill-extrusion-pattern").constantOr(1))vn(p,i,c,m,v,d.StencilMode.disabled,d.ColorMode.disabled),vn(p,i,c,m,v,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const D=p.colorModeForRenderPass();vn(p,i,c,m,v,d.StencilMode.disabled,D)}}},hillshade:function(p,i,c,m){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const y=p.context,v=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),D=p.colorModeForRenderPass(),C=p.terrain&&p.terrain.renderingToTexture,[A,R]="translucent"!==p.renderPass||C?[{},m]:p.stencilConfigForOverlap(m);for(const L of R){const F=i.getTile(L);if(F.needsHillshadePrepare&&"offscreen"===p.renderPass)ic(p,F,c,v,d.StencilMode.disabled,D);else if("translucent"===p.renderPass){const U=C&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):A[L.overscaledZ];to(p,L,F,c,v,U,D)}}y.viewport.set([0,0,p.width,p.height])},raster:function(p,i,c,m,y,v){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity")||!m.length)return;const D=p.context,C=D.gl,A=i.getSource(),R=p.useProgram("raster"),L=p.colorModeForRenderPass(),F=p.terrain&&p.terrain.renderingToTexture,[U,H]=A instanceof Y||F?[{},m]:p.stencilConfigForOverlap(m),Z=H[H.length-1].overscaledZ,G=!p.options.moving;for(const Q of H){const q=F?d.DepthMode.disabled:p.depthModeForSublayer(Q.overscaledZ-Z,1===c.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,C.LESS),ee=Q.toUnwrapped(),re=i.getTile(Q);if(F&&(!re||!re.hasData()))continue;const W=F?Q.projMatrix:p.transform.calculateProjMatrix(ee,G),ie=p.terrain&&F?p.terrain.stencilModeForRTTOverlap(Q):U[Q.overscaledZ],ae=v?0:c.paint.get("raster-fade-duration");re.registerFadeDuration(ae);const be=i.findLoadedParent(Q,0),xe=un(re,be,i,p.transform,ae);let Ce,Se;p.terrain&&p.terrain.prepareDrawTile(Q);const Ve="nearest"===c.paint.get("raster-resampling")?C.NEAREST:C.LINEAR;D.activeTexture.set(C.TEXTURE0),re.texture.bind(Ve,C.CLAMP_TO_EDGE),D.activeTexture.set(C.TEXTURE1),be?(be.texture.bind(Ve,C.CLAMP_TO_EDGE),Ce=Math.pow(2,be.tileID.overscaledZ-re.tileID.overscaledZ),Se=[re.tileID.canonical.x*Ce%1,re.tileID.canonical.y*Ce%1]):re.texture.bind(Ve,C.CLAMP_TO_EDGE);const we=Qo(W,Se||[0,0],Ce||1,xe,c);if(p.prepareDrawProgram(D,R,ee),A instanceof Y)R.draw(D,C.TRIANGLES,q,d.StencilMode.disabled,L,d.CullFaceMode.disabled,we,c.id,A.boundsBuffer,p.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:ve,tileBoundsSegments:Ge}=p.getTileBoundsBuffers(re);R.draw(D,C.TRIANGLES,q,ie,L,d.CullFaceMode.disabled,we,c.id,Ue,ve,Ge)}}},background:function(p,i,c,m){const y=c.paint.get("background-color"),v=c.paint.get("background-opacity");if(0===v)return;const D=p.context,C=D.gl,A=p.transform,R=A.tileSize,L=c.paint.get("background-pattern");if(p.isPatternMissing(L))return;const F=!L&&1===y.a&&1===v&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==F)return;const U=d.StencilMode.disabled,H=p.depthModeForSublayer(0,"opaque"===F?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),Z=p.colorModeForRenderPass(),G=p.useProgram(L?"backgroundPattern":"background");let Q,q=m;q||(Q=p.getBackgroundTiles(),q=Object.values(Q).map(re=>re.tileID)),L&&(D.activeTexture.set(C.TEXTURE0),p.imageManager.bind(p.context));const ee=c.getCrossfadeParameters();for(const re of q){const W=re.toUnwrapped(),ie=m?re.projMatrix:p.transform.calculateProjMatrix(W);p.prepareDrawTile(re);const ae=i?i.getTile(re):Q?Q[re.key]:new d.Tile(re,R,A.zoom,p),be=L?Cs(ie,v,p,L,{tileID:re,tileSize:R},ee):cc(ie,v,y);p.prepareDrawProgram(D,G,W);const{tileBoundsBuffer:xe,tileBoundsIndexBuffer:Ce,tileBoundsSegments:Se}=p.getTileBoundsBuffers(ae);G.draw(D,C.TRIANGLES,H,U,Z,d.CullFaceMode.disabled,be,c.id,xe,Ce,Se)}},sky:function(p,i,c){const m=p.transform,y="mercator"===m.projection.name?1:d.smoothstep(7,8,m.zoom),v=c.paint.get("sky-opacity")*y;if(0===v)return;const D=p.context,C=c.paint.get("sky-type"),A=new d.DepthMode(D.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),R=p.frameCounter/1e3%1;"atmosphere"===C?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(L,F,U,H){const Z=L.context,G=Z.gl;let Q=F.skyboxFbo;if(!Q){Q=F.skyboxFbo=Z.createFramebuffer(32,32,!1),F.skyboxGeometry=new ya(Z),F.skyboxTexture=Z.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,F.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let W=0;W<6;++W)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+W,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(Q.framebuffer),Z.viewport.set([0,0,32,32]);const q=F.getCenter(L,!0),ee=L.useProgram("skyboxCapture"),re=new Float64Array(16);d.identity(re),d.rotateY(re,re,.5*-Math.PI),br(Z,F,ee,re,q,0),d.identity(re),d.rotateY(re,re,.5*Math.PI),br(Z,F,ee,re,q,1),d.identity(re),d.rotateX(re,re,.5*-Math.PI),br(Z,F,ee,re,q,2),d.identity(re),d.rotateX(re,re,.5*Math.PI),br(Z,F,ee,re,q,3),d.identity(re),br(Z,F,ee,re,q,4),d.identity(re),d.rotateY(re,re,Math.PI),br(Z,F,ee,re,q,5),Z.viewport.set([0,0,L.width,L.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,F,U,H,Z){const G=L.context,Q=G.gl,q=L.transform,ee=L.useProgram("skybox");G.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,F.skyboxTexture);const re={u_matrix:q.skyboxMatrix,u_sun_direction:F.getCenter(L,!1),u_cubemap:0,u_opacity:H,u_temporal_offset:Z};L.prepareDrawProgram(G,ee),ee.draw(G,Q.TRIANGLES,U,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,re,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,c,A,v,R):"gradient"===C&&"sky"===p.renderPass&&function(L,F,U,H,Z){const G=L.context,Q=G.gl,q=L.transform,ee=L.useProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new ya(G)),G.activeTexture.set(Q.TEXTURE0);let re=F.colorRampTexture;re||(re=F.colorRampTexture=new d.Texture(G,F.colorRamp,Q.RGBA)),re.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const W=(ie=q.skyboxMatrix,ae=F.getCenter(L,!1),be=F.paint.get("sky-gradient-radius"),xe=H,Ce=Z,{u_matrix:ie,u_color_ramp:0,u_center_direction:ae,u_radius:d.degToRad(be),u_opacity:xe,u_temporal_offset:Ce});var ie,ae,be,xe,Ce;L.prepareDrawProgram(G,ee),ee.draw(G,Q.TRIANGLES,U,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,W,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(p,c,A,v,R)},debug:function(p,i,c){for(let m=0;m<c.length;m++)Is(p,i,c[m])},custom:function(p,i,c){const m=p.context,y=c.implementation;if("mercator"===p.transform.projection.name){if("offscreen"===p.renderPass){const v=y.prerender;v&&(p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),v.call(y,m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),m.setColorMode(p.colorModeForRenderPass()),m.setStencilMode(d.StencilMode.disabled);const v="3d"===y.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);m.setDepthMode(v),y.render(m.gl,p.transform.customLayerMatrix()),m.setDirty(),p.setBaseState(),m.bindFramebuffer.set(null)}}else d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.")}};class hc{constructor(i,c){this.context=new Ya(i),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Jc,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,c){const m=!!i&&!!i.terrain&&"mercator"===this.transform.projection.name;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Jo(this,i));const y=this._terrain;this.transform.elevation=m?y:null,y.update(i,this.transform,c)}_updateFog(i){const c=i.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=c.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const v=m+.78*(y-m);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,c){if(this.width=i*d.exported.devicePixelRatio,this.height=c*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const i=this.context,c=new d.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(d.EXTENT,0),c.emplaceBack(0,d.EXTENT),c.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(c,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const m=new d.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(d.EXTENT,0),m.emplaceBack(0,d.EXTENT),m.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(m,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const y=new d.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const v=new d.StructArrayLayout4i8;v.emplaceBack(0,0,0,0),v.emplaceBack(d.EXTENT,0,d.EXTENT,0),v.emplaceBack(0,d.EXTENT,0,d.EXTENT),v.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(v,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const D=new d.StructArrayLayout3ui6;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(D);const C=new d.StructArrayLayout1ui2;for(const R of[0,1,3,2,0])C.emplaceBack(R);this.debugIndexBuffer=i.createIndexBuffer(C),this.emptyTexture=new d.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA),this.identityMat=d.create$1();const A=this.context.gl;this.stencilClearMode=new d.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(d.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,c=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(i,c.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,sc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,c,m){if(!(c&&this.currentStencilSource!==c.id&&i.isTileClipped()&&m&&m.length))return;this.currentStencilSource=c.id;const y=this.context,v=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(d.ColorMode.disabled),y.setDepthMode(d.DepthMode.disabled);const D=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of m){const A=c.getTile(C),R=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:U}=this.getTileBoundsBuffers(A);D.draw(y,v.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,sc(C.projMatrix),"$clipping",L,F,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new d.StencilMode({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new d.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,m=i.sort((D,C)=>C.overscaledZ-D.overscaledZ),y=m[m.length-1].overscaledZ,v=m[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const D={};for(let C=0;C<v;C++)D[C+y]=new d.StencilMode({func:c.GEQUAL,mask:255},C+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[D,m]}return[{[y]:d.StencilMode.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new d.ColorMode([i.CONSTANT_COLOR,i.ONE],new d.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(i,c,m){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new d.DepthMode(m||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,c){this.style=i,this.options=c,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const R in y){const L=y[R];L.used&&L.prepare(this.context)}const v={},D={},C={};for(const R in y){const L=y[R];v[R]=L.getVisibleCoordinates(),D[R]=v[R].slice().reverse(),C[R]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<m.length;R++)if(this.style._layers[m[R]].is3D()){this.opaquePassCutoff=R;break}if(this.terrain&&(this.terrain.updateTileBinding(C),this.opaquePassCutoff=0),!d.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const R of m){const L=this.style._layers[R],F=i._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const U=F?D[F.id]:void 0;("custom"===L.type||L.isSky()||U&&U.length)&&this.renderLayer(this,F,L,U)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let A=d.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(A=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?d.Color.black:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[m[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky())continue;const F=L?D[L.id]:void 0;this._renderTileClippingMasks(R,L,F),this.renderLayer(this,L,R,F)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const R=this.style._layers[m[this.currentLayer]],L=i._getLayerSourceCache(R);R.isSky()&&this.renderLayer(this,L,R,L?D[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const R=this.style._layers[m[this.currentLayer]],L=i._getLayerSourceCache(R);if(R.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(R)){if(R.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=L?("symbol"===R.type?C:D)[L.id]:void 0;this._renderTileClippingMasks(R,L,L?v[L.id]:void 0),this.renderLayer(this,L,R,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let R=null;d.values(this.style._layers).forEach(L=>{const F=i._getLayerSourceCache(L);F&&!L.isHidden(this.transform.zoom)&&(!R||R.getSource().maxzoom<F.getSource().maxzoom)&&(R=F)}),R&&this.options.showTileBoundaries&&si.debug(this,R,R.getVisibleCoordinates())}this.options.showPadding&&function(R){const L=R.transform.padding;Oi(R,R.transform.height-(L.top||0),3,es),Oi(R,L.bottom||0,3,tt),Zr(R,L.left||0,3,Ss),Zr(R,R.transform.width-(L.right||0),3,_a);const F=R.transform.centerPoint;var U,H,Z,G;ts(U=R,(H=F.x)-1,(Z=R.transform.height-F.y)-10,2,20,G=uc),ts(U,H-10,Z-1,20,2,G)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%d.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,c,m,y){m.isHidden(this.transform.zoom)||("background"===m.type||"sky"===m.type||"custom"===m.type||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),si[m.type](i,c,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[i.id];m||(m=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}queryGpuTimers(i){const c={};for(const m in i){const y=i[m],v=this.context.extTimerQuery,D=v.getQueryObjectEXT(y.query,v.QUERY_RESULT_EXT)/1e6;v.deleteQueryEXT(y.query),c[m]=D}return c}translatePosMatrix(i,c,m,y,v){if(!m[0]&&!m[1])return i;const D=v?"map"===y?this.transform.angle:0:"viewport"===y?-this.transform.angle:0;if(D){const R=Math.sin(D),L=Math.cos(D);m=[m[0]*L-m[1]*R,m[0]*R+m[1]*L]}const C=[v?m[0]:cr(c,m[0],this.transform.zoom),v?m[1]:cr(c,m[1],this.transform.zoom),0],A=new Float32Array(16);return d.translate(A,i,C),A}saveTileTexture(i){const c=this._tileTextures[i.size[0]];c?c.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const c=this.imageManager.getPattern(i.from.toString()),m=this.imageManager.getPattern(i.to.toString());return!c||!m}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,m=[];return this.terrain&&!this.terrain.renderingToTexture&&m.push("TERRAIN"),c&&!i&&0!==c.getOpacity(this.transform.pitch)&&m.push("FOG"),i&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}useProgram(i,c,m){this.cache=this.cache||{};const y=m||[],v=this.currentGlobalDefines().concat(y),D=Ts.cacheKey(i,v,c);return this.cache[D]||(this.cache[D]=new Ts(this.context,i,rc[i],c,Rr[i],v)),this.cache[D]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(i){this.terrain&&this.terrain.prepareDrawTile(i)}prepareDrawProgram(i,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const v=y.getOpacity(this.transform.pitch);0!==v&&c.setFogUniformValues(i,((D,C,A,R)=>{const L=C.properties.get("color"),F=D.frameCounter/1e3%1,U=[L.r/L.a,L.g/L.a,L.b/L.a,R];return{u_fog_matrix:A?D.transform.calculateFogTileMatrix(A):D.identityMat,u_fog_range:C.getFovAdjustedRange(D.transform._fov),u_fog_color:U,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:F}})(this,y,m,v))}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)c[y.key]=i[y.key]||new d.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Do{constructor(i=0,c=0,m=0,y=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=m,this.right=y}interpolate(i,c,m){return null!=c.top&&null!=i.top&&(this.top=d.number(i.top,c.top,m)),null!=c.bottom&&null!=i.bottom&&(this.bottom=d.number(i.bottom,c.bottom,m)),null!=c.left&&null!=i.left&&(this.left=d.number(i.left,c.left,m)),null!=c.right&&null!=i.right&&(this.right=d.number(i.right,c.right,m)),this}getCenter(i,c){const m=d.clamp((this.left+i-this.right)/2,0,i),y=d.clamp((this.top+c-this.bottom)/2,0,c);return new d.pointGeometry(m,y)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Do(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ni(p,i){return[p[4*i],p[4*i+1],p[4*i+2],p[4*i+3]]}function Un(p,i,c){p[4*i+0]=c[0],p[4*i+1]=c[1],p[4*i+2]=c[2],p[4*i+3]=c[3]}function dc(p,i){const c=Ni(p,3);d.fromQuat(p,i),Un(p,3,c)}function mh(p,i){Un(p,3,[i[0],i[1],i[2],1])}function pc(p,i){const c=d.identity$1([]);return d.rotateZ$1(c,c,-i),d.rotateX$1(c,c,-p),c}function ns(p,i){const c=[p[0],p[1],0],m=[i[0],i[1],0];if(d.length(c)>=1e-15){const D=d.normalize([],c);d.scale(m,D,d.dot(m,D)),i[0]=m[0],i[1]=m[1]}const y=d.cross([],i,p);if(d.len(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return pc(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}class gh{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){this._position=this._renderWorldCopies?function(c){if(!c)return;const m=Array.isArray(c)?new d.MercatorCoordinate(c[0],c[1],c[2]):c;return m.x=d.wrap(m.x,0,1),m}(i):i}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(i)):0,y=this.position,v=d.MercatorCoordinate.fromLngLat(i,m),D=[v.x-y.x,v.y-y.y,v.z-y.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ns(D,c)}setPitchBearing(i,c){this.orientation=pc(d.degToRad(i),d.degToRad(-c))}}class sl{constructor(i,c){this._transform=d.identity([]),this._orientation=d.identity$1([]),c&&(this._orientation=c,dc(this._transform,this._orientation)),i&&mh(this._transform,i)}get mercatorPosition(){const i=this.position;return new d.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=Ni(this._transform,3);return[i[0],i[1],i[2]]}set position(i){mh(this._transform,i)}get orientation(){return this._orientation}set orientation(i){this._orientation=i,dc(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=pc(i,c),dc(this._transform,this._orientation)}forward(){const i=Ni(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=Ni(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=Ni(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const m=new Float64Array(16);return d.invert(m,this.getWorldToCamera(i,c)),m}getWorldToCameraPosition(i,c,m){const y=this.position;d.scale(y,y,-i);const v=new Float64Array(16);return d.fromScaling(v,[m,m,m]),d.translate(v,v,y),v[10]*=c,v}getWorldToCamera(i,c){const m=new Float64Array(16),y=new Float64Array(4),v=this.position;return d.conjugate(y,this._orientation),d.scale(v,v,-i),d.fromQuat(m,y),d.translate(m,m,v),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(i,c,m,y){const v=new Float64Array(16);return d.perspective(v,i,c,m,y),v}getDistanceToElevation(i){const c=0===i?0:d.mercatorZfromAltitude(i,this.position[1]),m=this.forward();return(c-this.position[2])/m[2]}clone(){return new sl([...this.position],[...this.orientation])}}function ru(p,i){const c=_h(p),m=function(v,D,C,A,R){const L=new d.LngLat(C.lng-180*va,C.lat),F=new d.LngLat(C.lng+180*va,C.lat),U=v.project(L.lng,L.lat),H=v.project(F.lng,F.lat),Z=-Math.atan2(H.y-U.y,H.x-U.x),G=d.MercatorCoordinate.fromLngLat(C);G.y=d.clamp(G.y,-.999975,.999975);const Q=G.toLngLat(),q=v.project(Q.lng,Q.lat),ee=d.MercatorCoordinate.fromLngLat(Q);ee.x+=va;const re=ee.toLngLat(),W=v.project(re.lng,re.lat),ie=jd(W.x-q.x,W.y-q.y,Z),ae=d.MercatorCoordinate.fromLngLat(Q);ae.y+=va;const be=ae.toLngLat(),xe=v.project(be.lng,be.lat),Ce=jd(xe.x-q.x,xe.y-q.y,Z),Se=Math.abs(ie.x)/Math.abs(Ce.y),Ve=d.identity([]);d.rotateZ(Ve,Ve,-Z*(1-(R?0:A)));const we=d.identity([]);return d.scale$1(we,we,[1,1-(1-Se)*A,1]),we[4]=-Ce.x/Ce.y*A,d.rotateZ(we,we,Z),d.multiply(we,Ve,we),we}(p.projection,0,p.center,c,i),y=fc(p);return d.scale$1(m,m,[y,y,1]),m}function fc(p){const i=p.projection,c=_h(p),m=xa(i,p.center),y=xa(i,d.LngLat.convert(i.center));return Math.pow(2,m*c+(1-c)*y)}function _h(p){const i=p.projection.range;if(!i)return 0;const c=Math.max(p.width,p.height),m=Math.log(c/1024)/Math.LN2;return d.smoothstep(i[0]+m,i[1]+m,p.zoom)}const va=1/4e4;function xa(p,i){const c=d.clamp(i.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=new d.LngLat(i.lng-180*va,c),y=new d.LngLat(i.lng+180*va,c),v=p.project(m.lng,c),D=p.project(y.lng,c),C=d.MercatorCoordinate.fromLngLat(m),A=d.MercatorCoordinate.fromLngLat(y),R=D.x-v.x,L=D.y-v.y,F=A.x-C.x,U=A.y-C.y,H=Math.sqrt((F*F+U*U)/(R*R+L*L));return Math.log(H)/Math.LN2}function jd(p,i,c){const m=Math.cos(c),y=Math.sin(c);return{x:p*m-i*y,y:p*y+i*m}}class yh{constructor(i,c,m,y,v){this.tileSize=512,this._renderWorldCopies=void 0===v||v,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=null==m?0:m,this._maxPitch=null==y?60:y,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Do,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new sl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const i=new yh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i.tileSize=this.tileSize,i.setMaxBounds(this.getMaxBounds()),i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._cameraZoom=this._cameraZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.setProjection(this.getProjection()),i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,i?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(i){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),i&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(i){null==i&&(i={name:"mercator"}),this.projectionOptions=i;const c=this.projection?this.getProjection():void 0;return this.projection=d.getProjection(i),!Ie(c,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.wrap}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;var m,y,v,D,C,A,R,L,F,U;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),y=this.rotationMatrix,D=this.angle,C=(v=this.rotationMatrix)[0],A=v[1],R=v[2],L=v[3],F=Math.sin(D),U=Math.cos(D),y[0]=C*U+R*F,y[1]=A*U+L*F,y[2]=C*-F+R*U,y[3]=A*-F+L*U)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const i=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===i?(this._cameraZoom=null,!1):(this._centerAltitude=i,!0)}_updateCameraOnTerrain(){const i=this.cameraToCenterDistance/this.worldSize,c=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(c+i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,v=0;for(let D=0;D<c.length;D++){const C=new d.pointGeometry(c[D][0]*this.width,m+c[D][1]*(this.height-m)),A=i.pointCoordinate(C);if(!A)continue;const R=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);y+=A[3]*R,v+=R}return 0===v?NaN:y/v}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const i=this._cameraZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=d.mercatorZfromAltitude(c,this.center.lat),y=this._mercatorZfromZoom(i),v=this._mercatorZfromZoom(this._maxZoom),D=Math.max(y-m,v);this._setZoom(this._zoomFromMercatorZ(D))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const y=d.length(d.sub([],this._camera.position,m));return d.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!d.exactEquals(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];d.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new gh;return c.position=new d.MercatorCoordinate(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!d.length$1(i))return!1;d.normalize$1(i,i);const c=d.transformQuat([],[0,0,-1],i),m=d.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const y=ns(c,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;i[2]=d.clamp(i[2],y/m,y/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,m){this._unmodified=!1,this._edgeInsets.interpolate(i,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new d.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new d.pointGeometry(0,0)),y=this.pointCoordinate(new d.pointGeometry(this.width,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),D=this.pointCoordinate(new d.pointGeometry(0,this.height)),C=Math.floor(Math.min(m.x,y.x,v.x,D.x)),A=Math.floor(Math.max(m.x,y.x,v.x,D.x)),R=1;for(let L=C-R;L<=A+R;L++)0!==L&&c.push(new d.UnwrappedTileID(L,i))}return c}coveringTiles(i){let c=this.coveringZoomLevel(i);const m=c,y=this.elevation&&!i.isTerrainDEM,v="mercator"===this.projection.name;if(void 0!==i.minzoom&&c<i.minzoom)return[];void 0!==i.maxzoom&&c>i.maxzoom&&(c=i.maxzoom);const D=this.locationCoordinate(this.center),C=1<<c,A=[C*D.x,C*D.y,0],R=ni.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),L=this.pointCoordinate(this.getCameraPoint()),F=C*d.mercatorZfromAltitude(1,this.center.lat),U=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),H=[C*L.x,C*L.y,U],Z=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),G=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&v?c:0,Q=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,q=i.isTerrainDEM?-Q:this._elevation?this._elevation.getMinElevationBelowMSL():0,ee=fc(this),re=ve=>{const Ge=1/4e4,Je=new d.MercatorCoordinate(ve.x+Ge,ve.y,ve.z),lt=new d.MercatorCoordinate(ve.x,ve.y+Ge,ve.z),ht=ve.toLngLat(),dt=Je.toLngLat(),pt=lt.toLngLat(),st=this.locationCoordinate(ht),ft=this.locationCoordinate(dt),qt=this.locationCoordinate(pt),$n=Math.hypot(ft.x-st.x,ft.y-st.y),Qn=Math.hypot(qt.x-st.x,qt.y-st.y);return Math.sqrt($n*Qn)*ee/Ge},W=(ve,Ge,Je,lt,ht,dt)=>{const pt=d.tileTransform({z:ve,x:Ge,y:Je},this.projection);return new bi([(lt+pt.x/pt.scale)*C,C*(pt.y/pt.scale),ht],[(lt+pt.x2/pt.scale)*C,C*(pt.y2/pt.scale),dt])},ie=ve=>({aabb:W(0,0,0,ve,q,Q),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),ae=[];let be=[];const xe=c,Ce=i.reparseOverscaled?m:c,Se=ve=>{if(!this._elevation||!ve.tileID)return;const Ge=this._elevation.getMinMaxForTile(ve.tileID),Je=ve.aabb;Ge?(Je.min[2]=Ge.min,Je.max[2]=Ge.max,Je.center[2]=(Je.min[2]+Je.max[2])/2):(ve.shouldSplit=Ue(ve),ve.shouldSplit||(Je.min[2]=Je.max[2]=Je.center[2]=this._centerAltitude))},Ve=ve=>ve*ve,we=Ve((U-this._centerAltitude)*F),Ue=ve=>{if(ve.zoom<G)return!0;if(ve.zoom===xe)return!1;if(null!=ve.shouldSplit)return ve.shouldSplit;const Ge=ve.aabb.distanceX(H),Je=ve.aabb.distanceY(H);let lt=we;y&&(lt=Ve(ve.aabb.distanceZ(H)*F));let ht=1;if(!v&&m<=5){const pt=Math.pow(2,ve.zoom),st=re(new d.MercatorCoordinate((ve.x+.5)/pt,(ve.y+.5)/pt));ht=st>.85?1:st}const dt=Ge*Ge+Je*Je+lt;return dt<Ve((1<<xe-ve.zoom)*Z*ht*((pt,st)=>{if(st*Ve(.707)<pt)return 1;const ft=Math.sqrt(st/pt);return ft/(1.4144271570014144+(Math.pow(1.1,ft-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(lt,we),dt))};if(this.renderWorldCopies)for(let ve=1;ve<=3;ve++)ae.push(ie(-ve)),ae.push(ie(ve));for(ae.push(ie(0));ae.length>0;){const ve=ae.pop(),Ge=ve.x,Je=ve.y;let lt=ve.fullyVisible;if(!lt){const ht=ve.aabb.intersects(R);if(0===ht)continue;lt=2===ht}if(ve.zoom!==xe&&Ue(ve))for(let ht=0;ht<4;ht++){const dt=(Ge<<1)+ht%2,pt=(Je<<1)+(ht>>1),st={aabb:"mercator"===this.projection.name?ve.aabb.quadrant(ht):W(ve.zoom+1,dt,pt,ve.wrap,0,0),zoom:ve.zoom+1,x:dt,y:pt,wrap:ve.wrap,fullyVisible:lt,tileID:void 0,shouldSplit:void 0};y&&(st.tileID=new d.OverscaledTileID(ve.zoom+1===xe?Ce:ve.zoom+1,ve.wrap,ve.zoom+1,dt,pt),Se(st)),ae.push(st)}else{const ht=ve.zoom===xe?Ce:ve.zoom;if(i.minzoom&&i.minzoom>ht)continue;const dt=A[0]-(.5+Ge+(ve.wrap<<ve.zoom))*(1<<c-ve.zoom),pt=A[1]-.5-Je,st=ve.tileID?ve.tileID:new d.OverscaledTileID(ht,ve.wrap,ve.zoom,Ge,Je);be.push({tileID:st,distanceSq:dt*dt+pt*pt})}}if(this.fogCullDistSq){const ve=this.fogCullDistSq,Ge=this.horizonLineFromTop();be=be.filter(Je=>{const lt=[0,0,0,1],ht=[d.EXTENT,d.EXTENT,0,1],dt=this.calculateFogTileMatrix(Je.tileID.toUnwrapped());d.transformMat4(lt,lt,dt),d.transformMat4(ht,ht,dt);const pt=d.getAABBPointSquareDist(lt,ht);if(0===pt)return!0;let st=!1;const ft=this._elevation;if(ft&&pt>ve&&0!==Ge){const qt=this.calculateProjMatrix(Je.tileID.toUnwrapped());let $n;i.isTerrainDEM||($n=ft.getMinMaxForTile(Je.tileID)),$n||($n={min:q,max:Q});const Qn=d.furthestTileCorner(this.rotation),Dr=[Qn[0]*d.EXTENT,Qn[1]*d.EXTENT,$n.max];d.transformMat4$1(Dr,Dr,qt),st=(1-Dr[1])*this.height*.5<Ge}return pt<ve||st})}return be.sort((ve,Ge)=>ve.distanceSq-Ge.distanceSq).map(ve=>ve.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const c=d.clamp(i.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),m=this.projection.project(i.lng,c);return new d.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,c){const m=this.pointCoordinate(c),y=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(i);this.setLocation(new d.MercatorCoordinate(v.x-(m.x-y.x),v.y-(m.y-y.y)))}setLocation(i){this.center=this.coordinateLocation(i),this.renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i){return this._coordinatePoint(this.locationCoordinate(i),!1)}locationPoint3D(i){return this._coordinatePoint(this.locationCoordinate(i),!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,c){const m=c?d.mercatorZfromAltitude(c,i.lat):void 0,y=this.projection.project(i.lng,i.lat);return new d.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const m=null!=c?c:this._centerAltitude,y=[i.x,i.y,0,1],v=[i.x,i.y,1,1];d.transformMat4(y,y,this.pixelMatrixInverse),d.transformMat4(v,v,this.pixelMatrixInverse);const D=v[3];d.scale$2(y,y,1/y[3]),d.scale$2(v,v,1/D);const C=y[2],A=v[2];return{p0:y,p1:v,t:C===A?0:(m-C)/(A-C)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return d.transformMat4(c,c,this.pixelMatrixInverse),d.transformMat4(m,m,this.pixelMatrixInverse),d.scale$2(c,c,1/c[3]),d.scale$2(m,m,1/m[3]),c[2]=d.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=d.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,d.scale$2(c,c,1/this.worldSize),d.scale$2(m,m,1/this.worldSize),new Vo([c[0],c[1],c[2]],d.normalize([],d.sub([],m,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:m,t:y}=i,v=d.mercatorZfromAltitude(c[2],this._center.lat),D=d.mercatorZfromAltitude(m[2],this._center.lat);return new d.MercatorCoordinate(d.number(c[0],m[0],y)/this.worldSize,d.number(c[1],m[1],y)/this.worldSize,d.number(v,D,y))}pointCoordinate(i,c=this._centerAltitude){const m=this.horizonLineFromTop(!1),y=new d.pointGeometry(i.x,Math.max(m,i.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(y,c))}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);const c=this.elevation;let m=this.elevation.pointCoordinate(i);if(m)return new d.MercatorCoordinate(m[0],m[1],m[2]);let y=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);const D=.02*v,C=i.clone();for(let A=0;A<10&&v-y>D;A++){C.y=d.number(y,v,.66);const R=c.pointCoordinate(C);R?(v=C.y,m=R):y=C.y}return m?new d.MercatorCoordinate(m[0],m[1],m[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){if(this.elevation)return!this.elevation.pointCoordinate(i);{const c=this.horizonLineFromTop();return i.y<c}}_coordinatePoint(i,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,y=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return d.transformMat4(y,y,this.pixelMatrix),y[3]>0?new d.pointGeometry(y[0]/y[3],y[1]/y[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,c){const m=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),y=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),D=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let C=this.pointCoordinate(m,i),A=this.pointCoordinate(y,i);const R=this.pointCoordinate(v,c),L=this.pointCoordinate(D,c),F=(U,H)=>(H.y-U.y)/(H.x-U.x);return C.y>1&&A.y>=0?C=new d.MercatorCoordinate((1-L.y)/F(L,C)+L.x,1):C.y<0&&A.y<=1&&(C=new d.MercatorCoordinate(-L.y/F(L,C)+L.x,0)),A.y>1&&C.y>=0?A=new d.MercatorCoordinate((1-R.y)/F(R,A)+R.x,1):A.y<0&&C.y<=1&&(A=new d.MercatorCoordinate(-R.y/F(R,A)+R.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(C)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(R))}_getBounds3D(){const i=this.elevation,c=i.visibleDemTiles.reduce((m,y)=>{if(y.dem){const v=y.dem.tree;m.min=Math.min(m.min,v.minimums[0]),m.max=Math.max(m.max,v.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){let m,y,v;const D=i.canonical,C=d.identity(new Float64Array(16));if("mercator"===this.projection.name)m=c/this.zoomScale(D.z),y=(D.x+Math.pow(2,D.z)*i.wrap)*m,v=D.y*m;else{const A=d.tileTransform(D,this.projection);m=1,y=A.x+i.wrap*A.scale,v=A.y,d.scale$1(C,C,[m/A.scale,m/A.scale,this.pixelsPerMeter/this.worldSize])}return d.translate(C,C,[y,v,0]),d.scale$1(C,C,[m/d.EXTENT,m/d.EXTENT,1]),C}calculateDistanceTileData(i){const c=i.key,m=this._distanceTileDataCache;if(m[c])return m[c];const y=i.canonical,v=1/this.height,D=this.cameraWorldSize/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*i.wrap)*D,A=y.y*D,R=this.point,L=this.angle,F=Math.sin(-L),U=-Math.cos(-L);return m[c]={bearing:[F,U],center:[(R.x-C)*v,(R.y-A)*v],scale:D/d.EXTENT*v},m[c]}calculateFogTileMatrix(i){const c=i.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const y=this.calculatePosMatrix(i,this.cameraWorldSize);return d.multiply(y,this.worldToFogMatrix,y),m[c]=new Float32Array(y),m[c]}calculateProjMatrix(i,c=!1){const m=i.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const v=this.calculatePosMatrix(i,this.worldSize);return d.multiply(v,"mercator"===this.projection.name?c?this.alignedProjMatrix:this.projMatrix:this.mercatorMatrix,v),y[m]=new Float32Array(v),y[m]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const y=function(v,D){const{scale:C}=v.tileTransform,A=C*d.EXTENT/(v.tileSize*Math.pow(2,D.zoom-v.tileID.overscaledZ+v.tileID.canonical.z));return R=new Float32Array(4),U=(L=D.inverseAdjustmentMatrix)[1],H=L[2],Z=L[3],Q=(F=[A,A])[1],R[0]=L[0]*(G=F[0]),R[1]=U*G,R[2]=H*Q,R[3]=Z*Q,R;var R,L,F,U,H,Z,G,Q}(i,this);return m[c]=y,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const c=this._camera.position,m=this._camera.forward();if(c[2]<=0||m[2]>=0)return;const y=d.mercatorZfromAltitude(1,this._center.lat);c[2]/=y,m[2]/=y,d.normalize(m,m);const v=i.raycast(c,m,i.exaggeration());if(v){const D=d.scaleAndAdd([],c,m,v),C=new d.MercatorCoordinate(D[0],D[1],d.mercatorZfromAltitude(D[2],d.latFromMercatorY(D[1]))),A=this._camera.position,R=C.z+d.length([C.x-A[0],C.y-A[1],C.z-A[2]]);this._cameraZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const c=i.getAtPointOrZero(this._camera.mercatorPosition),m=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),y=d.mercatorZfromAltitude(c,this._center.lat),v=this._camera.position[2]-y;if(v<m){const D=this.locationCoordinate(this._center,this._centerAltitude),C=this._camera.mercatorPosition,A=[D.x-C.x,D.y-C.y,D.z-C.z],R=d.length(A);A[2]-=m-v;const L=d.length(A);if(0===L)return;d.scale(A,A,R/L),this._camera.position=[D.x-A[0],D.y-A[1],D.z-A[2]],this._camera.orientation=ns(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,"mercator"!==this.projection.name){const F=this.center;return F.lat=d.clamp(F.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(F.lng=d.clamp(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const i=this._unmodified,{x:c,y:m}=this.point;let y=0,v=c,D=m;const C=this.width/2,A=this.height/2,R=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(m-A<R&&(D=R+A),m+A>L&&(D=L-A),L-R<this.height&&(y=Math.max(y,this.height/(L-R)),D=(L+R)/2),this.maxBounds||!this.renderWorldCopies){const F=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,H=this.worldSize/2-(F+U)/2;v=(c+H+this.worldSize)%this.worldSize-H,v-C<F&&(v=F+C),v+C>U&&(v=U-C),U-F<this.width&&(y=Math.max(y,this.width/(U-F)),v=(U+F)/2)}v===c&&D===m||(this.center=this.unproject(new d.pointGeometry(v,D))),y&&(this.zoom+=this.scaleZoom(y)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=this.pixelsPerMeter;this._updateCameraState();const m=Math.PI/2+this._pitch,y=this.fovAboveCenter,v=this.elevation?this.elevation.getMinElevationBelowMSL()*c:0,D=(this._camera.position[2]*this.worldSize-v)/Math.cos(this._pitch),C=Math.sin(y)*D/Math.sin(d.clamp(Math.PI-m-y,.01,Math.PI-.01)),A=this.point,R=A.x,L=A.y,F=Math.cos(Math.PI/2-this._pitch)*C+D,U=Math.min(1.01*F,D*(1/this._horizonShift)),H=this.height/50,Z=this._camera.getWorldToCamera(this.worldSize,c),G=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,H,U);G[8]=2*-i.x/this.width,G[9]=2*i.y/this.height;let Q=d.mul$1([],G,Z);if("mercator"!==this.projection.name){const Ve=this.locationCoordinate(this.center),we=d.identity([]);d.translate(we,we,[Ve.x*this.worldSize,Ve.y*this.worldSize,0]),d.multiply(we,we,ru(this)),d.translate(we,we,[-Ve.x*this.worldSize,-Ve.y*this.worldSize,0]),d.multiply(Q,Q,we),this.inverseAdjustmentMatrix=function(Ue){const ve=ru(Ue,!0);return Hl([],[ve[0],ve[1],ve[4],ve[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale$1([],Q,[this.worldSize,this.worldSize,this.worldSize/c]),this.projMatrix=Q,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const q=new Float32Array(16);d.identity(q),d.scale$1(q,q,[1,-1,1]),d.rotateX(q,q,this._pitch),d.rotateZ(q,q,this.angle);const ee=d.perspective(new Float32Array(16),this._fov,this.width/this.height,H,U),re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-i.x/this.width,ee[9]=2*(i.y+re)/this.height,this.skyboxMatrix=d.multiply(q,ee,q);const W=this.width%2/2,ie=this.height%2/2,ae=Math.cos(this.angle),be=Math.sin(this.angle),xe=R-Math.round(R)+ae*W+be*ie,Ce=L-Math.round(L)+ae*ie+be*W,Se=new Float64Array(Q);if(d.translate(Se,Se,[xe>.5?xe-1:xe,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Se,Q=d.create$1(),d.scale$1(Q,Q,[this.width/2,-this.height/2,1]),d.translate(Q,Q,[1,-1,0]),this.labelPlaneMatrix=Q,Q=d.create$1(),d.scale$1(Q,Q,[1,-1,1]),d.translate(Q,Q,[-1,-1,0]),d.scale$1(Q,Q,[2/this.width,2/this.height,1]),this.glCoordMatrix=Q,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},Q=d.invert(new Float64Array(16),this.pixelMatrix),!Q)throw new Error("failed to invert matrix");this.pixelMatrixInverse=Q,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,c=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height,v=[i,i,c];d.scale(v,v,y),d.scale(m,m,-1),d.multiply$1(m,m,v);const D=d.create$1();d.translate(D,D,m),d.scale$1(D,D,v),this.mercatorFogMatrix=D,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,y)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const i=this._camera.forward(),c=this.cameraToCenterDistance,m=this.point,y=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this.cameraToCenterDistance/y;this._camera.position=[m.x/this.worldSize-i[0]*c/v,m.y/this.worldSize-i[1]*c/v,d.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-i[2]*c/v]}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=i[2];let y=1;m>0&&(y=Math.min((c-this._camera.position[2])/m,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,i,y),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),v=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat),D=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),C=Math.max((i[2]-v)/Math.cos(m),D),A=this._zoomFromMercatorZ(C);d.scaleAndAdd(i,i,c,C),this._pitch=d.clamp(m,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(y,-Math.PI,Math.PI),this._setZoom(d.clamp(A,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new d.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||"mercator"!==this.projection.name&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(i,c){const m=Math.min(i.x,c.x),y=Math.max(i.x,c.x),v=Math.min(i.y,c.y),D=Math.max(i.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const C=[new d.pointGeometry(m,v),new d.pointGeometry(y,D),new d.pointGeometry(m,D),new d.pointGeometry(y,v)],A=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(const L of C){const F=this.pointRayIntersection(L);if(F.t<0)return!0;const U=this.rayIntersectionCoordinate(F);if(U.x<A||U.y<0||U.x>R||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,c){const m=d.length(d.sub([],this._camera.position,i)),y=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(y)}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,i))}}function vh(p,i){let c=!1,m=null;const y=()=>{m=null,c&&(p(),m=setTimeout(y,i),c=!1)};return()=>(c=!0,m||y(),m)}class iu{constructor(i){this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vh(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const c=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),D=Math.round(c.lng*v)/v,C=Math.round(c.lat*v)/v,A=this._map.getBearing(),R=this._map.getPitch();let L="";if(L+=i?`/${D}/${C}/${m}`:`${m}/${C}/${D}`,(A||R)&&(L+="/"+Math.round(10*A)/10),R&&(L+=`/${Math.round(R)}`),this._hashName){const F=this._hashName;let U=!1;const H=d.window.location.hash.slice(1).split("&").map(Z=>{const G=Z.split("=")[0];return G===F?(U=!0,`${G}=${L}`):Z}).filter(Z=>Z);return U||H.push(`${F}=${L}`),`#${H.join("&")}`}return`#${L}`}_getCurrentHash(){const i=d.window.location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:c,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,i)}}const al={linearity:.3,easing:d.bezier(0,0,.3,1)},$d=d.extend({deceleration:2500,maxSpeed:1400},al),Gd=d.extend({deceleration:20,maxSpeed:1400},al),ll=d.extend({deceleration:1e3,maxSpeed:360},al),cl=d.extend({deceleration:1e3,maxSpeed:90},al);class Hd{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=d.exported.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const v=gc(c.pan.mag(),m,d.extend({},$d,i||{}));y.offset=c.pan.mult(v.amount/c.pan.mag()),y.center=this._map.transform.center,mc(y,v)}if(c.zoom){const v=gc(c.zoom,m,Gd);y.zoom=this._map.transform.zoom+v.amount,mc(y,v)}if(c.bearing){const v=gc(c.bearing,m,ll);y.bearing=this._map.transform.bearing+d.clamp(v.amount,-179,179),mc(y,v)}if(c.pitch){const v=gc(c.pitch,m,cl);y.pitch=this._map.transform.pitch+v.amount,mc(y,v)}if(y.zoom||y.bearing){const v=void 0===c.pinchAround?c.around:c.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),d.extend(y,{noMoveStart:!0})}}function mc(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function gc(p,i,c){const{maxSpeed:m,linearity:y,deceleration:v}=c,D=d.clamp(p*y/(i/1e3),-m,m),C=Math.abs(D)/(v*y);return{easing:c.easing,duration:1e3*C,amount:D*(C/2)}}class Jn extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m,y={}){const v=De.mousePos(c.getCanvasContainer(),m),D=c.unproject(v);super(i,d.extend({point:v,lngLat:D,originalEvent:m},y)),this._defaultPrevented=!1,this.target=c}}class ul extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){const y="touchend"===i?m.changedTouches:m.touches,v=De.touchPos(c.getCanvasContainer(),y),D=v.map(A=>c.unproject(A)),C=v.reduce((A,R,L,F)=>A.add(R.div(F.length)),new d.pointGeometry(0,0));super(i,{points:v,point:C,lngLats:D,lngLat:c.unproject(C),originalEvent:m}),this._defaultPrevented=!1}}class To extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,m){super(i,{originalEvent:m}),this._defaultPrevented=!1}}class ou{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new To(i.type,this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new Jn(i.type,this._map,i))}mouseup(i){this._map.fire(new Jn(i.type,this._map,i))}preclick(i){const c=d.extend({},i);c.type="preclick",this._map.fire(new Jn(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Jn(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Jn(i.type,this._map,i))}mouseover(i){this._map.fire(new Jn(i.type,this._map,i))}mouseout(i){this._map.fire(new Jn(i.type,this._map,i))}touchstart(i){return this._firePreventable(new ul(i.type,this._map,i))}touchmove(i){this._map.fire(new ul(i.type,this._map,i))}touchend(i){this._map.fire(new ul(i.type,this._map,i))}touchcancel(i){this._map.fire(new ul(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xh{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(i){this._map.fire(new Jn(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Jn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Jn(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bh{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&0===i.button&&(De.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const m=c;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=m,this._box||(this._box=De.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const v=Math.min(y.x,m.x),D=Math.max(y.x,m.x),C=Math.min(y.y,m.y),A=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(De.setTransform(this._box,`translate(${v}px,${C}px)`),this._box.style.width=D-v+"px",this._box.style.height=A-C+"px")})}mouseupWindow(i,c){if(!this._active||0!==i.button)return;const m=this._startPos,y=c;if(this.reset(),De.suppressClick(),m.x!==y.x||m.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:v=>v.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(De.remove(this._box),this._box=null),De.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new d.Event(i,{originalEvent:c}))}}function hl(p,i){const c={};for(let m=0;m<p.length;m++)c[p[m].identifier]=i[m];return c}class su{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const v=new d.pointGeometry(0,0);for(const D of y)v._add(D);return v.div(y.length)}(c),this.touches=hl(m,c)))}touchmove(i,c,m){if(this.aborted||!this.centroid)return;const y=hl(m,c);for(const v in this.touches){const D=this.touches[v],C=y[v];(!C||C.dist(D)>30)&&(this.aborted=!0)}}touchend(i,c,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===m.length){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class _c{constructor(i){this.singleTap=new su(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,c,m){this.singleTap.touchstart(i,c,m)}touchmove(i,c,m){this.singleTap.touchmove(i,c,m)}touchend(i,c,m){const y=this.singleTap.touchend(i,c,m);if(y){const v=i.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(y)<30;if(v&&D||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class hr{constructor(){this._zoomIn=new _c({numTouches:1,numTaps:2}),this._zoomOut=new _c({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,m){this._zoomIn.touchstart(i,c,m),this._zoomOut.touchstart(i,c,m)}touchmove(i,c,m){this._zoomIn.touchmove(i,c,m),this._zoomOut.touchmove(i,c,m)}touchend(i,c,m){const y=this._zoomIn.touchend(i,c,m),v=this._zoomOut.touchend(i,c,m);return y?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()+1,around:D.unproject(y)},{originalEvent:i})}):v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:D.getZoom()-1,around:D.unproject(v)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qd={0:1,2:2};class jn{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const m=De.mouseButton(i);this._correctButton(i,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(i,c){const m=this._lastPoint;if(m)if(i.preventDefault(),function(y,v){const D=qd[v];return void 0===y.buttons||(y.buttons&D)!==D}(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}mouseupWindow(i){this._lastPoint&&De.mouseButton(i)===this._eventButton&&(this._moved&&De.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class au extends jn{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return 0===c&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class ao extends jn{_correctButton(i,c){return 0===c&&i.ctrlKey||2===c}_move(i,c){const m=.8*(c.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class Co extends jn{_correctButton(i,c){return 0===c&&i.ctrlKey||2===c}_move(i,c){const m=-.5*(c.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class Zd{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(i,c,m){return this._calculateTransform(i,c,m)}touchmove(i,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===m.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,c,m)}}touchend(i,c,m){this._calculateTransform(i,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,m){m.length>0&&(this._active=!0);const y=hl(m,c),v=new d.pointGeometry(0,0),D=new d.pointGeometry(0,0);let C=0;for(const R in y){const L=y[R],F=this._touches[R];F&&(v._add(L),D._add(L.sub(F)),C++,y[R]=L)}if(this._touches=y,C<this._minTouches||!D.mag())return;const A=D.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(C),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class dl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,c,m){return{}}touchstart(i,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,m){if(!this._firstTwoTouches)return;i.preventDefault();const[y,v]=this._firstTwoTouches,D=lu(m,c,y),C=lu(m,c,v);if(!D||!C)return;const A=this._aroundCenter?null:D.add(C).div(2);return this._move([D,C],A,i)}touchend(i,c,m){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,D=lu(m,c,y),C=lu(m,c,v);D&&C||(this._active&&De.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function lu(p,i,c){for(let m=0;m<p.length;m++)if(p[m].identifier===c)return i[m]}function Fn(p,i){return Math.log(p/i)/Math.LN2}class cu extends dl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Fn(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fn(this._distance,m),pinchAround:c}}}function ba(p,i){return 180*p.angleWith(i)/Math.PI}class fn extends dl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const m=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ba(this._vector,m),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,m=ba(i,this._startVector);return Math.abs(m)<c}}function yc(p){return Math.abs(p.y)>Math.abs(p.x)}class Wd extends dl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(i){this._lastPoints=i,yc(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,m){const y=i[0].sub(this._lastPoints[0]),v=i[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&m.touches.length<3)&&(this._valid=this.gestureBeginsVertically(y,v,m.timeStamp),this._valid))return this._lastPoints=i,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5}}gestureBeginsVertically(i,c,m){if(void 0!==this._valid)return this._valid;const y=i.mag()>=2,v=c.mag()>=2;if(!y&&!v)return;if(!y||!v)return void 0===this._firstMove&&(this._firstMove=m),m-this._firstMove<100&&void 0;const D=i.y>0==c.y>0;return yc(i)&&yc(c)&&D}}const rs={panStep:100,bearingStep:15,pitchStep:10};class Ye{constructor(){const i=rs;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,m=0,y=0,v=0,D=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),v=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),v=1);break;case 38:i.shiftKey?y=1:(i.preventDefault(),D=-1);break;case 40:i.shiftKey?y=-1:(i.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:C=>{const A=C.getZoom();C.easeTo({duration:300,easeId:"keyboardHandler",easing:wh,zoom:c?Math.round(A)+c*(i.shiftKey?2:1):A,bearing:C.getBearing()+m*this._bearingStep,pitch:C.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-D*this._panStep],center:C.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function wh(p){return p*(2-p)}const pl=4.000244140625;class lo{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=d.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,0!==c&&c%pl==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=De.mousePos(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,c=()=>i._terrainEnabled()?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>pl?this._wheelZoomRate:this._defaultZoomRate;let R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==R&&(R=1/R);const L=c(),F=Math.pow(2,L),U="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):F;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(U*R))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const m="number"==typeof this._targetZoom?this._targetZoom:c(),y=this._startZoom,v=this._easing;let D,C=!1;if("wheel"===this._type&&y&&v){const A=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),R=v(A);D=d.number(y,m,R),A<1?this._frameId||(this._frameId=!0):C=!0}else D=m,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:D-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=d.ease;if(this._prevEase){const m=this._prevEase,y=(d.exported.now()-m.start)/m.duration,v=m.easing(y+.01)-m.easing(y),D=.27/Math.sqrt(v*v+1e-4)*.01,C=Math.sqrt(.0729-D*D);c=d.bezier(D,C,.25,1)}return this._prevEase={start:d.exported.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=De.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class wr{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class uu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vc{constructor(){this._tap=new _c({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,c,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,c,m))}touchmove(i,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=c[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,i.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(i,c,m)}touchend(i,c,m){this._tapTime?this._swipePoint&&0===m.length&&this.reset():this._tap.touchend(i,c,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eh{constructor(i,c,m){this._el=i,this._mousePan=c,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class So{constructor(i,c,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hu{constructor(i,c,m,y){this._el=i,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ms=p=>p.zoom||p.drag||p.pitch||p.rotate;class xt extends d.Event{}class du{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const m=d.sub([],c,i);this.radius=d.length(m[2]<0?d.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){d.div(i,i,this.constants),d.normalize(i,i),d.mul$2(i,i,this.constants);const c=d.scale([],i,this.radius);if(c[2]>0){const m=d.scale([],[0,0,1],d.dot(c,[0,0,1])),y=d.scale([],d.normalize([],[c[0],c[1],0]),this.radius),v=d.add([],c,d.scale([],d.sub([],d.add([],y,m),c),2));c[0]=v[0],c[1]=v[1]}return c}}function wa(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class xc{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hd(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new du,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),d.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[y,v,D]of this._listeners)De.addEventListener(y,v,y===d.window.document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[i,c,m]of this._listeners)De.removeEventListener(i,c,i===d.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(i){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new ou(c,i));const y=c.boxZoom=new bh(c,i);this._add("boxZoom",y);const v=new hr,D=new uu;c.doubleClickZoom=new wr(D,v),this._add("tapZoom",v),this._add("clickZoom",D);const C=new vc;this._add("tapDragZoom",C);const A=c.touchPitch=new Wd(c);this._add("touchPitch",A);const R=new ao(i),L=new Co(i);c.dragRotate=new So(i,R,L),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const F=new au(i),U=new Zd(c,i);c.dragPan=new Eh(m,F,U),this._add("mousePan",F),this._add("touchPan",U,["touchZoom","touchRotate"]);const H=new fn,Z=new cu;c.touchZoomRotate=new hu(m,Z,H,C),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xh(c));const G=c.scrollZoom=new lo(c,this);this._add("scrollZoom",G,["mousePan"]);const Q=c.keyboard=new Ye;this._add("keyboard",Q);for(const q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[q]&&c[q].enable(i[q])}_add(i,c,m){this._handlers.push({handlerName:i,handler:c,allowed:m}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ms(this._eventsInProgress))||this.isZooming()}_blockedByActive(i,c,m){for(const y in i)if(y!==m&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const m of i)this._el.contains(m.target)&&c.push(m);return c}handleEvent(i,c){this._updatingCamera=!0;const m="renderFrame"===i.type,y=m?void 0:i,v={needsRenderFrame:!1},D={},C={},A=i.touches?this._getMapTouches(i.touches):void 0,R=A?De.touchPos(this._el,A):m?void 0:De.mousePos(this._el,i);for(const{handlerName:U,handler:H,allowed:Z}of this._handlers){if(!H.isEnabled())continue;let G;this._blockedByActive(C,Z,U)?H.reset():H[c||i.type]&&(G=H[c||i.type](i,R,A),this.mergeHandlerResult(v,D,G,U,y),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||H.isActive())&&(C[U]=H)}const L={};for(const U in this._previousActiveHandlers)C[U]||(L[U]=y);this._previousActiveHandlers=C,(Object.keys(L).length||wa(v))&&(this._changes.push([v,D,L]),this._triggerRenderFrame()),(Object.keys(C).length||wa(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=v;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(i,c,m,y,v){if(!m)return;d.extend(i,m);const D={handlerName:y,originalEvent:m.originalEvent||v};void 0!==m.zoomDelta&&(c.zoom=D),void 0!==m.panDelta&&(c.drag=D),void 0!==m.pitchDelta&&(c.pitch=D),void 0!==m.bearingDelta&&(c.rotate=D)}_applyChanges(){const i={},c={},m={};for(const[y,v,D]of this._changes)y.panDelta&&(i.panDelta=(i.panDelta||new d.pointGeometry(0,0))._add(y.panDelta)),y.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+y.pitchDelta),void 0!==y.around&&(i.around=y.around),void 0!==y.aroundCoord&&(i.aroundCoord=y.aroundCoord),void 0!==y.pinchAround&&(i.pinchAround=y.pinchAround),y.noInertia&&(i.noInertia=y.noInertia),d.extend(c,v),d.extend(m,D);this._updateMapTransform(i,c,m),this._changes=[]}_updateMapTransform(i,c,m){const y=this._map,v=y.transform,D=ee=>[ee.x,ee.y,ee.z];if((ee=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!wa(i)){const ee=v.zoom;v.cameraElevationReference="sea",v.recenterOnTerrain(),v.cameraElevationReference="ground",ee!==v.zoom&&this._map._update(!0)}if(!wa(i))return this._fireEvents(c,m,!0);let{panDelta:C,zoomDelta:A,bearingDelta:R,pitchDelta:L,around:F,aroundCoord:U,pinchAround:H}=i;void 0!==H&&(F=H),(ee=>c.drag&&!this._eventsInProgress.drag)()&&F&&(this._dragOrigin=D(v.pointCoordinate3D(F)),this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),F=F||y.transform.centerPoint,R&&(v.bearing+=R),L&&(v.pitch+=L),v._updateCameraState();const Z=[0,0,0];if(C){const ee=v.screenPointToMercatorRay(F),re=v.screenPointToMercatorRay(F.sub(C)),W=this._trackingEllipsoid.projectRay(ee.dir),ie=this._trackingEllipsoid.projectRay(re.dir);Z[0]=ie[0]-W[0],Z[1]=ie[1]-W[1]}const G=v.zoom,Q=[0,0,0];if(A){const ee=D(U||v.pointCoordinate3D(F)),re={dir:d.normalize([],d.sub([],ee,v._camera.position))},W=v.screenPointToMercatorRay(v.centerPoint);if(re.dir[2]<0){const ie=d.altitudeFromMercatorZ(ee[2],ee[1]),ae=v.rayIntersectionCoordinate(v.pointRayIntersection(v.centerPoint,ie)),be=v.zoomDeltaToMovement(D(ae),A)*(W.dir[2]/re.dir[2]);d.scale(Q,re.dir,be)}else if(v._terrainEnabled()){const ie=v.zoomDeltaToMovement(ee,A);d.scale(Q,re.dir,ie)}}const q=d.add(Z,Z,Q);v._translateCameraConstrained(q),A&&Math.abs(v.zoom-G)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,m,!0)}_fireEvents(i,c,m){const y=Ms(this._eventsInProgress),v=Ms(i),D={};for(const L in i){const{originalEvent:F}=i[L];this._eventsInProgress[L]||(D[`${L}start`]=F),this._eventsInProgress[L]=i[L]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const L in D)this._fireEvent(L,D[L]);v&&this._fireEvent("move",v.originalEvent);for(const L in i){const{originalEvent:F}=i[L];this._fireEvent(L,F)}const C={};let A;for(const L in this._eventsInProgress){const{handlerName:F,originalEvent:U}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],A=c[F]||U,C[`${L}end`]=A)}for(const L in C)this._fireEvent(L,C[L]);const R=Ms(this._eventsInProgress);if(m&&(y||v)&&!R){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=U=>0!==U&&-this._bearingSnap<U&&U<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new d.Event("moveend",{originalEvent:A})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new d.Event(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new xt("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const pu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class fu extends d.Evented{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,m){return i=d.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,d.extend({offset:i},c),m)}panTo(i,c,m){return this.easeTo(d.extend({center:i},c),m)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,m){return this.easeTo(d.extend({zoom:i},c),m)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,m){return this.easeTo(d.extend({bearing:i},c),m)}resetNorth(i,c){return this.rotateTo(0,d.extend({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=d.LngLatBounds.convert(i);const m=c&&c.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),m,c)}_extendCameraOptions(i){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=d.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const m=i.padding;i.padding={top:m,bottom:m,right:m,left:m}}return i.padding=d.extend(c,i.padding),i}_cameraForBoxAndBearing(i,c,m,y){const v=this._extendCameraOptions(y),D=this.transform,C=D.padding,A=D.project(d.LngLat.convert(i)),R=D.project(d.LngLat.convert(c)),L=A.rotate(-d.degToRad(m)),F=R.rotate(-d.degToRad(m)),U=new d.pointGeometry(Math.max(L.x,F.x),Math.max(L.y,F.y)),H=new d.pointGeometry(Math.min(L.x,F.x),Math.min(L.y,F.y)),Z=U.sub(H),G=(D.width-(C.left+C.right+v.padding.left+v.padding.right))/Z.x,Q=(D.height-(C.top+C.bottom+v.padding.top+v.padding.bottom))/Z.y;if(Q<0||G<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const q=Math.min(D.scaleZoom(D.scale*Math.min(G,Q)),v.maxZoom),ee="number"==typeof v.offset.x?new d.pointGeometry(v.offset.x,v.offset.y):d.pointGeometry.convert(v.offset),re=new d.pointGeometry((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(m*Math.PI/180),W=ee.add(re).mult(D.scale/D.zoomScale(q));return{center:D.unproject(A.add(R).div(2).sub(W)),zoom:q,bearing:m}}_cameraForBox(i,c,m,y,v){const D=this._extendCameraOptions(v);m=m||0,y=y||0,i=d.LngLat.convert(i),c=d.LngLat.convert(c);const C=this.transform.clone();C.padding=D.padding;const A=this.getFreeCameraOptions(),R=new d.LngLat(.5*(i.lng+c.lng),.5*(i.lat+c.lat)),L=.5*(m+y);if(C._camera.position[2]<d.mercatorZfromAltitude(L,R.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(R),C.setFreeCameraOptions(A);const F=d.MercatorCoordinate.fromLngLat(i),U=d.MercatorCoordinate.fromLngLat(c),H=C.pointRayIntersection(C.centerPoint,L),Z=[(G=C.rayIntersectionCoordinate(H)).x,G.y,G.z];var G;const Q=C.screenPointToMercatorRay(C.centerPoint);let q,ee=0;do{const re=Math.floor(C.zoom),W=1<<re,ie=Math.min(W*F.x,W*U.x),ae=Math.min(W*F.y,W*U.y),be=Math.max(W*F.x,W*U.x),xe=Math.max(W*F.y,W*U.y),Ce=new bi([ie,ae,m],[be,xe,y]),Se=ni.fromInvProjectionMatrix(C.invProjMatrix,C.worldSize,re);if(2!==Ce.intersects(Se)){q&&(C._camera.position=d.scaleAndAdd([],C._camera.position,Q.dir,-q),C._updateStateFromCamera());break}const Ve=d.sub([],C._camera.position,Z);q=.5*d.length(Ve),C._camera.position=d.scaleAndAdd([],C._camera.position,Q.dir,q);try{C._updateStateFromCamera()}catch(we){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++ee<10);return{center:C.center,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch}}fitBounds(i,c,m){return this._fitInternal(this.cameraForBounds(i,c),c,m)}_raycastElevationBox(i,c){const m=this.transform.elevation;if(!m)return;const y=new d.pointGeometry(i.x,c.y),v=new d.pointGeometry(c.x,i.y),D=m.pointCoordinate(i);if(!D)return;const C=m.pointCoordinate(c);if(!C)return;const A=m.pointCoordinate(y);if(!A)return;const R=m.pointCoordinate(v);if(!R)return;const L=new d.MercatorCoordinate(D[0],D[1]).toLngLat(),F=new d.MercatorCoordinate(C[0],C[1]).toLngLat(),U=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),H=new d.MercatorCoordinate(R[0],R[1]).toLngLat(),Z=Math.min(L.lng,Math.min(F.lng,Math.min(U.lng,H.lng))),G=Math.min(L.lat,Math.min(F.lat,Math.min(U.lat,H.lat))),Q=Math.max(L.lng,Math.max(F.lng,Math.max(U.lng,H.lng))),q=Math.max(L.lat,Math.max(F.lat,Math.max(U.lat,H.lat))),ee=Math.min(D[3],Math.min(C[3],Math.min(A[3],R[3]))),re=Math.max(D[3],Math.max(C[3],Math.max(A[3],R[3])));return{minLngLat:new d.LngLat(Z,G),maxLngLat:new d.LngLat(Q,q),minAltitude:ee,maxAltitude:re}}fitScreenCoordinates(i,c,m,y,v){let D,C,A,R;const L=d.pointGeometry.convert(i),F=d.pointGeometry.convert(c),U=this._raycastElevationBox(L,F);if(U)D=U.minLngLat,C=U.maxLngLat,A=U.minAltitude,R=U.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,F))return this;D=this.transform.pointLocation(L),C=this.transform.pointLocation(F)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(i)),this.transform.pointLocation(d.pointGeometry.convert(c)),m,y):this._cameraForBox(D,C,A,R,y),y,v)}_fitInternal(i,c,m){return i?(delete(c=d.extend(i,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(i,c){this.stop();const m=this.transform;let y=!1,v=!1,D=!1;return"zoom"in i&&m.zoom!==+i.zoom&&(y=!0,m.zoom=+i.zoom),void 0!==i.center&&(m.center=d.LngLat.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(v=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(D=!0,m.pitch=+i.pitch),null==i.padding||m.isPaddingEqual(i.padding)||(m.padding=i.padding),this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),y&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),v&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),D&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c))}getFreeCameraOptions(){return"mercator"!==this.transform.projection.name&&d.warnOnce(pu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const m=this.transform;if("mercator"!==m.projection.name)return void d.warnOnce(pu);this.stop();const y=m.zoom,v=m.pitch,D=m.bearing;m.setFreeCameraOptions(i);const C=y!==m.zoom,A=v!==m.pitch,R=D!==m.bearing;return this.fire(new d.Event("movestart",c)).fire(new d.Event("move",c)),C&&this.fire(new d.Event("zoomstart",c)).fire(new d.Event("zoom",c)).fire(new d.Event("zoomend",c)),R&&this.fire(new d.Event("rotatestart",c)).fire(new d.Event("rotate",c)).fire(new d.Event("rotateend",c)),A&&this.fire(new d.Event("pitchstart",c)).fire(new d.Event("pitch",c)).fire(new d.Event("pitchend",c)),this.fire(new d.Event("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),(!1===(i=d.extend({offset:[0,0],duration:500,easing:d.ease},i)).animate||!i.essential&&d.exported.prefersReducedMotion)&&(i.duration=0);const m=this.transform,y=this.getZoom(),v=this.getBearing(),D=this.getPitch(),C=this.getPadding(),A="zoom"in i?+i.zoom:y,R="bearing"in i?this._normalizeBearing(i.bearing,v):v,L="pitch"in i?+i.pitch:D,F="padding"in i?i.padding:m.padding,U=d.pointGeometry.convert(i.offset);let H=m.centerPoint.add(U);const Z=m.pointLocation(H),G=d.LngLat.convert(i.center||Z);this._normalizeCenter(G);const Q=m.project(Z),q=m.project(G).sub(Q),ee=m.zoomScale(A-y);let re,W;i.around&&(re=d.LngLat.convert(i.around),W=m.locationPoint(re));const ie={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||A!==y,this._rotating=this._rotating||v!==R,this._pitching=this._pitching||L!==D,this._padding=!m.isPaddingEqual(F),this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,ie),this._ease(ae=>{if(this._zooming&&(m.zoom=d.number(y,A,ae)),this._rotating&&(m.bearing=d.number(v,R,ae)),this._pitching&&(m.pitch=d.number(D,L,ae)),this._padding&&(m.interpolatePadding(C,F,ae),H=m.centerPoint.add(U)),re)m.setLocationAtPoint(re,W);else{const be=m.zoomScale(m.zoom-y),xe=A>y?Math.min(2,ee):Math.max(.5,ee),Ce=Math.pow(xe,1-ae),Se=m.unproject(Q.add(q.mult(ae*Ce)).mult(be));m.setLocationAtPoint(m.renderWorldCopies?Se.wrap():Se,H)}this._fireMoveEvents(c)},ae=>{m.recenterOnTerrain(),this._afterEase(c,ae)},i),this}_prepareEase(i,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new d.Event("movestart",i)),this._zooming&&!m.zooming&&this.fire(new d.Event("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new d.Event("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new d.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new d.Event("move",i)),this._zooming&&this.fire(new d.Event("zoom",i)),this._rotating&&this.fire(new d.Event("rotate",i)),this._pitching&&this.fire(new d.Event("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new d.Event("zoomend",i)),y&&this.fire(new d.Event("rotateend",i)),v&&this.fire(new d.Event("pitchend",i)),this.fire(new d.Event("moveend",i))}flyTo(i,c){if(!i.essential&&d.exported.prefersReducedMotion){const Ge=d.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,c)}this.stop(),i=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},i);const m=this.transform,y=this.getZoom(),v=this.getBearing(),D=this.getPitch(),C=this.getPadding(),A="zoom"in i?d.clamp(+i.zoom,m.minZoom,m.maxZoom):y,R="bearing"in i?this._normalizeBearing(i.bearing,v):v,L="pitch"in i?+i.pitch:D,F="padding"in i?i.padding:m.padding,U=m.zoomScale(A-y),H=d.pointGeometry.convert(i.offset);let Z=m.centerPoint.add(H);const G=m.pointLocation(Z),Q=d.LngLat.convert(i.center||G);this._normalizeCenter(Q);const q=m.project(G),ee=m.project(Q).sub(q);let re=i.curve;const W=Math.max(m.width,m.height),ie=W/U,ae=ee.mag();if("minZoom"in i){const Ge=d.clamp(Math.min(i.minZoom,y,A),m.minZoom,m.maxZoom),Je=W/m.zoomScale(Ge-y);re=Math.sqrt(Je/ae*2)}const be=re*re;function xe(Ge){const Je=(ie*ie-W*W+(Ge?-1:1)*be*be*ae*ae)/(2*(Ge?ie:W)*be*ae);return Math.log(Math.sqrt(Je*Je+1)-Je)}function Ce(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Se(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Ve=xe(0);let we=function(Ge){return Se(Ve)/Se(Ve+re*Ge)},Ue=function(Ge){return W*((Se(Ve)*(Ce(Je=Ve+re*Ge)/Se(Je))-Ce(Ve))/be)/ae;var Je},ve=(xe(1)-Ve)/re;if(Math.abs(ae)<1e-6||!isFinite(ve)){if(Math.abs(W-ie)<1e-6)return this.easeTo(i,c);const Ge=ie<W?-1:1;ve=Math.abs(Math.log(ie/W))/re,Ue=function(){return 0},we=function(Je){return Math.exp(Ge*re*Je)}}return i.duration="duration"in i?+i.duration:1e3*ve/("screenSpeed"in i?+i.screenSpeed/re:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=v!==R,this._pitching=L!==D,this._padding=!m.isPaddingEqual(F),this._prepareEase(c,!1),this._ease(Ge=>{const Je=Ge*ve,lt=1/we(Je);m.zoom=1===Ge?A:y+m.scaleZoom(lt),this._rotating&&(m.bearing=d.number(v,R,Ge)),this._pitching&&(m.pitch=d.number(D,L,Ge)),this._padding&&(m.interpolatePadding(C,F,Ge),Z=m.centerPoint.add(H));const ht=1===Ge?Q:m.unproject(q.add(ee.mult(Ue(Je))).mult(lt));m.setLocationAtPoint(m.renderWorldCopies?ht.wrap():ht,Z),m._updateCenterElevation(),this._fireMoveEvents(c)},()=>this._afterEase(c),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,c)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,c,m){!1===m.animate||0===m.duration?(i(1),c()):(this._easeStart=d.exported.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=d.wrap(i,-180,180);const m=Math.abs(i-c);return Math.abs(i-360-c)<m&&(i-=360),Math.abs(i+360-c)<m&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=i.lng-c.center.lng;i.lng+=m>180?-360:m<-180?360:0}}class mu{constructor(i={}){this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact;return this._map=i,this._container=De.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=De.create("button","mapboxgl-ctrl-attrib-button",this._container),De.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=De.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){De.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,c){const m=this._map._getUIString(`AttributionControl.${c}`);i.setAttribute("aria-label",m),i.firstElementChild&&i.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){const m=c.reduce((y,v,D)=>(v.value&&(y+=`${v.key}=${v.value}${D<c.length-1?"&":""}`),y),"?");i.href=`${d.config.FEEDBACK_URL}/${m}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(y=>"string"!=typeof y?"":y)):"string"==typeof this.options.customAttribution&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const v=c[y];if(v.used){const D=v.getSource();D.attribution&&i.indexOf(D.attribution)<0&&i.push(D.attribution)}}i.sort((y,v)=>y.length-v.length),i=i.filter((y,v)=>{for(let D=v+1;D<i.length;D++)if(i[D].indexOf(y)>=0)return!1;return!0});const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gu{constructor(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)}onAdd(i){this._map=i,this._container=De.create("div","mapboxgl-ctrl");const c=De.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){De.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const c in i){const m=i[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Be{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const y of m)if(y.id===i)return void(y.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function $t(p,i,c){if(p=new d.LngLat(p.lng,p.lat),i){const m=new d.LngLat(p.lng-360,p.lat),y=new d.LngLat(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),D=c.locationPoint(p).distSqr(i),C=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint(m).distSqr(i)<D&&(C||Math.abs(m.lng-c.center.lng)<v)?p=m:c.locationPoint(y).distSqr(i)<D&&(C||Math.abs(y.lng-c.center.lng)<v)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const m=c.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const As={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class On extends d.Evented{constructor(i,c){if(super(),(i instanceof d.window.HTMLElement||c)&&(i=d.extend({element:i},c)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=d.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=De.create("div"),this._element.setAttribute("aria-label","Map marker");const y=De.createNS("http://www.w3.org/2000/svg","svg"),v=41,D=27;y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height",`${v}px`),y.setAttributeNS(null,"width",`${D}px`),y.setAttributeNS(null,"viewBox",`0 0 ${D} ${v}`);const C=De.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");const A=De.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const R=De.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of L){const W=De.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",re.rx),W.setAttributeNS(null,"ry",re.ry),R.appendChild(W)}const F=De.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const U=De.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(U);const H=De.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const Z=De.createNS("http://www.w3.org/2000/svg","path");Z.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(Z);const G=De.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const Q=De.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const q=De.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");const ee=De.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#FFFFFF"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962"),Q.appendChild(q),Q.appendChild(ee),A.appendChild(R),A.appendChild(F),A.appendChild(H),A.appendChild(G),A.appendChild(Q),y.appendChild(A),y.setAttributeNS(null,"height",v*this._scale+"px"),y.setAttributeNS(null,"width",D*this._scale+"px"),this._element.appendChild(y),this._offset=d.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in As)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),De.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=d.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const c=38.1,m=13.5,y=Math.sqrt(Math.pow(m,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[y,-1*(c-m+y)],"bottom-right":[-y,-1*(c-m+y)],left:[m,-1*(c-m)],right:[-m,-1*(c-m)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,m=i.charCode||i.keyCode;"Space"!==c&&"Enter"!==c&&32!==m&&13!==m||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const i=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(i))return void this._clearFadeTimer();const c=this._map.unproject(i);let m=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const v=this._map.getFreeCameraOptions();if(v.position){const D=v.position.toLngLat();m=D.distanceTo(c)<.9*D.distanceTo(this._lngLat)}}const y=(1-this._map._queryFogOpacity(c))*(m?.2:1);this._element.style.opacity=`${y}`,this._popup&&this._popup._setOpacity(`${y}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(i){const c=this._map.transform;return!!i&&i.x>=0&&i.x<c.width&&i.y>=0&&i.y<c.height}_update(i){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=$t(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?m="rotateX(0deg)":"map"===this._pitchAlignment&&(m=`rotateX(${this._map.getPitch()}deg)`),i&&"moveend"!==i.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&De.setTransform(this._element,`${As[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${c}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const i=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(i.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(i._pitch)),c}getOffset(){return this._offset}setOffset(i){return this._offset=d.pointGeometry.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&"auto"!==i?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class _u{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=d.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,m){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+m}}const Ea={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:ai,HTMLElement:bc,ImageBitmap:co}=d.window,Xd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function fl(p){p.parentNode&&p.parentNode.removeChild(p)}const ml={showCompass:!0,showZoom:!0,visualizePitch:!1};class Da{constructor(i,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new ao({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new Co({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),De.addEventListener(c,"mousedown",this.mousedown),De.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),De.addEventListener(c,"touchmove",this.touchmove),De.addEventListener(c,"touchend",this.touchend),De.addEventListener(c,"touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),De.disableDrag()}move(i,c){const m=this.map,y=this.mouseRotate.mousemoveWindow(i,c);if(y&&y.bearingDelta&&m.setBearing(m.getBearing()+y.bearingDelta),this.mousePitch){const v=this.mousePitch.mousemoveWindow(i,c);v&&v.pitchDelta&&m.setPitch(m.getPitch()+v.pitchDelta)}}off(){const i=this.element;De.removeEventListener(i,"mousedown",this.mousedown),De.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),De.removeEventListener(i,"touchmove",this.touchmove),De.removeEventListener(i,"touchend",this.touchend),De.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){De.enableDrag(),De.removeEventListener(d.window,"mousemove",this.mousemove),De.removeEventListener(d.window,"mouseup",this.mouseup)}mousedown(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),De.mousePos(this.element,i)),De.addEventListener(d.window,"mousemove",this.mousemove),De.addEventListener(d.window,"mouseup",this.mouseup)}mousemove(i){this.move(i,De.mousePos(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=De.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=De.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Er={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Lr,gl=0,uo=!1;const Vi={maxWidth:100,unit:"metric"};function yu(p,i,c){const m=c&&c.maxWidth||100,y=p._container.getBoundingClientRect().height/2,v=p.unproject([0,y]),D=p.unproject([m,y]),C=v.distanceTo(D);if(c&&"imperial"===c.unit){const A=3.2808*C;A>5280?Ps(i,m,A/5280,p._getUIString("ScaleControl.Miles"),p):Ps(i,m,A,p._getUIString("ScaleControl.Feet"),p)}else c&&"nautical"===c.unit?Ps(i,m,C/1852,p._getUIString("ScaleControl.NauticalMiles"),p):C>=1e3?Ps(i,m,C/1e3,p._getUIString("ScaleControl.Kilometers"),p):Ps(i,m,C,p._getUIString("ScaleControl.Meters"),p)}function Ps(p,i,c,m,y){const v=function(C){const A=Math.pow(10,`${Math.floor(C)}`.length-1);let R=C/A;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(R),A*R}(c),D=v/c;y._requestDomTask(()=>{p.style.width=i*D+"px",p.innerHTML=`${v}&nbsp;${m}`})}const Kd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),is={version:d.version,supported:At,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends fu{constructor(p){if(null!=(p=d.extend({},Xd,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new yh(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._renderTaskQueue=new Be,this._domRenderTaskQueue=new Be,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Ea,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new _u(0),this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof bc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new xc(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new iu("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new mu({customAttribution:p.customAttribution})),this._logoControl=new gu,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new d.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new d.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(p,i){if(void 0===i&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[i];return-1!==i.indexOf("bottom")?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){const[i,c]=this._containerDimensions();if(i===this.transform.width&&c===this.transform.height)return this;this._resizeCanvas(i,c),this.transform.resize(i,c),this.painter.resize(Math.ceil(i),Math.ceil(c));const m=!this._moving;return m&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),m&&this.fire(new d.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getProjection(){return this.transform.getProjection()}setProjection(p){this._lazyInitEmptyStyle(),"string"==typeof p&&(p={name:p}),this._runtimeProjection=p,this.style.updateProjection()}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(p,i,c){if("mouseenter"===p||"mouseover"===p){let m=!1;const y=D=>{const C=i.filter(R=>this.getLayer(R)),A=C.length?this.queryRenderedFeatures(D.point,{layers:C}):[];A.length?m||(m=!0,c.call(this,new Jn(p,this,D.originalEvent,{features:A}))):m=!1},v=()=>{m=!1};return{layers:new Set(i),listener:c,delegates:{mousemove:y,mouseout:v}}}if("mouseleave"===p||"mouseout"===p){let m=!1;const y=D=>{const C=i.filter(A=>this.getLayer(A));(C.length?this.queryRenderedFeatures(D.point,{layers:C}):[]).length?m=!0:m&&(m=!1,c.call(this,new Jn(p,this,D.originalEvent)))},v=D=>{m&&(m=!1,c.call(this,new Jn(p,this,D.originalEvent)))};return{layers:new Set(i),listener:c,delegates:{mousemove:y,mouseout:v}}}{const m=y=>{const v=i.filter(C=>this.getLayer(C)),D=v.length?this.queryRenderedFeatures(y.point,{layers:v}):[];D.length&&(y.features=D,c.call(this,y),delete y.features)};return{layers:new Set(i),listener:c,delegates:{[p]:m}}}}on(p,i,c){if(void 0===c)return super.on(p,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(p,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(p,i,c){if(void 0===c)return super.once(p,i);Array.isArray(i)||(i=[i]);const m=this._createDelegatedListener(p,i,c);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(p,i,c){if(void 0===c)return super.off(p,i);i=new Set(Array.isArray(i)?i:[i]);const m=(v,D)=>{if(v.size!==D.size)return!1;for(const C of v)if(!D.has(C))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(v=>{for(let D=0;D<v.length;D++){const C=v[D];if(C.listener===c&&m(C.layers,i)){for(const A in C.delegates)this.off(A,C.delegates[A]);return v.splice(D,1),this}}})(y),this}queryRenderedFeatures(p,i){return this.style?(void 0!==i||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(i=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(p,i){return this.style.querySourceFeatures(p,i)}queryTerrainElevation(p,i){const c=this.transform.elevation;return c?(i=d.extend({},{exaggerated:!0},i),c.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,i.exaggerated)):null}setStyle(p,i){return!1!==(i=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(null==i)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),p&&(this.style=new di(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new di(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,i){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),m=this._requestManager.transformRequest(c,d.ResourceType.Style);d.getJSON(m,(y,v)=>{y?this.fire(new d.ErrorEvent(y)):v&&this._updateDiff(v,i)})}else"object"==typeof p&&this._updateDiff(p,i)}_updateDiff(p,i){try{this.style.setState(p)&&this._update(!0)}catch(c){d.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")}addSource(p,i){return this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)}isSourceLoaded(p){const i=this.style&&this.style._getSourceCaches(p);if(0!==i.length)return i.every(c=>c.loaded());this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const i in p){const c=p[i]._tiles;for(const m in c){const y=c[m];if("loaded"!==y.state&&"errored"!==y.state)return!1}}return!0}addSourceType(p,i,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,i,{pixelRatio:c=1,sdf:m=!1,stretchX:y,stretchY:v,content:D}={}){if(this._lazyInitEmptyStyle(),i instanceof ai||co&&i instanceof co){const{width:C,height:A,data:R}=d.exported.getImageData(i);this.style.addImage(p,{data:new d.RGBAImage({width:C,height:A},R),pixelRatio:c,stretchX:y,stretchY:v,content:D,sdf:m,version:0})}else{if(void 0===i.width||void 0===i.height)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:C,height:A,data:R}=i,L=i;this.style.addImage(p,{data:new d.RGBAImage({width:C,height:A},new Uint8Array(R)),pixelRatio:c,stretchX:y,stretchY:v,content:D,sdf:m,version:0,userImage:L}),L.onAdd&&L.onAdd(this,p)}}}updateImage(p,i){const c=this.style.getImage(p);if(!c)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof ai||co&&i instanceof co?d.exported.getImageData(i):i,{width:y,height:v,data:D}=m;return void 0===y||void 0===v?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):y!==c.data.width||v!==c.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(D,!(i instanceof ai||co&&i instanceof co)),void this.style.updateImage(p,c))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(c,m)=>{i(c,m instanceof ai?d.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(p,i){return this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)}moveLayer(p,i){return this.style.moveLayer(p,i),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,i,c){return this.style.setLayerZoomRange(p,i,c),this._update(!0)}setFilter(p,i,c={}){return this.style.setFilter(p,i,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,i,c,m={}){return this.style.setPaintProperty(p,i,c,m),this._update(!0)}getPaintProperty(p,i){return this.style.getPaintProperty(p,i)}setLayoutProperty(p,i,c,m={}){return this.style.setLayoutProperty(p,i,c,m),this._update(!0)}getLayoutProperty(p,i){return this.style.getLayoutProperty(p,i)}setLight(p,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,i){return this.style.setFeatureState(p,i),this._update()}removeFeatureState(p,i){return this.style.removeFeatureState(p,i),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_containerDimensions(){let p=0,i=0;return this._container&&(p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300),[p,i]}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=De.create("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=De.create("div","mapboxgl-canvas-container",p);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=De.create("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);const m=this._controlContainer=De.create("div","mapboxgl-control-container",p),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{y[v]=De.create("div",`mapboxgl-ctrl-${v}`,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const c=d.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const p=d.extend({},At.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);i?(d.storeAuthState(i,!0),this.painter=new hc(i,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(i)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;const c=this.painter.context.extTimerQuery,m=d.exported.now();this.listens("gpu-timing-frame")&&(i=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,i));let y=this._updateAverageElevation(m);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;let v=!1;const D=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,R=this.transform.pitch,L=d.exported.now();this.style.zoomHistory.update(A,L);const F=new d.EvaluationParameters(A,{now:L,fadeDuration:D,pitch:R,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=F.crossFadingFactor();1===U&&U===this._crossFadingFactor||(v=!0,this._crossFadingFactor=U),this.style.update(F)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,D,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:D,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const A=d.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,i),setTimeout(()=>{const R=c.getQueryObjectEXT(i,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(i),this.fire(new d.Event("gpu-timing-frame",{cpuTime:A,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const R=this.painter.queryGpuTimers(A);this.fire(new d.Event("gpu-timing-layer",{layerTimes:R}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||y;if(C||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(y=this._updateAverageElevation(m,!0)),y)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const R=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,i=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();isNaN(y)?y=0:this._averageElevationLastSampledAt=p;const v=Math.abs(m-y);if(v>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const i=this.painter.context.gl;d.storeAuthState(i,!1),this._logoControl instanceof gu&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function y(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const D=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,D),D}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(y(p),i.canvasCopies.map(y),i.timeStamps)}_canvasPixelComparison(p,i,c){let m=c[1]-c[0];const y=p.length/4;for(let v=0;v<i.length;v++){const D=i[v];let C=0;for(let A=0;A<D.length;A+=4)D[A]===p[A]&&D[A+1]===p[A+1]&&D[A+2]===p[A+2]&&D[A+3]===p[A+3]&&(C+=1);m+=(c[v+2]-c[v+1])*(1-C/y)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.clearWorkerCaches(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),fl(this._canvasContainer),fl(this._controlContainer),fl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)}))}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,i){d.setCacheLimits(p,i)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},ml,p),this._container=De.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),De.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),De.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=De.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const p=this._map.getZoom(),i=p===this._map.getMaxZoom(),c=p===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const p=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=p)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Da(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){De.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,i){const c=De.create("button",p,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(p,i){const c=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({},Er,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=vh(this._updateMarkerRotation,20)}onAdd(p){var i;return this._map=p,this._container=De.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),i=this._setupUI,void 0!==Lr?i(Lr):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(c=>{Lr="denied"!==c.state,i(Lr)}):(Lr=!!d.window.navigator.geolocation,i(Lr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),De.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,gl=0,uo=!1}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),c=p.coords;return i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const i=new d.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,m=this._map.getBearing(),y=d.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map._container.getBoundingClientRect().height/2,i=this._map.unproject([0,p]),c=this._map.unproject([100,p]),m=i.distanceTo(c)/100,y=Math.ceil(2*this._accuracy/m);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&uo)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=De.create("button","mapboxgl-ctrl-geolocate",this._container),De.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=De.create("div","mapboxgl-user-location"),this._dotElement.appendChild(De.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(De.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new On({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=De.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new On({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":gl--,uo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),gl++,gl>1?(p={maximumAge:6e5,timeout:0},uo=!0):(p=this.options.positionOptions,uo=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&p()}).catch(console.error):p()}_clearWatch(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mu,ScaleControl:class{constructor(p){this.options=d.extend({},Vi,p),d.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){yu(this._map,this._container,this.options)}onAdd(p){return this._map=p,this._container=De.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){De.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(p){this.options.unit=p,yu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=De.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){De.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=De.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);De.create("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden",!0),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(Kd),p),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&De.remove(this._content),this._container&&(De.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const i=d.window.document.createDocumentFragment(),c=d.window.document.createElement("body");let m;for(c.innerHTML=p;m=c.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=De.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._container&&this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._container&&this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._container&&this._updateClassList(),i}_createCloseButton(){this.options.closeButton&&(this._closeButton=De.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(p){this._update(p.point)}_onMouseMove(p){this._update(p.point)}_onDrag(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._pos,c=this._container.offsetWidth,m=this._container.offsetHeight;let y;return y=i.y+p.bottom.y<m?["top"]:i.y>this._map.transform.height-m?["bottom"]:[],i.x<c/2?y.push("left"):i.x>this._map.transform.width-c/2&&y.push("right"),0===y.length?"bottom":y.join("-")}_updateClassList(){const p=[...this._classList];p.push("mapboxgl-popup"),this._anchor&&p.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&p.push("mapboxgl-popup-track-pointer"),this._container.className=p.join(" ")}_update(p){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=De.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=De.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$t(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p){const i=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),c=function(v){if(v||(v=new d.pointGeometry(0,0)),"number"==typeof v){const D=Math.round(Math.sqrt(.5*Math.pow(v,2)));return{center:new d.pointGeometry(0,0),top:new d.pointGeometry(0,v),"top-left":new d.pointGeometry(D,D),"top-right":new d.pointGeometry(-D,D),bottom:new d.pointGeometry(0,-v),"bottom-left":new d.pointGeometry(D,-D),"bottom-right":new d.pointGeometry(-D,-D),left:new d.pointGeometry(v,0),right:new d.pointGeometry(-v,0)}}if(v instanceof d.pointGeometry||Array.isArray(v)){const D=d.pointGeometry.convert(v);return{center:D,top:D,"top-left":D,"top-right":D,bottom:D,"bottom-left":D,"bottom-right":D,left:D,right:D}}return{center:d.pointGeometry.convert(v.center||[0,0]),top:d.pointGeometry.convert(v.top||[0,0]),"top-left":d.pointGeometry.convert(v["top-left"]||[0,0]),"top-right":d.pointGeometry.convert(v["top-right"]||[0,0]),bottom:d.pointGeometry.convert(v.bottom||[0,0]),"bottom-left":d.pointGeometry.convert(v["bottom-left"]||[0,0]),"bottom-right":d.pointGeometry.convert(v["bottom-right"]||[0,0]),left:d.pointGeometry.convert(v.left||[0,0]),right:d.pointGeometry.convert(v.right||[0,0])}}(this.options.offset),m=this._anchor=this._getAnchor(c),y=i.add(c[m]).round();this._map._requestDomTask(()=>{this._container&&m&&De.setTransform(this._container,`${As[m]} translate(${y.x}px,${y.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Yd);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._content&&(this._content.style.opacity=p),this._tip&&(this._tip.style.opacity=p)}},Marker:On,Style:di,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:gh,Evented:d.Evented,config:d.config,prewarm:function(){We().acquire(ce)},clearPrewarmedResources:function(){const p=Pe;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(ce),Pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return _e.workerCount},set workerCount(p){_e.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return is}),Ln}()},257:(xi,Nn)=>{Nn.encode=function(it){var Ln="";for(var at in it)it.hasOwnProperty(at)&&(Ln.length&&(Ln+="&"),Ln+=encodeURIComponent(at)+"="+encodeURIComponent(it[at]));return Ln},Nn.decode=function(it){for(var Ln={},at=it.split("&"),ln=0,d=at.length;ln<d;ln++){var At=at[ln].split("=");Ln[decodeURIComponent(At[0])]=decodeURIComponent(At[1])}return Ln}},884:xi=>{var Nn=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,it=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];xi.exports=function(d){var At=d,Bt=d.indexOf("["),Sn=d.indexOf("]");-1!=Bt&&-1!=Sn&&(d=d.substring(0,Bt)+d.substring(Bt,Sn).replace(/:/g,";")+d.substring(Sn,d.length));for(var Ie=Nn.exec(d||""),De={},nt=14;nt--;)De[it[nt]]=Ie[nt]||"";return-1!=Bt&&-1!=Sn&&(De.source=At,De.host=De.host.substring(1,De.host.length-1).replace(/;/g,":"),De.authority=De.authority.replace("[","").replace("]","").replace(/;/g,":"),De.ipv6uri=!0),De.pathNames=function Ln(ln,d){var Bt=d.replace(/\/{2,9}/g,"/").split("/");return("/"==d.substr(0,1)||0===d.length)&&Bt.splice(0,1),"/"==d.substr(d.length-1,1)&&Bt.splice(Bt.length-1,1),Bt}(0,De.path),De.queryKey=function at(ln,d){var At={};return d.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Bt,Sn,Ie){Sn&&(At[Sn]=Ie)}),At}(0,De.query),De}},379:xi=>{"use strict";var d,Nn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ln={},at=0,ln=0;function At(Ie){var De="";do{De=Nn[Ie%64]+De,Ie=Math.floor(Ie/64)}while(Ie>0);return De}function Sn(){var Ie=At(+new Date);return Ie!==d?(at=0,d=Ie):Ie+"."+At(at++)}for(;ln<64;ln++)Ln[Nn[ln]]=ln;Sn.encode=At,Sn.decode=function Bt(Ie){var De=0;for(ln=0;ln<Ie.length;ln++)De=64*De+Ln[Ie.charAt(ln)];return De},xi.exports=Sn}},xi=>{xi(xi.s=355)}]);